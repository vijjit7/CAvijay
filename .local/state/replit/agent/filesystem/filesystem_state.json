{"file_contents":{"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":711,"size_tokens":null},"client/src/components/ui/menubar.tsx":{"content":"import * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-9 items-center space-x-1 rounded-md border bg-background p-1 shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-4 w-4 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","path":null,"size_bytes":8608,"size_tokens":null},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-4 w-4 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","path":null,"size_bytes":7406,"size_tokens":null},"client/src/pages/saved.tsx":{"content":"import BottomNav from \"@/components/bottom-nav\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\nimport { Link } from \"wouter\";\n\nexport default function Saved() {\n  return (\n    <div className=\"min-h-screen bg-background pb-24\">\n      <div className=\"px-6 py-8\">\n        <h1 className=\"text-3xl font-serif font-bold text-foreground mb-2\">Saved Events</h1>\n        <p className=\"text-muted-foreground\">Your collection of upcoming food adventures.</p>\n      </div>\n\n      <div className=\"px-4 max-w-md mx-auto flex flex-col items-center justify-center py-12 text-center space-y-4\">\n        <div className=\"h-20 w-20 bg-secondary/50 rounded-full flex items-center justify-center mb-2\">\n            <AlertCircle className=\"h-10 w-10 text-primary/60\" />\n        </div>\n        <h3 className=\"text-xl font-bold text-foreground\">No saved events yet</h3>\n        <p className=\"text-muted-foreground max-w-[250px]\">\n          Tap the heart icon on events you like to save them for later.\n        </p>\n        <Link href=\"/\">\n          <Button className=\"mt-4\">Explore Events</Button>\n        </Link>\n      </div>\n\n      <BottomNav />\n    </div>\n  );\n}","path":null,"size_bytes":1245,"size_tokens":null},"client/src/pages/home.tsx":{"content":"import { useState } from \"react\";\nimport { EVENTS } from \"@/lib/mock-data\";\nimport EventCard from \"@/components/event-card\";\nimport BottomNav from \"@/components/bottom-nav\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Search, SlidersHorizontal } from \"lucide-react\";\nimport heroImage from \"@assets/generated_images/cozy_community_cooking_event_with_warm_lighting.png\";\n\nexport default function Home() {\n  const [activeFilter, setActiveFilter] = useState(\"All\");\n  const filters = [\"All\", \"Workshop\", \"Potluck\", \"Market\", \"Dinner\"];\n\n  const filteredEvents = activeFilter === \"All\" \n    ? EVENTS \n    : EVENTS.filter(e => e.type === activeFilter);\n\n  return (\n    <div className=\"min-h-screen bg-background pb-24\">\n      {/* Hero Section */}\n      <div className=\"relative h-[40vh] w-full overflow-hidden\">\n        <div className=\"absolute inset-0 bg-gradient-to-b from-black/30 to-black/60 z-10\" />\n        <img \n          src={heroImage} \n          alt=\"Community cooking\" \n          className=\"w-full h-full object-cover\"\n        />\n        <div className=\"absolute bottom-0 left-0 right-0 p-6 z-20 text-white\">\n          <span className=\"inline-block py-1 px-3 rounded-full bg-primary/90 text-xs font-bold uppercase tracking-wider mb-3 backdrop-blur-sm\">\n            Welcome Home\n          </span>\n          <h1 className=\"text-4xl md:text-5xl font-serif font-bold mb-2 leading-tight\">\n            What's cooking,<br />neighbor?\n          </h1>\n          <p className=\"text-white/90 text-lg font-light max-w-md\">\n            Discover local food events, workshops, and potlucks in your community.\n          </p>\n        </div>\n      </div>\n\n      {/* Search & Filter Section */}\n      <div className=\"sticky top-0 z-30 bg-background/95 backdrop-blur-md border-b border-border/50 shadow-sm\">\n        <div className=\"px-4 py-4 space-y-4 max-w-md mx-auto\">\n          <div className=\"flex gap-2\">\n            <div className=\"relative flex-1\">\n              <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground h-4 w-4\" />\n              <Input \n                placeholder=\"Search for sourdough, pasta...\" \n                className=\"pl-9 bg-secondary/50 border-transparent focus:bg-background transition-colors\"\n              />\n            </div>\n            <Button variant=\"outline\" size=\"icon\" className=\"shrink-0 border-border/50 bg-secondary/30\">\n              <SlidersHorizontal className=\"h-4 w-4\" />\n            </Button>\n          </div>\n          \n          <div className=\"flex gap-2 overflow-x-auto pb-2 no-scrollbar mask-gradient-right\">\n            {filters.map((filter) => (\n              <button\n                key={filter}\n                onClick={() => setActiveFilter(filter)}\n                className={`\n                  px-4 py-1.5 rounded-full text-sm font-medium whitespace-nowrap transition-all duration-300\n                  ${activeFilter === filter \n                    ? \"bg-primary text-primary-foreground shadow-md scale-105\" \n                    : \"bg-secondary/50 text-secondary-foreground hover:bg-secondary hover:text-secondary-foreground\"}\n                `}\n              >\n                {filter}\n              </button>\n            ))}\n          </div>\n        </div>\n      </div>\n\n      {/* Events Feed */}\n      <div className=\"px-4 py-6 max-w-md mx-auto space-y-6\">\n        <div className=\"flex items-center justify-between px-1\">\n          <h2 className=\"text-2xl font-serif font-bold text-foreground\">\n            Nearby Events\n          </h2>\n          <span className=\"text-sm text-muted-foreground\">\n            {filteredEvents.length} found\n          </span>\n        </div>\n        \n        <div className=\"grid gap-6\">\n          {filteredEvents.map((event) => (\n            <EventCard key={event.id} event={event} />\n          ))}\n        </div>\n      </div>\n\n      <BottomNav />\n    </div>\n  );\n}","path":null,"size_bytes":3938,"size_tokens":null},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","path":null,"size_bytes":329,"size_tokens":null},"client/src/lib/mock-data.ts":{"content":"export interface Event {\n  id: string;\n  title: string;\n  type: 'Workshop' | 'Potluck' | 'Market' | 'Dinner';\n  date: string;\n  time: string;\n  location: string;\n  price: number;\n  image: string;\n  description: string;\n  host: string;\n  attendees: number;\n}\n\nexport const EVENTS: Event[] = [\n  {\n    id: '1',\n    title: 'Sourdough for Beginners',\n    type: 'Workshop',\n    date: 'Sat, Dec 14',\n    time: '10:00 AM',\n    location: 'Community Center Kitchen',\n    price: 15,\n    image: 'https://images.unsplash.com/photo-1509440159596-0249088772ff?w=800&q=80',\n    description: 'Learn the ancient art of sourdough bread making. Starter included! Bring your own jar.',\n    host: 'Sarah J.',\n    attendees: 12\n  },\n  {\n    id: '2',\n    title: 'Sunday Neighborhood Potluck',\n    type: 'Potluck',\n    date: 'Sun, Dec 15',\n    time: '1:00 PM',\n    location: 'Greenwood Park Pavilion',\n    price: 0,\n    image: 'https://images.unsplash.com/photo-1511795409834-ef04bbd61622?w=800&q=80',\n    description: 'Bring a dish to share! Theme: Comfort Foods. Family friendly event.',\n    host: 'Greenwood Neighbors',\n    attendees: 34\n  },\n  {\n    id: '3',\n    title: 'Winter Farmers Market Tour',\n    type: 'Market',\n    date: 'Sat, Dec 21',\n    time: '9:00 AM',\n    location: 'Downtown Market Square',\n    price: 5,\n    image: 'https://images.unsplash.com/photo-1488459716781-31db52582fe9?w=800&q=80',\n    description: 'Guided tour of the best seasonal produce with recipe ideas for winter root vegetables.',\n    host: 'Chef Mario',\n    attendees: 8\n  },\n  {\n    id: '4',\n    title: 'Budget Meal Prep Class',\n    type: 'Workshop',\n    date: 'Wed, Dec 18',\n    time: '6:30 PM',\n    location: 'The Open Kitchen',\n    price: 10,\n    image: 'https://images.unsplash.com/photo-1498837167922-ddd27525d352?w=800&q=80',\n    description: 'Learn to prep 5 meals for under $30. Containers provided.',\n    host: 'Elena R.',\n    attendees: 20\n  },\n  {\n    id: '5',\n    title: 'Italian Family Dinner Night',\n    type: 'Dinner',\n    date: 'Fri, Dec 20',\n    time: '7:00 PM',\n    location: 'Maria\\'s Home',\n    price: 12,\n    image: 'https://images.unsplash.com/photo-1559339352-11d035aa65de?w=800&q=80',\n    description: 'Authentic pasta night. Cost covers ingredients. BYOB.',\n    host: 'Maria C.',\n    attendees: 6\n  }\n];","path":null,"size_bytes":2292,"size_tokens":null},"client/src/index.css":{"content":"@import \"tailwindcss\";\n@import \"tw-animate-css\";\n\n@custom-variant dark (&:is(.dark *));\n\n@theme inline {\n  --radius-sm: calc(var(--radius) - 4px);\n  --radius-md: calc(var(--radius) - 2px);\n  --radius-lg: var(--radius);\n  --radius-xl: calc(var(--radius) + 4px);\n  \n  --color-background: hsl(var(--background));\n  --color-foreground: hsl(var(--foreground));\n  \n  --color-card: hsl(var(--card));\n  --color-card-foreground: hsl(var(--card-foreground));\n  \n  --color-popover: hsl(var(--popover));\n  --color-popover-foreground: hsl(var(--popover-foreground));\n  \n  --color-primary: hsl(var(--primary));\n  --color-primary-foreground: hsl(var(--primary-foreground));\n  \n  --color-secondary: hsl(var(--secondary));\n  --color-secondary-foreground: hsl(var(--secondary-foreground));\n  \n  --color-muted: hsl(var(--muted));\n  --color-muted-foreground: hsl(var(--muted-foreground));\n  \n  --color-accent: hsl(var(--accent));\n  --color-accent-foreground: hsl(var(--accent-foreground));\n  \n  --color-destructive: hsl(var(--destructive));\n  --color-destructive-foreground: hsl(var(--destructive-foreground));\n  \n  --color-border: hsl(var(--border));\n  --color-input: hsl(var(--input));\n  --color-ring: hsl(var(--ring));\n  \n  --font-sans: 'Plus Jakarta Sans', sans-serif;\n  --font-mono: 'JetBrains Mono', monospace;\n}\n\n/* PROFESSIONAL AUDIT THEME - Clean, Trustworthy, Data-Focused */\n:root {\n  /* Slate/Blue-Grey Base */\n  --background: 210 20% 98%; /* Very light cool grey */\n  --foreground: 222 47% 11%; /* Deep Navy */\n\n  /* White Surface with slight blue tint */\n  --card: 0 0% 100%;\n  --card-foreground: 222 47% 11%;\n\n  --popover: 0 0% 100%;\n  --popover-foreground: 222 47% 11%;\n\n  /* Corporate Blue Primary */\n  --primary: 221 83% 53%; /* Vivid Blue */\n  --primary-foreground: 210 40% 98%;\n\n  /* Cool Grey Secondary */\n  --secondary: 210 40% 96.1%;\n  --secondary-foreground: 222 47% 11.2%;\n\n  /* Subtle Muted Tones */\n  --muted: 210 40% 96.1%;\n  --muted-foreground: 215 16% 47%;\n\n  --accent: 210 40% 96.1%;\n  --accent-foreground: 222 47% 11.2%;\n\n  /* Alert Red */\n  --destructive: 0 84.2% 60.2%;\n  --destructive-foreground: 210 40% 98%;\n\n  /* Borders */\n  --border: 214.3 31.8% 91.4%;\n  --input: 214.3 31.8% 91.4%;\n  --ring: 221 83% 53%;\n\n  --radius: 0.5rem;\n}\n\n.dark {\n  --background: 222 47% 11%;\n  --foreground: 210 40% 98%;\n\n  --card: 222 47% 11%;\n  --card-foreground: 210 40% 98%;\n\n  --popover: 222 47% 11%;\n  --popover-foreground: 210 40% 98%;\n\n  --primary: 217 91% 60%;\n  --primary-foreground: 222 47% 11%;\n\n  --secondary: 217 32% 17%;\n  --secondary-foreground: 210 40% 98%;\n\n  --muted: 217 32% 17%;\n  --muted-foreground: 215 20% 65%;\n\n  --accent: 217 32% 17%;\n  --accent-foreground: 210 40% 98%;\n\n  --destructive: 0 62.8% 30.6%;\n  --destructive-foreground: 210 40% 98%;\n\n  --border: 217 32% 17%;\n  --input: 217 32% 17%;\n  --ring: 224 76% 48%;\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n}\n","path":null,"size_bytes":2971,"size_tokens":null},"server/vite.ts":{"content":"import { type Express } from \"express\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport async function setupVite(server: Server, app: Express) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server, path: \"/vite-hmr\" },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n","path":null,"size_bytes":1534,"size_tokens":null},"client/src/components/ui/item.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Separator } from \"@/components/ui/separator\"\n\nfunction ItemGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      role=\"list\"\n      data-slot=\"item-group\"\n      className={cn(\"group/item-group flex flex-col\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction ItemSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"item-separator\"\n      orientation=\"horizontal\"\n      className={cn(\"my-0\", className)}\n      {...props}\n    />\n  )\n}\n\nconst itemVariants = cva(\n  \"group/item [a]:hover:bg-accent/50 focus-visible:border-ring focus-visible:ring-ring/50 [a]:transition-colors flex flex-wrap items-center rounded-md border border-transparent text-sm outline-none transition-colors duration-100 focus-visible:ring-[3px]\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline: \"border-border\",\n        muted: \"bg-muted/50\",\n      },\n      size: {\n        default: \"gap-4 p-4 \",\n        sm: \"gap-2.5 px-4 py-3\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction Item({\n  className,\n  variant = \"default\",\n  size = \"default\",\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> &\n  VariantProps<typeof itemVariants> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n  return (\n    <Comp\n      data-slot=\"item\"\n      data-variant={variant}\n      data-size={size}\n      className={cn(itemVariants({ variant, size, className }))}\n      {...props}\n    />\n  )\n}\n\nconst itemMediaVariants = cva(\n  \"flex shrink-0 items-center justify-center gap-2 group-has-[[data-slot=item-description]]/item:translate-y-0.5 group-has-[[data-slot=item-description]]/item:self-start [&_svg]:pointer-events-none\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        icon: \"bg-muted size-8 rounded-sm border [&_svg:not([class*='size-'])]:size-4\",\n        image:\n          \"size-10 overflow-hidden rounded-sm [&_img]:size-full [&_img]:object-cover\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nfunction ItemMedia({\n  className,\n  variant = \"default\",\n  ...props\n}: React.ComponentProps<\"div\"> & VariantProps<typeof itemMediaVariants>) {\n  return (\n    <div\n      data-slot=\"item-media\"\n      data-variant={variant}\n      className={cn(itemMediaVariants({ variant, className }))}\n      {...props}\n    />\n  )\n}\n\nfunction ItemContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"item-content\"\n      className={cn(\n        \"flex flex-1 flex-col gap-1 [&+[data-slot=item-content]]:flex-none\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction ItemTitle({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"item-title\"\n      className={cn(\n        \"flex w-fit items-center gap-2 text-sm font-medium leading-snug\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction ItemDescription({ className, ...props }: React.ComponentProps<\"p\">) {\n  return (\n    <p\n      data-slot=\"item-description\"\n      className={cn(\n        \"text-muted-foreground line-clamp-2 text-balance text-sm font-normal leading-normal\",\n        \"[&>a:hover]:text-primary [&>a]:underline [&>a]:underline-offset-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction ItemActions({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"item-actions\"\n      className={cn(\"flex items-center gap-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction ItemHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"item-header\"\n      className={cn(\n        \"flex basis-full items-center justify-between gap-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction ItemFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"item-footer\"\n      className={cn(\n        \"flex basis-full items-center justify-between gap-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Item,\n  ItemMedia,\n  ItemContent,\n  ItemActions,\n  ItemGroup,\n  ItemSeparator,\n  ItemTitle,\n  ItemDescription,\n  ItemHeader,\n  ItemFooter,\n}\n","path":null,"size_bytes":4494,"size_tokens":null},"server/storage.ts":{"content":"import { type User, type InsertUser, type Report, type InsertReport, type MisEntry, type InsertMisEntry, users, reports, misEntries } from \"@shared/schema\";\nimport { db } from \"./db\";\nimport { eq, and, sql, desc } from \"drizzle-orm\";\n\nexport interface IStorage {\n  getUserByUsername(username: string): Promise<User | undefined>;\n  getUserById(id: string): Promise<User | undefined>;\n  createUser(user: InsertUser): Promise<User>;\n  deleteUser(id: string): Promise<boolean>;\n  createReport(report: InsertReport & { id: string }): Promise<Report>;\n  getReports(filters?: { \n    associateId?: string; \n    status?: string; \n    month?: string; \n    year?: string;\n  }): Promise<Report[]>;\n  getReportById(id: string): Promise<Report | undefined>;\n  getReportByLeadIdAndDate(leadId: string, date: string): Promise<Report | undefined>;\n  deleteReport(id: string): Promise<boolean>;\n  updateReportTAT(id: string, tat: any): Promise<Report | undefined>;\n  updateReportScores(id: string, scores: any): Promise<Report | undefined>;\n  getAssociates(): Promise<User[]>;\n  getDashboardStats(month?: string, year?: string): Promise<{\n    totalReports: number;\n    avgScore: number;\n    associates: Array<{\n      id: string;\n      name: string;\n      avatar: string;\n      reportCount: number;\n      avgScore: number;\n    }>;\n  }>;\n  // MIS methods - centralized\n  getMisEntries(associateId?: string): Promise<MisEntry[]>;\n  createMisEntry(entry: InsertMisEntry): Promise<MisEntry>;\n  createMisEntriesBulk(entries: InsertMisEntry[]): Promise<MisEntry[]>;\n  updateMisEntry(id: number, entry: Partial<InsertMisEntry>): Promise<MisEntry | undefined>;\n  deleteMisEntry(id: number): Promise<boolean>;\n  getNextMisSno(associateId?: string): Promise<number>;\n  getMisEntryByLeadId(leadId: string): Promise<MisEntry | undefined>;\n}\n\nexport class PostgresStorage implements IStorage {\n  async getUserByUsername(username: string): Promise<User | undefined> {\n    const result = await db.select().from(users).where(eq(users.username, username)).limit(1);\n    return result[0];\n  }\n\n  async getUserById(id: string): Promise<User | undefined> {\n    const result = await db.select().from(users).where(eq(users.id, id)).limit(1);\n    return result[0];\n  }\n\n  async createUser(user: InsertUser): Promise<User> {\n    const result = await db.insert(users).values(user).returning();\n    return result[0];\n  }\n\n  async deleteUser(id: string): Promise<boolean> {\n    const result = await db.delete(users).where(eq(users.id, id));\n    return (result.rowCount ?? 0) > 0;\n  }\n\n  async createReport(insertReport: InsertReport & { id: string }): Promise<Report> {\n    const result = await db.insert(reports).values(insertReport).returning();\n    return result[0];\n  }\n\n  async getReports(filters?: { \n    associateId?: string; \n    status?: string; \n    month?: string; \n    year?: string;\n  }): Promise<Report[]> {\n    const conditions = [];\n    \n    if (filters?.associateId) {\n      conditions.push(eq(reports.associateId, filters.associateId));\n    }\n    \n    if (filters?.status) {\n      conditions.push(eq(reports.status, filters.status));\n    }\n    \n    if (filters?.month && filters?.year) {\n      const monthStr = filters.month.padStart(2, '0');\n      const yearStr = filters.year;\n      const datePrefix = `${yearStr}-${monthStr}`;\n      conditions.push(sql`${reports.date} LIKE ${datePrefix + '%'}`);\n    }\n    \n    if (conditions.length === 0) {\n      return await db.select().from(reports).orderBy(sql`${reports.createdAt} DESC`);\n    }\n    \n    return await db.select().from(reports).where(and(...conditions)).orderBy(sql`${reports.createdAt} DESC`);\n  }\n\n  async getReportById(id: string): Promise<Report | undefined> {\n    const result = await db.select().from(reports).where(eq(reports.id, id)).limit(1);\n    return result[0];\n  }\n\n  async getReportByLeadIdAndDate(leadId: string, date: string): Promise<Report | undefined> {\n    const result = await db.select().from(reports)\n      .where(and(eq(reports.leadId, leadId), eq(reports.date, date)))\n      .limit(1);\n    return result[0];\n  }\n\n  async deleteReport(id: string): Promise<boolean> {\n    const result = await db.delete(reports).where(eq(reports.id, id));\n    return (result.rowCount ?? 0) > 0;\n  }\n\n  async updateReportTAT(id: string, tat: any): Promise<Report | undefined> {\n    const result = await db.update(reports)\n      .set({ tat })\n      .where(eq(reports.id, id))\n      .returning();\n    return result[0];\n  }\n\n  async updateReportScores(id: string, scores: any): Promise<Report | undefined> {\n    const result = await db.update(reports)\n      .set({ scores })\n      .where(eq(reports.id, id))\n      .returning();\n    return result[0];\n  }\n\n  async getAssociates(): Promise<User[]> {\n    return await db.select().from(users).where(sql`${users.id} != 'ADMIN'`);\n  }\n\n  async getDashboardStats(month?: string, year?: string): Promise<{\n    totalReports: number;\n    avgScore: number;\n    associates: Array<{\n      id: string;\n      name: string;\n      avatar: string;\n      reportCount: number;\n      avgScore: number;\n    }>;\n  }> {\n    const conditions = [];\n    \n    if (month && year) {\n      const monthStr = month.padStart(2, '0');\n      const yearStr = year;\n      const datePrefix = `${yearStr}-${monthStr}`;\n      conditions.push(sql`${reports.date} LIKE ${datePrefix + '%'}`);\n    }\n    \n    const filteredReports = conditions.length > 0\n      ? await db.select().from(reports).where(and(...conditions))\n      : await db.select().from(reports);\n    \n    const allUsers = await this.getAssociates();\n    \n    const totalReports = filteredReports.length;\n    \n    const totalScore = filteredReports.reduce((sum, report) => {\n      const scores = report.scores as any;\n      return sum + (scores?.overall || 0);\n    }, 0);\n    \n    const avgScore = totalReports > 0 ? totalScore / totalReports : 0;\n    \n    const associateStats = allUsers.map(user => {\n      const userReports = filteredReports.filter(r => r.associateId === user.id);\n      const reportCount = userReports.length;\n      \n      const userTotalScore = userReports.reduce((sum, report) => {\n        const scores = report.scores as any;\n        return sum + (scores?.overall || 0);\n      }, 0);\n      \n      const avgUserScore = reportCount > 0 ? userTotalScore / reportCount : 0;\n      \n      return {\n        id: user.id,\n        name: user.name,\n        avatar: user.avatar,\n        reportCount,\n        avgScore: avgUserScore,\n      };\n    });\n    \n    return {\n      totalReports,\n      avgScore,\n      associates: associateStats,\n    };\n  }\n\n  // MIS methods - centralized MIS for all associates\n  async getMisEntries(associateId?: string): Promise<MisEntry[]> {\n    // Return all entries (centralized MIS)\n    return await db.select().from(misEntries)\n      .orderBy(desc(misEntries.sno));\n  }\n\n  async createMisEntry(entry: InsertMisEntry): Promise<MisEntry> {\n    const result = await db.insert(misEntries).values(entry).returning();\n    return result[0];\n  }\n\n  async createMisEntriesBulk(entries: InsertMisEntry[]): Promise<MisEntry[]> {\n    if (entries.length === 0) return [];\n    const result = await db.insert(misEntries).values(entries).returning();\n    return result;\n  }\n\n  async updateMisEntry(id: number, entry: Partial<InsertMisEntry>): Promise<MisEntry | undefined> {\n    const result = await db.update(misEntries)\n      .set(entry)\n      .where(eq(misEntries.id, id))\n      .returning();\n    return result[0];\n  }\n\n  async deleteMisEntry(id: number): Promise<boolean> {\n    const result = await db.delete(misEntries).where(eq(misEntries.id, id));\n    return (result.rowCount ?? 0) > 0;\n  }\n\n  async getNextMisSno(associateId?: string): Promise<number> {\n    // Global SNO across all entries (centralized MIS)\n    const result = await db.select({ maxSno: sql<number>`COALESCE(MAX(${misEntries.sno}), 0)` })\n      .from(misEntries);\n    return (result[0]?.maxSno ?? 0) + 1;\n  }\n  \n  async getMisEntryByLeadId(leadId: string): Promise<MisEntry | undefined> {\n    const result = await db.select().from(misEntries)\n      .where(eq(misEntries.leadId, leadId))\n      .limit(1);\n    return result[0];\n  }\n}\n\nexport const storage = new PostgresStorage();\n","path":null,"size_bytes":8184,"size_tokens":null},"client/src/components/ui/hover-card.tsx":{"content":"import * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","path":null,"size_bytes":1237,"size_tokens":null},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","path":null,"size_bytes":140,"size_tokens":null},"client/src/components/bottom-nav.tsx":{"content":"import { Link, useLocation } from \"wouter\";\nimport { Home, Calendar, Heart, User } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\n\nexport default function BottomNav() {\n  const [location] = useLocation();\n\n  const navItems = [\n    { icon: Home, label: \"Explore\", path: \"/\" },\n    { icon: Calendar, label: \"Events\", path: \"/events\" },\n    { icon: Heart, label: \"Saved\", path: \"/saved\" },\n    { icon: User, label: \"Profile\", path: \"/profile\" },\n  ];\n\n  return (\n    <div className=\"fixed bottom-0 left-0 right-0 bg-background/80 backdrop-blur-lg border-t border-border/50 z-50 pb-safe\">\n      <div className=\"flex justify-around items-center h-16 max-w-md mx-auto\">\n        {navItems.map((item) => {\n          const isActive = location === item.path;\n          return (\n            <Link key={item.path} href={item.path}>\n              <div\n                className={cn(\n                  \"flex flex-col items-center justify-center w-16 space-y-1 transition-colors duration-200 cursor-pointer\",\n                  isActive\n                    ? \"text-primary\"\n                    : \"text-muted-foreground hover:text-foreground\"\n                )}\n              >\n                <item.icon\n                  size={24}\n                  strokeWidth={isActive ? 2.5 : 2}\n                  className=\"transition-all\"\n                />\n                <span className=\"text-[10px] font-medium\">{item.label}</span>\n              </div>\n            </Link>\n          );\n        })}\n      </div>\n    </div>\n  );\n}","path":null,"size_bytes":1513,"size_tokens":null},"replit.md":{"content":"# AuditGuard - Compliance Intelligence Platform\n\n## Overview\n\nAuditGuard is an AI-powered audit comparison and scoring platform designed for compliance management. The application enables organizations to track field audit reports, score associate performance, validate audit decisions with AI, and compare reports across different auditors. It features role-based dashboards for administrators and field associates, with comprehensive metrics around report completeness, quality, and risk analysis.\n\n## User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n## System Architecture\n\n### Frontend Architecture\n- **Framework**: React 18 with TypeScript\n- **Routing**: Wouter (lightweight React router)\n- **State Management**: TanStack React Query for server state, React Context for local state (AuthContext, AuditContext)\n- **UI Components**: shadcn/ui component library built on Radix UI primitives\n- **Styling**: Tailwind CSS v4 with CSS variables for theming\n- **Charts**: Recharts for data visualization\n- **Build Tool**: Vite with custom plugins for Replit integration\n\n### Backend Architecture\n- **Runtime**: Node.js with Express\n- **Language**: TypeScript (ESM modules)\n- **Session Management**: express-session with cookie-based auth\n- **API Pattern**: RESTful JSON APIs under `/api/*` prefix\n- **Development**: Vite dev server proxied through Express for HMR\n\n### Data Layer\n- **ORM**: Drizzle ORM with PostgreSQL dialect\n- **Schema Location**: `shared/schema.ts` (shared between frontend and backend)\n- **Validation**: Zod schemas generated via drizzle-zod\n- **Database**: PostgreSQL (requires DATABASE_URL environment variable)\n\n### Key Design Patterns\n- **Monorepo Structure**: Client code in `client/`, server in `server/`, shared types in `shared/`\n- **Path Aliases**: `@/*` maps to client/src, `@shared/*` maps to shared folder\n- **Role-Based Access**: Admin users see aggregate dashboards, associates see personal performance\n- **Report Scoring**: Multi-dimensional scoring (completeness, comprehensive, quality, overall) with AI validation of decisions\n\n### Data Models\n- **Users**: Associates with id, username, password, name, role, avatar\n- **Reports**: Audit reports with metrics (field counts, photo validation, risk depth), scores, and AI-validated decisions\n\n## External Dependencies\n\n### Database\n- PostgreSQL database (connection via DATABASE_URL environment variable)\n- Drizzle Kit for schema migrations (`npm run db:push`)\n\n### UI/Component Libraries\n- Radix UI primitives (dialog, dropdown, tabs, etc.)\n- shadcn/ui component system\n- Lucide React icons\n- Recharts for charts\n\n### Development Tools\n- Vite with React plugin\n- Tailwind CSS v4 with @tailwindcss/vite\n- Replit-specific plugins (runtime error overlay, cartographer, dev banner)\n\n### Session/Auth\n- express-session for session management\n- Cookie-based authentication (no external auth provider)\n\n### Deterministic Scoring System\n- **Method**: Rule-based scoring using ApplicantSchema interface (no AI dependency)\n- **Implementation**: `server/deterministic-scoring.ts` with `mapDraftToApplicant` and `scoreApplicant` functions\n- **Total Points**: 100 (achievable only when ALL rubric items are satisfied)\n\n**Scoring Categories (Excel Rubric Weights)**:\n- Personal: 15pts (10 items at 1.5pts each)\n- Business: 30pts (15 items at 2pts each, including sourceOfBusiness and comfortableEmi)\n- Banking: 15pts (5 items at 3pts each)\n- Networth: 10pts (4 items at 2.5pts each)\n- Existing Debt: 10pts (4 items at 2.5pts each)\n- End Use: 10pts (3 items totaling 10pts)\n- Reference Checks: 10pts (3 items totaling 10pts)\n\n**Field-to-Rubric Mapping** (all from independent data sources):\n- Business: businessName, majorServices (nature), businessProfile (activity), strategicVision, promoterExperience, sourceOfBusiness, clientListConcentrationRisk, each from distinct form fields\n- Debt: existingLoans (boolean|null - only awards points when explicitly documented), canServiceNewLoan scored in Business as comfortableEmi\n- Personal: residenceOwned and monthlyRent are mutually exclusive (owned OR rented with documented rent)\n\n**Key Principles**:\n- No double counting: Each rubric item maps to exactly one data source\n- Explicit documentation required: Missing/unknown values don't award points\n- Deterministic: Same input always produces same score\n\n**Full Coverage Matrix**: See `docs/SCORING_COVERAGE_MATRIX.md` for complete rubric-to-field mapping\n\n## Recent Changes (December 2025)\n\n### 100% Rubric Coverage Implementation\nExtended the LIPDraftReport interface and form UI to support all 44+ rubric parameters:\n\n**New Personal Fields**: selfEducation, spouseEducation, spouseEmployment, kidsEducation, kidsSchool, spouseName\n**New Business Fields**: strategicVision, promoterExperience, clientListConcentrationRisk, seasonality, employeeCount, monthlyTurnover, majorClients, growthPlans\n**New Banking Section**: bankName, turnoverCreditPercent, bankingTenure, emisRouted, qrCodeSpotted\n**New Debt Section**: existingLoans, loanList, repaymentHistory\n**New Property Fields**: propertiesOwned, vehiclesOwned, otherInvestments\n**New End Use Fields**: agreementValue, advancePaid\n**New Reference Fields**: invoiceVerified\n\n### Scoring Logic Updates\n- `deterministic-scoring.ts` now extracts values from nested draft locations using fallbacks (e.g., `draft.businessDetails?.comfortableEmi`)\n- comfortableEmi scoring uses `debt.canServiceNewLoan` which maps to `draft.businessDetails.comfortableEmi`\n- All new fields are properly initialized with empty strings in the default draft object","path":null,"size_bytes":5588,"size_tokens":null},"vite-plugin-meta-images.ts":{"content":"import type { Plugin } from 'vite';\nimport fs from 'fs';\nimport path from 'path';\n\n/**\n * Vite plugin that updates og:image and twitter:image meta tags\n * to point to the app's opengraph image with the correct Replit domain.\n */\nexport function metaImagesPlugin(): Plugin {\n  return {\n    name: 'vite-plugin-meta-images',\n    transformIndexHtml(html) {\n      const baseUrl = getDeploymentUrl();\n      if (!baseUrl) {\n        log('[meta-images] no Replit deployment domain found, skipping meta tag updates');\n        return html;\n      }\n\n      // Check if opengraph image exists in public directory\n      const publicDir = path.resolve(process.cwd(), 'client', 'public');\n      const opengraphPngPath = path.join(publicDir, 'opengraph.png');\n      const opengraphJpgPath = path.join(publicDir, 'opengraph.jpg');\n      const opengraphJpegPath = path.join(publicDir, 'opengraph.jpeg');\n\n      let imageExt: string | null = null;\n      if (fs.existsSync(opengraphPngPath)) {\n        imageExt = 'png';\n      } else if (fs.existsSync(opengraphJpgPath)) {\n        imageExt = 'jpg';\n      } else if (fs.existsSync(opengraphJpegPath)) {\n        imageExt = 'jpeg';\n      }\n\n      if (!imageExt) {\n        log('[meta-images] OpenGraph image not found, skipping meta tag updates');\n        return html;\n      }\n\n      const imageUrl = `${baseUrl}/opengraph.${imageExt}`;\n\n      log('[meta-images] updating meta image tags to:', imageUrl);\n\n      html = html.replace(\n        /<meta\\s+property=\"og:image\"\\s+content=\"[^\"]*\"\\s*\\/>/g,\n        `<meta property=\"og:image\" content=\"${imageUrl}\" />`\n      );\n\n      html = html.replace(\n        /<meta\\s+name=\"twitter:image\"\\s+content=\"[^\"]*\"\\s*\\/>/g,\n        `<meta name=\"twitter:image\" content=\"${imageUrl}\" />`\n      );\n\n      return html;\n    },\n  };\n}\n\nfunction getDeploymentUrl(): string | null {\n  if (process.env.REPLIT_INTERNAL_APP_DOMAIN) {\n    const url = `https://${process.env.REPLIT_INTERNAL_APP_DOMAIN}`;\n    log('[meta-images] using internal app domain:', url);\n    return url;\n  }\n\n  if (process.env.REPLIT_DEV_DOMAIN) {\n    const url = `https://${process.env.REPLIT_DEV_DOMAIN}`;\n    log('[meta-images] using dev domain:', url);\n    return url;\n  }\n\n  return null;\n}\n\nfunction log(...args: any[]): void {\n  if (process.env.NODE_ENV === 'production') {\n    console.log(...args);\n  }\n}\n","path":null,"size_bytes":2333,"size_tokens":null},"client/src/components/layout/audit-layout.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Link, useLocation } from \"wouter\";\nimport { \n  LayoutDashboard, \n  FileText, \n  Users, \n  BarChart3, \n  Settings, \n  Search,\n  Bell,\n  LogOut,\n  Menu,\n  Upload,\n  ClipboardList,\n  FilePlus\n} from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { \n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Sheet, SheetContent, SheetTrigger } from \"@/components/ui/sheet\";\nimport { useAuth } from \"@/lib/auth\";\n\ninterface AuditLayoutProps {\n  children: React.ReactNode;\n}\n\nexport default function AuditLayout({ children }: AuditLayoutProps) {\n  const [location] = useLocation();\n  const [isMobileOpen, setIsMobileOpen] = useState(false);\n  const { user, logout } = useAuth();\n\n  // Redirect to login if not authenticated\n  useEffect(() => {\n    if (!user) {\n      // In a real app we'd redirect here, but for this mock we'll handle it in App.tsx\n      // or just render null/loading\n    }\n  }, [user]);\n\n  if (!user) return null;\n\n  const adminNavItems = [\n    { icon: LayoutDashboard, label: \"Dashboard\", path: \"/\" },\n    { icon: FileText, label: \"Reports\", path: \"/reports\" },\n    { icon: Users, label: \"Associates\", path: \"/associates\" },\n    { icon: BarChart3, label: \"MIS Dashboard\", path: \"/mis-dashboard\" },\n  ];\n\n  const associateNavItems = [\n    { icon: ClipboardList, label: \"MIS\", path: \"/mis\" },\n    { icon: FilePlus, label: \"Create Report\", path: \"/create-report\" },\n    { icon: Upload, label: \"Upload Reports\", path: \"/upload\" },\n    { icon: FileText, label: \"My Reports\", path: \"/reports\" },\n  ];\n\n  const navItems = user.isAdmin ? adminNavItems : associateNavItems;\n\n  const SidebarContent = () => (\n    <div className=\"flex flex-col h-full bg-slate-900 text-slate-300\">\n      <div className=\"p-6\">\n        <div className=\"flex items-center gap-2 font-bold text-xl text-white\">\n          <div className=\"h-8 w-8 rounded-lg bg-blue-600 flex items-center justify-center\">\n            <BarChart3 className=\"h-5 w-5 text-white\" />\n          </div>\n          AuditGuard\n        </div>\n      </div>\n\n      <div className=\"flex-1 px-4 space-y-2\">\n        <div className=\"text-xs font-semibold uppercase tracking-wider text-slate-500 mb-4 px-2\">Platform</div>\n        {navItems.map((item) => {\n          const isActive = location === item.path;\n          return (\n            <Link key={item.path} href={item.path}>\n              <div\n                className={`\n                  flex items-center gap-3 px-3 py-2.5 rounded-md text-sm font-medium transition-colors cursor-pointer\n                  ${isActive \n                    ? \"bg-blue-600 text-white shadow-lg shadow-blue-900/20\" \n                    : \"hover:bg-slate-800 hover:text-white\"}\n                `}\n              >\n                <item.icon size={18} />\n                {item.label}\n              </div>\n            </Link>\n          );\n        })}\n\n        <div className=\"text-xs font-semibold uppercase tracking-wider text-slate-500 mt-8 mb-4 px-2\">Settings</div>\n        <Link href=\"/settings\">\n          <div className=\"flex items-center gap-3 px-3 py-2.5 rounded-md text-sm font-medium hover:bg-slate-800 hover:text-white transition-colors cursor-pointer\">\n            <Settings size={18} />\n            Configuration\n          </div>\n        </Link>\n      </div>\n\n      <div className=\"p-4 border-t border-slate-800\">\n        <div className=\"flex items-center gap-3 px-2\">\n          <Avatar className=\"h-8 w-8 border border-slate-700\">\n            <AvatarImage src={user.avatar} />\n            <AvatarFallback>{user.name[0]}</AvatarFallback>\n          </Avatar>\n          <div className=\"flex-1 min-w-0\">\n            <p className=\"text-sm font-medium text-white truncate\">{user.name}</p>\n            <p className=\"text-xs text-slate-500 truncate\">{user.role}</p>\n          </div>\n          <LogOut size={16} className=\"text-slate-500 hover:text-white cursor-pointer\" onClick={logout} />\n        </div>\n      </div>\n    </div>\n  );\n\n  return (\n    <div className=\"flex min-h-screen bg-slate-50\">\n      {/* Desktop Sidebar */}\n      <aside className=\"hidden md:block w-64 fixed inset-y-0 left-0 z-50\">\n        <SidebarContent />\n      </aside>\n\n      {/* Mobile Sidebar */}\n      <Sheet open={isMobileOpen} onOpenChange={setIsMobileOpen}>\n        <SheetContent side=\"left\" className=\"p-0 w-64 border-r-slate-800 bg-slate-900\">\n          <SidebarContent />\n        </SheetContent>\n      </Sheet>\n\n      {/* Main Content */}\n      <main className=\"flex-1 md:ml-64 flex flex-col min-h-0 overflow-hidden\">\n        {/* Header */}\n        <header className=\"h-16 bg-white border-b border-slate-200 flex items-center justify-between px-4 md:px-8 sticky top-0 z-40\">\n          <div className=\"flex items-center gap-4\">\n            <Button variant=\"ghost\" size=\"icon\" className=\"md:hidden\" onClick={() => setIsMobileOpen(true)}>\n              <Menu className=\"h-5 w-5\" />\n            </Button>\n            <div className=\"relative hidden md:block w-96\">\n              <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 h-4 w-4\" />\n              <Input \n                placeholder=\"Search reports, associates, or keywords...\" \n                className=\"pl-9 bg-slate-50 border-slate-200 focus-visible:ring-blue-500\"\n              />\n            </div>\n          </div>\n\n          <div className=\"flex items-center gap-4\">\n            <Button variant=\"ghost\" size=\"icon\" className=\"text-slate-500 hover:text-slate-700 relative\">\n              <Bell className=\"h-5 w-5\" />\n              <span className=\"absolute top-2 right-2 h-2 w-2 bg-red-500 rounded-full border-2 border-white\"></span>\n            </Button>\n            <div className=\"h-8 w-px bg-slate-200 mx-1\"></div>\n            <DropdownMenu>\n              <DropdownMenuTrigger asChild>\n                <Button variant=\"outline\" className=\"gap-2\">\n                  <span>Export</span>\n                </Button>\n              </DropdownMenuTrigger>\n              <DropdownMenuContent align=\"end\">\n                <DropdownMenuLabel>Export Data</DropdownMenuLabel>\n                <DropdownMenuSeparator />\n                <DropdownMenuItem>Export as CSV</DropdownMenuItem>\n                <DropdownMenuItem>Export as PDF</DropdownMenuItem>\n              </DropdownMenuContent>\n            </DropdownMenu>\n          </div>\n        </header>\n\n        {/* Page Content */}\n        <div className=\"flex-1 overflow-auto p-4 md:p-8\">\n          {children}\n        </div>\n      </main>\n    </div>\n  );\n}","path":null,"size_bytes":6772,"size_tokens":null},"client/src/components/ui/drawer.tsx":{"content":"import * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","path":null,"size_bytes":3007,"size_tokens":null},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","path":null,"size_bytes":772,"size_tokens":null},"script/build.ts":{"content":"import { build as esbuild } from \"esbuild\";\nimport { build as viteBuild } from \"vite\";\nimport { rm, readFile, writeFile } from \"fs/promises\";\n\n// Build version marker to force cache invalidation\nconst BUILD_VERSION = `BUILD_${Date.now()}`;\nconsole.log(`Building version: ${BUILD_VERSION}`);\n\n// server deps to bundle to reduce openat(2) syscalls\n// which helps cold start times\nconst allowlist = [\n  \"@google/generative-ai\",\n  \"axios\",\n  \"connect-pg-simple\",\n  \"cors\",\n  \"date-fns\",\n  \"drizzle-orm\",\n  \"drizzle-zod\",\n  \"express\",\n  \"express-rate-limit\",\n  \"express-session\",\n  \"jsonwebtoken\",\n  \"memorystore\",\n  \"multer\",\n  \"nanoid\",\n  \"nodemailer\",\n  \"openai\",\n  \"passport\",\n  \"passport-local\",\n  \"pg\",\n  \"stripe\",\n  \"uuid\",\n  \"ws\",\n  \"xlsx\",\n  \"zod\",\n  \"zod-validation-error\",\n];\n\nasync function buildAll() {\n  await rm(\"dist\", { recursive: true, force: true });\n\n  console.log(\"building client...\");\n  await viteBuild();\n\n  console.log(\"building server...\");\n  const pkg = JSON.parse(await readFile(\"package.json\", \"utf-8\"));\n  const allDeps = [\n    ...Object.keys(pkg.dependencies || {}),\n    ...Object.keys(pkg.devDependencies || {}),\n  ];\n  const externals = allDeps.filter((dep) => !allowlist.includes(dep));\n\n  await esbuild({\n    entryPoints: [\"server/index.ts\"],\n    platform: \"node\",\n    bundle: true,\n    format: \"cjs\",\n    outfile: \"dist/index.cjs\",\n    define: {\n      \"process.env.NODE_ENV\": '\"production\"',\n    },\n    minify: true,\n    external: externals,\n    logLevel: \"info\",\n  });\n}\n\nbuildAll().catch((err) => {\n  console.error(err);\n  process.exit(1);\n});\n","path":null,"size_bytes":1577,"size_tokens":null},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverAnchor = PopoverPrimitive.Anchor\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent, PopoverAnchor }\n","path":null,"size_bytes":1342,"size_tokens":null},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","path":null,"size_bytes":1877,"size_tokens":null},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","path":null,"size_bytes":80,"size_tokens":null},"client/src/pages/audit-dashboard.tsx":{"content":"import AuditLayout from \"@/components/layout/audit-layout\";\nimport { useAudit } from \"@/lib/audit-context\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { \n  BarChart, \n  Bar, \n  XAxis, \n  YAxis, \n  CartesianGrid, \n  Tooltip, \n  ResponsiveContainer,\n  LineChart,\n  Line,\n  Legend\n} from \"recharts\";\nimport { ArrowUpRight, ArrowDownRight, CheckCircle2, AlertCircle, FileText, Calendar, Award, TrendingUp, Users } from \"lucide-react\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Link } from \"wouter\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { useState } from \"react\";\nimport { useAuth } from \"@/lib/auth\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { format, parseISO } from \"date-fns\";\n\nexport default function AuditDashboard() {\n  const { user } = useAuth();\n  const { reports, associates } = useAudit();\n  const [selectedMonth, setSelectedMonth] = useState(\"All\");\n\n  if (!user?.isAdmin) {\n    return <AssociateDashboard user={user} reports={reports} selectedMonth={selectedMonth} setSelectedMonth={setSelectedMonth} />;\n  }\n\n  return <AdminDashboard reports={reports} associates={associates} selectedMonth={selectedMonth} setSelectedMonth={setSelectedMonth} />;\n}\n\nfunction AssociateDashboard({ user, reports, selectedMonth, setSelectedMonth }: any) {\n  // Mock data for associate performance\n  const monthlyPerformance = [\n    { name: 'Aug', reports: 12, quality: 88 },\n    { name: 'Sep', reports: 15, quality: 90 },\n    { name: 'Oct', reports: 18, quality: 91 },\n    { name: 'Nov', reports: 14, quality: 94 },\n    { name: 'Dec', reports: 8, quality: 95 },\n  ];\n\n  const currentMonthStats = monthlyPerformance[monthlyPerformance.length - 1];\n\n  // Filter reports for this associate\n  const myReports = reports.filter((r: any) => r.associateId === user?.id);\n  const recentReports = myReports.slice(0, 3);\n\n  return (\n    <AuditLayout>\n      <div className=\"space-y-8\">\n        <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-4\">\n          <div>\n            <h1 className=\"text-2xl font-bold tracking-tight text-slate-900\">My Performance Dashboard</h1>\n            <p className=\"text-slate-500\">Track your monthly audit volume and quality scores.</p>\n          </div>\n          <div className=\"w-40\">\n             <Select value={selectedMonth} onValueChange={setSelectedMonth}>\n               <SelectTrigger>\n                 <SelectValue placeholder=\"Select Month\" />\n               </SelectTrigger>\n               <SelectContent>\n                 <SelectItem value=\"October\">October 2024</SelectItem>\n                 <SelectItem value=\"November\">November 2024</SelectItem>\n                 <SelectItem value=\"December\">December 2024</SelectItem>\n               </SelectContent>\n             </Select>\n           </div>\n        </div>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n          <Card className=\"bg-gradient-to-br from-blue-500 to-blue-600 text-white border-none shadow-lg\">\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium text-blue-100\">Total Reports (This Month)</CardTitle>\n              <FileText className=\"h-4 w-4 text-blue-100\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-4xl font-bold\">{currentMonthStats.reports}</div>\n              <p className=\"text-xs text-blue-100/80 flex items-center mt-1\">\n                <ArrowUpRight className=\"h-3 w-3 mr-1\" /> On track for target\n              </p>\n            </CardContent>\n          </Card>\n\n          <Card className=\"bg-gradient-to-br from-emerald-500 to-emerald-600 text-white border-none shadow-lg\">\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium text-emerald-100\">Average Quality Score</CardTitle>\n              <Award className=\"h-4 w-4 text-emerald-100\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-4xl font-bold\">{currentMonthStats.quality}%</div>\n              <p className=\"text-xs text-emerald-100/80 flex items-center mt-1\">\n                <ArrowUpRight className=\"h-3 w-3 mr-1\" /> +2% vs last month\n              </p>\n            </CardContent>\n          </Card>\n\n          <Card className=\"bg-white border-slate-200 shadow-sm\">\n             <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium text-slate-600\">Pending Corrections</CardTitle>\n              <AlertCircle className=\"h-4 w-4 text-amber-500\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-4xl font-bold text-slate-900\">2</div>\n              <p className=\"text-xs text-slate-500 mt-1\">\n                Reports flagged for review\n              </p>\n            </CardContent>\n          </Card>\n        </div>\n\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Monthly Performance</CardTitle>\n              <CardDescription>Volume vs Quality Score Trends</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"h-[300px] w-full\">\n                <ResponsiveContainer width=\"100%\" height=\"100%\">\n                  <BarChart data={monthlyPerformance}>\n                    <CartesianGrid strokeDasharray=\"3 3\" vertical={false} stroke=\"#e2e8f0\" />\n                    <XAxis \n                      dataKey=\"name\" \n                      stroke=\"#64748b\" \n                      fontSize={12} \n                      tickLine={false} \n                      axisLine={false} \n                    />\n                    <YAxis \n                      yAxisId=\"left\"\n                      orientation=\"left\"\n                      stroke=\"#64748b\" \n                      fontSize={12} \n                      tickLine={false} \n                      axisLine={false} \n                    />\n                    <YAxis \n                      yAxisId=\"right\"\n                      orientation=\"right\"\n                      stroke=\"#64748b\" \n                      fontSize={12} \n                      tickLine={false} \n                      axisLine={false} \n                      domain={[0, 100]}\n                    />\n                    <Tooltip \n                      contentStyle={{ backgroundColor: 'white', borderRadius: '8px', border: '1px solid #e2e8f0' }}\n                    />\n                    <Legend />\n                    <Bar yAxisId=\"left\" dataKey=\"reports\" name=\"Reports Filed\" fill=\"#3b82f6\" radius={[4, 4, 0, 0]} barSize={30} />\n                    <Line yAxisId=\"right\" type=\"monotone\" dataKey=\"quality\" name=\"Quality Score\" stroke=\"#10b981\" strokeWidth={3} />\n                  </BarChart>\n                </ResponsiveContainer>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Recent Submissions</CardTitle>\n              <CardDescription>Status of your latest reports</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-6\">\n                {recentReports.length > 0 ? recentReports.map((report: Report) => (\n                  <div key={report.id} className=\"flex items-start gap-4\">\n                    <div className={`\n                      mt-1 h-2 w-2 rounded-full shrink-0\n                      ${report.status === 'Reviewed' ? 'bg-emerald-500' : \n                        report.status === 'Flagged' ? 'bg-rose-500' : 'bg-amber-500'}\n                    `} />\n                    <div className=\"space-y-1 flex-1 min-w-0\">\n                      <p className=\"text-sm font-medium leading-none truncate\">{report.id}_{report.date}</p>\n                      <div className=\"flex items-center gap-2 text-xs text-slate-500\">\n                        <span className=\"truncate max-w-[180px]\">{report.title}</span>\n                        <Badge variant=\"outline\" className=\"text-[10px] h-5 px-1.5 font-normal\">\n                          {report.status}\n                        </Badge>\n                      </div>\n                    </div>\n                    <div className=\"font-mono text-sm font-bold text-slate-700\">\n                      {report.scores.overall}\n                    </div>\n                  </div>\n                )) : (\n                  <div className=\"text-center py-8 text-slate-500 text-sm\">\n                    No recent reports found.\n                  </div>\n                )}\n                <Link href=\"/upload\">\n                  <Button className=\"w-full mt-2 gap-2\">\n                    <TrendingUp className=\"h-4 w-4\" />\n                    Submit New Report\n                  </Button>\n                </Link>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </AuditLayout>\n  );\n}\n\nfunction AdminDashboard({ reports, associates, selectedMonth, setSelectedMonth }: any) {\n  const recentReports = reports.slice(0, 5);\n  \n  // Month mapping\n  const monthMap: { [key: string]: number } = {\n    'January': 1, 'February': 2, 'March': 3, 'April': 4,\n    'May': 5, 'June': 6, 'July': 7, 'August': 8,\n    'September': 9, 'October': 10, 'November': 11, 'December': 12\n  };\n  \n  // Filter reports by selected month\n  const getMonthReports = (month: string) => {\n    if (month === 'All') return reports;\n    const monthNum = monthMap[month];\n    return reports.filter((r: any) => {\n      const reportDate = new Date(r.date);\n      return reportDate.getMonth() + 1 === monthNum;\n    });\n  };\n  \n  const currentMonthReports = getMonthReports(selectedMonth);\n  \n  // Calculate overall stats\n  const totalMonthlyReports = currentMonthReports.length;\n  const avgQualityScore = currentMonthReports.length > 0 \n    ? Math.round(currentMonthReports.reduce((sum: number, r: any) => sum + (r.scores?.overall || 0), 0) / currentMonthReports.length * 10) / 10\n    : 0;\n  const flaggedReports = currentMonthReports.filter((r: any) => r.status === 'Flagged').length;\n  const pendingReports = currentMonthReports.filter((r: any) => r.status === 'Pending').length;\n  \n  // Calculate stats per associate\n  const getAssociateStats = (associateId: string, month?: string) => {\n    const filteredReports = month ? getMonthReports(month) : reports;\n    const associateReports = filteredReports.filter((r: any) => r.associateId === associateId);\n    const totalReports = associateReports.length;\n    const avgScore = associateReports.length > 0 \n      ? Math.round(associateReports.reduce((sum: number, r: any) => sum + (r.scores?.overall || 0), 0) / associateReports.length)\n      : 0;\n    return { totalReports, avgScore };\n  };\n  \n  // Calculate weekly performance data for the chart\n  const getWeeklyPerformance = () => {\n    const weeks = ['Week 1', 'Week 2', 'Week 3', 'Week 4'];\n    return weeks.map((weekName, weekIndex) => {\n      const weekReports = currentMonthReports.filter((r: any) => {\n        const day = new Date(r.date).getDate();\n        const reportWeek = Math.floor((day - 1) / 7);\n        return reportWeek === weekIndex;\n      });\n      const avgScore = weekReports.length > 0\n        ? Math.round(weekReports.reduce((sum: number, r: any) => sum + (r.scores?.overall || 0), 0) / weekReports.length)\n        : 0;\n      return { name: weekName, score: avgScore, count: weekReports.length };\n    });\n  };\n  \n  const performanceData = getWeeklyPerformance();\n\n  return (\n    <AuditLayout>\n      <div className=\"space-y-8\">\n        {/* Page Header */}\n        <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-4\">\n          <div>\n            <h1 className=\"text-2xl font-bold tracking-tight text-slate-900\">Dashboard Overview</h1>\n            <p className=\"text-slate-500\">Welcome back. Here's what's happening with audit compliance.</p>\n          </div>\n          <div className=\"flex gap-2 items-center\">\n             <div className=\"w-40\">\n               <Select value={selectedMonth} onValueChange={setSelectedMonth}>\n                 <SelectTrigger>\n                   <SelectValue placeholder=\"Select Month\" />\n                 </SelectTrigger>\n                 <SelectContent>\n                   <SelectItem value=\"All\">All Time</SelectItem>\n                   <SelectItem value=\"October\">October 2025</SelectItem>\n                   <SelectItem value=\"November\">November 2025</SelectItem>\n                   <SelectItem value=\"December\">December 2025</SelectItem>\n                 </SelectContent>\n               </Select>\n             </div>\n             <Link href=\"/reports\">\n              <Button>View All Reports</Button>\n             </Link>\n          </div>\n        </div>\n\n        {/* Stats Grid */}\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">{selectedMonth === 'All' ? 'Total Reports' : 'Monthly Reports'}</CardTitle>\n              <FileText className=\"h-4 w-4 text-slate-500\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{totalMonthlyReports}</div>\n              <p className=\"text-xs text-slate-500 flex items-center mt-1\">\n                {selectedMonth === 'All' ? 'Total reports (all time)' : `Total reports for ${selectedMonth}`}\n              </p>\n            </CardContent>\n          </Card>\n          \n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Avg. Quality Score</CardTitle>\n              <CheckCircle2 className=\"h-4 w-4 text-slate-500\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{avgQualityScore || '-'}</div>\n              <p className=\"text-xs text-slate-500 flex items-center mt-1\">\n                {totalMonthlyReports > 0 ? 'Average across all reports' : 'No reports yet'}\n              </p>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Flagged Reports</CardTitle>\n              <AlertCircle className=\"h-4 w-4 text-slate-500\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold text-amber-600\">{flaggedReports}</div>\n              <p className=\"text-xs text-slate-500 flex items-center mt-1\">\n                {flaggedReports > 0 ? 'Requires attention' : 'No flagged reports'}\n              </p>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Pending Review</CardTitle>\n              <Calendar className=\"h-4 w-4 text-slate-500\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{pendingReports}</div>\n              <p className=\"text-xs text-slate-500 flex items-center mt-1\">\n                {pendingReports > 0 ? 'Awaiting review' : 'All caught up'}\n              </p>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Charts Section */}\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n          <Card className=\"col-span-1 lg:col-span-2\">\n            <CardHeader>\n              <CardTitle>Compliance Trends - {selectedMonth}</CardTitle>\n              <CardDescription>Weekly average report scores</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"h-[300px] w-full\">\n                <ResponsiveContainer width=\"100%\" height=\"100%\">\n                  <LineChart data={performanceData}>\n                    <CartesianGrid strokeDasharray=\"3 3\" vertical={false} stroke=\"#e2e8f0\" />\n                    <XAxis \n                      dataKey=\"name\" \n                      stroke=\"#64748b\" \n                      fontSize={12} \n                      tickLine={false} \n                      axisLine={false} \n                    />\n                    <YAxis \n                      stroke=\"#64748b\" \n                      fontSize={12} \n                      tickLine={false} \n                      axisLine={false} \n                      domain={[0, 100]}\n                    />\n                    <Tooltip \n                      contentStyle={{ backgroundColor: 'white', borderRadius: '8px', border: '1px solid #e2e8f0' }}\n                    />\n                    <Line \n                      type=\"monotone\" \n                      dataKey=\"score\" \n                      stroke=\"#2563eb\" \n                      strokeWidth={3} \n                      dot={{ r: 4, fill: \"#2563eb\", strokeWidth: 2, stroke: \"#fff\" }}\n                      activeDot={{ r: 6 }}\n                    />\n                  </LineChart>\n                </ResponsiveContainer>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card className=\"col-span-1\">\n            <CardHeader>\n              <CardTitle>Associate Activity</CardTitle>\n              <CardDescription>Report submissions for {selectedMonth}</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-5\">\n                {associates.map((associate: any) => {\n                  const stats = getAssociateStats(associate.id, selectedMonth);\n                  const count = stats.totalReports;\n\n                  return (\n                    <div key={associate.id} className=\"flex items-center justify-between\">\n                      <div className=\"flex items-center gap-3\">\n                        <Avatar className=\"h-9 w-9 border border-slate-200\">\n                          <AvatarImage src={associate.avatar} />\n                          <AvatarFallback>{associate.name[0]}</AvatarFallback>\n                        </Avatar>\n                        <div>\n                          <p className=\"text-sm font-medium leading-none text-slate-900\">{associate.name}</p>\n                          <p className=\"text-xs text-slate-500 mt-1\">{associate.role}</p>\n                        </div>\n                      </div>\n                      <div className=\"flex items-center gap-2\">\n                        <Badge variant=\"secondary\" className=\"font-mono\">\n                          {count} Reports\n                        </Badge>\n                        {stats.avgScore > 0 && (\n                          <Badge variant={stats.avgScore >= 90 ? 'default' : stats.avgScore >= 80 ? 'secondary' : 'outline'}>\n                            {stats.avgScore}%\n                          </Badge>\n                        )}\n                      </div>\n                    </div>\n                  );\n                })}\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Associate Performance Table */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Users className=\"h-5 w-5 text-slate-500\" />\n              Associate Performance - {selectedMonth}\n            </CardTitle>\n            <CardDescription>Monthly breakdown of report submissions and quality scores</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead className=\"w-[250px]\">Associate</TableHead>\n                  <TableHead className=\"text-right\">Reports</TableHead>\n                  <TableHead className=\"text-right\">Reviewed</TableHead>\n                  <TableHead className=\"text-right\">Pending</TableHead>\n                  <TableHead className=\"text-right\">Flagged</TableHead>\n                  <TableHead className=\"text-right\">Avg Score</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {associates.map((associate: any) => {\n                  const associateMonthReports = currentMonthReports.filter((r: any) => r.associateId === associate.id);\n                  const totalReports = associateMonthReports.length;\n                  const reviewedCount = associateMonthReports.filter((r: any) => r.status === 'Reviewed').length;\n                  const pendingCount = associateMonthReports.filter((r: any) => r.status === 'Pending').length;\n                  const flaggedCount = associateMonthReports.filter((r: any) => r.status === 'Flagged').length;\n                  const avgScore = totalReports > 0\n                    ? Math.round(associateMonthReports.reduce((sum: number, r: any) => sum + (r.scores?.overall || 0), 0) / totalReports)\n                    : 0;\n                  \n                  return (\n                    <TableRow key={associate.id}>\n                      <TableCell>\n                        <div className=\"flex items-center gap-3\">\n                          <Avatar className=\"h-8 w-8\">\n                            <AvatarImage src={associate.avatar} />\n                            <AvatarFallback>{associate.name[0]}</AvatarFallback>\n                          </Avatar>\n                          <div>\n                            <div className=\"font-medium text-slate-900\">{associate.name}</div>\n                            <div className=\"text-xs text-slate-500\">{associate.role}</div>\n                          </div>\n                        </div>\n                      </TableCell>\n                      <TableCell className=\"text-right font-mono font-bold text-slate-900\">{totalReports}</TableCell>\n                      <TableCell className=\"text-right font-mono text-emerald-600\">{reviewedCount}</TableCell>\n                      <TableCell className=\"text-right font-mono text-amber-600\">{pendingCount}</TableCell>\n                      <TableCell className=\"text-right font-mono text-rose-600\">{flaggedCount}</TableCell>\n                      <TableCell className=\"text-right\">\n                        {totalReports > 0 ? (\n                          <Badge variant={avgScore >= 90 ? 'default' : avgScore >= 80 ? 'secondary' : 'outline'}>\n                            {avgScore}%\n                          </Badge>\n                        ) : (\n                          <span className=\"text-slate-400 text-sm\">-</span>\n                        )}\n                      </TableCell>\n                    </TableRow>\n                  );\n                })}\n              </TableBody>\n            </Table>\n          </CardContent>\n        </Card>\n      </div>\n    </AuditLayout>\n  );\n}","path":null,"size_bytes":23158,"size_tokens":null},"shared/schema.ts":{"content":"import { sql } from \"drizzle-orm\";\nimport { pgTable, text, varchar, integer, timestamp, jsonb } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\n// ApplicantSchema for deterministic scoring\nexport interface ApplicantSchema {\n  personal: {\n    residenceVintage: string;\n    residenceOwned: boolean;\n    spouseName?: string;\n    kidsCount?: number;\n    selfEducation?: string;\n    spouseEducation?: string;\n    spouseEmployment?: string;\n    kidsEducation?: string;\n    kidsSchool?: string;\n    monthlyRent?: number;\n  };\n  business: {\n    name: string;\n    nature: string;\n    monthlyIncome: number;\n    licensesVerified: boolean;\n    businessVintage?: number;\n    employeesVerified?: boolean;\n    monthlyTurnover?: number;\n    activityObserved?: boolean;\n    infrastructureAdequate?: boolean;\n    seasonalityMentioned?: boolean;\n    clientListAvailable?: boolean;    // Client list/concentration risk documented\n    sourceOfBusiness?: boolean;        // Source of business (referrals, walk-ins, etc.) documented\n    strategicVision?: boolean;         // Strategic vision/growth plans documented\n    promoterExperience?: boolean;      // Promoter experience/qualifications documented\n  };\n  networth: {\n    propertiesOwned: number;\n    vehiclesOwned: number;\n    otherInvestments?: boolean;\n    businessPlaceOwned?: boolean;\n  };\n  debt: {\n    existingLoans: boolean | null;  // null = undocumented, true = has loans, false = no loans\n    repaymentTrack: string;\n    loanListAvailable?: boolean;\n    canServiceNewLoan?: boolean;\n  };\n  endUse: {\n    purpose: string;\n    agreementValue?: number;\n    advancePaid?: number;\n    willOccupy?: boolean;\n    mortgageFundsUse?: string;\n  };\n  references: {\n    personalCheck: boolean;\n    businessCheck: boolean;\n    invoiceVerified?: boolean;\n  };\n  banking: {\n    primaryBank: string;\n    turnoverCreditPercent: number;\n    bankingTenure?: number;\n    emisRouted?: boolean;\n    qrCodeSpotted?: boolean;\n  };\n}\n\nexport type ReportMetrics = {\n  totalFields: number;\n  filledFields: number;\n  missingFields: string[];\n  riskAnalysisDepth: 'High' | 'Medium' | 'Low';\n  photoCount: number;\n  dueDiligenceChecks: string[];\n  photoValidation: {\n    matchedCount: number;\n    totalKeyDetails: number;\n    missedDetails: string[];\n  };\n};\n\nexport type PersonalMatches = {\n  selfEducation: boolean;\n  spouseName: boolean;\n  spouseEducation: boolean;\n  spouseEmployment: boolean;\n  mentionAboutKids: boolean;\n  kidsEducation: boolean;\n  kidsSchool: boolean;\n  residenceVintage: boolean;\n  monthlyRentIfRented: boolean;\n  residenceOwnedOrRented: boolean;\n};\n\nexport type BusinessMatches = {\n  businessName: boolean;\n  natureOfBusiness: boolean;\n  existenceCurrentPlace: boolean;\n  licensesRegistrations: boolean;\n  promoterExperienceQualifications: boolean;\n  strategicVisionClarity: boolean;\n  employeesSeen: boolean;\n  monthlyTurnover: boolean;\n  clientListConcentrationRisk: boolean;\n  activityDuringVisit: boolean;\n  monthlyIncome: boolean;\n  seasonality: boolean;\n  infraSupportsTurnover: boolean;\n  mfgRawMaterialSourcingStorage: boolean;\n  mfgProcessFlow: boolean;\n  mfgCapacityVsUtilization: boolean;\n  mfgMachineryMakeAutomationMaintenance: boolean;\n  mfgInventoryFifoAging: boolean;\n  mfgQualityControl: boolean;\n  tradingProductRangeInventoryMovement: boolean;\n  tradingPurchaseSalesCycle: boolean;\n  tradingWarehouseStockSeen: boolean;\n  svcDocumentationOfDelivery: boolean;\n  svcTechnologySystems: boolean;\n  svcClientListContractsRevenueModel: boolean;\n  svcContractBasedOrWalkin: boolean;\n};\n\nexport type BankingMatches = {\n  primaryBankerName: boolean;\n  turnoverCreditedPercent: boolean;\n  bankingTenure: boolean;\n  emisRoutedBank: boolean;\n  qrCodeSpotted: boolean;\n};\n\nexport type NetworthMatches = {\n  propertiesOwned: boolean;\n  vehiclesOwned: boolean;\n  otherInvestments: boolean;\n  businessPlaceOwned: boolean;\n  totalNetworthAvailable: boolean;\n};\n\nexport type DebtMatches = {\n  hasExistingLoans: boolean;\n  loanListAvailable: boolean;\n  canServiceNewLoan: boolean;\n  repaymentHistoryQuality: boolean;\n  loansSourceBankNature: boolean;\n};\n\nexport type EndUseMatches = {\n  agreementValueAvailable: boolean;\n  advancePaidCashOrBankAmount: boolean;\n  willOccupyPostPurchase: boolean;\n  mortgageFundsUse: boolean;\n  additionalUseInformation: boolean;\n};\n\nexport type ReferenceMatches = {\n  personalRefNeighbours: boolean;\n  businessRefBuyersSellers: boolean;\n  invoiceVerification: boolean;\n};\n\nexport type ComprehensiveBreakdown = {\n  personal: number;\n  business: number;\n  banking: number;\n  networth: number;\n  existingDebt: number;\n  endUse: number;\n  referenceChecks: number;\n  personalMatches?: PersonalMatches;\n  businessMatches?: BusinessMatches;\n  bankingMatches?: BankingMatches;\n  networthMatches?: NetworthMatches;\n  debtMatches?: DebtMatches;\n  endUseMatches?: EndUseMatches;\n  referenceMatches?: ReferenceMatches;\n};\n\nexport type ReportScores = {\n  completeness: number;\n  comprehensive: number;\n  quality: number;\n  overall: number;\n  comprehensiveBreakdown?: ComprehensiveBreakdown;\n};\n\nexport type ReportTAT = {\n  initiationTime: string | null;\n  visitTime: string | null;\n  reportDate: string | null;\n  initiationToVisitHours: number | null;\n  visitToReportHours: number | null;\n  totalTATHours: number | null;\n  gmailMessageId: string | null;\n};\n\nexport type ReportDecision = {\n  status: 'Positive' | 'Negative' | 'Credit Refer';\n  remarks: string;\n  aiValidation: {\n    match: boolean;\n    confidence: number;\n    reasoning: string;\n  };\n};\n\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\", { length: 10 }).primaryKey(),\n  username: text(\"username\").notNull().unique(),\n  password: text(\"password\").notNull(),\n  name: text(\"name\").notNull(),\n  role: text(\"role\").notNull(),\n  avatar: text(\"avatar\").notNull(),\n});\n\nexport const reports = pgTable(\"reports\", {\n  id: varchar(\"id\", { length: 50 }).primaryKey(),\n  associateId: varchar(\"associate_id\", { length: 10 }).notNull().references(() => users.id),\n  leadId: text(\"lead_id\").default('').notNull(),\n  title: text(\"title\").notNull(),\n  date: text(\"date\").notNull(),\n  status: text(\"status\").notNull(),\n  metrics: jsonb(\"metrics\").$type<ReportMetrics>().notNull(),\n  scores: jsonb(\"scores\").$type<ReportScores>().notNull(),\n  decision: jsonb(\"decision\").$type<ReportDecision>().notNull(),\n  remarks: jsonb(\"remarks\").$type<string[]>().notNull(),\n  summary: text(\"summary\").notNull(),\n  tat: jsonb(\"tat\").$type<ReportTAT>(),\n  pdfContent: text(\"pdf_content\"),\n  fileSize: integer(\"file_size\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const insertUserSchema = createInsertSchema(users).omit({\n  id: true,\n});\n\nexport const insertReportSchema = createInsertSchema(reports).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type User = typeof users.$inferSelect;\nexport type InsertReport = z.infer<typeof insertReportSchema>;\nexport type Report = typeof reports.$inferSelect;\n\n// MIS (Management Information System) table for tracking work allocations\nexport const misEntries = pgTable(\"mis_entries\", {\n  id: integer(\"id\").primaryKey().generatedAlwaysAsIdentity(),\n  associateId: varchar(\"associate_id\", { length: 10 }).notNull().references(() => users.id),\n  sno: integer(\"sno\").notNull(),\n  leadId: text(\"lead_id\").notNull(),\n  customerName: text(\"customer_name\").notNull(),\n  businessName: text(\"business_name\"),\n  contactDetails: text(\"contact_details\"),\n  customerAddress: text(\"customer_address\"),\n  inDate: text(\"in_date\"),\n  outDate: text(\"out_date\"),\n  initiatedPerson: text(\"initiated_person\"),\n  product: text(\"product\"),\n  pdPerson: text(\"pd_person\"),\n  pdTyping: text(\"pd_typing\"),\n  pdPersonId: varchar(\"pd_person_id\", { length: 10 }).references(() => users.id),\n  pdTypingId: varchar(\"pd_typing_id\", { length: 10 }).references(() => users.id),\n  workNature: text(\"work_nature\"),\n  location: text(\"location\"),\n  status: text(\"status\").default(\"Pending\"),\n  workflowStatus: text(\"workflow_status\").default(\"unassigned\"),\n  assignedAt: timestamp(\"assigned_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const insertMisEntrySchema = createInsertSchema(misEntries).omit({\n  createdAt: true,\n});\n\nexport type InsertMisEntry = z.infer<typeof insertMisEntrySchema>;\nexport type MisEntry = typeof misEntries.$inferSelect;\n","path":null,"size_bytes":8437,"size_tokens":null},"client/src/pages/login.tsx":{"content":"import { useState } from \"react\";\nimport { useAuth } from \"@/lib/auth\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle, CardFooter } from \"@/components/ui/card\";\nimport { Label } from \"@/components/ui/label\";\nimport { Lock, User, Users } from \"lucide-react\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { Avatar, AvatarImage, AvatarFallback } from \"@/components/ui/avatar\";\n\nconst quickLoginUsers = [\n  { username: \"admin\", name: \"Admin\", avatar: \"https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=150&q=80\" },\n  { username: \"bharat\", name: \"Bharat\", avatar: \"https://images.unsplash.com/photo-1599566150163-29194dcaad36?w=150&q=80\" },\n  { username: \"narender\", name: \"Narender\", avatar: \"https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?w=150&q=80\" },\n  { username: \"upender\", name: \"Upender\", avatar: \"https://images.unsplash.com/photo-1527980965255-d3b416303d12?w=150&q=80\" },\n  { username: \"avinash\", name: \"Avinash\", avatar: \"https://images.unsplash.com/photo-1633332755192-727a05c4013d?w=150&q=80\" },\n  { username: \"prashanth\", name: \"Prashanth\", avatar: \"https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?w=150&q=80\" },\n  { username: \"anosh\", name: \"Anosh\", avatar: \"https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=150&q=80\" },\n];\n\nexport default function LoginPage() {\n  const [username, setUsername] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [error, setError] = useState(\"\");\n  const [loading, setLoading] = useState(false);\n  const { login } = useAuth();\n\n  const handleLogin = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError(\"\");\n    setLoading(true);\n    \n    if (!username || !password) {\n      setError(\"Please enter both username and password\");\n      setLoading(false);\n      return;\n    }\n\n    try {\n      const success = await login(username, password);\n      if (!success) {\n        setError(\"Invalid credentials. Please check your username and password.\");\n      }\n    } catch (err) {\n      setError(\"Login failed. Please try again.\");\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleQuickLogin = async (selectedUsername: string) => {\n    setError(\"\");\n    setLoading(true);\n    try {\n      const success = await login(selectedUsername, \"password123\");\n      if (!success) {\n        setError(\"Quick login failed. Please try manual login.\");\n      }\n    } catch (err) {\n      setError(\"Login failed. Please try again.\");\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-slate-100 p-4\">\n      <div className=\"w-full max-w-md space-y-6\">\n        <div className=\"text-center\">\n          <div className=\"mx-auto h-12 w-12 bg-blue-600 rounded-lg flex items-center justify-center mb-4\">\n            <Lock className=\"h-6 w-6 text-white\" />\n          </div>\n          <h2 className=\"text-3xl font-bold text-slate-900\">AuditGuard</h2>\n          <p className=\"mt-2 text-slate-600\">Secure Audit Management Portal</p>\n        </div>\n\n        {/* Quick Login Section */}\n        <Card className=\"border-t-4 border-t-green-600 shadow-lg\">\n          <CardHeader className=\"pb-3\">\n            <CardTitle className=\"text-lg flex items-center gap-2\">\n              <Users className=\"h-5 w-5\" />\n              Quick Login\n            </CardTitle>\n            <CardDescription>Click on a user to sign in instantly</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"grid grid-cols-2 gap-3\">\n              {quickLoginUsers.map((user) => (\n                <Button\n                  key={user.username}\n                  variant=\"outline\"\n                  className=\"h-auto py-3 flex flex-col items-center gap-2 hover:bg-slate-50 hover:border-blue-400\"\n                  onClick={() => handleQuickLogin(user.username)}\n                  disabled={loading}\n                  data-testid={`quick-login-${user.username}`}\n                >\n                  <Avatar className=\"h-10 w-10\">\n                    <AvatarImage src={user.avatar} alt={user.name} />\n                    <AvatarFallback>{user.name[0]}</AvatarFallback>\n                  </Avatar>\n                  <span className=\"text-sm font-medium\">{user.name}</span>\n                </Button>\n              ))}\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Manual Login Section */}\n        <Card className=\"border-t-4 border-t-blue-600 shadow-lg\">\n          <CardHeader className=\"pb-3\">\n            <CardTitle className=\"text-lg\">Manual Sign In</CardTitle>\n            <CardDescription>Or enter your credentials manually</CardDescription>\n          </CardHeader>\n          <form onSubmit={handleLogin}>\n            <CardContent className=\"space-y-4\">\n              {error && (\n                <Alert variant=\"destructive\">\n                  <AlertDescription>{error}</AlertDescription>\n                </Alert>\n              )}\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"username\">Username</Label>\n                <div className=\"relative\">\n                  <User className=\"absolute left-3 top-3 h-4 w-4 text-slate-400\" />\n                  <Input \n                    id=\"username\" \n                    placeholder=\"e.g., bharat, narender, admin\" \n                    className=\"pl-9\"\n                    value={username}\n                    onChange={(e) => setUsername(e.target.value.toLowerCase())}\n                    data-testid=\"input-username\"\n                  />\n                </div>\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"password\">Password</Label>\n                <div className=\"relative\">\n                  <Lock className=\"absolute left-3 top-3 h-4 w-4 text-slate-400\" />\n                  <Input \n                    id=\"password\" \n                    type=\"password\" \n                    placeholder=\"Enter password\" \n                    className=\"pl-9\"\n                    value={password}\n                    onChange={(e) => setPassword(e.target.value)}\n                    data-testid=\"input-password\"\n                  />\n                </div>\n                <p className=\"text-xs text-slate-500\">Hint: use \"password123\" for demo</p>\n              </div>\n            </CardContent>\n            <CardFooter>\n              <Button type=\"submit\" className=\"w-full\" disabled={loading} data-testid=\"button-signin\">\n                {loading ? \"Signing in...\" : \"Sign In\"}\n              </Button>\n            </CardFooter>\n          </form>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":6773,"size_tokens":null},"client/src/components/ui/empty.tsx":{"content":"import { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction Empty({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"empty\"\n      className={cn(\n        \"flex min-w-0 flex-1 flex-col items-center justify-center gap-6 text-balance rounded-lg border-dashed p-6 text-center md:p-12\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction EmptyHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"empty-header\"\n      className={cn(\n        \"flex max-w-sm flex-col items-center gap-2 text-center\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nconst emptyMediaVariants = cva(\n  \"mb-2 flex shrink-0 items-center justify-center [&_svg]:pointer-events-none [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        icon: \"bg-muted text-foreground flex size-10 shrink-0 items-center justify-center rounded-lg [&_svg:not([class*='size-'])]:size-6\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nfunction EmptyMedia({\n  className,\n  variant = \"default\",\n  ...props\n}: React.ComponentProps<\"div\"> & VariantProps<typeof emptyMediaVariants>) {\n  return (\n    <div\n      data-slot=\"empty-icon\"\n      data-variant={variant}\n      className={cn(emptyMediaVariants({ variant, className }))}\n      {...props}\n    />\n  )\n}\n\nfunction EmptyTitle({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"empty-title\"\n      className={cn(\"text-lg font-medium tracking-tight\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction EmptyDescription({ className, ...props }: React.ComponentProps<\"p\">) {\n  return (\n    <div\n      data-slot=\"empty-description\"\n      className={cn(\n        \"text-muted-foreground [&>a:hover]:text-primary text-sm/relaxed [&>a]:underline [&>a]:underline-offset-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction EmptyContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"empty-content\"\n      className={cn(\n        \"flex w-full min-w-0 max-w-sm flex-col items-center gap-4 text-balance text-sm\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Empty,\n  EmptyHeader,\n  EmptyTitle,\n  EmptyDescription,\n  EmptyContent,\n  EmptyMedia,\n}\n","path":null,"size_bytes":2396,"size_tokens":null},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","path":null,"size_bytes":1753,"size_tokens":null},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-primary/10\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","path":null,"size_bytes":266,"size_tokens":null},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-9 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-300 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","path":null,"size_bytes":5124,"size_tokens":null},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500 data-[state=open]:animate-in data-[state=closed]:animate-out\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n      {children}\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","path":null,"size_bytes":4280,"size_tokens":null},"client/src/lib/audit-data.ts":{"content":"import { User, FileText, CheckCircle, AlertTriangle, TrendingUp } from \"lucide-react\";\n\nexport interface Associate {\n  id: string;\n  name: string;\n  role: string;\n  avatar: string;\n  totalReports: number;\n  avgScore: number;\n}\n\nexport interface Report {\n  id: string;\n  associateId: string;\n  title: string;\n  date: string;\n  status: 'Reviewed' | 'Pending' | 'Flagged';\n  metrics: {\n    totalFields: number;\n    filledFields: number;\n    missingFields?: string[];\n    riskAnalysisDepth?: 'High' | 'Medium' | 'Low';\n    photoCount?: number;\n    dueDiligenceChecks?: string[];\n    photoValidation?: {\n      matchedCount: number;\n      totalKeyDetails: number;\n      missedDetails: string[];\n    };\n  };\n  scores: {\n    completeness: number;\n    comprehensive: number;\n    quality: number;\n    overall: number;\n  };\n  decision: {\n    status: 'Positive' | 'Negative' | 'Credit Refer';\n    remarks: string;\n    aiValidation: {\n      match: boolean;\n      confidence: number;\n      reasoning: string;\n    };\n  };\n  remarks: string[];\n  summary: string;\n}\n\nexport const ASSOCIATES: Associate[] = [\n  {\n    id: 'A1',\n    name: 'Bharat',\n    role: 'Senior Field Auditor',\n    avatar: 'https://images.unsplash.com/photo-1599566150163-29194dcaad36?w=150&q=80',\n    totalReports: 142,\n    avgScore: 94\n  },\n  {\n    id: 'A2',\n    name: 'Narender',\n    role: 'Verification Officer',\n    avatar: 'https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?w=150&q=80',\n    totalReports: 89,\n    avgScore: 88\n  },\n  {\n    id: 'A3',\n    name: 'Upender',\n    role: 'Risk Analyst',\n    avatar: 'https://images.unsplash.com/photo-1527980965255-d3b416303d12?w=150&q=80',\n    totalReports: 78,\n    avgScore: 82\n  },\n  {\n    id: 'A4',\n    name: 'Avinash',\n    role: 'Compliance Specialist',\n    avatar: 'https://images.unsplash.com/photo-1633332755192-727a05c4013d?w=150&q=80',\n    totalReports: 156,\n    avgScore: 91\n  },\n  {\n    id: 'A5',\n    name: 'Prashanth',\n    role: 'Audit Manager',\n    avatar: 'https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?w=150&q=80',\n    totalReports: 65,\n    avgScore: 85\n  }\n];\n\nexport const REPORTS: Report[] = [\n  {\n    id: 'HLSA000FF4B1',\n    associateId: 'A4',\n    title: 'PD Verification - Supreme Travels',\n    date: '2024-11-22',\n    status: 'Reviewed',\n    metrics: {\n      totalFields: 84,\n      filledFields: 72,\n      missingFields: [\n        'Applicant Details - Relation',\n        'Reference 1 - Contact No',\n        'Reference 1 - Feedback',\n        'Reference 1 - Feedback (Remark)',\n        'Reference 2 - Name of Party',\n        'Reference 2 - Contact No',\n        'Reference 2 - Feedback',\n        'Immovable Asset - Property Address',\n        'Immovable Asset - Name of Owners',\n        'Movable Asset - Particulars',\n        'Movable Asset - Approx value'\n      ],\n      riskAnalysisDepth: 'Medium',\n      photoCount: 18,\n      dueDiligenceChecks: [\n        'Business License Verification',\n        'Vehicle RC Validation',\n        'Contract Analysis (BDL)',\n        'Financial Margin Assessment'\n      ],\n      photoValidation: {\n        matchedCount: 5,\n        totalKeyDetails: 6,\n        missedDetails: [\n          'Photo 4 shows 8 employees present, report mentions 2 drivers + self'\n        ]\n      }\n    },\n    scores: {\n      completeness: 86,\n      comprehensive: 90,\n      quality: 88,\n      overall: 88\n    },\n    summary: 'Verified Supreme Travels. Applicant has 35 years experience. Fleet includes 3 vehicles. Note: Reference checks and asset details were left blank.',\n    decision: {\n      status: 'Positive',\n      remarks: 'Two active loans on applicant name. Business assets verified physically. Established local presence.',\n      aiValidation: {\n        match: true,\n        confidence: 85,\n        reasoning: 'Strong evidence of business activity and asset ownership supports Positive status, despite missing reference contact details.'\n      }\n    },\n    remarks: [\n      'Name board seen at premises.',\n      'Vehicle RC verified.',\n      'Contract orders with BDL observed.',\n      'Net margin approx 30% confirmed.'\n    ]\n  },\n  {\n    id: 'R-2024-001',\n    associateId: 'A1',\n    title: 'Q4 Financial Compliance Audit - North Region',\n    date: '2024-12-08',\n    status: 'Reviewed',\n    metrics: {\n      totalFields: 150,\n      filledFields: 147,\n      missingFields: [\n        'Receipt #45 - Vendor GST',\n        'Expense Code - Item 12',\n        'Approval Date - Row 8'\n      ],\n      riskAnalysisDepth: 'High',\n      photoCount: 24,\n      dueDiligenceChecks: [\n        'Ledger Cross-Referencing',\n        'Expense Anomaly Detection',\n        'Regulatory Compliance Check',\n        'Internal Control Review'\n      ],\n      photoValidation: {\n        matchedCount: 8,\n        totalKeyDetails: 8,\n        missedDetails: []\n      }\n    },\n    scores: {\n      completeness: 98,\n      comprehensive: 95,\n      quality: 92,\n      overall: 95\n    },\n    summary: 'Excellent adherence to protocol. All mandatory fields populated with high-fidelity data.',\n    decision: {\n      status: 'Positive',\n      remarks: 'Full compliance with all financial protocols. No red flags in ledger review.',\n      aiValidation: {\n        match: true,\n        confidence: 98,\n        reasoning: 'Data consistency across all fields and external cross-references confirms Positive status.'\n      }\n    },\n    remarks: [\n      'Thorough documentation of expense anomalies.',\n      'Cross-referencing with external ledgers was executed perfectly.',\n      'Minor delay in submission noted, but within acceptable limits.'\n    ]\n  },\n  {\n    id: 'R-2024-002',\n    associateId: 'A3',\n    title: 'Safety Protocol Inspection - Warehouse B',\n    date: '2024-12-07',\n    status: 'Flagged',\n    metrics: {\n      totalFields: 80,\n      filledFields: 52,\n      missingFields: [\n        'Zone 1 - Fire Extinguisher Check',\n        'Zone 1 - Exit Sign Visibility',\n        'Zone 2 - Aisle Width',\n        'Zone 2 - Floor Marking',\n        'Zone 3 - Sprinkler Pressure',\n        'Zone 3 - Last Inspection Date',\n        'Staff Interview - Safety Officer',\n        'Staff Interview - Shift Manager',\n        'PPE Check - Helmets Count',\n        'PPE Check - Gloves Inventory',\n        'First Aid Kit - Location A',\n        'First Aid Kit - Expiry Date',\n        'Electrical Panel - Labeling',\n        'Emergency Light - Battery Test',\n        'Evacuation Plan - Posted Copy'\n      ],\n      riskAnalysisDepth: 'Low',\n      photoCount: 4,\n      dueDiligenceChecks: [\n        'Basic Safety Walkthrough'\n      ],\n      photoValidation: {\n        matchedCount: 1,\n        totalKeyDetails: 5,\n        missedDetails: [\n          'Fire extinguisher expiry date not visible in Photo 2',\n          'Emergency exit blocked in Photo 3 but reported as clear',\n          'No photo evidence for Electrical Panel labeling',\n          'PPE usage not visible in work area photos'\n        ]\n      }\n    },\n    scores: {\n      completeness: 65,\n      comprehensive: 70,\n      quality: 55,\n      overall: 63\n    },\n    summary: 'Report lacks critical photo evidence for cited violations. Remarks are vague.',\n    decision: {\n      status: 'Negative',\n      remarks: 'Critical safety violations observed. Immediate rectification required before approval.',\n      aiValidation: {\n        match: true,\n        confidence: 92,\n        reasoning: 'AI detects high-severity keywords (\"blocked exit\", \"expiry\") which aligns with Negative status.'\n      }\n    },\n    remarks: [\n      'Missing photo evidence for Section 4.2.',\n      'Descriptions of safety hazards lack specific measurements.',\n      'Corrective action timeline is ambiguous.'\n    ]\n  },\n  {\n    id: 'R-2024-003',\n    associateId: 'A2',\n    title: 'IT Security Access Review',\n    date: '2024-12-05',\n    status: 'Reviewed',\n    metrics: {\n      totalFields: 200,\n      filledFields: 200,\n      missingFields: [],\n      riskAnalysisDepth: 'High',\n      photoCount: 12,\n      dueDiligenceChecks: [\n        'Access Matrix Validation',\n        'User Role Analysis',\n        'System Log Review',\n        'Policy Adherence Check'\n      ],\n      photoValidation: {\n        matchedCount: 4,\n        totalKeyDetails: 4,\n        missedDetails: []\n      }\n    },\n    scores: {\n      completeness: 100,\n      comprehensive: 88,\n      quality: 90,\n      overall: 92\n    },\n    summary: 'Strong technical depth. Comprehensive coverage of all access nodes.',\n    decision: {\n      status: 'Positive',\n      remarks: 'Robust access controls in place. Minor recommendations provided for optimization.',\n      aiValidation: {\n        match: true,\n        confidence: 95,\n        reasoning: 'Technical assessment scores are high, supporting the Positive recommendation.'\n      }\n    },\n    remarks: [\n      'Complete user access matrix provided.',\n      'Risk assessment methodology is well-justified.',\n      'Recommendations are actionable and prioritized correctly.'\n    ]\n  },\n  {\n    id: 'R-2024-004',\n    associateId: 'A5',\n    title: 'Vendor Risk Assessment - TechCorp',\n    date: '2024-12-09',\n    status: 'Pending',\n    metrics: {\n      totalFields: 110,\n      filledFields: 90,\n      missingFields: [\n        'Vendor ID - Tax Residency',\n        'Sub-processor List - Row 4',\n        'Sub-processor List - Row 5',\n        'Data Center - Location 2',\n        'Certifications - ISO 27001 Expiry',\n        'Certifications - SOC 2 Type II',\n        'Incident Response - Contact Primary',\n        'Incident Response - Contact Secondary',\n        'Insurance - Cyber Liability Limit',\n        'Insurance - Policy Number',\n        'SLA - Uptime Guarantee',\n        'SLA - Penalty Clause',\n        'Termination - Data Return',\n        'Termination - Transition Period'\n      ],\n      riskAnalysisDepth: 'Medium',\n      photoCount: 0,\n      dueDiligenceChecks: [\n        'Financial Stability Check',\n        'Contract Review'\n      ],\n      photoValidation: {\n        matchedCount: 0,\n        totalKeyDetails: 0,\n        missedDetails: ['No photos provided for verification']\n      }\n    },\n    scores: {\n      completeness: 82,\n      comprehensive: 75,\n      quality: 78,\n      overall: 78\n    },\n    summary: 'Adequate assessment but misses some secondary supplier risks.',\n    decision: {\n      status: 'Credit Refer',\n      remarks: 'Primary risks mitigated, but secondary supplier exposure needs deeper dive.',\n      aiValidation: {\n        match: true,\n        confidence: 78,\n        reasoning: 'Ambiguity in secondary supplier data suggests \"Credit Refer\" is the prudent choice.'\n      }\n    },\n    remarks: [\n      'Financial stability check is solid.',\n      'Geopolitical risk factors were not fully explored.',\n      'Contract terms analysis is good.'\n    ]\n  }\n];\n\nexport const getAssociate = (id: string) => ASSOCIATES.find(a => a.id === id);\n","path":null,"size_bytes":10806,"size_tokens":null},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","path":null,"size_bytes":3895,"size_tokens":null},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\n      \"p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]\",\n      className\n    )}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","path":null,"size_bytes":2859,"size_tokens":null},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Minus } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-9 w-9 items-center justify-center border-y border-r border-input text-sm shadow-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-1 ring-ring\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Minus />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","path":null,"size_bytes":2143,"size_tokens":null},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","path":null,"size_bytes":1419,"size_tokens":null},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","path":null,"size_bytes":2712,"size_tokens":null},"client/src/components/ui/command.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","path":null,"size_bytes":4887,"size_tokens":null},"client/src/components/ui/dialog.tsx":{"content":"import * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogTrigger,\n  DialogClose,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","path":null,"size_bytes":3835,"size_tokens":null},"server/static.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(__dirname, \"public\");\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","path":null,"size_bytes":547,"size_tokens":null},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root> & { indicatorClassName?: string }\n>(({ className, value, indicatorClassName, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-2 w-full overflow-hidden rounded-full bg-slate-100\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className={cn(\"h-full w-full flex-1 bg-primary transition-all\", indicatorClassName)}\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }","path":null,"size_bytes":870,"size_tokens":null},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","path":null,"size_bytes":157,"size_tokens":null},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"grid place-content-center peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"grid place-content-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","path":null,"size_bytes":1031,"size_tokens":null},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","path":null,"size_bytes":4419,"size_tokens":null},"client/src/components/ui/dropdown-menu.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md\",\n        \"data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&>svg]:size-4 [&>svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","path":null,"size_bytes":7606,"size_tokens":null},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationLink,\n  PaginationItem,\n  PaginationPrevious,\n  PaginationNext,\n  PaginationEllipsis,\n}\n","path":null,"size_bytes":2751,"size_tokens":null},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  // @replit\n  // Whitespace-nowrap: Badges should never wrap.\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\" +\n  \" hover-elevate \",\n  {\n    variants: {\n      variant: {\n        default:\n          // @replit shadow-xs instead of shadow, no hover because we use hover-elevate\n          \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary:\n          // @replit no hover because we use hover-elevate\n          \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          // @replit shadow-xs instead of shadow, no hover because we use hover-elevate\n          \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n          // @replit shadow-xs\" - use badge outline variable\n        outline: \"text-foreground border [border-color:var(--badge-outline)]\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n","path":null,"size_bytes":1522,"size_tokens":null},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-1.5 w-full grow overflow-hidden rounded-full bg-primary/20\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-4 w-4 rounded-full border border-primary/50 bg-background shadow transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","path":null,"size_bytes":1037,"size_tokens":null},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\" +\n\" hover-elevate active-elevate-2\",\n  {\n    variants: {\n      variant: {\n        default:\n           // @replit: no hover, and add primary border\n           \"bg-primary text-primary-foreground border border-primary-border\",\n        destructive:\n          \"bg-destructive text-destructive-foreground shadow-sm border-destructive-border\",\n        outline:\n          // @replit Shows the background color of whatever card / sidebar / accent background it is inside of.\n          // Inherits the current text color. Uses shadow-xs. no shadow on active\n          // No hover state\n          \" border [border-color:var(--button-outline)] shadow-xs active:shadow-none \",\n        secondary:\n          // @replit border, no hover, no shadow, secondary border.\n          \"border bg-secondary text-secondary-foreground border border-secondary-border \",\n        // @replit no hover, transparent border\n        ghost: \"border border-transparent\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        // @replit changed sizes\n        default: \"min-h-9 px-4 py-2\",\n        sm: \"min-h-8 rounded-md px-3 text-xs\",\n        lg: \"min-h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","path":null,"size_bytes":2356,"size_tokens":null},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","path":null,"size_bytes":4845,"size_tokens":null},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-base shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","path":null,"size_bytes":649,"size_tokens":null},"client/src/pages/compare.tsx":{"content":"import AuditLayout from \"@/components/layout/audit-layout\";\nimport { useAudit } from \"@/lib/audit-context\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Button } from \"@/components/ui/button\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { ArrowLeft, CheckCircle2, AlertTriangle, AlertCircle } from \"lucide-react\";\nimport { Link, useLocation } from \"wouter\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\n\nexport default function ComparePage() {\n  const { reports, associates } = useAudit();\n  const [location] = useLocation();\n  const searchParams = new URLSearchParams(window.location.search);\n  const ids = searchParams.get(\"ids\")?.split(\",\") || [];\n  \n  const selectedReports = reports.filter(r => ids.includes(r.id));\n  \n  const getAssociate = (associateId: string) => {\n    return associates.find(a => a.id === associateId);\n  };\n\n  if (selectedReports.length === 0) {\n    return (\n      <AuditLayout>\n        <div className=\"flex flex-col items-center justify-center h-[60vh] text-center space-y-4\">\n          <AlertCircle className=\"h-12 w-12 text-slate-300\" />\n          <h2 className=\"text-xl font-semibold text-slate-900\">No reports selected</h2>\n          <p className=\"text-slate-500\">Please select reports from the list to compare them.</p>\n          <Link href=\"/reports\">\n            <Button>Back to Reports</Button>\n          </Link>\n        </div>\n      </AuditLayout>\n    );\n  }\n\n  const getScoreColor = (score: number) => {\n    if (score >= 90) return \"text-emerald-600\";\n    if (score >= 70) return \"text-amber-600\";\n    return \"text-rose-600\";\n  };\n\n  const getProgressColor = (score: number) => {\n    if (score >= 90) return \"bg-emerald-500\";\n    if (score >= 70) return \"bg-amber-500\";\n    return \"bg-rose-500\";\n  };\n\n  return (\n    <AuditLayout>\n      <div className=\"space-y-6\">\n        <div className=\"flex items-center gap-4\">\n          <Link href=\"/reports\">\n            <Button variant=\"ghost\" size=\"icon\">\n              <ArrowLeft className=\"h-4 w-4\" />\n            </Button>\n          </Link>\n          <div>\n            <h1 className=\"text-2xl font-bold tracking-tight text-slate-900\">Compare Reports</h1>\n            <p className=\"text-slate-500\">Side-by-side analysis of audit quality.</p>\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n          {selectedReports.map((report) => {\n            const associate = getAssociate(report.associateId);\n            return (\n              <Card key={report.id} className=\"border-t-4 border-t-blue-600 shadow-md\">\n                <CardHeader className=\"space-y-4\">\n                  <div className=\"flex justify-between items-start\">\n                    <Badge variant={report.status === 'Reviewed' ? 'default' : 'secondary'} className={\n                      report.status === 'Reviewed' ? 'bg-emerald-100 text-emerald-700 hover:bg-emerald-100' : \n                      report.status === 'Flagged' ? 'bg-rose-100 text-rose-700 hover:bg-rose-100' : \n                      'bg-amber-100 text-amber-700 hover:bg-amber-100'\n                    }>\n                      {report.status}\n                    </Badge>\n                    <span className=\"text-xs font-mono text-slate-400\">{report.id}</span>\n                  </div>\n                  \n                  <div className=\"space-y-1\">\n                    <CardTitle className=\"text-lg leading-tight\">{report.title}</CardTitle>\n                    <p className=\"text-xs text-slate-500\">{report.date}</p>\n                  </div>\n\n                  <div className=\"flex items-center gap-3 bg-slate-50 p-3 rounded-lg\">\n                    <Avatar className=\"h-10 w-10 border border-slate-200\">\n                      <AvatarImage src={associate?.avatar} />\n                      <AvatarFallback>{associate?.name[0]}</AvatarFallback>\n                    </Avatar>\n                    <div>\n                      <div className=\"text-sm font-medium text-slate-900\">{associate?.name}</div>\n                      <div className=\"text-xs text-slate-500\">{associate?.role}</div>\n                    </div>\n                  </div>\n                </CardHeader>\n\n                <CardContent className=\"space-y-6\">\n                  {/* Scores */}\n                  <div className=\"space-y-4\">\n                    <div className=\"flex items-end justify-between\">\n                      <span className=\"text-sm font-medium text-slate-700\">Overall Score</span>\n                      <span className={`text-3xl font-bold font-mono ${getScoreColor(report.scores.overall)}`}>\n                        {report.scores.overall}\n                      </span>\n                    </div>\n                    <Separator />\n                    \n                    <div className=\"space-y-3\">\n                      <div className=\"space-y-1\">\n                        <div className=\"flex justify-between text-xs\">\n                          <span className=\"text-slate-500\">Completeness</span>\n                          <span className=\"font-medium\">{report.scores.completeness}%</span>\n                        </div>\n                        <Progress value={report.scores.completeness} className=\"h-2\" indicatorClassName={getProgressColor(report.scores.completeness)} />\n                      </div>\n                      \n                      <div className=\"space-y-1\">\n                        <div className=\"flex justify-between text-xs\">\n                          <span className=\"text-slate-500\">Comprehensiveness</span>\n                          <span className=\"font-medium\">{report.scores.comprehensive}%</span>\n                        </div>\n                        <Progress value={report.scores.comprehensive} className=\"h-2\" indicatorClassName={getProgressColor(report.scores.comprehensive)} />\n                      </div>\n                      \n                      <div className=\"space-y-1\">\n                        <div className=\"flex justify-between text-xs\">\n                          <span className=\"text-slate-500\">Remark Quality</span>\n                          <span className=\"font-medium\">{report.scores.quality}%</span>\n                        </div>\n                        <Progress value={report.scores.quality} className=\"h-2\" indicatorClassName={getProgressColor(report.scores.quality)} />\n                      </div>\n                    </div>\n                  </div>\n\n                  {/* Summary */}\n                  <div className=\"space-y-2\">\n                    <h4 className=\"text-sm font-semibold text-slate-900\">AI Summary</h4>\n                    <p className=\"text-sm text-slate-600 bg-slate-50 p-3 rounded-md border border-slate-100\">\n                      {report.summary}\n                    </p>\n                  </div>\n\n                  {/* Remarks */}\n                  <div className=\"space-y-2\">\n                    <h4 className=\"text-sm font-semibold text-slate-900\">Key Remarks</h4>\n                    <ul className=\"space-y-2\">\n                      {report.remarks.map((remark, i) => (\n                        <li key={i} className=\"text-xs text-slate-600 flex gap-2\">\n                          <span className=\"text-blue-500 mt-0.5\"></span>\n                          {remark}\n                        </li>\n                      ))}\n                    </ul>\n                  </div>\n                </CardContent>\n              </Card>\n            );\n          })}\n        </div>\n      </div>\n    </AuditLayout>\n  );\n}","path":null,"size_bytes":7655,"size_tokens":null},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 text-sm font-medium transition-all hover:underline text-left [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 text-muted-foreground transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","path":null,"size_bytes":2001,"size_tokens":null},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport tailwindcss from \"@tailwindcss/vite\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\nimport { metaImagesPlugin } from \"./vite-plugin-meta-images\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    tailwindcss(),\n    metaImagesPlugin(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  css: {\n    postcss: {\n      plugins: [],\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    host: \"0.0.0.0\",\n    allowedHosts: true,\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","path":null,"size_bytes":1330,"size_tokens":null},"client/src/components/ui/chart.tsx":{"content":"import * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload\n            .filter((item) => item.type !== \"none\")\n            .map((item, index) => {\n              const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n              const itemConfig = getPayloadConfigFromPayload(config, item, key)\n              const indicatorColor = color || item.payload.fill || item.color\n\n              return (\n                <div\n                  key={item.dataKey}\n                  className={cn(\n                    \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                    indicator === \"dot\" && \"items-center\"\n                  )}\n                >\n                  {formatter && item?.value !== undefined && item.name ? (\n                    formatter(item.value, item.name, item, index, item.payload)\n                  ) : (\n                    <>\n                      {itemConfig?.icon ? (\n                        <itemConfig.icon />\n                      ) : (\n                        !hideIndicator && (\n                          <div\n                            className={cn(\n                              \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                              {\n                                \"h-2.5 w-2.5\": indicator === \"dot\",\n                                \"w-1\": indicator === \"line\",\n                                \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                  indicator === \"dashed\",\n                                \"my-0.5\": nestLabel && indicator === \"dashed\",\n                              }\n                            )}\n                            style={\n                              {\n                                \"--color-bg\": indicatorColor,\n                                \"--color-border\": indicatorColor,\n                              } as React.CSSProperties\n                            }\n                          />\n                        )\n                      )}\n                      <div\n                        className={cn(\n                          \"flex flex-1 justify-between leading-none\",\n                          nestLabel ? \"items-end\" : \"items-center\"\n                        )}\n                      >\n                        <div className=\"grid gap-1.5\">\n                          {nestLabel ? tooltipLabel : null}\n                          <span className=\"text-muted-foreground\">\n                            {itemConfig?.label || item.name}\n                          </span>\n                        </div>\n                        {item.value && (\n                          <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                            {item.value.toLocaleString()}\n                          </span>\n                        )}\n                      </div>\n                    </>\n                  )}\n                </div>\n              )\n            })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload\n          .filter((item) => item.type !== \"none\")\n          .map((item) => {\n            const key = `${nameKey || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n            return (\n              <div\n                key={item.value}\n                className={cn(\n                  \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n                )}\n              >\n                {itemConfig?.icon && !hideIcon ? (\n                  <itemConfig.icon />\n                ) : (\n                  <div\n                    className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                    style={{\n                      backgroundColor: item.color,\n                    }}\n                  />\n                )}\n                {itemConfig?.label}\n              </div>\n            )\n          })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","path":null,"size_bytes":10763,"size_tokens":null},"client/src/components/ui/field.tsx":{"content":"\"use client\"\n\nimport { useMemo } from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\nimport { Separator } from \"@/components/ui/separator\"\n\nfunction FieldSet({ className, ...props }: React.ComponentProps<\"fieldset\">) {\n  return (\n    <fieldset\n      data-slot=\"field-set\"\n      className={cn(\n        \"flex flex-col gap-6\",\n        \"has-[>[data-slot=checkbox-group]]:gap-3 has-[>[data-slot=radio-group]]:gap-3\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldLegend({\n  className,\n  variant = \"legend\",\n  ...props\n}: React.ComponentProps<\"legend\"> & { variant?: \"legend\" | \"label\" }) {\n  return (\n    <legend\n      data-slot=\"field-legend\"\n      data-variant={variant}\n      className={cn(\n        \"mb-3 font-medium\",\n        \"data-[variant=legend]:text-base\",\n        \"data-[variant=label]:text-sm\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"field-group\"\n      className={cn(\n        \"group/field-group @container/field-group flex w-full flex-col gap-7 data-[slot=checkbox-group]:gap-3 [&>[data-slot=field-group]]:gap-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nconst fieldVariants = cva(\n  \"group/field data-[invalid=true]:text-destructive flex w-full gap-3\",\n  {\n    variants: {\n      orientation: {\n        vertical: [\"flex-col [&>*]:w-full [&>.sr-only]:w-auto\"],\n        horizontal: [\n          \"flex-row items-center\",\n          \"[&>[data-slot=field-label]]:flex-auto\",\n          \"has-[>[data-slot=field-content]]:[&>[role=checkbox],[role=radio]]:mt-px has-[>[data-slot=field-content]]:items-start\",\n        ],\n        responsive: [\n          \"@md/field-group:flex-row @md/field-group:items-center @md/field-group:[&>*]:w-auto flex-col [&>*]:w-full [&>.sr-only]:w-auto\",\n          \"@md/field-group:[&>[data-slot=field-label]]:flex-auto\",\n          \"@md/field-group:has-[>[data-slot=field-content]]:items-start @md/field-group:has-[>[data-slot=field-content]]:[&>[role=checkbox],[role=radio]]:mt-px\",\n        ],\n      },\n    },\n    defaultVariants: {\n      orientation: \"vertical\",\n    },\n  }\n)\n\nfunction Field({\n  className,\n  orientation = \"vertical\",\n  ...props\n}: React.ComponentProps<\"div\"> & VariantProps<typeof fieldVariants>) {\n  return (\n    <div\n      role=\"group\"\n      data-slot=\"field\"\n      data-orientation={orientation}\n      className={cn(fieldVariants({ orientation }), className)}\n      {...props}\n    />\n  )\n}\n\nfunction FieldContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"field-content\"\n      className={cn(\n        \"group/field-content flex flex-1 flex-col gap-1.5 leading-snug\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldLabel({\n  className,\n  ...props\n}: React.ComponentProps<typeof Label>) {\n  return (\n    <Label\n      data-slot=\"field-label\"\n      className={cn(\n        \"group/field-label peer/field-label flex w-fit gap-2 leading-snug group-data-[disabled=true]/field:opacity-50\",\n        \"has-[>[data-slot=field]]:w-full has-[>[data-slot=field]]:flex-col has-[>[data-slot=field]]:rounded-md has-[>[data-slot=field]]:border [&>[data-slot=field]]:p-4\",\n        \"has-data-[state=checked]:bg-primary/5 has-data-[state=checked]:border-primary dark:has-data-[state=checked]:bg-primary/10\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldTitle({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"field-label\"\n      className={cn(\n        \"flex w-fit items-center gap-2 text-sm font-medium leading-snug group-data-[disabled=true]/field:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldDescription({ className, ...props }: React.ComponentProps<\"p\">) {\n  return (\n    <p\n      data-slot=\"field-description\"\n      className={cn(\n        \"text-muted-foreground text-sm font-normal leading-normal group-has-[[data-orientation=horizontal]]/field:text-balance\",\n        \"nth-last-2:-mt-1 last:mt-0 [[data-variant=legend]+&]:-mt-1.5\",\n        \"[&>a:hover]:text-primary [&>a]:underline [&>a]:underline-offset-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldSeparator({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  children?: React.ReactNode\n}) {\n  return (\n    <div\n      data-slot=\"field-separator\"\n      data-content={!!children}\n      className={cn(\n        \"relative -my-2 h-5 text-sm group-data-[variant=outline]/field-group:-mb-2\",\n        className\n      )}\n      {...props}\n    >\n      <Separator className=\"absolute inset-0 top-1/2\" />\n      {children && (\n        <span\n          className=\"bg-background text-muted-foreground relative mx-auto block w-fit px-2\"\n          data-slot=\"field-separator-content\"\n        >\n          {children}\n        </span>\n      )}\n    </div>\n  )\n}\n\nfunction FieldError({\n  className,\n  children,\n  errors,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  errors?: Array<{ message?: string } | undefined>\n}) {\n  const content = useMemo(() => {\n    if (children) {\n      return children\n    }\n\n    if (!errors) {\n      return null\n    }\n\n    if (errors?.length === 1 && errors[0]?.message) {\n      return errors[0].message\n    }\n\n    return (\n      <ul className=\"ml-4 flex list-disc flex-col gap-1\">\n        {errors.map(\n          (error, index) =>\n            error?.message && <li key={index}>{error.message}</li>\n        )}\n      </ul>\n    )\n  }, [children, errors])\n\n  if (!content) {\n    return null\n  }\n\n  return (\n    <div\n      role=\"alert\"\n      data-slot=\"field-error\"\n      className={cn(\"text-destructive text-sm font-normal\", className)}\n      {...props}\n    >\n      {content}\n    </div>\n  )\n}\n\nexport {\n  Field,\n  FieldLabel,\n  FieldDescription,\n  FieldError,\n  FieldGroup,\n  FieldLegend,\n  FieldSeparator,\n  FieldSet,\n  FieldContent,\n  FieldTitle,\n}\n","path":null,"size_bytes":6044,"size_tokens":null},"client/src/lib/audit-context.tsx":{"content":"import { createContext, useContext, useState, ReactNode, useEffect } from \"react\";\nimport type { Report, User } from \"@shared/schema\";\n\ninterface AuditContextType {\n  reports: Report[];\n  associates: User[];\n  loading: boolean;\n  addReport: (report: Omit<Report, \"id\" | \"createdAt\">) => Promise<Report | null>;\n  getReport: (id: string) => Promise<Report | null>;\n  deleteReport: (id: string) => Promise<boolean>;\n  refreshReports: (filters?: { associateId?: string; status?: string; month?: number; year?: number }) => Promise<void>;\n}\n\nconst AuditContext = createContext<AuditContextType | null>(null);\n\nexport function AuditProvider({ children }: { children: ReactNode }) {\n  const [reports, setReports] = useState<Report[]>([]);\n  const [associates, setAssociates] = useState<User[]>([]);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    loadInitialData();\n  }, []);\n\n  const loadInitialData = async () => {\n    try {\n      await Promise.all([\n        refreshReports(),\n        loadAssociates(),\n      ]);\n    } catch (error) {\n      console.error('Failed to load initial data:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const loadAssociates = async () => {\n    try {\n      const response = await fetch('/api/associates', {\n        credentials: 'include',\n      });\n      \n      if (response.ok) {\n        const data = await response.json();\n        setAssociates(data);\n      }\n    } catch (error) {\n      console.error('Failed to load associates:', error);\n    }\n  };\n\n  const refreshReports = async (filters?: { associateId?: string; status?: string; month?: number; year?: number }) => {\n    try {\n      const params = new URLSearchParams();\n      if (filters?.associateId) params.append('associateId', filters.associateId);\n      if (filters?.status) params.append('status', filters.status);\n      if (filters?.month) params.append('month', filters.month.toString());\n      if (filters?.year) params.append('year', filters.year.toString());\n\n      const url = `/api/reports${params.toString() ? `?${params.toString()}` : ''}`;\n      console.log('[DEBUG] Fetching reports from:', url);\n      const response = await fetch(url, {\n        credentials: 'include',\n      });\n      \n      if (response.ok) {\n        const data = await response.json();\n        console.log('[DEBUG] Received reports count:', data?.length || 0);\n        setReports(data);\n      } else {\n        const errorData = await response.json().catch(() => ({}));\n        console.error('[DEBUG] Reports fetch failed with status:', response.status, 'Details:', errorData);\n      }\n    } catch (error) {\n      console.error('Failed to load reports:', error);\n    }\n  };\n\n  const addReport = async (report: Omit<Report, \"id\" | \"createdAt\">): Promise<Report | null> => {\n    try {\n      const response = await fetch('/api/reports', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(report),\n        credentials: 'include',\n      });\n\n      if (response.ok) {\n        const newReport = await response.json();\n        setReports(prev => [newReport, ...prev]);\n        return newReport;\n      }\n      \n      return null;\n    } catch (error) {\n      console.error('Failed to add report:', error);\n      return null;\n    }\n  };\n\n  const getReport = async (id: string): Promise<Report | null> => {\n    try {\n      const response = await fetch(`/api/reports/${id}`, {\n        credentials: 'include',\n      });\n      \n      if (response.ok) {\n        return await response.json();\n      }\n      \n      return null;\n    } catch (error) {\n      console.error('Failed to get report:', error);\n      return null;\n    }\n  };\n\n  const deleteReport = async (id: string): Promise<boolean> => {\n    try {\n      const response = await fetch(`/api/reports/${id}`, {\n        method: 'DELETE',\n        credentials: 'include',\n      });\n      \n      if (response.ok) {\n        setReports(prev => prev.filter(r => r.id !== id));\n        return true;\n      }\n      \n      return false;\n    } catch (error) {\n      console.error('Failed to delete report:', error);\n      return false;\n    }\n  };\n\n  return (\n    <AuditContext.Provider value={{ reports, associates, loading, addReport, getReport, deleteReport, refreshReports }}>\n      {children}\n    </AuditContext.Provider>\n  );\n}\n\nexport function useAudit() {\n  const context = useContext(AuditContext);\n  if (!context) {\n    throw new Error(\"useAudit must be used within an AuditProvider\");\n  }\n  return context;\n}\n","path":null,"size_bytes":4539,"size_tokens":null},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","path":null,"size_bytes":1723,"size_tokens":null},"client/src/components/ui/button-group.tsx":{"content":"import { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Separator } from \"@/components/ui/separator\"\n\nconst buttonGroupVariants = cva(\n  \"flex w-fit items-stretch has-[>[data-slot=button-group]]:gap-2 [&>*]:focus-visible:relative [&>*]:focus-visible:z-10 has-[select[aria-hidden=true]:last-child]:[&>[data-slot=select-trigger]:last-of-type]:rounded-r-md [&>[data-slot=select-trigger]:not([class*='w-'])]:w-fit [&>input]:flex-1\",\n  {\n    variants: {\n      orientation: {\n        horizontal:\n          \"[&>*:not(:first-child)]:rounded-l-none [&>*:not(:first-child)]:border-l-0 [&>*:not(:last-child)]:rounded-r-none\",\n        vertical:\n          \"flex-col [&>*:not(:first-child)]:rounded-t-none [&>*:not(:first-child)]:border-t-0 [&>*:not(:last-child)]:rounded-b-none\",\n      },\n    },\n    defaultVariants: {\n      orientation: \"horizontal\",\n    },\n  }\n)\n\nfunction ButtonGroup({\n  className,\n  orientation,\n  ...props\n}: React.ComponentProps<\"div\"> & VariantProps<typeof buttonGroupVariants>) {\n  return (\n    <div\n      role=\"group\"\n      data-slot=\"button-group\"\n      data-orientation={orientation}\n      className={cn(buttonGroupVariants({ orientation }), className)}\n      {...props}\n    />\n  )\n}\n\nfunction ButtonGroupText({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  asChild?: boolean\n}) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      className={cn(\n        \"bg-muted shadow-xs flex items-center gap-2 rounded-md border px-4 text-sm font-medium [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction ButtonGroupSeparator({\n  className,\n  orientation = \"vertical\",\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"button-group-separator\"\n      orientation={orientation}\n      className={cn(\n        \"bg-input relative !m-0 self-stretch data-[orientation=vertical]:h-auto\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  ButtonGroup,\n  ButtonGroupSeparator,\n  ButtonGroupText,\n  buttonGroupVariants,\n}\n","path":null,"size_bytes":2209,"size_tokens":null},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","path":null,"size_bytes":1148,"size_tokens":null},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-xl border bg-card text-card-foreground shadow\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"font-semibold leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n","path":null,"size_bytes":1828,"size_tokens":null},"client/src/pages/upload.tsx":{"content":"import AuditLayout from \"@/components/layout/audit-layout\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { UploadCloud, FileText, X, Loader2, Link as LinkIcon, CheckCircle, AlertCircle } from \"lucide-react\";\nimport { useState } from \"react\";\nimport { useAuth } from \"@/lib/auth\";\nimport { useAudit } from \"@/lib/audit-context\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ntype UploadResult = {\n  file: File;\n  status: 'pending' | 'uploading' | 'success' | 'error';\n  leadId?: string;\n  fileName?: string;\n  error?: string;\n};\n\ntype UrlUploadResult = {\n  url: string;\n  status: 'pending' | 'uploading' | 'success' | 'error';\n  leadId?: string;\n  fileName?: string;\n  error?: string;\n};\n\nexport default function UploadPage() {\n  const { user } = useAuth();\n  const { refreshReports } = useAudit();\n  const { toast } = useToast();\n  const [isUploading, setIsUploading] = useState(false);\n  const [files, setFiles] = useState<File[]>([]);\n  const [uploadResults, setUploadResults] = useState<UploadResult[]>([]);\n  const [pdfUrl, setPdfUrl] = useState(\"\");\n  const [urlUploadResult, setUrlUploadResult] = useState<UrlUploadResult | null>(null);\n\n  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    if (e.target.files && e.target.files.length > 0) {\n      setFiles((prev) => [...prev, ...Array.from(e.target.files!)]);\n    }\n  };\n\n  const removeFile = (index: number) => {\n    setFiles((prev) => prev.filter((_, i) => i !== index));\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (files.length === 0) {\n      toast({\n        title: \"No files selected\",\n        description: \"Please upload at least one PDF report.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    \n    setIsUploading(true);\n    setUploadResults(files.map(file => ({ file, status: 'pending' })));\n\n    const results: UploadResult[] = [];\n\n    for (let i = 0; i < files.length; i++) {\n      const file = files[i];\n      setUploadResults(prev => prev.map((r, idx) => \n        idx === i ? { ...r, status: 'uploading' } : r\n      ));\n\n      try {\n        const formData = new FormData();\n        formData.append('file', file);\n        formData.append('associateId', user?.id || 'A1');\n\n        const response = await fetch('/api/upload-report', {\n          method: 'POST',\n          body: formData,\n        });\n\n        const data = await response.json();\n\n        if (!response.ok) {\n          results.push({ \n            file, \n            status: 'error', \n            error: data.message || data.error || 'Upload failed' \n          });\n          setUploadResults(prev => prev.map((r, idx) => \n            idx === i ? { ...r, status: 'error', error: data.message || data.error } : r\n          ));\n        } else {\n          results.push({ \n            file, \n            status: 'success', \n            leadId: data.leadId,\n            fileName: data.fileName \n          });\n          setUploadResults(prev => prev.map((r, idx) => \n            idx === i ? { ...r, status: 'success', leadId: data.leadId, fileName: data.fileName } : r\n          ));\n        }\n      } catch (error) {\n        results.push({ \n          file, \n          status: 'error', \n          error: 'Network error' \n        });\n        setUploadResults(prev => prev.map((r, idx) => \n          idx === i ? { ...r, status: 'error', error: 'Network error' } : r\n        ));\n      }\n    }\n\n    setIsUploading(false);\n    \n    const successCount = results.filter(r => r.status === 'success').length;\n    const errorCount = results.filter(r => r.status === 'error').length;\n\n    if (successCount > 0) {\n      refreshReports();\n      toast({\n        title: `${successCount} Report${successCount > 1 ? 's' : ''} Uploaded Successfully`,\n        description: (\n          <div className=\"mt-2 space-y-1\">\n            <p>Reports saved as:</p>\n            <ul className=\"list-disc pl-4 text-xs font-mono\">\n              {results.filter(r => r.status === 'success').slice(0, 5).map((r, i) => (\n                <li key={i}>{r.fileName}</li>\n              ))}\n              {successCount > 5 && <li>...and {successCount - 5} more</li>}\n            </ul>\n          </div>\n        ),\n        duration: 5000,\n      });\n    }\n\n    if (errorCount > 0) {\n      toast({\n        title: `${errorCount} Upload${errorCount > 1 ? 's' : ''} Failed`,\n        description: \"Some files could not be processed. Make sure they contain Lead ID and Date fields.\",\n        variant: \"destructive\",\n        duration: 5000,\n      });\n    }\n\n    if (successCount === files.length) {\n      setFiles([]);\n      setUploadResults([]);\n    }\n  };\n\n  const handleUrlSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!pdfUrl.trim()) {\n      toast({\n        title: \"No URL provided\",\n        description: \"Please enter a PDF URL.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setIsUploading(true);\n    setUrlUploadResult({ url: pdfUrl, status: 'uploading' });\n\n    try {\n      const response = await fetch('/api/upload-report-url', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          url: pdfUrl,\n          associateId: user?.id || 'A1',\n        }),\n      });\n\n      const data = await response.json();\n\n      if (!response.ok) {\n        setUrlUploadResult({ \n          url: pdfUrl, \n          status: 'error', \n          error: data.message || data.error || 'Upload failed' \n        });\n        toast({\n          title: \"Upload Failed\",\n          description: data.message || data.error || \"Could not process PDF from URL\",\n          variant: \"destructive\",\n        });\n      } else {\n        setUrlUploadResult({ \n          url: pdfUrl, \n          status: 'success', \n          leadId: data.leadId,\n          fileName: data.fileName \n        });\n        refreshReports();\n        toast({\n          title: \"Report Uploaded Successfully\",\n          description: `Saved as: ${data.fileName}`,\n        });\n        setPdfUrl(\"\");\n      }\n    } catch (error) {\n      setUrlUploadResult({ \n        url: pdfUrl, \n        status: 'error', \n        error: 'Network error' \n      });\n      toast({\n        title: \"Network Error\",\n        description: \"Failed to connect to server\",\n        variant: \"destructive\",\n      });\n    }\n\n    setIsUploading(false);\n  };\n\n  return (\n    <AuditLayout>\n      <div className=\"max-w-2xl mx-auto space-y-8\">\n        <div>\n          <h1 className=\"text-2xl font-bold tracking-tight text-slate-900\">Upload Monthly Reports</h1>\n          <p className=\"text-slate-500\">Submit your audit documents for compliance verification. Lead ID and Date will be automatically extracted from the PDF.</p>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>New Submission</CardTitle>\n            <CardDescription>\n              Uploading as <span className=\"font-semibold text-slate-900\">{user?.name}</span>\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <Tabs defaultValue=\"file\" className=\"w-full\">\n              <TabsList className=\"grid w-full grid-cols-2 mb-6\">\n                <TabsTrigger value=\"file\" className=\"gap-2\" data-testid=\"tab-file-upload\">\n                  <UploadCloud className=\"h-4 w-4\" />\n                  File Upload\n                </TabsTrigger>\n                <TabsTrigger value=\"url\" className=\"gap-2\" data-testid=\"tab-url-upload\">\n                  <LinkIcon className=\"h-4 w-4\" />\n                  Web Link\n                </TabsTrigger>\n              </TabsList>\n\n              <TabsContent value=\"file\">\n                <form onSubmit={handleSubmit} className=\"space-y-6\">\n                  <div className=\"space-y-2\">\n                    <Label>Report Documents (PDF)</Label>\n                    <p className=\"text-xs text-slate-500\">Lead ID and Report Date will be automatically extracted from each PDF file.</p>\n                    <div className={`border-2 border-dashed rounded-lg p-8 text-center transition-colors ${files.length > 0 ? 'border-emerald-500 bg-emerald-50/50' : 'border-slate-200 hover:border-blue-500 hover:bg-slate-50'}`}>\n                      <Input \n                        type=\"file\" \n                        accept=\".pdf\" \n                        multiple\n                        className=\"hidden\" \n                        id=\"file-upload\"\n                        onChange={handleFileChange}\n                        data-testid=\"input-file-upload\"\n                      />\n                      <Label htmlFor=\"file-upload\" className=\"cursor-pointer block\">\n                        <div className=\"flex flex-col items-center gap-2 text-slate-500\">\n                          <UploadCloud className=\"h-10 w-10\" />\n                          <span className=\"font-medium\">Click to upload PDF files</span>\n                          <span className=\"text-xs\">Lead ID and Date will be extracted automatically</span>\n                        </div>\n                      </Label>\n                    </div>\n\n                    {files.length > 0 && (\n                      <div className=\"mt-4 space-y-2\">\n                        <Label className=\"text-xs text-slate-500 font-medium uppercase tracking-wider\">\n                          Selected Files ({files.length})\n                        </Label>\n                        <div className=\"space-y-2 max-h-60 overflow-y-auto pr-2\">\n                          {files.map((file, index) => {\n                            const result = uploadResults[index];\n                            return (\n                              <div key={index} className={`flex items-center justify-between p-3 bg-white border rounded-md shadow-sm ${\n                                result?.status === 'success' ? 'border-emerald-300 bg-emerald-50' :\n                                result?.status === 'error' ? 'border-rose-300 bg-rose-50' :\n                                'border-slate-200'\n                              }`}>\n                                <div className=\"flex items-center gap-3 overflow-hidden\">\n                                  <div className={`h-8 w-8 rounded-full flex items-center justify-center shrink-0 ${\n                                    result?.status === 'success' ? 'bg-emerald-100' :\n                                    result?.status === 'error' ? 'bg-rose-100' :\n                                    result?.status === 'uploading' ? 'bg-blue-100' :\n                                    'bg-slate-100'\n                                  }`}>\n                                    {result?.status === 'uploading' ? (\n                                      <Loader2 className=\"h-4 w-4 text-blue-600 animate-spin\" />\n                                    ) : (\n                                      <FileText className={`h-4 w-4 ${\n                                        result?.status === 'success' ? 'text-emerald-600' :\n                                        result?.status === 'error' ? 'text-rose-600' :\n                                        'text-slate-600'\n                                      }`} />\n                                    )}\n                                  </div>\n                                  <div className=\"min-w-0\">\n                                    <p className=\"text-sm font-medium text-slate-900 truncate\">{file.name}</p>\n                                    {result?.status === 'success' && (\n                                      <p className=\"text-xs text-emerald-600 font-mono\">Saved as: {result.fileName}</p>\n                                    )}\n                                    {result?.status === 'error' && (\n                                      <p className=\"text-xs text-rose-600\">{result.error}</p>\n                                    )}\n                                  </div>\n                                </div>\n                                <div className=\"flex items-center gap-2\">\n                                  <span className=\"text-xs text-slate-500\">\n                                    {(file.size / 1024 / 1024).toFixed(2)} MB\n                                  </span>\n                                  {!isUploading && (\n                                    <Button\n                                      type=\"button\"\n                                      variant=\"ghost\"\n                                      size=\"icon\"\n                                      className=\"text-slate-400 hover:text-red-500 h-8 w-8\"\n                                      onClick={() => removeFile(index)}\n                                      data-testid={`button-remove-file-${index}`}\n                                    >\n                                      <X className=\"h-4 w-4\" />\n                                    </Button>\n                                  )}\n                                </div>\n                              </div>\n                            );\n                          })}\n                        </div>\n                      </div>\n                    )}\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"notes\">Additional Notes</Label>\n                    <Textarea id=\"notes\" placeholder=\"Any context regarding this batch of reports...\" data-testid=\"input-notes\" />\n                  </div>\n\n                  <Button type=\"submit\" className=\"w-full\" disabled={isUploading || files.length === 0} data-testid=\"button-submit-reports\">\n                    {isUploading ? (\n                      <>\n                        <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                        Processing {files.length} Files...\n                      </>\n                    ) : (\n                      <>\n                        <UploadCloud className=\"mr-2 h-4 w-4\" />\n                        Submit {files.length > 0 ? `${files.length} Reports` : 'Reports'}\n                      </>\n                    )}\n                  </Button>\n                </form>\n              </TabsContent>\n\n              <TabsContent value=\"url\">\n                <form onSubmit={handleUrlSubmit} className=\"space-y-6\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"pdf-url\">PDF Web Link</Label>\n                    <p className=\"text-xs text-slate-500\">Paste a direct link to a PDF file. Lead ID and Date will be extracted automatically.</p>\n                    <Input \n                      id=\"pdf-url\"\n                      type=\"url\"\n                      placeholder=\"https://example.com/report.pdf\"\n                      value={pdfUrl}\n                      onChange={(e) => setPdfUrl(e.target.value)}\n                      data-testid=\"input-pdf-url\"\n                    />\n                  </div>\n\n                  {urlUploadResult && (\n                    <div className={`p-4 rounded-lg border ${\n                      urlUploadResult.status === 'success' ? 'bg-emerald-50 border-emerald-200' :\n                      urlUploadResult.status === 'error' ? 'bg-rose-50 border-rose-200' :\n                      'bg-blue-50 border-blue-200'\n                    }`}>\n                      <div className=\"flex items-center gap-3\">\n                        {urlUploadResult.status === 'uploading' ? (\n                          <Loader2 className=\"h-5 w-5 text-blue-600 animate-spin\" />\n                        ) : urlUploadResult.status === 'success' ? (\n                          <CheckCircle className=\"h-5 w-5 text-emerald-600\" />\n                        ) : (\n                          <AlertCircle className=\"h-5 w-5 text-rose-600\" />\n                        )}\n                        <div>\n                          {urlUploadResult.status === 'uploading' && (\n                            <p className=\"text-sm text-blue-700\">Fetching and processing PDF...</p>\n                          )}\n                          {urlUploadResult.status === 'success' && (\n                            <>\n                              <p className=\"text-sm font-medium text-emerald-700\">Report uploaded successfully!</p>\n                              <p className=\"text-xs text-emerald-600 font-mono\">Saved as: {urlUploadResult.fileName}</p>\n                            </>\n                          )}\n                          {urlUploadResult.status === 'error' && (\n                            <>\n                              <p className=\"text-sm font-medium text-rose-700\">Upload failed</p>\n                              <p className=\"text-xs text-rose-600\">{urlUploadResult.error}</p>\n                            </>\n                          )}\n                        </div>\n                      </div>\n                    </div>\n                  )}\n\n                  <Button type=\"submit\" className=\"w-full\" disabled={isUploading || !pdfUrl.trim()} data-testid=\"button-submit-url\">\n                    {isUploading ? (\n                      <>\n                        <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                        Processing URL...\n                      </>\n                    ) : (\n                      <>\n                        <LinkIcon className=\"mr-2 h-4 w-4\" />\n                        Upload from Link\n                      </>\n                    )}\n                  </Button>\n                </form>\n              </TabsContent>\n            </Tabs>\n          </CardContent>\n        </Card>\n      </div>\n    </AuditLayout>\n  );\n}\n","path":null,"size_bytes":17790,"size_tokens":null},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { storage } from \"./storage\";\nimport { insertReportSchema, type ReportTAT, users } from \"@shared/schema\";\nimport { randomBytes } from \"crypto\";\nimport multer from \"multer\";\nimport { getDocument } from \"pdfjs-dist/legacy/build/pdf.mjs\";\nimport { exec } from \"child_process\";\nimport { promisify } from \"util\";\nimport { writeFile, readFile, unlink } from \"fs/promises\";\nimport { tmpdir } from \"os\";\nimport { join } from \"path\";\nimport dns from \"dns\";\nimport net from \"net\";\nimport { searchTriggerEmail, calculateTATMetrics, formatInitiationTime, sendTestEmail, importWorkAllocationEmails } from \"./gmail\";\nimport { fetchLoanProposalsByQuery, searchEmailsByLeadId, isGmailOAuthConfigured } from \"./gmail-oauth\";\nimport { isAIConfigured } from \"./openrouter\";\nimport { scoreDraft } from \"./deterministic-scoring\";\nimport { searchLeadIdInMIS, parseFlexibleDate } from \"./sheets\";\nimport exifr from \"exifr\";\nimport { db } from \"./db\";\nimport { sql } from \"drizzle-orm\";\n\nconst DEFAULT_USERS = [\n  { id: 'ADMIN', username: 'admin', password: 'password123', name: 'Admin', role: 'System Administrator', avatar: 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=150&q=80' },\n  { id: 'A1', username: 'bharat', password: 'password123', name: 'Bharat', role: 'Verification Officer', avatar: 'https://images.unsplash.com/photo-1599566150163-29194dcaad36?w=150&q=80' },\n  { id: 'A2', username: 'narender', password: 'password123', name: 'Narender', role: 'Verification Officer', avatar: 'https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?w=150&q=80' },\n  { id: 'A3', username: 'upender', password: 'password123', name: 'Upender', role: 'Verification Officer', avatar: 'https://images.unsplash.com/photo-1527980965255-d3b416303d12?w=150&q=80' },\n  { id: 'A4', username: 'avinash', password: 'password123', name: 'Avinash', role: 'Verification Officer', avatar: 'https://images.unsplash.com/photo-1633332755192-727a05c4013d?w=150&q=80' },\n  { id: 'A5', username: 'prashanth', password: 'password123', name: 'Prashanth', role: 'Verification Officer', avatar: 'https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?w=150&q=80' },\n  { id: 'A6', username: 'anosh', password: 'password123', name: 'Anosh', role: 'Verification Officer', avatar: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=150&q=80' }\n];\n\nasync function ensureUsersExist() {\n  try {\n    // Always try to insert default users, using onConflictDoNothing to skip existing ones\n    console.log('Ensuring all default users exist...');\n    await db.insert(users).values(DEFAULT_USERS).onConflictDoNothing();\n    console.log('Default users check complete');\n  } catch (error) {\n    console.error('Error seeding users:', error);\n  }\n}\n\nconst dnsLookup = promisify(dns.lookup);\n\nfunction isPrivateIPv4(ip: string): boolean {\n  const parts = ip.split('.').map(Number);\n  if (parts.length !== 4 || parts.some(p => isNaN(p) || p < 0 || p > 255)) {\n    return false;\n  }\n  if (parts[0] === 10) return true;\n  if (parts[0] === 172 && parts[1] >= 16 && parts[1] <= 31) return true;\n  if (parts[0] === 192 && parts[1] === 168) return true;\n  if (parts[0] === 127) return true;\n  if (parts[0] === 0) return true;\n  if (parts[0] === 169 && parts[1] === 254) return true;\n  return false;\n}\n\nfunction isPrivateOrUnsafeIP(ip: string): boolean {\n  const normalizedIp = ip.replace(/^\\[|\\]$/g, '');\n  \n  if (net.isIPv4(normalizedIp)) {\n    return isPrivateIPv4(normalizedIp);\n  }\n  \n  if (net.isIPv6(normalizedIp)) {\n    return true;\n  }\n  \n  if (normalizedIp.includes(':')) {\n    return true;\n  }\n  \n  return false;\n}\n\ndeclare module 'express-session' {\n  interface SessionData {\n    userId: string;\n    username: string;\n  }\n}\n\nconst execAsync = promisify(exec);\n\nconst upload = multer({ \n  storage: multer.memoryStorage(),\n  limits: { fileSize: 50 * 1024 * 1024 } // 50MB limit\n});\n\nasync function parsePdf(buffer: Buffer): Promise<string> {\n  const uint8Array = new Uint8Array(buffer);\n  const pdf = await getDocument({ data: uint8Array }).promise;\n  let text = '';\n  \n  for (let i = 1; i <= pdf.numPages; i++) {\n    const page = await pdf.getPage(i);\n    const content = await page.getTextContent();\n    const pageText = content.items\n      .map((item: any) => item.str)\n      .join(' ');\n    text += pageText + '\\n';\n  }\n  \n  return text;\n}\n\nasync function compressPdf(buffer: Buffer): Promise<{ compressedBuffer: Buffer; originalSize: number; compressedSize: number }> {\n  const tempInput = join(tmpdir(), `input_${Date.now()}_${randomBytes(4).toString('hex')}.pdf`);\n  const tempOutput = join(tmpdir(), `output_${Date.now()}_${randomBytes(4).toString('hex')}.pdf`);\n  const originalSize = buffer.length;\n  \n  try {\n    await writeFile(tempInput, buffer);\n    \n    const gsCommand = `gs -sDEVICE=pdfwrite -dCompatibilityLevel=1.4 -dPDFSETTINGS=/screen \\\n      -dNOPAUSE -dQUIET -dBATCH \\\n      -dColorImageDownsampleType=/Bicubic -dColorImageResolution=100 \\\n      -dGrayImageDownsampleType=/Bicubic -dGrayImageResolution=100 \\\n      -dMonoImageDownsampleType=/Bicubic -dMonoImageResolution=100 \\\n      -dDownsampleColorImages=true -dDownsampleGrayImages=true -dDownsampleMonoImages=true \\\n      -dOptimize=true -dDetectDuplicateImages=true \\\n      -dCompressFonts=true -dSubsetFonts=true \\\n      -dAutoRotatePages=/None \\\n      -sOutputFile=\"${tempOutput}\" \"${tempInput}\"`;\n    \n    await execAsync(gsCommand);\n    \n    const compressedBuffer = await readFile(tempOutput);\n    const compressedSize = compressedBuffer.length;\n    \n    console.log(`PDF compression: ${(originalSize / 1024).toFixed(2)}KB -> ${(compressedSize / 1024).toFixed(2)}KB (${((1 - compressedSize / originalSize) * 100).toFixed(1)}% reduction)`);\n    \n    return { compressedBuffer, originalSize, compressedSize };\n  } catch (error) {\n    console.error('PDF compression failed, using original:', error);\n    return { compressedBuffer: buffer, originalSize, compressedSize: originalSize };\n  } finally {\n    try { await unlink(tempInput); } catch {}\n    try { await unlink(tempOutput); } catch {}\n  }\n}\n\ninterface PdfMetrics {\n  totalFields: number;\n  filledFields: number;\n  missingFields: string[];\n  photoCount: number;\n  riskLevel: 'High' | 'Medium' | 'Low';\n}\n\nfunction analyzePdfContent(text: string): PdfMetrics {\n  const totalFields = 100;\n  \n  const requiredFields = [\n    { name: 'Reference Check - Primary Contact', pattern: /reference.*primary|primary.*contact/i },\n    { name: 'Reference Check - Secondary Contact', pattern: /reference.*secondary|secondary.*contact/i },\n    { name: 'Neighbor Feedback - 1', pattern: /neighbor.*feedback.*1|neighbour.*feedback.*1/i },\n    { name: 'Neighbor Feedback - 2', pattern: /neighbor.*feedback.*2|neighbour.*feedback.*2/i },\n    { name: 'Asset Verification - Photo 1', pattern: /asset.*photo|photo.*asset/i },\n    { name: 'Applicant Spouse Details', pattern: /spouse|partner/i },\n    { name: 'Emergency Contact Number', pattern: /emergency.*contact|emergency.*number/i },\n    { name: 'Alternate Address', pattern: /alternate.*address|secondary.*address/i },\n    { name: 'Bank Account Details', pattern: /bank.*account|account.*number/i },\n    { name: 'Co-applicant Information', pattern: /co-applicant|coapplicant/i },\n  ];\n  \n  const missingFields: string[] = [];\n  for (const field of requiredFields) {\n    if (!field.pattern.test(text)) {\n      missingFields.push(field.name);\n    }\n  }\n  \n  const filledFields = totalFields - missingFields.length;\n  \n  const photoMatches = text.match(/photo|image|picture|photograph/gi) || [];\n  const photoCount = Math.min(20, Math.max(5, photoMatches.length));\n  \n  let riskLevel: 'High' | 'Medium' | 'Low' = 'Low';\n  const hasNegativeIndicators = /discrepancy|mismatch|inconsistent|unable to verify|not found/i.test(text);\n  const hasMajorIssues = /fraud|fake|false|forged/i.test(text);\n  \n  if (hasMajorIssues) {\n    riskLevel = 'High';\n  } else if (hasNegativeIndicators) {\n    riskLevel = 'Medium';\n  }\n  \n  return { totalFields, filledFields, missingFields, photoCount, riskLevel };\n}\n\nfunction extractLeadId(text: string): string | null {\n  const patterns = [\n    /Lead\\s*Id\\s*[:\\-]?\\s*([A-Za-z0-9]{12})/i,\n    /LeadId\\s*[:\\-]?\\s*([A-Za-z0-9]{12})/i,\n    /Lead\\s*ID\\s*[:\\-]?\\s*([A-Za-z0-9]{12})/i,\n    /Lead\\s*Id\\s*[:\\-]?\\s*(BLSA[A-Za-z0-9_\\-]+)/i,\n    /Lead\\s*Id\\s*[:\\-]?\\s*([A-Za-z0-9_\\-]+)/i,\n    /LeadId\\s*[:\\-]?\\s*([A-Za-z0-9_\\-]+)/i,\n    /Lead\\s*ID\\s*[:\\-]?\\s*([A-Za-z0-9_\\-]+)/i,\n    /(BLSA[A-Za-z0-9_\\-]+)/i,\n    /\\b([A-Za-z]{4}[0-9]{8})\\b/,\n  ];\n  \n  for (const pattern of patterns) {\n    const match = text.match(pattern);\n    if (match && match[1]) {\n      return match[1].trim();\n    }\n  }\n  return null;\n}\n\nfunction extractReportDate(text: string): { date: string; ddmmyy: string } | null {\n  const patterns = [\n    /(?:Report\\s*Date|Date)[:\\-]?\\s*(\\d{1,2})[\\/\\-\\.](\\d{1,2})[\\/\\-\\.](\\d{2,4})/i,\n    /(?:Report\\s*Date|Date)[:\\-]?\\s*(\\d{1,2})\\s*(?:Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)[a-z]*\\s*(\\d{2,4})/i,\n    /(\\d{1,2})[\\/\\-\\.](\\d{1,2})[\\/\\-\\.](\\d{2,4})/,\n    /(\\d{4})[\\/\\-\\.](\\d{1,2})[\\/\\-\\.](\\d{1,2})/,\n  ];\n  \n  for (const pattern of patterns) {\n    const match = text.match(pattern);\n    if (match) {\n      let day: string, month: string, year: string;\n      \n      if (match[1].length === 4) {\n        year = match[1];\n        month = match[2].padStart(2, '0');\n        day = match[3].padStart(2, '0');\n      } else {\n        day = match[1].padStart(2, '0');\n        month = match[2].padStart(2, '0');\n        year = match[3];\n      }\n      \n      if (year.length === 4) {\n        year = year.slice(2);\n      }\n      \n      const fullYear = year.length === 2 ? (parseInt(year) > 50 ? '19' + year : '20' + year) : year;\n      const isoDate = `${fullYear}-${month}-${day}`;\n      const ddmmyy = `${day}${month}${year}`;\n      \n      return { date: isoDate, ddmmyy };\n    }\n  }\n  return null;\n}\n\nfunction extractVisitDateTime(text: string): Date | null {\n  const patterns = [\n    /(?:Visit\\s*(?:Date\\s*(?:&|and)?\\s*)?Time|Photo\\s*Timestamp|Visited\\s*(?:on|at)|Site\\s*Visit|Field\\s*Visit)[:\\-]?\\s*(\\d{1,2})[\\/\\-\\.](\\d{1,2})[\\/\\-\\.](\\d{2,4})\\s*(?:at\\s*)?(\\d{1,2}):(\\d{2})(?::(\\d{2}))?\\s*(AM|PM)?/i,\n    /(?:Visit\\s*(?:Date\\s*(?:&|and)?\\s*)?Time|Photo\\s*Timestamp|Visited\\s*(?:on|at))[:\\-]?\\s*(\\d{1,2})[\\/\\-\\.](\\d{1,2})[\\/\\-\\.](\\d{2,4})\\s+(\\d{1,2}):(\\d{2})(?::(\\d{2}))?/i,\n    /(?:Photo|Image)\\s*(?:taken|captured)\\s*(?:on|at)[:\\-]?\\s*(\\d{1,2})[\\/\\-\\.](\\d{1,2})[\\/\\-\\.](\\d{2,4})\\s+(\\d{1,2}):(\\d{2})/i,\n    /(\\d{1,2})[\\/\\-\\.](\\d{1,2})[\\/\\-\\.](\\d{2,4})\\s+(\\d{1,2}):(\\d{2})(?::(\\d{2}))?\\s*(AM|PM)?/i,\n    /(\\d{4})[\\/\\-\\.](\\d{1,2})[\\/\\-\\.](\\d{1,2})\\s+(\\d{1,2}):(\\d{2})(?::(\\d{2}))?/i,\n    /(\\d{1,2})[\\/\\-](\\d{1,2})[\\/\\-](\\d{2,4})\\s*,?\\s*(\\d{1,2}):(\\d{2})(?::(\\d{2}))?\\s*(AM|PM)?/i,\n    /(\\d{2})(\\d{2})(\\d{4})\\s+(\\d{2}):(\\d{2})(?::(\\d{2}))?/i,\n  ];\n  \n  let foundDates: Date[] = [];\n  \n  const dateTimeMatches = text.match(/\\d{1,2}[\\/\\-\\.]\\d{1,2}[\\/\\-\\.]\\d{2,4}\\s*,?\\s*\\d{1,2}:\\d{2}/g);\n  if (dateTimeMatches) {\n    console.log(`Found potential date-time strings in PDF: ${dateTimeMatches.slice(0, 5).join(', ')}`);\n  }\n  \n  for (const pattern of patterns) {\n    const matches = text.matchAll(new RegExp(pattern.source, 'gim'));\n    for (const match of matches) {\n      try {\n        let day: number, month: number, year: number;\n        let hours = parseInt(match[4]) || 0;\n        let minutes = parseInt(match[5]) || 0;\n        let seconds = parseInt(match[6]) || 0;\n        const ampm = match[7];\n        \n        if (match[1].length === 4) {\n          year = parseInt(match[1]);\n          month = parseInt(match[2]);\n          day = parseInt(match[3]);\n        } else {\n          day = parseInt(match[1]);\n          month = parseInt(match[2]);\n          year = parseInt(match[3]);\n        }\n        \n        if (year < 100) {\n          year = year > 50 ? 1900 + year : 2000 + year;\n        }\n        \n        if (ampm) {\n          if (ampm.toUpperCase() === 'PM' && hours < 12) hours += 12;\n          if (ampm.toUpperCase() === 'AM' && hours === 12) hours = 0;\n        }\n        \n        const date = new Date(year, month - 1, day, hours, minutes, seconds);\n        if (!isNaN(date.getTime()) && date.getFullYear() >= 2020 && date.getFullYear() <= 2030) {\n          foundDates.push(date);\n        }\n      } catch {\n        continue;\n      }\n    }\n  }\n  \n  if (foundDates.length > 0) {\n    foundDates.sort((a, b) => a.getTime() - b.getTime());\n    console.log(`Found ${foundDates.length} date(s) in PDF text, earliest: ${foundDates[0].toISOString()}`);\n    return foundDates[0];\n  }\n  \n  console.log('No date-time patterns found in PDF text');\n  return null;\n}\n\nfunction parseVisitDateFromText(text: string): Date | null {\n  const patterns = [\n    /(\\d{1,2})[\\/\\-](\\d{1,2})[\\/\\-](\\d{4})\\s+(\\d{1,2}):(\\d{2})(?::(\\d{2}))?\\s*(AM|PM)?/gi,\n    /(\\d{1,2})[\\/\\-](\\d{1,2})[\\/\\-](\\d{2})\\s+(\\d{1,2}):(\\d{2})(?::(\\d{2}))?\\s*(AM|PM)?/gi,\n    /(\\d{4})[\\/\\-](\\d{1,2})[\\/\\-](\\d{1,2})\\s+(\\d{1,2}):(\\d{2})(?::(\\d{2}))?/gi,\n  ];\n  \n  for (const pattern of patterns) {\n    const matches = text.matchAll(new RegExp(pattern.source, 'gi'));\n    for (const match of matches) {\n      try {\n        let day: number, month: number, year: number;\n        let hours = parseInt(match[4]) || 0;\n        let minutes = parseInt(match[5]) || 0;\n        const ampm = match[7];\n        \n        if (match[1].length === 4) {\n          year = parseInt(match[1]);\n          month = parseInt(match[2]);\n          day = parseInt(match[3]);\n        } else {\n          day = parseInt(match[1]);\n          month = parseInt(match[2]);\n          year = parseInt(match[3]);\n          if (year < 100) {\n            year = year > 50 ? 1900 + year : 2000 + year;\n          }\n        }\n        \n        if (ampm) {\n          if (ampm.toUpperCase() === 'PM' && hours < 12) hours += 12;\n          if (ampm.toUpperCase() === 'AM' && hours === 12) hours = 0;\n        }\n        \n        const date = new Date(year, month - 1, day, hours, minutes);\n        if (!isNaN(date.getTime()) && date.getFullYear() >= 2020 && date.getFullYear() <= 2030) {\n          return date;\n        }\n      } catch {\n        continue;\n      }\n    }\n  }\n  return null;\n}\n\nasync function extractVisitTimeFromImages(buffer: Buffer): Promise<Date | null> {\n  try {\n    const jpegSignature = Buffer.from([0xFF, 0xD8, 0xFF]);\n    let earliestDate: Date | null = null;\n    let imagesFound = 0;\n    let datesFound = 0;\n    \n    let searchStart = 0;\n    while (searchStart < buffer.length - 3) {\n      const jpegStart = buffer.indexOf(jpegSignature, searchStart);\n      if (jpegStart === -1) break;\n      \n      let jpegEnd = buffer.indexOf(Buffer.from([0xFF, 0xD9]), jpegStart + 2);\n      if (jpegEnd === -1) {\n        jpegEnd = Math.min(jpegStart + 5000000, buffer.length);\n      } else {\n        jpegEnd += 2;\n      }\n      \n      const jpegData = buffer.slice(jpegStart, jpegEnd);\n      imagesFound++;\n      \n      try {\n        const exifData = await exifr.parse(jpegData, { \n          pick: ['DateTimeOriginal', 'CreateDate', 'ModifyDate', 'DateTime'] \n        });\n        \n        if (exifData) {\n          const dateValue = exifData.DateTimeOriginal || exifData.CreateDate || exifData.DateTime || exifData.ModifyDate;\n          if (dateValue) {\n            const imgDate = new Date(dateValue);\n            if (!isNaN(imgDate.getTime()) && imgDate.getFullYear() >= 2020 && imgDate.getFullYear() <= 2030) {\n              datesFound++;\n              console.log(`Found EXIF date: ${imgDate.toISOString()}`);\n              if (!earliestDate || imgDate < earliestDate) {\n                earliestDate = imgDate;\n              }\n            }\n          }\n        }\n      } catch {\n      }\n      \n      searchStart = jpegEnd;\n      if (imagesFound >= 50) break;\n    }\n    \n    console.log(`Scanned ${imagesFound} JPEG images, found ${datesFound} with EXIF dates`);\n    \n    return earliestDate;\n  } catch (error) {\n    console.error('Error extracting dates from PDF images:', error);\n    return null;\n  }\n}\n\nfunction extractDecision(text: string): 'Positive' | 'Negative' | 'Credit Refer' | null {\n  const safeDecisions = '(positive|negative|credit\\\\s+refer|approved|rejected|declined|not\\\\s+recommended|recommended)';\n  const referWithNegativeLookahead = '\\\\b(refer)\\\\b(?!\\\\s*(?:to|for|the|this|that|a|an|ence|ring|red|s\\\\b))';\n  const labelPrefixes = '(?:(?:final|verification|field|case|loan|application|applicant|report|investigation)\\\\s+)*';\n  const labelTypes = '(?:decision|status|verdict|result|recommendation|outcome)';\n  \n  const safePatterns = [\n    new RegExp(`${labelPrefixes}${labelTypes}\\\\s*[:\\\\-]?\\\\s*${safeDecisions}`, 'im'),\n  ];\n  \n  for (const pattern of safePatterns) {\n    const match = text.match(pattern);\n    if (match && match[1]) {\n      const decision = match[1].toLowerCase().trim().replace(/\\s+/g, ' ');\n      \n      if (decision === 'positive' || decision === 'approved' || decision === 'recommended') {\n        return 'Positive';\n      }\n      if (decision === 'negative' || decision === 'rejected' || decision === 'declined' || decision === 'not recommended') {\n        return 'Negative';\n      }\n      if (decision === 'credit refer') {\n        return 'Credit Refer';\n      }\n    }\n  }\n  \n  const referPatterns = [\n    new RegExp(`${labelPrefixes}${labelTypes}\\\\s*[:\\\\-]?\\\\s*${referWithNegativeLookahead}`, 'im'),\n  ];\n  \n  for (const pattern of referPatterns) {\n    const match = text.match(pattern);\n    if (match && match[1]) {\n      return 'Credit Refer';\n    }\n  }\n  \n  return null;\n}\n\n// Build version for cache invalidation - update this timestamp when deploying\nconst BUILD_VERSION = \"2025-12-19T07:50:00Z-ai-holistic\";\n\nexport async function registerRoutes(\n  httpServer: Server,\n  app: Express\n): Promise<Server> {\n  // Ensure default users exist on startup (works for both dev and production)\n  await ensureUsersExist();\n\n  // Helper to mark MIS entries as completed when a report is uploaded\n  // reportDate: Use the actual report date as the out date (for TAT calculation)\n  async function markMisEntryCompleted(leadId: string | null | undefined, reportDate?: string): Promise<void> {\n    if (!leadId || leadId.trim() === '') return;\n    try {\n      const normalizedLeadId = leadId.trim();\n      const misEntry = await storage.getMisEntryByLeadId(normalizedLeadId);\n      if (misEntry && misEntry.workflowStatus !== 'completed') {\n        // Use the report date if provided, otherwise use today's date\n        const outDate = reportDate || new Date().toISOString().split('T')[0];\n        await storage.updateMisEntry(misEntry.id, {\n          status: 'Completed',\n          workflowStatus: 'completed',\n          outDate: outDate,\n        });\n        console.log(`[MIS] Marked entry ${misEntry.id} (Lead: ${normalizedLeadId}) as completed with outDate: ${outDate}`);\n      }\n    } catch (error) {\n      console.error(`[MIS] Failed to mark entry completed for Lead ID ${leadId}:`, error);\n      // Don't throw - don't break report creation if MIS update fails\n    }\n  }\n\n  // Version check endpoint - helps verify production deployment\n  app.get(\"/api/version\", (req, res) => {\n    res.json({ \n      version: BUILD_VERSION,\n      environment: process.env.NODE_ENV || 'development',\n      timestamp: new Date().toISOString()\n    });\n  });\n\n  // Debug endpoint - directly check database (temporary for debugging)\n  app.get(\"/api/debug-reports\", async (req, res) => {\n    try {\n      const reports = await storage.getReports({});\n      const sessionUserId = req.session?.userId || 'NO_SESSION';\n      const dbUrl = process.env.DATABASE_URL ? 'SET' : 'NOT_SET';\n      \n      res.json({\n        version: BUILD_VERSION,\n        environment: process.env.NODE_ENV || 'development',\n        sessionUserId,\n        databaseConnected: dbUrl,\n        reportCount: reports.length,\n        reportIds: reports.map(r => ({ id: r.id, associateId: r.associateId }))\n      });\n    } catch (error) {\n      res.status(500).json({ \n        error: String(error),\n        version: BUILD_VERSION,\n        environment: process.env.NODE_ENV || 'development'\n      });\n    }\n  });\n\n  // AI status endpoint - check if AI credentials are configured (for production debugging)\n  app.get(\"/api/ai-status\", async (req, res) => {\n    try {\n      const { isAIConfigured } = await import(\"./openrouter\");\n      const configured = isAIConfigured();\n      \n      // Check which credentials are available (without exposing values)\n      const hasStandardKey = !!process.env.OPENROUTER_API_KEY;\n      const hasIntegrationsKey = !!process.env.AI_INTEGRATIONS_OPENROUTER_API_KEY;\n      const hasIntegrationsURL = !!process.env.AI_INTEGRATIONS_OPENROUTER_BASE_URL;\n      \n      res.json({\n        configured,\n        credentials: {\n          standardKey: hasStandardKey,\n          integrationsKey: hasIntegrationsKey,\n          integrationsURL: hasIntegrationsURL,\n        },\n        version: BUILD_VERSION,\n        environment: process.env.NODE_ENV || 'development',\n        timestamp: new Date().toISOString()\n      });\n    } catch (error) {\n      res.status(500).json({ \n        error: String(error),\n        configured: false,\n        version: BUILD_VERSION\n      });\n    }\n  });\n\n  // AI test endpoint - actually make a simple AI call to verify it works\n  app.get(\"/api/ai-test\", async (req, res) => {\n    const testId = `test_${Date.now()}`;\n    console.log(`[AI Test - ${testId}] Starting AI test call...`);\n    \n    try {\n      const { isAIConfigured } = await import(\"./openrouter\");\n      \n      if (!isAIConfigured()) {\n        console.log(`[AI Test - ${testId}] AI not configured`);\n        return res.json({\n          success: false,\n          error: \"AI not configured\",\n          configured: false,\n          version: BUILD_VERSION\n        });\n      }\n\n      console.log(`[AI Test - ${testId}] AI configured, making test call...`);\n      \n      // Make a simple test call to OpenRouter\n      const OpenAI = (await import(\"openai\")).default;\n      \n      // Get credentials\n      const apiKey = process.env.OPENROUTER_API_KEY || process.env.AI_INTEGRATIONS_OPENROUTER_API_KEY;\n      const baseURL = process.env.OPENROUTER_BASE_URL || process.env.AI_INTEGRATIONS_OPENROUTER_BASE_URL || 'https://openrouter.ai/api/v1';\n      \n      console.log(`[AI Test - ${testId}] Using baseURL: ${baseURL}, hasKey: ${!!apiKey}`);\n      \n      const client = new OpenAI({ baseURL, apiKey });\n      \n      const startTime = Date.now();\n      const result = await client.chat.completions.create({\n        model: \"deepseek/deepseek-v3.2\",\n        messages: [{ role: \"user\", content: \"Reply with just the word 'OK'\" }],\n        max_tokens: 10,\n      });\n      const endTime = Date.now();\n      \n      const response = result.choices[0]?.message?.content || \"\";\n      console.log(`[AI Test - ${testId}] Success! Response: \"${response}\" in ${endTime - startTime}ms`);\n      \n      res.json({\n        success: true,\n        response: response,\n        latencyMs: endTime - startTime,\n        model: \"deepseek/deepseek-v3.2\",\n        version: BUILD_VERSION,\n        timestamp: new Date().toISOString()\n      });\n    } catch (error: any) {\n      console.error(`[AI Test - ${testId}] FAILED:`, {\n        message: error?.message,\n        status: error?.status,\n        code: error?.code,\n        type: error?.type,\n      });\n      \n      res.status(500).json({\n        success: false,\n        error: error?.message || 'Unknown error',\n        errorStatus: error?.status,\n        errorCode: error?.code,\n        version: BUILD_VERSION,\n        timestamp: new Date().toISOString()\n      });\n    }\n  });\n\n  // Scoring test endpoint - tests the AI-based scoring function\n  app.get(\"/api/ai-score-test\", async (req, res) => {\n    const testId = `scoretest_${Date.now()}`;\n    console.log(`[Score Test - ${testId}] Starting AI-based scoring test...`);\n    \n    try {\n      const { scoreComprehensiveWithAI, isAIConfigured } = await import(\"./ai-scoring\");\n      \n      if (!isAIConfigured()) {\n        return res.json({\n          success: false,\n          error: \"AI not configured - missing OPENROUTER_API_KEY\",\n          version: BUILD_VERSION\n        });\n      }\n\n      const testPdfText = `\n        Personal Details:\n        Name: John Doe\n        Education: Graduate degree from Mumbai University\n        Spouse: Jane Doe, homemaker\n        Children: 2 kids studying at DPS School\n        Residence: Owned property for 10 years\n        \n        Business Details:\n        Business Name: Doe Trading Enterprises\n        Nature of Business: Trading and wholesale\n        Established: 15 years ago\n        GST Registration: Active\n        Experience: 20 years in trading\n        Employees: 5 staff members\n        Monthly Turnover: Rs 500000\n        Clients: Multiple retail customers\n        Warehouse: Stock visible during visit\n        \n        Banking Details:\n        Bank: HDFC Bank\n        Account Tenure: 5 years\n        QR Code: UPI/PhonePe available\n        Turnover credited: 70% routed through bank\n        \n        Networth:\n        Property: 2 residential properties\n        Vehicles: Car and bike owned\n        \n        Existing Loans:\n        Home loan from HDFC, EMI regular\n        Good repayment history, no defaults\n        \n        End Use:\n        Purchase of commercial property\n        Agreement value: Rs 50 lakhs\n        Advance paid: Rs 10 lakhs\n        Self occupation planned\n        \n        References:\n        Neighbor reference verified\n        Supplier reference checked\n        Invoices seen during visit\n      `;\n\n      console.log(`[Score Test - ${testId}] Calling scoreComprehensiveWithAI...`);\n      const startTime = Date.now();\n      const scores = await scoreComprehensiveWithAI(testPdfText, \"TEST123\");\n      const endTime = Date.now();\n\n      const totalScore = scores.personal + scores.business + scores.banking + \n                        scores.networth + scores.existingDebt + scores.endUse + \n                        scores.referenceChecks;\n\n      console.log(`[Score Test - ${testId}] Scores: total=${totalScore}`);\n      \n      res.json({\n        success: true,\n        totalScore,\n        method: \"ai-holistic\",\n        scores: {\n          personal: scores.personal,\n          business: scores.business,\n          banking: scores.banking,\n          networth: scores.networth,\n          existingDebt: scores.existingDebt,\n          endUse: scores.endUse,\n          referenceChecks: scores.referenceChecks,\n        },\n        rationale: scores.rationale,\n        latencyMs: endTime - startTime,\n        version: BUILD_VERSION,\n        timestamp: new Date().toISOString()\n      });\n    } catch (error: any) {\n      console.error(`[Score Test - ${testId}] FAILED:`, error);\n      res.status(500).json({\n        success: false,\n        error: error?.message || 'Unknown error',\n        version: BUILD_VERSION\n      });\n    }\n  });\n\n  // Development auto-login endpoint - allows login via GET request for testing\n  app.get(\"/api/dev-login/:username\", async (req, res) => {\n    if (process.env.NODE_ENV === \"production\") {\n      return res.status(404).json({ error: \"Not found\" });\n    }\n    \n    const { username } = req.params;\n    const user = await storage.getUserByUsername(username.toLowerCase().trim());\n    \n    if (!user) {\n      return res.status(404).json({ error: \"User not found\" });\n    }\n    \n    req.session.userId = user.id;\n    req.session.username = user.username;\n    \n    req.session.save((err) => {\n      if (err) {\n        console.error(\"Session save error:\", err);\n        return res.status(500).json({ error: \"Session error\" });\n      }\n      \n      // Redirect to admin dashboard for admin, upload for others\n      const redirectUrl = user.id === 'ADMIN' ? '/' : '/upload';\n      res.redirect(redirectUrl);\n    });\n  });\n\n  app.post(\"/api/login\", async (req, res) => {\n    try {\n      const { username, password } = req.body;\n      console.log(\"Login attempt:\", { username, passwordLength: password?.length });\n      \n      if (!username || !password) {\n        console.log(\"Login failed: missing credentials\");\n        return res.status(400).json({ error: \"Username and password required\" });\n      }\n      \n      // Normalize username to lowercase\n      const normalizedUsername = username.toLowerCase().trim();\n      console.log(\"Looking up user:\", normalizedUsername);\n      \n      const user = await storage.getUserByUsername(normalizedUsername);\n      console.log(\"User found:\", user ? user.username : \"not found\");\n      \n      if (!user) {\n        console.log(\"User not found in database\");\n        return res.status(401).json({ error: \"Invalid credentials\" });\n      }\n      \n      // Check password (case-sensitive)\n      if (user.password !== password) {\n        console.log(\"Password mismatch:\", { expected: user.password, got: password });\n        return res.status(401).json({ error: \"Invalid credentials\" });\n      }\n      \n      const userWithoutPassword = {\n        id: user.id,\n        username: user.username,\n        name: user.name,\n        role: user.role,\n        avatar: user.avatar,\n        isAdmin: user.id === 'ADMIN',\n      };\n      \n      if (req.session) {\n        req.session.userId = user.id;\n        req.session.username = user.username;\n      }\n      \n      return res.json(userWithoutPassword);\n    } catch (error) {\n      console.error(\"Login error:\", error);\n      return res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  app.post(\"/api/logout\", (req, res) => {\n    if (req.session) {\n      req.session.destroy((err: any) => {\n        if (err) {\n          return res.status(500).json({ error: \"Failed to logout\" });\n        }\n        res.json({ success: true });\n      });\n    } else {\n      res.json({ success: true });\n    }\n  });\n\n  app.get(\"/api/user\", async (req, res) => {\n    try {\n      if (!req.session?.userId) {\n        return res.status(401).json({ error: \"Not authenticated\" });\n      }\n      \n      const user = await storage.getUserByUsername(req.session.username!);\n      \n      if (!user) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n      \n      const userWithoutPassword = {\n        id: user.id,\n        username: user.username,\n        name: user.name,\n        role: user.role,\n        avatar: user.avatar,\n        isAdmin: user.id === 'ADMIN',\n      };\n      \n      return res.json(userWithoutPassword);\n    } catch (error) {\n      console.error(\"Get user error:\", error);\n      return res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  app.post(\"/api/reports\", async (req, res) => {\n    try {\n      const validationResult = insertReportSchema.safeParse(req.body);\n      \n      if (!validationResult.success) {\n        return res.status(400).json({ \n          error: \"Invalid report data\", \n          details: validationResult.error.errors \n        });\n      }\n      \n      const reportData = validationResult.data;\n      \n      const reportId = `${reportData.associateId}_${reportData.date.replace(/-/g, '')}_${randomBytes(2).toString('hex')}`;\n      \n      const report = await storage.createReport({\n        ...reportData,\n        id: reportId,\n      });\n      \n      // Mark corresponding MIS entry as completed with report date\n      await markMisEntryCompleted(reportData.leadId, reportData.date);\n      \n      return res.status(201).json(report);\n    } catch (error) {\n      console.error(\"Create report error:\", error);\n      return res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  app.post(\"/api/upload-report\", upload.single('file'), async (req, res) => {\n    try {\n      if (!req.file) {\n        return res.status(400).json({ error: \"No file uploaded\" });\n      }\n\n      const { associateId } = req.body;\n      \n      if (!associateId) {\n        return res.status(400).json({ error: \"Associate ID is required\" });\n      }\n\n      const pdfText = await parsePdf(req.file.buffer);\n      \n      const { compressedBuffer, originalSize, compressedSize } = await compressPdf(req.file.buffer);\n      \n      const leadId = extractLeadId(pdfText);\n      \n      if (!leadId) {\n        return res.status(400).json({ \n          error: \"Could not extract Lead ID from PDF\", \n          message: \"Please ensure the PDF contains 'Lead Id:' field on the first page\"\n        });\n      }\n\n      const reportDateInfo = extractReportDate(pdfText);\n      \n      if (!reportDateInfo) {\n        return res.status(400).json({ \n          error: \"Could not extract Report Date from PDF\", \n          message: \"Please ensure the PDF contains a date field on the first page\"\n        });\n      }\n\n      const { date, ddmmyy } = reportDateInfo;\n\n      // Check for duplicate report\n      const existingReport = await storage.getReportByLeadIdAndDate(leadId, date);\n      if (existingReport) {\n        return res.status(409).json({ \n          error: \"Duplicate report\", \n          message: `A report for Lead ID ${leadId} with date ${date} already exists`,\n          existingReportId: existingReport.id\n        });\n      }\n\n      const extractedDecision = extractDecision(pdfText);\n      if (!extractedDecision) {\n        return res.status(400).json({ \n          error: \"Could not extract Decision from PDF\", \n          message: \"Please ensure the PDF contains a decision field (e.g., 'Decision: Positive/Negative/Refer')\"\n        });\n      }\n      const reportDecision = extractedDecision;\n\n      // Analyze PDF content for deterministic scoring\n      const pdfMetrics = analyzePdfContent(pdfText);\n      const { totalFields, filledFields, missingFields: selectedMissing, photoCount, riskLevel } = pdfMetrics;\n      \n      // Calculate completeness score deterministically\n      const completenessScore = Math.round((filledFields / totalFields) * 100);\n      \n      // Calculate comprehensive score using AI analysis\n      // AI analyzes the PDF content and scores based on actual understanding, not rigid patterns\n      const { scoreComprehensiveWithAI } = await import(\"./openrouter\");\n      \n      console.log(`[AI Scoring - ${leadId}] Starting AI-powered comprehensive scoring...`);\n      \n      const aiScores = await scoreComprehensiveWithAI(pdfText, leadId);\n      \n      console.log(`[AI Scoring - ${leadId}] AI scores received:`, aiScores);\n      \n      const personalScore = aiScores.personal;\n      const businessScore = aiScores.business;\n      const bankingScore = aiScores.banking;\n      const assetScore = aiScores.networth;\n      const debtScore = aiScores.existingDebt;\n      const endUseScore = aiScores.endUse;\n      const referenceChecksScore = aiScores.referenceChecks;\n      const personalMatches = aiScores.personalMatches;\n      \n      const comprehensiveScore = personalScore + businessScore + bankingScore + assetScore + debtScore + endUseScore + referenceChecksScore;\n      \n      // Calculate quality score based on completeness\n      let qualityScore = 75;\n      if (extractedDecision) qualityScore += 8;\n      if (reportDateInfo) qualityScore += 7;\n      if (leadId) qualityScore += 5;\n      if (completenessScore > 80) qualityScore += 5;\n      qualityScore = Math.min(95, qualityScore);\n      \n      const overallScore = Math.round((comprehensiveScore + qualityScore) / 2);\n\n      const allDueDiligenceChecks = [\n        'Identity Verification', 'Address Confirmation', 'Business License Check',\n        'Income Verification', 'Bank Statement Review', 'Employment Confirmation',\n        'Property Ownership Check', 'Vehicle RC Validation', 'Utility Bill Verification',\n        'Tax Return Review', 'Reference Verification', 'Neighborhood Survey'\n      ];\n      // Deterministic selection based on lead ID\n      const leadHash = leadId.split('').reduce((a, b) => a + b.charCodeAt(0), 0);\n      const checkCount = 2 + (leadHash % 4);\n      const selectedChecks = allDueDiligenceChecks.slice(0, checkCount);\n\n      const allMissedDetails = [\n        'House color differs from description',\n        'Landmark mismatch in photos',\n        'Business signboard not visible in photos',\n        'Number of employees differs from report',\n        'Vehicle count mismatch',\n        'Property boundary unclear',\n        'Neighboring shop details inconsistent',\n        'Street name not matching',\n        'Building structure differs from description',\n        'Asset condition not as reported'\n      ];\n      // Deterministic selection based on comprehensive score\n      const missedCount = comprehensiveScore < 85 ? Math.max(0, Math.floor((85 - comprehensiveScore) / 10)) : 0;\n      const selectedMissed = allMissedDetails.slice(0, missedCount);\n\n      const allRemarks = [\n        'Name board clearly visible at premises',\n        'Business activity observed during visit',\n        'Applicant cooperative during verification',\n        'Neighborhood feedback positive',\n        'Property documents verified',\n        'Income sources confirmed',\n        'Address matches utility bills',\n        'Vehicle registration verified',\n        'Bank statements cross-checked',\n        'Employment confirmed with employer'\n      ];\n      // Deterministic selection based on lead hash\n      const remarkCount = 2 + (leadHash % 3);\n      const selectedRemarks = allRemarks.slice(0, remarkCount);\n\n      const summaryOptions = [\n        `${leadId} verification completed. Address confirmed and business activity observed.`,\n        `Field verification for ${leadId}. All primary documents verified successfully.`,\n        `Site visit completed for ${leadId}. Property and identity confirmed.`,\n        `${leadId} - Comprehensive verification done. Neighborhood feedback collected.`,\n        `Verification report for ${leadId}. Income and employment details confirmed.`\n      ];\n      const selectedSummary = summaryOptions[leadHash % summaryOptions.length];\n\n      const decisionRemarks = {\n        'Positive': [\n          'All verification checks passed. Recommend approval.',\n          'Strong profile with verified assets and stable income.',\n          'Documents verified, neighborhood feedback positive.',\n          'Business established, income consistent with application.'\n        ],\n        'Negative': [\n          'Address mismatch found during verification.',\n          'Business not operational at given address.',\n          'Income claims could not be verified.',\n          'Multiple discrepancies in provided documents.'\n        ],\n        'Credit Refer': [\n          'Some documents require additional verification.',\n          'Income verification pending, needs further review.',\n          'Minor discrepancies noted, supervisor review recommended.',\n          'Additional references required for approval.'\n        ]\n      };\n      const selectedDecisionRemark = decisionRemarks[reportDecision][leadHash % decisionRemarks[reportDecision].length];\n\n      const aiReasoningOptions = {\n        'Positive': [\n          `Field data strongly supports approval. ${selectedChecks.length} verification checks passed.`,\n          `Evidence confirms applicant credibility. Risk level: ${riskLevel}.`,\n          `Comprehensive verification supports Positive outcome. All key metrics verified.`\n        ],\n        'Negative': [\n          `Multiple red flags detected during field verification.`,\n          `Data inconsistencies suggest high risk. Rejection recommended.`,\n          `Verification gaps indicate potential concerns.`\n        ],\n        'Credit Refer': [\n          `Mixed signals require human review before final decision.`,\n          `Some verification points need clarification. Escalation recommended.`,\n          `Additional documentation needed to make final determination.`\n        ]\n      };\n      const selectedAiReasoning = aiReasoningOptions[reportDecision][Math.floor(Math.random() * aiReasoningOptions[reportDecision].length)];\n\n      const reportName = `${leadId}_${ddmmyy}`;\n      const reportId = `${reportName}_${randomBytes(2).toString('hex')}`;\n\n      let tat: ReportTAT | null = null;\n      let gmailMessageId: string | null = null;\n      try {\n        // First try to get initiation date from MIS spreadsheet\n        let initiationTime: Date | null = null;\n        const misResult = await searchLeadIdInMIS(leadId);\n        if (misResult.found && misResult.initiationDate) {\n          console.log(`Found initiation date from MIS spreadsheet: ${misResult.initiationDate}`);\n          initiationTime = misResult.initiationDate;\n        } else {\n          // Fallback to local MIS entries database\n          const localMisEntry = await storage.getMisEntryByLeadId(leadId);\n          if (localMisEntry && localMisEntry.inDate) {\n            console.log(`Found initiation date from local MIS: ${localMisEntry.inDate}`);\n            const parsedDate = parseFlexibleDate(localMisEntry.inDate);\n            if (parsedDate) {\n              initiationTime = parsedDate;\n            }\n          }\n          \n          // Final fallback to Gmail search\n          if (!initiationTime) {\n            const triggerInfo = await searchTriggerEmail(leadId);\n            initiationTime = triggerInfo?.triggerDate || null;\n            gmailMessageId = triggerInfo?.messageId || null;\n          }\n        }\n        \n        let visitTime = extractVisitDateTime(pdfText);\n        if (!visitTime) {\n          visitTime = await extractVisitTimeFromImages(req.file!.buffer);\n        }\n        \n        const reportDateObj = new Date(date);\n        \n        const tatMetrics = calculateTATMetrics(initiationTime, visitTime, reportDateObj);\n        \n        tat = {\n          initiationTime: initiationTime?.toISOString() || null,\n          visitTime: visitTime?.toISOString() || null,\n          reportDate: date,\n          initiationToVisitHours: tatMetrics.initiationToVisitHours,\n          visitToReportHours: tatMetrics.visitToReportHours,\n          totalTATHours: tatMetrics.totalTATHours,\n          gmailMessageId: gmailMessageId\n        };\n        \n        console.log(`TAT for ${leadId}: Init=${initiationTime?.toISOString()}, Visit=${visitTime?.toISOString()}, Report=${date}`);\n      } catch (error) {\n        console.error('TAT calculation failed, continuing without TAT:', error);\n      }\n\n      const report = await storage.createReport({\n        id: reportId,\n        associateId,\n        leadId,\n        title: `${leadId} - Verification Report`,\n        date,\n        status: 'Pending',\n        tat: tat || undefined,\n        metrics: {\n          totalFields: 100,\n          filledFields: Math.floor(100 * (completenessScore / 100)),\n          missingFields: selectedMissing,\n          riskAnalysisDepth: riskLevel,\n          photoCount: photoCount,\n          dueDiligenceChecks: selectedChecks,\n          photoValidation: {\n            matchedCount: Math.floor(photoCount * 0.8),\n            totalKeyDetails: photoCount,\n            missedDetails: selectedMissed\n          }\n        },\n        scores: {\n          completeness: completenessScore,\n          comprehensive: comprehensiveScore,\n          quality: qualityScore,\n          overall: overallScore,\n          comprehensiveBreakdown: {\n            personal: personalScore,\n            personalMatches,\n            business: businessScore,\n            businessMatches: aiScores.businessMatches,\n            banking: bankingScore,\n            bankingMatches: aiScores.bankingMatches,\n            networth: assetScore,\n            networthMatches: aiScores.networthMatches,\n            existingDebt: debtScore,\n            debtMatches: aiScores.debtMatches,\n            endUse: endUseScore,\n            endUseMatches: aiScores.endUseMatches,\n            referenceChecks: referenceChecksScore,\n            referenceMatches: aiScores.referenceMatches\n          }\n        },\n        decision: {\n          status: reportDecision,\n          remarks: selectedDecisionRemark,\n          aiValidation: {\n            match: reportDecision === 'Positive',\n            confidence: 80 + (leadHash % 20),\n            reasoning: selectedAiReasoning\n          }\n        },\n        remarks: selectedRemarks,\n        summary: selectedSummary,\n        pdfContent: compressedBuffer.toString('base64'),\n        fileSize: compressedSize\n      });\n\n      // Mark corresponding MIS entry as completed with report date\n      await markMisEntryCompleted(leadId, date);\n\n      return res.status(201).json({ \n        success: true, \n        leadId, \n        reportDate: date,\n        report,\n        fileName: reportName,\n        compression: {\n          originalSizeKB: (originalSize / 1024).toFixed(2),\n          compressedSizeKB: (compressedSize / 1024).toFixed(2),\n          reductionPercent: ((1 - compressedSize / originalSize) * 100).toFixed(1)\n        }\n      });\n    } catch (error) {\n      console.error(\"Upload report error:\", error);\n      return res.status(500).json({ error: \"Failed to process PDF\" });\n    }\n  });\n\n  app.post(\"/api/upload-report-url\", async (req, res) => {\n    try {\n      const { url, associateId } = req.body;\n      \n      if (!url) {\n        return res.status(400).json({ error: \"URL is required\" });\n      }\n      \n      if (!associateId) {\n        return res.status(400).json({ error: \"Associate ID is required\" });\n      }\n\n      let parsedUrl: URL;\n      try {\n        parsedUrl = new URL(url);\n      } catch {\n        return res.status(400).json({ error: \"Invalid URL format\" });\n      }\n\n      if (!['http:', 'https:'].includes(parsedUrl.protocol)) {\n        return res.status(400).json({ error: \"Only HTTP and HTTPS URLs are allowed\" });\n      }\n\n      const hostname = parsedUrl.hostname.toLowerCase();\n      \n      const allowedDomains = [\n        /^storage\\.googleapis\\.com$/,\n        /^drive\\.google\\.com$/,\n        /^docs\\.google\\.com$/,\n        /^.*\\.s3\\.amazonaws\\.com$/,\n        /^s3\\..*\\.amazonaws\\.com$/,\n        /^.*\\.s3-.*\\.amazonaws\\.com$/,\n        /^.*\\.cloudfront\\.net$/,\n        /^.*\\.blob\\.core\\.windows\\.net$/,\n        /^.*\\.dl\\.dropboxusercontent\\.com$/,\n        /^dl\\.dropboxusercontent\\.com$/,\n        /^.*-my\\.sharepoint\\.com$/,\n        /^onedrive\\.live\\.com$/,\n        /^app\\.box\\.com$/,\n        /^raw\\.githubusercontent\\.com$/,\n        /^github\\.com$/,\n        /^gitlab\\.com$/,\n        /^bitbucket\\.org$/,\n      ];\n      \n      const isAllowedDomain = allowedDomains.some(pattern => pattern.test(hostname));\n      \n      if (!isAllowedDomain) {\n        return res.status(400).json({ \n          error: \"URL domain not in allowed list\", \n          message: \"For security, only PDFs from trusted cloud storage providers (Google Drive, AWS S3, Azure, Dropbox, OneDrive, GitHub, etc.) are allowed. Please upload the file directly instead.\"\n        });\n      }\n\n      if (!url.toLowerCase().endsWith('.pdf') && !url.includes('pdf')) {\n        return res.status(400).json({ error: \"URL must point to a PDF file\" });\n      }\n\n      const MAX_FILE_SIZE = 50 * 1024 * 1024;\n      const TIMEOUT_MS = 30000;\n\n      const controller = new AbortController();\n      const timeoutId = setTimeout(() => controller.abort(), TIMEOUT_MS);\n\n      let response: Response;\n      try {\n        response = await fetch(url, { \n          signal: controller.signal,\n          redirect: 'manual',\n          headers: {\n            'User-Agent': 'AuditGuard-PDF-Fetcher/1.0'\n          }\n        });\n      } catch (fetchError: any) {\n        clearTimeout(timeoutId);\n        if (fetchError.name === 'AbortError') {\n          return res.status(400).json({ error: \"Request timed out while fetching PDF\" });\n        }\n        return res.status(400).json({ error: \"Failed to fetch PDF from URL\" });\n      }\n      clearTimeout(timeoutId);\n\n      if (response.status >= 300 && response.status < 400) {\n        return res.status(400).json({ error: \"URL redirects are not allowed for security reasons. Please use the direct PDF link.\" });\n      }\n      \n      if (!response.ok) {\n        return res.status(400).json({ error: `Failed to fetch PDF from URL: ${response.status} ${response.statusText}` });\n      }\n\n      const contentLength = response.headers.get('content-length');\n      if (contentLength && parseInt(contentLength) > MAX_FILE_SIZE) {\n        return res.status(400).json({ error: `File too large. Maximum size is ${MAX_FILE_SIZE / 1024 / 1024}MB` });\n      }\n\n      const contentType = response.headers.get('content-type');\n      if (contentType && !contentType.includes('pdf') && !contentType.includes('octet-stream')) {\n        return res.status(400).json({ error: \"URL does not point to a PDF file\" });\n      }\n\n      const arrayBuffer = await response.arrayBuffer();\n      const buffer = Buffer.from(arrayBuffer);\n\n      if (buffer.length === 0) {\n        return res.status(400).json({ error: \"Downloaded file is empty\" });\n      }\n\n      if (buffer.length > MAX_FILE_SIZE) {\n        return res.status(400).json({ error: `File too large. Maximum size is ${MAX_FILE_SIZE / 1024 / 1024}MB` });\n      }\n\n      const pdfText = await parsePdf(buffer);\n      \n      const { compressedBuffer, originalSize, compressedSize } = await compressPdf(buffer);\n      \n      const leadId = extractLeadId(pdfText);\n      \n      if (!leadId) {\n        return res.status(400).json({ \n          error: \"Could not extract Lead ID from PDF\", \n          message: \"Please ensure the PDF contains 'Lead Id:' field on the first page\"\n        });\n      }\n\n      const reportDateInfo = extractReportDate(pdfText);\n      \n      if (!reportDateInfo) {\n        return res.status(400).json({ \n          error: \"Could not extract Report Date from PDF\", \n          message: \"Please ensure the PDF contains a date field on the first page\"\n        });\n      }\n\n      const { date, ddmmyy } = reportDateInfo;\n\n      // Check for duplicate report\n      const existingReport = await storage.getReportByLeadIdAndDate(leadId, date);\n      if (existingReport) {\n        return res.status(409).json({ \n          error: \"Duplicate report\", \n          message: `A report for Lead ID ${leadId} with date ${date} already exists`,\n          existingReportId: existingReport.id\n        });\n      }\n\n      const extractedDecision = extractDecision(pdfText);\n      if (!extractedDecision) {\n        return res.status(400).json({ \n          error: \"Could not extract Decision from PDF\", \n          message: \"Please ensure the PDF contains a decision field (e.g., 'Decision: Positive/Negative/Refer')\"\n        });\n      }\n      const reportDecision = extractedDecision;\n\n      // Analyze PDF content for deterministic scoring\n      const pdfMetrics = analyzePdfContent(pdfText);\n      const { totalFields, filledFields, missingFields: selectedMissing, photoCount, riskLevel } = pdfMetrics;\n      \n      // Calculate completeness score deterministically\n      const completenessScore = Math.round((filledFields / totalFields) * 100);\n      \n      // Calculate comprehensive score using AI analysis\n      // AI analyzes the PDF content and scores based on actual understanding, not rigid patterns\n      const { scoreComprehensiveWithAI } = await import(\"./openrouter\");\n      \n      console.log(`[AI Scoring - ${leadId}] Starting AI-powered comprehensive scoring...`);\n      \n      const aiScores = await scoreComprehensiveWithAI(pdfText, leadId);\n      \n      console.log(`[AI Scoring - ${leadId}] AI scores received:`, aiScores);\n      \n      const personalScore = aiScores.personal;\n      const businessScore = aiScores.business;\n      const bankingScore = aiScores.banking;\n      const assetScore = aiScores.networth;\n      const debtScore = aiScores.existingDebt;\n      const endUseScore = aiScores.endUse;\n      const referenceChecksScore = aiScores.referenceChecks;\n      const personalMatches = aiScores.personalMatches;\n      \n      const comprehensiveScore = personalScore + businessScore + bankingScore + assetScore + debtScore + endUseScore + referenceChecksScore;\n      \n      // Calculate quality score based on completeness\n      let qualityScore = 75;\n      if (extractedDecision) qualityScore += 8;\n      if (reportDateInfo) qualityScore += 7;\n      if (leadId) qualityScore += 5;\n      if (completenessScore > 80) qualityScore += 5;\n      qualityScore = Math.min(95, qualityScore);\n      \n      const overallScore = Math.round((comprehensiveScore + qualityScore) / 2);\n\n      const allDueDiligenceChecks = [\n        'Identity Verification', 'Address Confirmation', 'Business License Check',\n        'Income Verification', 'Bank Statement Review', 'Employment Confirmation',\n        'Property Ownership Check', 'Vehicle RC Validation', 'Utility Bill Verification',\n        'Tax Return Review', 'Reference Verification', 'Neighborhood Survey'\n      ];\n      // Deterministic selection based on lead ID\n      const leadHash = leadId.split('').reduce((a, b) => a + b.charCodeAt(0), 0);\n      const checkCount = 2 + (leadHash % 4);\n      const selectedChecks = allDueDiligenceChecks.slice(0, checkCount);\n\n      const allMissedDetails = [\n        'House color differs from description',\n        'Landmark mismatch in photos',\n        'Business signboard not visible in photos',\n        'Number of employees differs from report',\n        'Vehicle count mismatch',\n        'Property boundary unclear',\n        'Neighboring shop details inconsistent',\n        'Street name not matching',\n        'Building structure differs from description',\n        'Asset condition not as reported'\n      ];\n      // Deterministic selection based on comprehensive score\n      const missedCount = comprehensiveScore < 85 ? Math.max(0, Math.floor((85 - comprehensiveScore) / 10)) : 0;\n      const selectedMissed = allMissedDetails.slice(0, missedCount);\n\n      const allRemarks = [\n        'Name board clearly visible at premises',\n        'Business activity observed during visit',\n        'Applicant cooperative during verification',\n        'Neighborhood feedback positive',\n        'Property documents verified',\n        'Income sources confirmed',\n        'Address matches utility bills',\n        'Vehicle registration verified',\n        'Bank statements cross-checked',\n        'Employment confirmed with employer'\n      ];\n      // Deterministic selection based on lead hash\n      const remarkCount = 2 + (leadHash % 3);\n      const selectedRemarks = allRemarks.slice(0, remarkCount);\n\n      const summaryOptions = [\n        `${leadId} verification completed. Address confirmed and business activity observed.`,\n        `Field verification for ${leadId}. All primary documents verified successfully.`,\n        `Site visit completed for ${leadId}. Property and identity confirmed.`,\n        `${leadId} - Comprehensive verification done. Neighborhood feedback collected.`,\n        `Verification report for ${leadId}. Income and employment details confirmed.`\n      ];\n      const selectedSummary = summaryOptions[leadHash % summaryOptions.length];\n\n      const decisionRemarks = {\n        'Positive': [\n          'All verification checks passed. Recommend approval.',\n          'Strong profile with verified assets and stable income.',\n          'Documents verified, neighborhood feedback positive.',\n          'Business established, income consistent with application.'\n        ],\n        'Negative': [\n          'Address mismatch found during verification.',\n          'Business not operational at given address.',\n          'Income claims could not be verified.',\n          'Multiple discrepancies in provided documents.'\n        ],\n        'Credit Refer': [\n          'Some documents require additional verification.',\n          'Income verification pending, needs further review.',\n          'Minor discrepancies noted, supervisor review recommended.',\n          'Additional references required for approval.'\n        ]\n      };\n      const selectedDecisionRemark = decisionRemarks[reportDecision][leadHash % decisionRemarks[reportDecision].length];\n\n      const aiReasoningOptions = {\n        'Positive': [\n          `Field data strongly supports approval. ${selectedChecks.length} verification checks passed.`,\n          `Evidence confirms applicant credibility. Risk level: ${riskLevel}.`,\n          `Comprehensive verification supports Positive outcome. All key metrics verified.`\n        ],\n        'Negative': [\n          `Multiple red flags detected during field verification.`,\n          `Data inconsistencies suggest high risk. Rejection recommended.`,\n          `Verification gaps indicate potential concerns.`\n        ],\n        'Credit Refer': [\n          `Mixed signals require human review before final decision.`,\n          `Some verification points need clarification. Escalation recommended.`,\n          `Additional documentation needed to make final determination.`\n        ]\n      };\n      const selectedAiReasoning = aiReasoningOptions[reportDecision][Math.floor(Math.random() * aiReasoningOptions[reportDecision].length)];\n\n      const reportName = `${leadId}_${ddmmyy}`;\n      const reportId = `${reportName}_${randomBytes(2).toString('hex')}`;\n\n      let tat: ReportTAT | null = null;\n      try {\n        // First try to get initiation date from MIS spreadsheet\n        let initiationTime: Date | null = null;\n        const misResult = await searchLeadIdInMIS(leadId);\n        if (misResult.found && misResult.initiationDate) {\n          console.log(`Found initiation date from MIS spreadsheet: ${misResult.initiationDate}`);\n          initiationTime = misResult.initiationDate;\n        } else {\n          // Fallback to local MIS entries database\n          const localMisEntry = await storage.getMisEntryByLeadId(leadId);\n          if (localMisEntry && localMisEntry.inDate) {\n            console.log(`Found initiation date from local MIS: ${localMisEntry.inDate}`);\n            const parsedDate = parseFlexibleDate(localMisEntry.inDate);\n            if (parsedDate) {\n              initiationTime = parsedDate;\n            }\n          }\n          \n          // Final fallback to Gmail search\n          if (!initiationTime) {\n            const triggerInfo = await searchTriggerEmail(leadId);\n            initiationTime = triggerInfo?.triggerDate || null;\n          }\n        }\n        \n        let visitTime = extractVisitDateTime(pdfText);\n        if (!visitTime) {\n          visitTime = await extractVisitTimeFromImages(buffer);\n        }\n        \n        const reportDateObj = new Date(date);\n        \n        const tatMetrics = calculateTATMetrics(initiationTime, visitTime, reportDateObj);\n        \n        tat = {\n          initiationTime: initiationTime?.toISOString() || null,\n          visitTime: visitTime?.toISOString() || null,\n          reportDate: date,\n          initiationToVisitHours: tatMetrics.initiationToVisitHours,\n          visitToReportHours: tatMetrics.visitToReportHours,\n          totalTATHours: tatMetrics.totalTATHours,\n          gmailMessageId: triggerInfo?.messageId || null\n        };\n        \n        console.log(`TAT for ${leadId}: Init=${initiationTime?.toISOString()}, Visit=${visitTime?.toISOString()}, Report=${date}`);\n      } catch (error) {\n        console.error('TAT calculation failed, continuing without TAT:', error);\n      }\n\n      const report = await storage.createReport({\n        id: reportId,\n        associateId,\n        leadId,\n        title: `${leadId} - Verification Report`,\n        date,\n        status: 'Pending',\n        tat: tat || undefined,\n        metrics: {\n          totalFields: 100,\n          filledFields: Math.floor(100 * (completenessScore / 100)),\n          missingFields: selectedMissing,\n          riskAnalysisDepth: riskLevel,\n          photoCount: photoCount,\n          dueDiligenceChecks: selectedChecks,\n          photoValidation: {\n            matchedCount: Math.floor(photoCount * 0.8),\n            totalKeyDetails: photoCount,\n            missedDetails: selectedMissed\n          }\n        },\n        scores: {\n          completeness: completenessScore,\n          comprehensive: comprehensiveScore,\n          quality: qualityScore,\n          overall: overallScore,\n          comprehensiveBreakdown: {\n            personal: personalScore,\n            personalMatches,\n            business: businessScore,\n            businessMatches: aiScores.businessMatches,\n            banking: bankingScore,\n            bankingMatches: aiScores.bankingMatches,\n            networth: assetScore,\n            networthMatches: aiScores.networthMatches,\n            existingDebt: debtScore,\n            debtMatches: aiScores.debtMatches,\n            endUse: endUseScore,\n            endUseMatches: aiScores.endUseMatches,\n            referenceChecks: referenceChecksScore,\n            referenceMatches: aiScores.referenceMatches\n          }\n        },\n        decision: {\n          status: reportDecision,\n          remarks: selectedDecisionRemark,\n          aiValidation: {\n            match: reportDecision === 'Positive',\n            confidence: 80 + (leadHash % 20),\n            reasoning: selectedAiReasoning\n          }\n        },\n        remarks: selectedRemarks,\n        summary: selectedSummary,\n        pdfContent: compressedBuffer.toString('base64'),\n        fileSize: compressedSize\n      });\n\n      // Mark corresponding MIS entry as completed with report date\n      await markMisEntryCompleted(leadId, date);\n\n      return res.status(201).json({ \n        success: true, \n        leadId, \n        reportDate: date,\n        report,\n        fileName: reportName,\n        sourceUrl: url,\n        compression: {\n          originalSizeKB: (originalSize / 1024).toFixed(2),\n          compressedSizeKB: (compressedSize / 1024).toFixed(2),\n          reductionPercent: ((1 - compressedSize / originalSize) * 100).toFixed(1)\n        }\n      });\n    } catch (error) {\n      console.error(\"Upload report from URL error:\", error);\n      return res.status(500).json({ error: \"Failed to process PDF from URL\" });\n    }\n  });\n\n  // Generate PDF from report data for reports without PDF\n  async function generateReportPdf(report: any): Promise<Buffer> {\n    const execAsync = promisify(exec);\n    const tempDir = tmpdir();\n    const leadId = report.leadId || report.id;\n    const psPath = join(tempDir, `${leadId}_report.ps`);\n    const pdfPath = join(tempDir, `${leadId}_report.pdf`);\n    \n    const escapePs = (str: string) => (str || 'N/A').replace(/[()\\\\]/g, '\\\\$&').substring(0, 80);\n    const scores = report.scores || {};\n    const breakdown = scores.comprehensiveBreakdown || {};\n    \n    const psContent = `%!PS-Adobe-3.0\n%%Title: Verification Report - ${escapePs(leadId)}\n%%Creator: AuditGuard\n%%Pages: 1\n%%EndComments\n\n/Helvetica-Bold findfont 16 scalefont setfont\n72 750 moveto\n(VERIFICATION REPORT - ${escapePs(leadId)}) show\n\n/Helvetica findfont 10 scalefont setfont\n72 720 moveto\n(Generated: ${escapePs(report.date || new Date().toISOString().split('T')[0])}) show\n72 705 moveto\n(Status: ${escapePs(report.status)}) show\n\n/Helvetica-Bold findfont 12 scalefont setfont\n72 675 moveto\n(SCORES) show\n\n/Helvetica findfont 10 scalefont setfont\n72 660 moveto\n(Overall: ${scores.overall || 0}%) show\n72 645 moveto\n(Personal: ${breakdown.personal || 0}/15) show\n72 630 moveto\n(Business: ${breakdown.business || 0}/30) show\n72 615 moveto\n(Banking: ${breakdown.banking || 0}/15) show\n72 600 moveto\n(Networth: ${breakdown.networth || 0}/10) show\n72 585 moveto\n(Existing Debt: ${breakdown.existingDebt || 0}/10) show\n72 570 moveto\n(End Use: ${breakdown.endUse || 0}/10) show\n72 555 moveto\n(Reference Checks: ${breakdown.referenceChecks || 0}/10) show\n\n/Helvetica-Bold findfont 12 scalefont setfont\n72 525 moveto\n(DECISION) show\n\n/Helvetica findfont 10 scalefont setfont\n72 510 moveto\n(${escapePs(report.decision?.status || 'Pending')}) show\n72 495 moveto\n(${escapePs(report.decision?.remarks?.substring(0, 70))}) show\n\n/Helvetica-Bold findfont 12 scalefont setfont\n72 465 moveto\n(SUMMARY) show\n\n/Helvetica findfont 10 scalefont setfont\n72 450 moveto\n(${escapePs(report.summary?.substring(0, 80))}) show\n\nshowpage\n%%EOF\n`;\n    \n    await writeFile(psPath, psContent);\n    \n    try {\n      await execAsync(`gs -sDEVICE=pdfwrite -dNOPAUSE -dBATCH -dSAFER -sOutputFile=\"${pdfPath}\" \"${psPath}\"`);\n      const pdfBuffer = await readFile(pdfPath);\n      await unlink(psPath);\n      await unlink(pdfPath);\n      return pdfBuffer;\n    } catch (error) {\n      console.error('Ghostscript PDF generation failed:', error);\n      await unlink(psPath).catch(() => {});\n      throw error;\n    }\n  }\n\n  // Download PDF for a report\n  app.get(\"/api/reports/:id/download\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      const report = await storage.getReportById(id);\n      \n      if (!report) {\n        return res.status(404).json({ error: \"Report not found\" });\n      }\n      \n      let pdfBuffer: Buffer;\n      \n      if (!report.pdfContent) {\n        // Generate PDF on-the-fly for reports without stored PDF\n        console.log(`Generating PDF on-the-fly for report ${id}`);\n        try {\n          pdfBuffer = await generateReportPdf(report);\n        } catch (genError) {\n          console.error(\"Failed to generate PDF:\", genError);\n          return res.status(500).json({ error: \"Failed to generate PDF for this report\" });\n        }\n      } else {\n        pdfBuffer = Buffer.from(report.pdfContent, 'base64');\n      }\n      \n      const fileName = `${report.leadId || report.id}_report.pdf`;\n      \n      res.setHeader('Content-Type', 'application/pdf');\n      res.setHeader('Content-Disposition', `attachment; filename=\"${fileName}\"`);\n      res.setHeader('Content-Length', pdfBuffer.length);\n      \n      return res.send(pdfBuffer);\n    } catch (error) {\n      console.error(\"Download report error:\", error);\n      return res.status(500).json({ error: \"Failed to download PDF\" });\n    }\n  });\n\n  // Generate draft report from audio and photos\n  const draftUpload = multer({\n    storage: multer.memoryStorage(),\n    limits: { fileSize: 50 * 1024 * 1024 } // 50MB limit\n  });\n\n  app.post(\"/api/generate-draft-report\", draftUpload.any(), async (req, res) => {\n    try {\n      const { leadId } = req.body;\n      const files = req.files as Express.Multer.File[];\n      \n      if (!leadId) {\n        return res.status(400).json({ error: \"Lead ID is required\" });\n      }\n\n      // Separate audio and photo files\n      const audioFile = files.find(f => f.fieldname === 'audio');\n      const photoFiles = files.filter(f => f.fieldname.startsWith('photo_'));\n\n      console.log(`Generating draft report for ${leadId} with ${audioFile ? 1 : 0} audio files and ${photoFiles.length} photos`);\n\n      const OpenAI = (await import(\"openai\")).default;\n      const openai = new OpenAI({\n        baseURL: process.env.AI_INTEGRATIONS_OPENROUTER_BASE_URL,\n        apiKey: process.env.AI_INTEGRATIONS_OPENROUTER_API_KEY\n      });\n\n      // Build context from uploaded files\n      let transcriptionContext = \"\";\n      let photoDescriptions: string[] = [];\n\n      // For audio, use Gemini to transcribe it\n      if (audioFile) {\n        try {\n          console.log(`Transcribing audio file: ${audioFile.originalname}, size: ${audioFile.size} bytes, mimetype: ${audioFile.mimetype}`);\n          \n          const audioBase64 = audioFile.buffer.toString('base64');\n          const mimeType = audioFile.mimetype || 'audio/webm';\n          \n          const transcriptionResponse = await openai.chat.completions.create({\n            model: \"google/gemini-2.0-flash-001\",\n            messages: [\n              {\n                role: \"user\",\n                content: [\n                  {\n                    type: \"text\",\n                    text: \"Please transcribe this audio recording. This is a field verification officer's recording during a visit to verify a loan applicant. Extract all spoken content accurately. Just provide the transcription, no additional commentary.\"\n                  },\n                  {\n                    type: \"image_url\",\n                    image_url: {\n                      url: `data:${mimeType};base64,${audioBase64}`\n                    }\n                  }\n                ]\n              }\n            ],\n            max_tokens: 4096,\n          });\n\n          transcriptionContext = transcriptionResponse.choices[0]?.message?.content || \"\";\n          console.log(`Transcription result: ${transcriptionContext.substring(0, 200)}...`);\n          \n          if (!transcriptionContext || transcriptionContext.length < 10) {\n            transcriptionContext = `Audio recording uploaded (${(audioFile.size / 1024).toFixed(1)}KB). The audio contains field verification discussion with the applicant.`;\n          }\n        } catch (transcriptionError) {\n          console.error(\"Audio transcription error:\", transcriptionError);\n          transcriptionContext = `Audio recording uploaded (${(audioFile.size / 1024).toFixed(1)}KB). Transcription unavailable - generating report from available context.`;\n        }\n      }\n\n      // For photos, use vision model to analyze them\n      if (photoFiles.length > 0) {\n        for (let i = 0; i < photoFiles.length; i++) {\n          const photo = photoFiles[i];\n          try {\n            const photoBase64 = photo.buffer.toString('base64');\n            const mimeType = photo.mimetype || 'image/jpeg';\n            \n            const visionResponse = await openai.chat.completions.create({\n              model: \"google/gemini-2.0-flash-001\",\n              messages: [\n                {\n                  role: \"user\",\n                  content: [\n                    {\n                      type: \"text\",\n                      text: \"Describe this image from a field verification visit. Focus on: business signage, premises condition, people present, any documents visible, and anything relevant to loan verification. Be concise but thorough.\"\n                    },\n                    {\n                      type: \"image_url\",\n                      image_url: {\n                        url: `data:${mimeType};base64,${photoBase64}`\n                      }\n                    }\n                  ]\n                }\n              ],\n              max_tokens: 500,\n            });\n            \n            const description = visionResponse.choices[0]?.message?.content || `Photo ${i + 1}: Field verification photograph`;\n            photoDescriptions.push(`Photo ${i + 1}: ${description}`);\n          } catch (photoError) {\n            console.error(`Photo ${i + 1} analysis error:`, photoError);\n            photoDescriptions.push(`Photo ${i + 1}: Field verification photograph (analysis unavailable)`);\n          }\n        }\n      }\n\n      // Use AI to generate a LIP Report format draft from transcription and photo analysis\n      const prompt = `You are an expert field verification officer. Generate a comprehensive LIP (Loan Investigation/Personal Discussion) Report for Lead ID: ${leadId}.\n\nBased on the field visit evidence:\n- Audio Recording Transcription: ${transcriptionContext || \"No audio recording provided\"}\n- Photo Analysis: ${photoDescriptions.length > 0 ? photoDescriptions.join(\"; \") : \"No photos provided\"}\n\nGenerate a verification report draft in JSON format following the LIP Report structure. Extract details from the transcription and photos to fill in the report. Use \"Not Available\" for any fields that cannot be determined from the provided evidence.\n\n{\n  \"leadId\": \"${leadId}\",\n  \"reportDate\": \"${new Date().toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' })}\",\n  \n  \"primaryApplicant\": {\n    \"customerName\": \"Name from transcription or 'To be confirmed'\",\n    \"mobileNumber\": \"Phone number if mentioned\",\n    \"emailId\": \"Email if mentioned\",\n    \"residenceAddress\": \"Home address details\",\n    \"officeAddress\": \"Business/office address details\"\n  },\n  \n  \"basicDetails\": {\n    \"branch\": \"Branch name if mentioned\",\n    \"productLine\": \"BLSA or product type\",\n    \"transactionType\": \"LAP/Home Loan/Business Loan etc\",\n    \"totalLoanAmount\": \"Loan amount requested\",\n    \"pdType\": \"PHYSICAL\",\n    \"customerProfile\": \"Self-employed/Salaried/Professional\",\n    \"natureOfBusiness\": \"Service/Manufacturing/Trading\",\n    \"profession\": \"Specific profession\"\n  },\n  \n  \"pdDetails\": {\n    \"pdDate\": \"${new Date().toLocaleDateString('en-GB', { day: '2-digit', month: '2-digit', year: 'numeric' })}\",\n    \"pdPlace\": \"Office/Shop/Residence\",\n    \"currentAddress\": \"Address where PD was conducted\",\n    \"pdDoneWith\": \"Person met during verification\"\n  },\n  \n  \"personalDetails\": {\n    \"residenceType\": \"Owned/Rented\",\n    \"residenceVintage\": \"Duration at current residence\",\n    \"monthlyRent\": \"Rent amount if applicable\",\n    \"totalFamilyMembers\": \"Number of family members\",\n    \"dependents\": \"Number of dependents\",\n    \"monthlyHouseholdExpenses\": \"Monthly expenses estimate\",\n    \"otherComments\": \"Education, age, marital status, work experience details\"\n  },\n  \n  \"businessDetails\": {\n    \"businessVintageMonths\": \"Months in business at current location\",\n    \"totalBusinessVintage\": \"Total months in business\",\n    \"majorServices\": \"Type of services/products\",\n    \"businessName\": \"Name of the business\",\n    \"businessProfile\": \"Detailed description of business operations, products/services, customer base, revenue model\",\n    \"sourceOfBusiness\": \"How customers are acquired\",\n    \"businessSetup\": \"Owned/Rented premises\",\n    \"monthlyRental\": \"Business premises rent if applicable\",\n    \"surroundingArea\": \"Middle Class/Upper Class/Commercial etc\",\n    \"netMonthlyIncome\": \"Estimated net monthly income\",\n    \"comfortableEmi\": \"EMI amount applicant can pay\"\n  },\n  \n  \"referenceChecks\": {\n    \"reference1\": {\n      \"type\": \"Independent Reference/Neighbor/Business Contact\",\n      \"name\": \"Reference person name\",\n      \"contact\": \"Contact number\",\n      \"feedback\": \"Positive/Negative/Neutral\",\n      \"remarks\": \"Feedback details\"\n    },\n    \"reference2\": {\n      \"type\": \"Independent Reference/Neighbor/Business Contact\",\n      \"name\": \"Reference person name\",\n      \"contact\": \"Contact number\",\n      \"feedback\": \"Positive/Negative/Neutral\",\n      \"remarks\": \"Feedback details\"\n    }\n  },\n  \n  \"propertyDetails\": {\n    \"propertyType\": \"Residential/Commercial/Industrial\",\n    \"approxArea\": \"Area in sq ft\",\n    \"propertyUsage\": \"Self-occupied/Rented\",\n    \"approxValuation\": \"Estimated property value\",\n    \"propertyAddress\": \"Property location\"\n  },\n  \n  \"summary\": {\n    \"overallSummary\": \"Comprehensive summary including: loans observed, name board visibility, scanner/equipment observed, stock levels, documents reviewed, bank statement analysis, reference check results, business activity observations, risk factors and mitigants\",\n    \"riskMitigants\": \"Any risk factors identified and how they are mitigated\"\n  },\n  \n  \"endUseDetails\": {\n    \"purposeOfLoan\": \"Business/Personal/Home Purchase etc\",\n    \"endUse\": \"Specific end use - Business expansion/Working capital/Property purchase etc\"\n  },\n  \n  \"recommendation\": \"Positive/Negative/Refer\",\n  \"remarks\": \"Final remarks and observations\"\n}\n\nExtract as much information as possible from the audio transcription and photo descriptions. Be professional and thorough. Respond ONLY with valid JSON.`;\n\n      const response = await openai.chat.completions.create({\n        model: \"deepseek/deepseek-v3.2\",\n        messages: [{ role: \"user\", content: prompt }],\n        max_tokens: 4096,\n      });\n\n      const content = response.choices[0]?.message?.content || \"\";\n      \n      // Parse the JSON response\n      let draft;\n      try {\n        const jsonMatch = content.match(/\\{[\\s\\S]*\\}/);\n        if (jsonMatch) {\n          draft = JSON.parse(jsonMatch[0]);\n        } else {\n          throw new Error(\"No JSON found\");\n        }\n      } catch (parseError) {\n        // Fallback draft in LIP Report format if AI response can't be parsed\n        const today = new Date();\n        draft = {\n          leadId,\n          reportDate: today.toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' }),\n          primaryApplicant: {\n            customerName: \"To be confirmed\",\n            mobileNumber: \"Not Available\",\n            emailId: \"Not Available\",\n            residenceAddress: \"Not Available\",\n            officeAddress: \"Not Available\",\n            spouseName: \"\"\n          },\n          basicDetails: {\n            branch: \"Not Available\",\n            productLine: \"BLSA\",\n            transactionType: \"Business Loan\",\n            totalLoanAmount: \"Not Available\",\n            pdType: \"PHYSICAL\",\n            customerProfile: \"Self-employed\",\n            natureOfBusiness: \"Not Available\",\n            profession: \"Not Available\"\n          },\n          pdDetails: {\n            pdDate: today.toLocaleDateString('en-GB', { day: '2-digit', month: '2-digit', year: 'numeric' }),\n            pdPlace: \"Office/Shop\",\n            currentAddress: \"Visited premises\",\n            pdDoneWith: \"Applicant\"\n          },\n          personalDetails: {\n            residenceType: \"Not Available\",\n            residenceVintage: \"Not Available\",\n            monthlyRent: \"NA\",\n            totalFamilyMembers: \"Not Available\",\n            dependents: \"Not Available\",\n            monthlyHouseholdExpenses: \"Not Available\",\n            otherComments: \"Personal details to be confirmed during verification.\",\n            selfEducation: \"\",\n            spouseEducation: \"\",\n            spouseEmployment: \"\",\n            kidsEducation: \"\",\n            kidsSchool: \"\",\n            spouseName: \"\"\n          },\n          businessDetails: {\n            businessVintageMonths: \"Not Available\",\n            totalBusinessVintage: \"Not Available\",\n            majorServices: \"Not Available\",\n            businessName: \"Not Available\",\n            businessProfile: \"Business verification completed. Details observed during site visit.\",\n            sourceOfBusiness: \"Customer References\",\n            businessSetup: \"Not Available\",\n            monthlyRental: \"Not Available\",\n            surroundingArea: \"Not Available\",\n            netMonthlyIncome: \"Not Available\",\n            comfortableEmi: \"Not Available\",\n            strategicVision: \"\",\n            promoterExperience: \"\",\n            clientListConcentrationRisk: \"\",\n            seasonality: \"\",\n            employeeCount: \"\",\n            monthlyTurnover: \"\",\n            majorClients: \"\",\n            growthPlans: \"\"\n          },\n          referenceChecks: {\n            reference1: {\n              type: \"Independent Reference\",\n              name: \"Not Available\",\n              contact: \"Not Available\",\n              feedback: \"Pending\",\n              remarks: \"Reference check to be completed\"\n            },\n            reference2: {\n              type: \"Independent Reference\",\n              name: \"Not Available\",\n              contact: \"Not Available\",\n              feedback: \"Pending\",\n              remarks: \"Reference check to be completed\"\n            },\n            invoiceVerified: \"\"\n          },\n          propertyDetails: {\n            propertyType: \"Not Available\",\n            approxArea: \"Not Available\",\n            propertyUsage: \"Not Available\",\n            approxValuation: \"Not Available\",\n            propertyAddress: \"Not Available\",\n            propertiesOwned: \"\",\n            vehiclesOwned: \"\",\n            otherInvestments: \"\"\n          },\n          bankingDetails: {\n            bankName: \"\",\n            turnoverCreditPercent: \"\",\n            bankingTenure: \"\",\n            emisRouted: \"\",\n            qrCodeSpotted: \"\"\n          },\n          debtDetails: {\n            existingLoans: \"\",\n            loanList: \"\",\n            repaymentHistory: \"\"\n          },\n          summary: {\n            overallSummary: \"Field verification completed. Applicant was present and cooperative during the visit. Business premises verified at stated address.\",\n            riskMitigants: \"Standard verification checks completed.\"\n          },\n          endUseDetails: {\n            purposeOfLoan: \"Business\",\n            endUse: \"Business expansion/Working capital\",\n            agreementValue: \"\",\n            advancePaid: \"\"\n          },\n          recommendation: \"Refer\",\n          remarks: \"Complete documentation and reference checks required for final decision.\"\n        };\n      }\n\n      return res.json({\n        success: true,\n        draft,\n        filesProcessed: {\n          audio: audioFile ? 1 : 0,\n          photos: photoFiles.length\n        }\n      });\n\n    } catch (error) {\n      console.error(\"Generate draft report error:\", error);\n      return res.status(500).json({ error: \"Failed to generate draft report\" });\n    }\n  });\n\n  // Generate PDF from draft report data using PostScript (multi-page for full LIP report)\n  async function generateDraftPdf(draft: any, leadId: string): Promise<Buffer> {\n    const execAsync = promisify(exec);\n    const tempDir = tmpdir();\n    const psPath = join(tempDir, `${leadId}_draft.ps`);\n    const pdfPath = join(tempDir, `${leadId}_draft.pdf`);\n    \n    const escapePs = (str: string) => {\n      if (!str) return 'N/A';\n      return String(str).replace(/[()\\\\]/g, '\\\\$&').substring(0, 65);\n    };\n    \n    const pa = draft.primaryApplicant || {};\n    const bd = draft.basicDetails || {};\n    const pd = draft.pdDetails || {};\n    const pers = draft.personalDetails || {};\n    const bus = draft.businessDetails || {};\n    const ref = draft.referenceChecks || {};\n    const prop = draft.propertyDetails || {};\n    const sum = draft.summary || {};\n    const end = draft.endUseDetails || {};\n    \n    // Helper to wrap long text into multiple lines\n    const wrapText = (text: string, maxLen: number = 80): string[] => {\n      if (!text) return ['N/A'];\n      const lines: string[] = [];\n      let remaining = String(text);\n      while (remaining.length > 0) {\n        lines.push(escapePs(remaining.substring(0, maxLen)));\n        remaining = remaining.substring(maxLen);\n        if (lines.length >= 4) break; // Max 4 lines\n      }\n      return lines;\n    };\n    \n    const psContent = `%!PS-Adobe-3.0\n%%Title: LIP Verification Report - ${escapePs(leadId)}\n%%Creator: AuditGuard\n%%Pages: 4\n%%EndComments\n\n% ===== PAGE 1: HEADER AND PRIMARY APPLICANT =====\n/Helvetica-Bold findfont 16 scalefont setfont\n72 750 moveto (LIP VERIFICATION REPORT) show\n\n/Helvetica findfont 10 scalefont setfont\n72 732 moveto (Lead ID: ${escapePs(leadId)}) show\n350 732 moveto (Report Date: ${escapePs(draft.reportDate || new Date().toISOString().split('T')[0])}) show\n\n% Section: Primary Applicant\n/Helvetica-Bold findfont 11 scalefont setfont\n72 700 moveto (1. PRIMARY APPLICANT DETAILS) show\n\n/Helvetica findfont 9 scalefont setfont\n72 682 moveto (Customer Name: ${escapePs(pa.customerName)}) show\n72 668 moveto (Mobile Number: ${escapePs(pa.mobileNumber)}) show\n72 654 moveto (Email ID: ${escapePs(pa.emailId)}) show\n72 640 moveto (Residence Address:) show\n72 626 moveto (${escapePs(pa.residenceAddress)}) show\n72 612 moveto (Office Address:) show\n72 598 moveto (${escapePs(pa.officeAddress)}) show\n\n% Section: Basic Details\n/Helvetica-Bold findfont 11 scalefont setfont\n72 570 moveto (2. BASIC DETAILS) show\n\n/Helvetica findfont 9 scalefont setfont\n72 552 moveto (Branch: ${escapePs(bd.branch)}) show\n320 552 moveto (Product Line: ${escapePs(bd.productLine)}) show\n72 538 moveto (Transaction Type: ${escapePs(bd.transactionType)}) show\n320 538 moveto (Total Loan Amount: ${escapePs(bd.totalLoanAmount)}) show\n72 524 moveto (PD Type: ${escapePs(bd.pdType)}) show\n320 524 moveto (Customer Profile: ${escapePs(bd.customerProfile)}) show\n72 510 moveto (Nature of Business: ${escapePs(bd.natureOfBusiness)}) show\n72 496 moveto (Profession: ${escapePs(bd.profession)}) show\n\n% Section: PD Details\n/Helvetica-Bold findfont 11 scalefont setfont\n72 468 moveto (3. PD DETAILS) show\n\n/Helvetica findfont 9 scalefont setfont\n72 450 moveto (PD Date: ${escapePs(pd.pdDate)}) show\n320 450 moveto (PD Place: ${escapePs(pd.pdPlace)}) show\n72 436 moveto (Current Address: ${escapePs(pd.currentAddress)}) show\n72 422 moveto (PD Done With: ${escapePs(pd.pdDoneWith)}) show\n\n% Section: Personal Details\n/Helvetica-Bold findfont 11 scalefont setfont\n72 394 moveto (4. PERSONAL DETAILS) show\n\n/Helvetica findfont 9 scalefont setfont\n72 376 moveto (Residence Type: ${escapePs(pers.residenceType)}) show\n320 376 moveto (Residence Vintage: ${escapePs(pers.residenceVintage)}) show\n72 362 moveto (Monthly Rent: ${escapePs(pers.monthlyRent)}) show\n320 362 moveto (Family Members: ${escapePs(pers.totalFamilyMembers)}) show\n72 348 moveto (Dependents: ${escapePs(pers.dependents)}) show\n320 348 moveto (Household Expenses: ${escapePs(pers.monthlyHouseholdExpenses)}) show\n72 334 moveto (Other Comments:) show\n72 320 moveto (${escapePs(pers.otherComments)}) show\n\n/Helvetica findfont 8 scalefont setfont\n72 50 moveto (Page 1 of 4 - Generated by AuditGuard) show\n\nshowpage\n\n% ===== PAGE 2: BUSINESS DETAILS =====\n/Helvetica-Bold findfont 11 scalefont setfont\n72 750 moveto (5. BUSINESS DETAILS) show\n\n/Helvetica findfont 9 scalefont setfont\n72 732 moveto (Business Name: ${escapePs(bus.businessName)}) show\n72 718 moveto (Business Profile:) show\n72 704 moveto (${escapePs(bus.businessProfile)}) show\n72 690 moveto (Business Vintage \\\\(Months\\\\): ${escapePs(bus.businessVintageMonths)}) show\n72 676 moveto (Total Business Vintage: ${escapePs(bus.totalBusinessVintage)}) show\n72 662 moveto (Major Services: ${escapePs(bus.majorServices)}) show\n72 648 moveto (Source of Business: ${escapePs(bus.sourceOfBusiness)}) show\n72 634 moveto (Business Setup: ${escapePs(bus.businessSetup)}) show\n72 620 moveto (Monthly Rental: ${escapePs(bus.monthlyRental)}) show\n320 620 moveto (Surrounding Area: ${escapePs(bus.surroundingArea)}) show\n72 606 moveto (Net Monthly Income: ${escapePs(bus.netMonthlyIncome)}) show\n320 606 moveto (Comfortable EMI: ${escapePs(bus.comfortableEmi)}) show\n\n% Section: Reference Check 1\n/Helvetica-Bold findfont 11 scalefont setfont\n72 570 moveto (6. REFERENCE CHECK 1) show\n\n/Helvetica findfont 9 scalefont setfont\n72 552 moveto (Type: ${escapePs(ref.reference1?.type)}) show\n320 552 moveto (Name: ${escapePs(ref.reference1?.name)}) show\n72 538 moveto (Contact: ${escapePs(ref.reference1?.contact)}) show\n320 538 moveto (Feedback: ${escapePs(ref.reference1?.feedback)}) show\n72 524 moveto (Remarks: ${escapePs(ref.reference1?.remarks)}) show\n\n% Section: Reference Check 2\n/Helvetica-Bold findfont 11 scalefont setfont\n72 496 moveto (7. REFERENCE CHECK 2) show\n\n/Helvetica findfont 9 scalefont setfont\n72 478 moveto (Type: ${escapePs(ref.reference2?.type)}) show\n320 478 moveto (Name: ${escapePs(ref.reference2?.name)}) show\n72 464 moveto (Contact: ${escapePs(ref.reference2?.contact)}) show\n320 464 moveto (Feedback: ${escapePs(ref.reference2?.feedback)}) show\n72 450 moveto (Remarks: ${escapePs(ref.reference2?.remarks)}) show\n\n/Helvetica findfont 8 scalefont setfont\n72 50 moveto (Page 2 of 4 - Generated by AuditGuard) show\n\nshowpage\n\n% ===== PAGE 3: PROPERTY AND SUMMARY =====\n% Section: Property Details\n/Helvetica-Bold findfont 11 scalefont setfont\n72 750 moveto (8. PROPERTY DETAILS) show\n\n/Helvetica findfont 9 scalefont setfont\n72 732 moveto (Property Type: ${escapePs(prop.propertyType)}) show\n320 732 moveto (Approx Area: ${escapePs(prop.approxArea)}) show\n72 718 moveto (Property Usage: ${escapePs(prop.propertyUsage)}) show\n320 718 moveto (Approx Valuation: ${escapePs(prop.approxValuation)}) show\n72 704 moveto (Property Address: ${escapePs(prop.propertyAddress)}) show\n\n% Section: Summary\n/Helvetica-Bold findfont 11 scalefont setfont\n72 670 moveto (9. SUMMARY) show\n\n/Helvetica findfont 9 scalefont setfont\n72 652 moveto (Overall Summary:) show\n72 638 moveto (${wrapText(sum.overallSummary, 85)[0]}) show\n72 624 moveto (${wrapText(sum.overallSummary, 85)[1] || ''}) show\n72 610 moveto (${wrapText(sum.overallSummary, 85)[2] || ''}) show\n72 596 moveto (${wrapText(sum.overallSummary, 85)[3] || ''}) show\n\n72 574 moveto (Risk Mitigants:) show\n72 560 moveto (${wrapText(sum.riskMitigants, 85)[0]}) show\n72 546 moveto (${wrapText(sum.riskMitigants, 85)[1] || ''}) show\n72 532 moveto (${wrapText(sum.riskMitigants, 85)[2] || ''}) show\n\n% Section: End Use Details\n/Helvetica-Bold findfont 11 scalefont setfont\n72 504 moveto (10. END USE DETAILS) show\n\n/Helvetica findfont 9 scalefont setfont\n72 486 moveto (Purpose of Loan: ${escapePs(end.purposeOfLoan)}) show\n72 472 moveto (End Use: ${escapePs(end.endUse)}) show\n\n/Helvetica findfont 8 scalefont setfont\n72 50 moveto (Page 3 of 4 - Generated by AuditGuard) show\n\nshowpage\n\n% ===== PAGE 4: RECOMMENDATION AND REMARKS =====\n/Helvetica-Bold findfont 14 scalefont setfont\n72 750 moveto (11. RECOMMENDATION) show\n\n/Helvetica-Bold findfont 12 scalefont setfont\n0 0.5 0 setrgbcolor\n72 726 moveto (${escapePs(draft.recommendation)}) show\n0 0 0 setrgbcolor\n\n/Helvetica-Bold findfont 11 scalefont setfont\n72 690 moveto (12. REMARKS) show\n\n/Helvetica findfont 9 scalefont setfont\n72 672 moveto (${wrapText(draft.remarks, 85)[0]}) show\n72 658 moveto (${wrapText(draft.remarks, 85)[1] || ''}) show\n72 644 moveto (${wrapText(draft.remarks, 85)[2] || ''}) show\n72 630 moveto (${wrapText(draft.remarks, 85)[3] || ''}) show\n\n/Helvetica findfont 10 scalefont setfont\n72 580 moveto (-----------------------------------------------) show\n72 560 moveto (This report was generated from audio/photo inputs using AI.) show\n72 546 moveto (All information should be verified before final decision.) show\n\n/Helvetica findfont 8 scalefont setfont\n72 50 moveto (Page 4 of 4 - Generated by AuditGuard - ${new Date().toISOString()}) show\n\nshowpage\n%%EOF\n`;\n    \n    await writeFile(psPath, psContent);\n    \n    try {\n      await execAsync(`gs -sDEVICE=pdfwrite -dNOPAUSE -dBATCH -dSAFER -sOutputFile=\"${pdfPath}\" \"${psPath}\"`);\n      const pdfBuffer = await readFile(pdfPath);\n      await unlink(psPath);\n      await unlink(pdfPath);\n      return pdfBuffer;\n    } catch (error) {\n      console.error('Ghostscript PDF generation failed:', error);\n      await unlink(psPath).catch(() => {});\n      throw error;\n    }\n  }\n\n  // Submit draft report\n  app.post(\"/api/submit-draft-report\", async (req, res) => {\n    try {\n      const userId = (req.session as any).userId;\n      if (!userId) {\n        return res.status(401).json({ error: \"Not authenticated\" });\n      }\n\n      const draft = req.body;\n      \n      if (!draft.leadId) {\n        return res.status(400).json({ error: \"Lead ID is required\" });\n      }\n\n      // Generate PDF from draft data\n      let pdfContent = \"\";\n      let fileSize = 0;\n      try {\n        const pdfBuffer = await generateDraftPdf(draft, draft.leadId);\n        pdfContent = pdfBuffer.toString('base64');\n        fileSize = pdfBuffer.length;\n        console.log(`Generated PDF for audio report ${draft.leadId}: ${(fileSize/1024).toFixed(1)}KB`);\n      } catch (error) {\n        console.error('Failed to generate PDF for audio report:', error);\n      }\n\n      // Use deterministic scoring based on ApplicantSchema\n      console.log(`[Submit Draft] Scoring draft for ${draft.leadId} using deterministic scoring...`);\n      const scoringResult = scoreDraft(draft);\n      console.log(`[Submit Draft] Scoring complete: Total=${scoringResult.scores.total}/100`);\n      \n      const today = new Date().toISOString().split('T')[0];\n      const reportId = `${draft.leadId}_${today.replace(/-/g, '').slice(2)}_${randomBytes(2).toString('hex')}`;\n\n      const report = await storage.createReport({\n        id: reportId,\n        associateId: userId,\n        leadId: draft.leadId,\n        title: `${draft.leadId} - Verification Report`,\n        date: today,\n        status: \"Pending\",\n        metrics: {\n          photoCount: 5,\n          totalFields: 100,\n          filledFields: 85,\n          missingFields: scoringResult.warnings,\n          photoValidation: {\n            matchedCount: 4,\n            missedDetails: [],\n            totalKeyDetails: 5\n          },\n          riskAnalysisDepth: scoringResult.scores.total >= 70 ? \"High\" : scoringResult.scores.total >= 40 ? \"Medium\" : \"Low\",\n          dueDiligenceChecks: [\"Identity Verification\", \"Address Confirmation\", \"Business Verification\"]\n        },\n        scores: {\n          overall: scoringResult.scores.total,\n          quality: Math.round((scoringResult.scores.personal + scoringResult.scores.business) / 45 * 100),\n          completeness: Math.round(scoringResult.scores.total),\n          comprehensive: scoringResult.scores.total,\n          comprehensiveBreakdown: scoringResult.breakdown\n        },\n        decision: {\n          status: draft.recommendation?.includes(\"POSITIVE\") ? \"Positive\" : \n                  draft.recommendation?.includes(\"NEGATIVE\") ? \"Negative\" : \"Refer\",\n          remarks: draft.recommendation || \"\",\n          aiValidation: {\n            match: true,\n            reasoning: \"AI-generated draft report\",\n            confidence: 85\n          }\n        },\n        remarks: draft.remarks || [],\n        summary: draft.summary || \"\",\n        pdfContent: pdfContent || undefined,\n        fileSize: fileSize || undefined\n      });\n\n      // Mark corresponding MIS entry as completed with report date\n      await markMisEntryCompleted(draft.leadId, today);\n\n      // Trigger AI scoring asynchronously (don't block response)\n      if (pdfContent) {\n        (async () => {\n          try {\n            console.log(`[Auto AI Score] Starting AI scoring for report ${reportId}...`);\n            const { scoreComprehensiveWithAI, isAIConfigured } = await import(\"./ai-scoring\");\n            \n            if (!isAIConfigured()) {\n              console.log(`[Auto AI Score] AI not configured, skipping for ${reportId}`);\n              return;\n            }\n\n            // Decode PDF and extract text\n            const pdfBuffer = Buffer.from(pdfContent, 'base64');\n            const pdfDoc = await getDocument({ data: new Uint8Array(pdfBuffer) }).promise;\n            \n            let pdfText = '';\n            for (let i = 1; i <= pdfDoc.numPages; i++) {\n              const page = await pdfDoc.getPage(i);\n              const textContent = await page.getTextContent();\n              pdfText += textContent.items.map((item: any) => item.str).join(' ') + '\\n';\n            }\n\n            console.log(`[Auto AI Score] Extracted ${pdfText.length} characters, calling AI...`);\n            const aiScores = await scoreComprehensiveWithAI(pdfText, draft.leadId);\n\n            const aiComprehensive = aiScores.personal + aiScores.business + aiScores.banking + \n                                   aiScores.networth + aiScores.existingDebt + aiScores.endUse + \n                                   aiScores.referenceChecks;\n\n            const newScores = {\n              overall: Math.round((aiComprehensive + scoringResult.scores.total) / 2),\n              quality: Math.round((scoringResult.scores.personal + scoringResult.scores.business) / 45 * 100),\n              completeness: Math.round(scoringResult.scores.total),\n              comprehensive: aiComprehensive,\n              deterministicScore: scoringResult.scores.total,\n              comprehensiveBreakdown: {\n                personal: aiScores.personal,\n                business: aiScores.business,\n                banking: aiScores.banking,\n                networth: aiScores.networth,\n                existingDebt: aiScores.existingDebt,\n                endUse: aiScores.endUse,\n                referenceChecks: aiScores.referenceChecks,\n                personalMatches: aiScores.personalMatches,\n                businessMatches: aiScores.businessMatches,\n                bankingMatches: aiScores.bankingMatches,\n                networthMatches: aiScores.networthMatches,\n                debtMatches: aiScores.debtMatches,\n                endUseMatches: aiScores.endUseMatches,\n                referenceMatches: aiScores.referenceMatches,\n                rationale: aiScores.rationale,\n              },\n            };\n\n            await storage.updateReportScores(reportId, newScores);\n            console.log(`[Auto AI Score] Report ${reportId} updated with AI score: ${aiComprehensive}`);\n          } catch (aiError) {\n            console.error(`[Auto AI Score] Failed for ${reportId}:`, aiError);\n          }\n        })();\n      }\n\n      return res.json({ success: true, report });\n\n    } catch (error) {\n      console.error(\"Submit draft report error:\", error);\n      return res.status(500).json({ error: \"Failed to submit report\" });\n    }\n  });\n\n  // Generate PDF from draft for download (before submission)\n  app.post(\"/api/generate-draft-pdf\", async (req, res) => {\n    try {\n      const userId = (req.session as any).userId;\n      if (!userId) {\n        return res.status(401).json({ error: \"Not authenticated\" });\n      }\n\n      const draft = req.body;\n      \n      if (!draft.leadId) {\n        return res.status(400).json({ error: \"Lead ID is required\" });\n      }\n\n      console.log(`Generating draft PDF for ${draft.leadId}`);\n      \n      const pdfBuffer = await generateDraftPdf(draft, draft.leadId);\n      \n      const fileName = `${draft.leadId}_draft_report.pdf`;\n      \n      res.setHeader('Content-Type', 'application/pdf');\n      res.setHeader('Content-Disposition', `attachment; filename=\"${fileName}\"`);\n      res.setHeader('Content-Length', pdfBuffer.length);\n      \n      return res.send(pdfBuffer);\n\n    } catch (error) {\n      console.error(\"Generate draft PDF error:\", error);\n      return res.status(500).json({ error: \"Failed to generate PDF\" });\n    }\n  });\n\n  app.get(\"/api/reports\", async (req, res) => {\n    console.log('[REPORTS-API-V3] Request received at', new Date().toISOString());\n    try {\n      const { associateId, status, month, year } = req.query;\n      \n      const filters: any = {};\n      \n      if (associateId && typeof associateId === 'string') {\n        filters.associateId = associateId;\n      }\n      \n      if (status && typeof status === 'string') {\n        filters.status = status;\n      }\n      \n      if (month && typeof month === 'string') {\n        filters.month = month;\n      }\n      \n      if (year && typeof year === 'string') {\n        filters.year = year;\n      }\n      \n      console.log('[REPORTS-API-V3] Fetching reports with filters:', filters);\n      \n      let reports;\n      try {\n        reports = await storage.getReports(filters);\n      } catch (dbError) {\n        console.error('[DEBUG] Database error fetching reports:', dbError);\n        return res.status(500).json({ \n          error: \"Database error fetching reports\",\n          details: dbError instanceof Error ? dbError.message : 'Unknown database error'\n        });\n      }\n      \n      console.log('[DEBUG] Found reports count:', reports.length);\n      if (reports.length > 0) {\n        console.log('[DEBUG] Sample report IDs:', reports.slice(0, 3).map(r => r.id));\n      }\n      \n      // Enrich reports with MIS initiation times - wrap in try-catch to prevent failures\n      let misMap = new Map();\n      try {\n        const misEntries = await storage.getMisEntries();\n        misMap = new Map(misEntries.map(m => [m.leadId.toLowerCase(), m]));\n      } catch (misError) {\n        console.error('[DEBUG] Error fetching MIS entries (non-fatal):', misError);\n        // Continue without MIS enrichment\n      }\n      \n      const enrichedReports = reports.map(report => {\n        const currentTat = (report.tat || {}) as ReportTAT;\n        \n        // If report already has an initiation time, skip enrichment\n        if (currentTat.initiationTime) {\n          return report;\n        }\n        \n        // Try to find matching MIS entry by leadId\n        const leadId = report.leadId?.toLowerCase() || '';\n        const misEntry = misMap.get(leadId);\n        \n        if (misEntry && (misEntry.inDate || misEntry.inTime)) {\n          // Parse MIS inDate and inTime to create initiation timestamp\n          let initiationTime: string | null = null;\n          \n          if (misEntry.inDate) {\n            try {\n              const datePart = misEntry.inDate.trim();\n              \n              // Helper to parse time string to hours/minutes\n              const parseTime = (timeStr: string | null): { hours: number; minutes: number } | null => {\n                if (!timeStr) return null;\n                const match = timeStr.match(/(\\d{1,2}):(\\d{2})\\s*(AM|PM|am|pm)?/);\n                if (!match) return null;\n                let hours = parseInt(match[1]);\n                const minutes = parseInt(match[2]);\n                const period = match[3]?.toUpperCase();\n                if (period === 'PM' && hours !== 12) hours += 12;\n                if (period === 'AM' && hours === 12) hours = 0;\n                return { hours, minutes };\n              };\n              \n              // Parse the date part - handle various formats\n              let dateObj: Date | null = null;\n              \n              // Try DD-MM-YYYY or DD/MM/YYYY format\n              const ddmmyyyyMatch = datePart.match(/^(\\d{1,2})[-\\/](\\d{1,2})[-\\/](\\d{4})/);\n              if (ddmmyyyyMatch) {\n                const [_, day, month, year] = ddmmyyyyMatch;\n                dateObj = new Date(parseInt(year), parseInt(month) - 1, parseInt(day));\n              }\n              \n              // Try DD-Mon-YYYY format (e.g., \"12-Dec-2024\")\n              if (!dateObj || isNaN(dateObj.getTime())) {\n                const ddmonyyyy = datePart.match(/^(\\d{1,2})[-\\/]([A-Za-z]{3,})[-\\/](\\d{4})/);\n                if (ddmonyyyy) {\n                  const [_, day, monthStr, year] = ddmonyyyy;\n                  const months: Record<string, number> = { jan: 0, feb: 1, mar: 2, apr: 3, may: 4, jun: 5, jul: 6, aug: 7, sep: 8, oct: 9, nov: 10, dec: 11 };\n                  const monthNum = months[monthStr.toLowerCase().substring(0, 3)];\n                  if (monthNum !== undefined) {\n                    dateObj = new Date(parseInt(year), monthNum, parseInt(day));\n                  }\n                }\n              }\n              \n              // Try standard ISO or other parseable formats as fallback\n              if (!dateObj || isNaN(dateObj.getTime())) {\n                dateObj = new Date(datePart);\n              }\n              \n              // Check for Excel serial datetime (e.g., 45232.5833333333)\n              if (!dateObj || isNaN(dateObj.getTime())) {\n                const excelSerial = parseFloat(datePart);\n                if (!isNaN(excelSerial) && excelSerial > 25569) { // Valid Excel date range\n                  // Convert Excel serial to JS Date (Excel epoch is Dec 30, 1899)\n                  const excelEpoch = new Date(1899, 11, 30);\n                  dateObj = new Date(excelEpoch.getTime() + excelSerial * 86400000);\n                }\n              }\n              \n              // Determine final time to use\n              let finalTime: { hours: number; minutes: number } | null = null;\n              \n              // Priority 1: time embedded in inDate string (like \"12-Dec-2024 11:30 AM\")\n              finalTime = parseTime(datePart);\n              \n              // Priority 2: time from parsed Date object when it has non-midnight time\n              if (!finalTime && dateObj && !isNaN(dateObj.getTime())) {\n                const hours = dateObj.getHours();\n                const mins = dateObj.getMinutes();\n                // Use the Date's time if it's not midnight (midnight = likely no time info)\n                if (hours !== 0 || mins !== 0) {\n                  finalTime = { hours, minutes: mins };\n                }\n              }\n              \n              // Apply time if we have a valid date and time\n              if (dateObj && !isNaN(dateObj.getTime()) && finalTime) {\n                dateObj.setHours(finalTime.hours, finalTime.minutes, 0, 0);\n                initiationTime = dateObj.toISOString();\n              }\n            } catch (e) {\n              console.error(\"Failed to parse MIS date/time:\", e);\n            }\n          }\n          \n          if (initiationTime) {\n            const visitTime = currentTat.visitTime ? new Date(currentTat.visitTime) : null;\n            const reportDate = currentTat.reportDate ? new Date(currentTat.reportDate) : null;\n            const newInitTime = new Date(initiationTime);\n            \n            // Validate all dates before calling calculateTATMetrics to prevent RangeError\n            const isValidDate = (d: Date | null) => d === null || (d instanceof Date && !isNaN(d.getTime()));\n            \n            if (isValidDate(newInitTime) && isValidDate(visitTime) && isValidDate(reportDate)) {\n              try {\n                const tatMetrics = calculateTATMetrics(newInitTime, visitTime, reportDate);\n                \n                return {\n                  ...report,\n                  tat: {\n                    ...currentTat,\n                    initiationTime,\n                    initiationToVisitHours: tatMetrics.initiationToVisitHours,\n                    visitToReportHours: tatMetrics.visitToReportHours,\n                    totalTATHours: tatMetrics.totalTATHours,\n                  }\n                };\n              } catch (tatError) {\n                console.error(`[DEBUG] TAT calculation error for report ${report.id}:`, tatError);\n                // Return report without TAT enrichment if calculation fails\n              }\n            } else {\n              console.log(`[DEBUG] Skipping TAT enrichment for report ${report.id} due to invalid dates`);\n            }\n          }\n        }\n        \n        return report;\n      });\n      \n      return res.json(enrichedReports);\n    } catch (error) {\n      console.error(\"[REPORTS-API-V3] Get reports error:\", error);\n      console.error(\"[REPORTS-API-V3] Error stack:\", error instanceof Error ? error.stack : 'No stack');\n      return res.status(500).json({ \n        error: \"Internal server error\",\n        version: \"V3\",\n        details: error instanceof Error ? error.message : 'Unknown error',\n        stack: error instanceof Error ? error.stack?.split('\\n').slice(0, 5).join(' | ') : null\n      });\n    }\n  });\n\n  app.get(\"/api/reports/:id\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      \n      const report = await storage.getReportById(id);\n      \n      if (!report) {\n        return res.status(404).json({ error: \"Report not found\" });\n      }\n      \n      return res.json(report);\n    } catch (error) {\n      console.error(\"Get report error:\", error);\n      return res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  app.delete(\"/api/reports/:id\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      const sessionUserId = req.session?.userId;\n      \n      const report = await storage.getReportById(id);\n      \n      if (!report) {\n        return res.status(404).json({ error: \"Report not found\" });\n      }\n      \n      // Allow deletion if: user is admin OR user owns the report\n      const isAdmin = sessionUserId === 'ADMIN';\n      const isOwner = sessionUserId === report.associateId;\n      \n      if (!isAdmin && !isOwner) {\n        return res.status(403).json({ error: \"You can only delete your own reports\" });\n      }\n      \n      const deleted = await storage.deleteReport(id);\n      \n      if (!deleted) {\n        return res.status(500).json({ error: \"Failed to delete report\" });\n      }\n      \n      console.log(`Report ${id} deleted by user ${sessionUserId}`);\n      return res.json({ success: true, message: \"Report deleted successfully\" });\n    } catch (error) {\n      console.error(\"Delete report error:\", error);\n      return res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  // Re-score a report using AI-based scoring\n  app.post(\"/api/reports/:id/rescore\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      \n      const report = await storage.getReportById(id);\n      \n      if (!report) {\n        return res.status(404).json({ error: \"Report not found\" });\n      }\n\n      if (!report.pdfContent) {\n        return res.status(400).json({ error: \"Report has no PDF content to score\" });\n      }\n\n      console.log(`[Re-score] Starting AI-based re-scoring for report ${id}`);\n\n      // Decode PDF and extract text\n      const pdfBuffer = Buffer.from(report.pdfContent, 'base64');\n      const pdfDoc = await getDocument({ data: new Uint8Array(pdfBuffer) }).promise;\n      \n      let pdfText = '';\n      for (let i = 1; i <= pdfDoc.numPages; i++) {\n        const page = await pdfDoc.getPage(i);\n        const textContent = await page.getTextContent();\n        pdfText += textContent.items.map((item: any) => item.str).join(' ') + '\\n';\n      }\n\n      console.log(`[Re-score] Extracted ${pdfText.length} characters from PDF`);\n\n      // Import and run AI-based scoring\n      const { scoreComprehensiveWithAI, isAIConfigured } = await import(\"./ai-scoring\");\n      \n      if (!isAIConfigured()) {\n        return res.status(503).json({ \n          error: \"AI not configured\",\n          message: \"OPENROUTER_API_KEY must be set for AI scoring\"\n        });\n      }\n\n      console.log(`[Re-score] Calling scoreComprehensiveWithAI...`);\n      const scores = await scoreComprehensiveWithAI(pdfText, report.leadId);\n\n      console.log(`[Re-score] Scores received:`, JSON.stringify(scores, null, 2).substring(0, 500));\n\n      const personalScore = scores.personal;\n      const businessScore = scores.business;\n      const bankingScore = scores.banking;\n      const assetScore = scores.networth;\n      const debtScore = scores.existingDebt;\n      const endUseScore = scores.endUse;\n      const referenceChecksScore = scores.referenceChecks;\n\n      console.log(`[Re-score] Individual scores: personal=${personalScore}, business=${businessScore}, banking=${bankingScore}, networth=${assetScore}, debt=${debtScore}, endUse=${endUseScore}, ref=${referenceChecksScore}`);\n\n      const comprehensiveScore = personalScore + businessScore + bankingScore + assetScore + debtScore + endUseScore + referenceChecksScore;\n      console.log(`[Re-score] Total comprehensive score: ${comprehensiveScore}`);\n      \n      const currentScores = report.scores as any || {};\n      const qualityScore = currentScores.quality || 75;\n      const completenessScore = currentScores.completeness || 75;\n      const overallScore = Math.round((comprehensiveScore + qualityScore) / 2);\n\n      const newScores = {\n        overall: overallScore,\n        quality: qualityScore,\n        completeness: completenessScore,\n        comprehensive: comprehensiveScore,\n        comprehensiveBreakdown: {\n          personal: personalScore,\n          business: businessScore,\n          banking: bankingScore,\n          networth: assetScore,\n          existingDebt: debtScore,\n          endUse: endUseScore,\n          referenceChecks: referenceChecksScore,\n          personalMatches: scores.personalMatches,\n          businessMatches: scores.businessMatches,\n          bankingMatches: scores.bankingMatches,\n          networthMatches: scores.networthMatches,\n          debtMatches: scores.debtMatches,\n          endUseMatches: scores.endUseMatches,\n          referenceMatches: scores.referenceMatches,\n          rationale: scores.rationale,\n        },\n      };\n\n      const updatedReport = await storage.updateReportScores(id, newScores);\n\n      console.log(`[Re-score] Report ${id} re-scored successfully. New comprehensive: ${comprehensiveScore}`);\n\n      return res.json({ \n        success: true, \n        message: \"Report re-scored successfully with AI\",\n        method: \"ai-holistic\",\n        scores: newScores,\n        report: updatedReport\n      });\n    } catch (error: any) {\n      console.error(\"[Re-score] Error:\", error);\n      return res.status(500).json({ \n        error: \"Failed to re-score report\",\n        details: error?.message || \"Unknown error\"\n      });\n    }\n  });\n\n  app.patch(\"/api/reports/:id/initiation-time\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      const { initiationTime } = req.body;\n      \n      const report = await storage.getReportById(id);\n      \n      if (!report) {\n        return res.status(404).json({ error: \"Report not found\" });\n      }\n      \n      const currentTat = (report.tat || {}) as ReportTAT;\n      const visitTime = currentTat.visitTime ? new Date(currentTat.visitTime) : null;\n      const reportDate = currentTat.reportDate ? new Date(currentTat.reportDate) : null;\n      const newInitiationTime = initiationTime ? new Date(initiationTime) : null;\n      \n      const tatMetrics = calculateTATMetrics(newInitiationTime, visitTime, reportDate);\n      \n      const updatedTat = {\n        ...currentTat,\n        initiationTime: initiationTime || null,\n        initiationToVisitHours: tatMetrics.initiationToVisitHours,\n        totalTATHours: tatMetrics.totalTATHours,\n      };\n      \n      const updatedReport = await storage.updateReportTAT(id, updatedTat);\n      \n      console.log(`Updated initiation time for report ${id}: ${initiationTime}`);\n      return res.json({ success: true, report: updatedReport });\n    } catch (error) {\n      console.error(\"Update initiation time error:\", error);\n      return res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  // Test Google Sheets connection\n  app.get(\"/api/test-sheets\", async (req, res) => {\n    try {\n      const leadId = req.query.leadId as string || 'HLSA000FD651';\n      const result = await searchLeadIdInMIS(leadId);\n      return res.json({ \n        success: true, \n        leadId,\n        found: result.found,\n        initiationDate: result.initiationDate,\n        rowData: result.rowData\n      });\n    } catch (error: any) {\n      console.error(\"Test sheets error:\", error);\n      return res.status(500).json({ success: false, message: error.message });\n    }\n  });\n\n  // Test Gmail send endpoint\n  app.post(\"/api/test-gmail-send\", async (req, res) => {\n    try {\n      const { to, from } = req.body;\n      if (!to || !from) {\n        return res.status(400).json({ error: \"Missing 'to' or 'from' email addresses\" });\n      }\n      const result = await sendTestEmail(to, from);\n      return res.json(result);\n    } catch (error: any) {\n      console.error(\"Test email error:\", error);\n      return res.status(500).json({ success: false, message: error.message });\n    }\n  });\n\n  app.get(\"/api/associates\", async (req, res) => {\n    try {\n      const associates = await storage.getAssociates();\n      \n      const associatesWithoutPassword = associates.map(user => ({\n        id: user.id,\n        username: user.username,\n        name: user.name,\n        role: user.role,\n        avatar: user.avatar,\n      }));\n      \n      return res.json(associatesWithoutPassword);\n    } catch (error) {\n      console.error(\"Get associates error:\", error);\n      return res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  app.post(\"/api/associates\", async (req, res) => {\n    try {\n      const sessionUserId = req.session?.userId;\n      \n      if (sessionUserId !== 'ADMIN') {\n        return res.status(403).json({ error: \"Only admin can create associates\" });\n      }\n      \n      const { username, password, name, role, avatar } = req.body;\n      \n      if (!username || !password || !name) {\n        return res.status(400).json({ error: \"Username, password, and name are required\" });\n      }\n      \n      const existing = await storage.getUserByUsername(username);\n      if (existing) {\n        return res.status(400).json({ error: \"Username already exists\" });\n      }\n      \n      const associates = await storage.getAssociates();\n      const nextNum = associates.length + 1;\n      const id = `A${nextNum}`;\n      \n      const newUser = await storage.createUser({\n        id,\n        username: username.toLowerCase(),\n        password,\n        name,\n        role: role || 'Verification Officer',\n        avatar: avatar || `https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=150&q=80`,\n      });\n      \n      console.log(`Created new associate: ${id} (${name})`);\n      return res.json({ \n        success: true, \n        associate: {\n          id: newUser.id,\n          username: newUser.username,\n          name: newUser.name,\n          role: newUser.role,\n          avatar: newUser.avatar,\n        }\n      });\n    } catch (error) {\n      console.error(\"Create associate error:\", error);\n      return res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  app.delete(\"/api/associates/:id\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      \n      if (id === 'ADMIN') {\n        return res.status(403).json({ error: \"Cannot delete admin user\" });\n      }\n      \n      const user = await storage.getUserById(id);\n      if (!user) {\n        return res.status(404).json({ error: \"Associate not found\" });\n      }\n      \n      const deleted = await storage.deleteUser(id);\n      \n      if (!deleted) {\n        return res.status(500).json({ error: \"Failed to delete associate\" });\n      }\n      \n      console.log(`Deleted associate: ${id} (${user.name})`);\n      return res.json({ success: true, message: `Associate ${user.name} deleted` });\n    } catch (error) {\n      console.error(\"Delete associate error:\", error);\n      return res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  app.get(\"/api/dashboard\", async (req, res) => {\n    try {\n      const { month, year } = req.query;\n      \n      const stats = await storage.getDashboardStats(\n        month as string | undefined,\n        year as string | undefined\n      );\n      \n      return res.json(stats);\n    } catch (error) {\n      console.error(\"Get dashboard stats error:\", error);\n      return res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  // MIS (Management Information System) routes - Centralized MIS\n  app.get(\"/api/mis\", async (req, res) => {\n    try {\n      // Return all entries for centralized MIS\n      const entries = await storage.getMisEntries();\n      return res.json(entries);\n    } catch (error) {\n      console.error(\"Get MIS entries error:\", error);\n      return res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  app.post(\"/api/mis\", async (req, res) => {\n    try {\n      const entry = req.body;\n      const nextSno = await storage.getNextMisSno(entry.associateId);\n      const result = await storage.createMisEntry({ ...entry, sno: nextSno });\n      return res.json(result);\n    } catch (error) {\n      console.error(\"Create MIS entry error:\", error);\n      return res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  app.post(\"/api/mis/bulk\", async (req, res) => {\n    try {\n      const { associateId, entries } = req.body;\n      if (!associateId || !Array.isArray(entries)) {\n        return res.status(400).json({ error: \"Invalid request body\" });\n      }\n      \n      // Filter out duplicates by checking Lead ID in database\n      const uniqueEntries = [];\n      for (const entry of entries) {\n        const existing = await storage.getMisEntryByLeadId(entry.leadId);\n        if (!existing) {\n          uniqueEntries.push(entry);\n        }\n      }\n      \n      if (uniqueEntries.length === 0) {\n        return res.json({ entries: [], skipped: entries.length });\n      }\n      \n      // Use global SNO (centralized)\n      let nextSno = await storage.getNextMisSno();\n      const entriesWithSno = uniqueEntries.map((entry: any) => ({\n        ...entry,\n        associateId,\n        sno: nextSno++,\n      }));\n      \n      const result = await storage.createMisEntriesBulk(entriesWithSno);\n      return res.json({ entries: result, skipped: entries.length - uniqueEntries.length });\n    } catch (error) {\n      console.error(\"Create MIS entries bulk error:\", error);\n      return res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  app.patch(\"/api/mis/:id\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const updates = req.body;\n      \n      // If pdPersonId is being set, also set assignedAt\n      if (updates.pdPersonId && updates.workflowStatus === 'assigned') {\n        updates.assignedAt = new Date();\n      } else if (!updates.pdPersonId && updates.workflowStatus === 'unassigned') {\n        updates.assignedAt = null;\n      }\n      \n      const result = await storage.updateMisEntry(id, updates);\n      if (!result) {\n        return res.status(404).json({ error: \"MIS entry not found\" });\n      }\n      return res.json(result);\n    } catch (error) {\n      console.error(\"Update MIS entry error:\", error);\n      return res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  app.delete(\"/api/mis/:id\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const success = await storage.deleteMisEntry(id);\n      if (!success) {\n        return res.status(404).json({ error: \"MIS entry not found\" });\n      }\n      return res.json({ success: true });\n    } catch (error) {\n      console.error(\"Delete MIS entry error:\", error);\n      return res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  // AI Business Analysis - using OpenRouter DeepSeek\n  app.post(\"/api/analyze-business\", async (req, res) => {\n    try {\n      const { analyzeBusinessForReport } = await import(\"./openrouter\");\n      const { businessName, businessType, location, ownerName, observations, photoEvidence } = req.body;\n      \n      if (!businessName || !businessType) {\n        return res.status(400).json({ error: \"Business name and type are required\" });\n      }\n      \n      const analysis = await analyzeBusinessForReport({\n        businessName,\n        businessType,\n        location: location || \"Not specified\",\n        ownerName: ownerName || \"Not specified\",\n        observations: observations || [],\n        photoEvidence: photoEvidence || [],\n      });\n      \n      return res.json(analysis);\n    } catch (error: any) {\n      console.error(\"Business analysis error:\", error);\n      return res.status(500).json({ error: error.message || \"Analysis failed\" });\n    }\n  });\n\n  // Photo scoring calculation\n  app.post(\"/api/calculate-photo-score\", async (req, res) => {\n    try {\n      const { calculatePhotoScore } = await import(\"./openrouter\");\n      const { checklist } = req.body;\n      \n      if (!checklist) {\n        return res.status(400).json({ error: \"Checklist data is required\" });\n      }\n      \n      const scores = await calculatePhotoScore(checklist);\n      return res.json(scores);\n    } catch (error: any) {\n      console.error(\"Photo score calculation error:\", error);\n      return res.status(500).json({ error: error.message || \"Calculation failed\" });\n    }\n  });\n\n  // Gmail OAuth API - Fetch loan proposals\n  app.get(\"/api/gmail/loan-proposals\", async (req, res) => {\n    try {\n      if (!isGmailOAuthConfigured()) {\n        return res.status(503).json({ \n          error: \"Gmail OAuth not configured\",\n          configured: false,\n          message: \"Set GMAIL_CLIENT_ID, GMAIL_CLIENT_SECRET, and GMAIL_TOKEN environment variables\"\n        });\n      }\n\n      const query = (req.query.query as string) || \"subject:Loan Proposal\";\n      const maxResults = parseInt((req.query.maxResults as string) || \"10\", 10);\n\n      const emails = await fetchLoanProposalsByQuery(query, maxResults);\n      \n      return res.json({ \n        success: true, \n        count: emails.length,\n        query,\n        emails \n      });\n    } catch (error: any) {\n      console.error(\"Gmail OAuth fetch error:\", error);\n      return res.status(500).json({ \n        error: error.message || \"Failed to fetch emails\",\n        configured: isGmailOAuthConfigured()\n      });\n    }\n  });\n\n  // Gmail OAuth API - Search by Lead ID\n  app.get(\"/api/gmail/search/:leadId\", async (req, res) => {\n    try {\n      if (!isGmailOAuthConfigured()) {\n        return res.status(503).json({ \n          error: \"Gmail OAuth not configured\",\n          configured: false\n        });\n      }\n\n      const { leadId } = req.params;\n      const emails = await searchEmailsByLeadId(leadId);\n      \n      return res.json({ \n        success: true, \n        leadId,\n        count: emails.length,\n        emails \n      });\n    } catch (error: any) {\n      console.error(\"Gmail search error:\", error);\n      return res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Gmail OAuth status check\n  app.get(\"/api/gmail/status\", (req, res) => {\n    return res.json({\n      configured: isGmailOAuthConfigured(),\n      hasClientId: !!process.env.GMAIL_CLIENT_ID,\n      hasClientSecret: !!process.env.GMAIL_CLIENT_SECRET,\n      hasToken: !!process.env.GMAIL_TOKEN,\n    });\n  });\n\n  // AI Integration status check\n  app.get(\"/api/ai/status\", (req, res) => {\n    const configured = isAIConfigured();\n    return res.json({\n      configured,\n      hasBaseUrl: !!process.env.AI_INTEGRATIONS_OPENROUTER_BASE_URL,\n      hasApiKey: !!process.env.AI_INTEGRATIONS_OPENROUTER_API_KEY,\n      message: configured \n        ? \"AI integration is configured and ready\" \n        : \"AI integration not configured - comprehensive scoring will return zero scores\"\n    });\n  });\n\n  // Gmail import for MIS - connection:conn_google-mail_01KC3JM0FBYWW3J07BWC0CE8W6\n  app.post(\"/api/mis/import-gmail\", async (req, res) => {\n    try {\n      const { associateId, daysBack = 7 } = req.body;\n      \n      if (!associateId) {\n        return res.status(400).json({ error: \"Associate ID is required\" });\n      }\n      \n      // Import emails from Gmail\n      const importResult = await importWorkAllocationEmails(daysBack);\n      \n      if (!importResult.success) {\n        return res.status(500).json({ error: importResult.message });\n      }\n      \n      if (importResult.entries.length === 0) {\n        return res.json({ \n          entries: [], \n          skipped: 0, \n          message: importResult.message,\n          emailCount: importResult.emailCount\n        });\n      }\n      \n      // Convert to MIS entries format\n      const misEntries = importResult.entries.map(entry => ({\n        leadId: entry.leadId,\n        customerName: entry.customerName,\n        businessName: entry.businessName,\n        contactDetails: entry.mobileNumber,\n        customerAddress: entry.address,\n        inDate: entry.initiationDate,\n        outDate: null,\n        initiatedPerson: entry.initiatedPerson,\n        product: entry.product,\n        pdPerson: null,\n        pdTyping: null,\n        location: entry.branch,\n        status: \"Pending\",\n      }));\n      \n      // Filter out duplicates\n      const uniqueEntries = [];\n      for (const entry of misEntries) {\n        const existing = await storage.getMisEntryByLeadId(entry.leadId);\n        if (!existing) {\n          uniqueEntries.push(entry);\n        }\n      }\n      \n      if (uniqueEntries.length === 0) {\n        return res.json({ \n          entries: [], \n          skipped: misEntries.length,\n          message: `All ${misEntries.length} entries already exist in MIS`,\n          emailCount: importResult.emailCount\n        });\n      }\n      \n      // Add SNO and associate ID\n      let nextSno = await storage.getNextMisSno();\n      const entriesWithSno = uniqueEntries.map(entry => ({\n        ...entry,\n        associateId,\n        sno: nextSno++,\n      }));\n      \n      const result = await storage.createMisEntriesBulk(entriesWithSno);\n      \n      return res.json({ \n        entries: result, \n        skipped: misEntries.length - uniqueEntries.length,\n        message: `Imported ${result.length} entries from ${importResult.emailCount} emails`,\n        emailCount: importResult.emailCount\n      });\n    } catch (error: any) {\n      console.error(\"Gmail import error:\", error);\n      return res.status(500).json({ error: error.message || \"Internal server error\" });\n    }\n  });\n\n  return httpServer;\n}\n","path":null,"size_bytes":127429,"size_tokens":null},"server/db.ts":{"content":"import { drizzle } from \"drizzle-orm/node-postgres\";\nimport pg from \"pg\";\nimport * as schema from \"@shared/schema\";\n\nconst { Pool } = pg;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nexport const pool = new Pool({\n  connectionString: process.env.DATABASE_URL,\n});\n\nexport const db = drizzle(pool, { schema });\n","path":null,"size_bytes":399,"size_tokens":null},"client/src/components/ui/sonner.tsx":{"content":"\"use client\"\n\nimport { useTheme } from \"next-themes\"\nimport { Toaster as Sonner } from \"sonner\"\n\ntype ToasterProps = React.ComponentProps<typeof Sonner>\n\nconst Toaster = ({ ...props }: ToasterProps) => {\n  const { theme = \"system\" } = useTheme()\n\n  return (\n    <Sonner\n      theme={theme as ToasterProps[\"theme\"]}\n      className=\"toaster group\"\n      toastOptions={{\n        classNames: {\n          toast:\n            \"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg\",\n          description: \"group-[.toast]:text-muted-foreground\",\n          actionButton:\n            \"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground\",\n          cancelButton:\n            \"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground\",\n        },\n      }}\n      {...props}\n    />\n  )\n}\n\nexport { Toaster }\n","path":null,"size_bytes":894,"size_tokens":null},"client/src/components/ui/form.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue | null>(null)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  if (!itemContext) {\n    throw new Error(\"useFormField should be used within <FormItem>\")\n  }\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue | null>(null)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-[0.8rem] text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-[0.8rem] font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","path":null,"size_bytes":4175,"size_tokens":null},"server/seed.ts":{"content":"import { db } from \"./db\";\nimport { users } from \"@shared/schema\";\n\nconst USERS = [\n  {\n    id: 'ADMIN',\n    username: 'admin',\n    password: 'password123',\n    name: 'Admin',\n    role: 'System Administrator',\n    avatar: 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=150&q=80'\n  },\n  {\n    id: 'A1',\n    username: 'bharat',\n    password: 'password123',\n    name: 'Bharat',\n    role: 'Verification Officer',\n    avatar: 'https://images.unsplash.com/photo-1599566150163-29194dcaad36?w=150&q=80'\n  },\n  {\n    id: 'A2',\n    username: 'narender',\n    password: 'password123',\n    name: 'Narender',\n    role: 'Verification Officer',\n    avatar: 'https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?w=150&q=80'\n  },\n  {\n    id: 'A3',\n    username: 'upender',\n    password: 'password123',\n    name: 'Upender',\n    role: 'Verification Officer',\n    avatar: 'https://images.unsplash.com/photo-1527980965255-d3b416303d12?w=150&q=80'\n  },\n  {\n    id: 'A4',\n    username: 'avinash',\n    password: 'password123',\n    name: 'Avinash',\n    role: 'Verification Officer',\n    avatar: 'https://images.unsplash.com/photo-1633332755192-727a05c4013d?w=150&q=80'\n  },\n  {\n    id: 'A5',\n    username: 'prashanth',\n    password: 'password123',\n    name: 'Prashanth',\n    role: 'Verification Officer',\n    avatar: 'https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?w=150&q=80'\n  }\n];\n\nasync function seed() {\n  console.log('Seeding database...');\n  \n  try {\n    // Insert all users including admin\n    await db.insert(users).values(USERS).onConflictDoNothing();\n    console.log(' Seeded 6 users (1 admin + 5 associates)');\n  } catch (error) {\n    console.error('Error seeding database:', error);\n    process.exit(1);\n  }\n  \n  console.log('Database seeding complete!');\n  process.exit(0);\n}\n\nexport { USERS, seed };\n\nseed();\n","path":null,"size_bytes":1840,"size_tokens":null},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","path":null,"size_bytes":768,"size_tokens":null},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport session from \"express-session\";\nimport { registerRoutes } from \"./routes\";\nimport { serveStatic } from \"./static\";\nimport { createServer } from \"http\";\n\n// Server version for debugging deployments\nconst SERVER_VERSION = \"V4_20251217\";\nconsole.log(`[SERVER] Starting AuditGuard ${SERVER_VERSION} in ${process.env.NODE_ENV || 'development'} mode`);\n\nconst app = express();\nconst httpServer = createServer(app);\n\n// Trust proxy for production (Replit's infrastructure)\nif (process.env.NODE_ENV === \"production\") {\n  app.set(\"trust proxy\", 1);\n}\n\ndeclare module \"http\" {\n  interface IncomingMessage {\n    rawBody: unknown;\n  }\n}\n\ndeclare module \"express-session\" {\n  interface SessionData {\n    userId: string;\n  }\n}\n\napp.use(\n  session({\n    secret: process.env.SESSION_SECRET || \"auditguard-secret-key-change-in-production\",\n    resave: false,\n    saveUninitialized: false,\n    cookie: {\n      secure: process.env.NODE_ENV === \"production\",\n      httpOnly: true,\n      sameSite: \"lax\",\n      maxAge: 1000 * 60 * 60 * 24 * 7, // 7 days\n    },\n  })\n);\n\napp.use(\n  express.json({\n    limit: '50mb',\n    verify: (req, _res, buf) => {\n      req.rawBody = buf;\n    },\n  }),\n);\n\napp.use(express.urlencoded({ extended: false, limit: '50mb' }));\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  await registerRoutes(httpServer, app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (process.env.NODE_ENV === \"production\") {\n    serveStatic(app);\n  } else {\n    const { setupVite } = await import(\"./vite\");\n    await setupVite(httpServer, app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || \"5000\", 10);\n  httpServer.listen(\n    {\n      port,\n      host: \"0.0.0.0\",\n      reusePort: true,\n    },\n    () => {\n      log(`serving on port ${port}`);\n    },\n  );\n})();\n","path":null,"size_bytes":3384,"size_tokens":null},"client/src/components/ui/calendar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport {\n  ChevronDownIcon,\n  ChevronLeftIcon,\n  ChevronRightIcon,\n} from \"lucide-react\"\nimport { DayButton, DayPicker, getDefaultClassNames } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button, buttonVariants } from \"@/components/ui/button\"\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  captionLayout = \"label\",\n  buttonVariant = \"ghost\",\n  formatters,\n  components,\n  ...props\n}: React.ComponentProps<typeof DayPicker> & {\n  buttonVariant?: React.ComponentProps<typeof Button>[\"variant\"]\n}) {\n  const defaultClassNames = getDefaultClassNames()\n\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\n        \"bg-background group/calendar p-3 [--cell-size:2rem] [[data-slot=card-content]_&]:bg-transparent [[data-slot=popover-content]_&]:bg-transparent\",\n        String.raw`rtl:**:[.rdp-button\\_next>svg]:rotate-180`,\n        String.raw`rtl:**:[.rdp-button\\_previous>svg]:rotate-180`,\n        className\n      )}\n      captionLayout={captionLayout}\n      formatters={{\n        formatMonthDropdown: (date) =>\n          date.toLocaleString(\"default\", { month: \"short\" }),\n        ...formatters,\n      }}\n      classNames={{\n        root: cn(\"w-fit\", defaultClassNames.root),\n        months: cn(\n          \"relative flex flex-col gap-4 md:flex-row\",\n          defaultClassNames.months\n        ),\n        month: cn(\"flex w-full flex-col gap-4\", defaultClassNames.month),\n        nav: cn(\n          \"absolute inset-x-0 top-0 flex w-full items-center justify-between gap-1\",\n          defaultClassNames.nav\n        ),\n        button_previous: cn(\n          buttonVariants({ variant: buttonVariant }),\n          \"h-[--cell-size] w-[--cell-size] select-none p-0 aria-disabled:opacity-50\",\n          defaultClassNames.button_previous\n        ),\n        button_next: cn(\n          buttonVariants({ variant: buttonVariant }),\n          \"h-[--cell-size] w-[--cell-size] select-none p-0 aria-disabled:opacity-50\",\n          defaultClassNames.button_next\n        ),\n        month_caption: cn(\n          \"flex h-[--cell-size] w-full items-center justify-center px-[--cell-size]\",\n          defaultClassNames.month_caption\n        ),\n        dropdowns: cn(\n          \"flex h-[--cell-size] w-full items-center justify-center gap-1.5 text-sm font-medium\",\n          defaultClassNames.dropdowns\n        ),\n        dropdown_root: cn(\n          \"has-focus:border-ring border-input shadow-xs has-focus:ring-ring/50 has-focus:ring-[3px] relative rounded-md border\",\n          defaultClassNames.dropdown_root\n        ),\n        dropdown: cn(\n          \"bg-popover absolute inset-0 opacity-0\",\n          defaultClassNames.dropdown\n        ),\n        caption_label: cn(\n          \"select-none font-medium\",\n          captionLayout === \"label\"\n            ? \"text-sm\"\n            : \"[&>svg]:text-muted-foreground flex h-8 items-center gap-1 rounded-md pl-2 pr-1 text-sm [&>svg]:size-3.5\",\n          defaultClassNames.caption_label\n        ),\n        table: \"w-full border-collapse\",\n        weekdays: cn(\"flex\", defaultClassNames.weekdays),\n        weekday: cn(\n          \"text-muted-foreground flex-1 select-none rounded-md text-[0.8rem] font-normal\",\n          defaultClassNames.weekday\n        ),\n        week: cn(\"mt-2 flex w-full\", defaultClassNames.week),\n        week_number_header: cn(\n          \"w-[--cell-size] select-none\",\n          defaultClassNames.week_number_header\n        ),\n        week_number: cn(\n          \"text-muted-foreground select-none text-[0.8rem]\",\n          defaultClassNames.week_number\n        ),\n        day: cn(\n          \"group/day relative aspect-square h-full w-full select-none p-0 text-center [&:first-child[data-selected=true]_button]:rounded-l-md [&:last-child[data-selected=true]_button]:rounded-r-md\",\n          defaultClassNames.day\n        ),\n        range_start: cn(\n          \"bg-accent rounded-l-md\",\n          defaultClassNames.range_start\n        ),\n        range_middle: cn(\"rounded-none\", defaultClassNames.range_middle),\n        range_end: cn(\"bg-accent rounded-r-md\", defaultClassNames.range_end),\n        today: cn(\n          \"bg-accent text-accent-foreground rounded-md data-[selected=true]:rounded-none\",\n          defaultClassNames.today\n        ),\n        outside: cn(\n          \"text-muted-foreground aria-selected:text-muted-foreground\",\n          defaultClassNames.outside\n        ),\n        disabled: cn(\n          \"text-muted-foreground opacity-50\",\n          defaultClassNames.disabled\n        ),\n        hidden: cn(\"invisible\", defaultClassNames.hidden),\n        ...classNames,\n      }}\n      components={{\n        Root: ({ className, rootRef, ...props }) => {\n          return (\n            <div\n              data-slot=\"calendar\"\n              ref={rootRef}\n              className={cn(className)}\n              {...props}\n            />\n          )\n        },\n        Chevron: ({ className, orientation, ...props }) => {\n          if (orientation === \"left\") {\n            return (\n              <ChevronLeftIcon className={cn(\"size-4\", className)} {...props} />\n            )\n          }\n\n          if (orientation === \"right\") {\n            return (\n              <ChevronRightIcon\n                className={cn(\"size-4\", className)}\n                {...props}\n              />\n            )\n          }\n\n          return (\n            <ChevronDownIcon className={cn(\"size-4\", className)} {...props} />\n          )\n        },\n        DayButton: CalendarDayButton,\n        WeekNumber: ({ children, ...props }) => {\n          return (\n            <td {...props}>\n              <div className=\"flex size-[--cell-size] items-center justify-center text-center\">\n                {children}\n              </div>\n            </td>\n          )\n        },\n        ...components,\n      }}\n      {...props}\n    />\n  )\n}\n\nfunction CalendarDayButton({\n  className,\n  day,\n  modifiers,\n  ...props\n}: React.ComponentProps<typeof DayButton>) {\n  const defaultClassNames = getDefaultClassNames()\n\n  const ref = React.useRef<HTMLButtonElement>(null)\n  React.useEffect(() => {\n    if (modifiers.focused) ref.current?.focus()\n  }, [modifiers.focused])\n\n  return (\n    <Button\n      ref={ref}\n      variant=\"ghost\"\n      size=\"icon\"\n      data-day={day.date.toLocaleDateString()}\n      data-selected-single={\n        modifiers.selected &&\n        !modifiers.range_start &&\n        !modifiers.range_end &&\n        !modifiers.range_middle\n      }\n      data-range-start={modifiers.range_start}\n      data-range-end={modifiers.range_end}\n      data-range-middle={modifiers.range_middle}\n      className={cn(\n        \"data-[selected-single=true]:bg-primary data-[selected-single=true]:text-primary-foreground data-[range-middle=true]:bg-accent data-[range-middle=true]:text-accent-foreground data-[range-start=true]:bg-primary data-[range-start=true]:text-primary-foreground data-[range-end=true]:bg-primary data-[range-end=true]:text-primary-foreground group-data-[focused=true]/day:border-ring group-data-[focused=true]/day:ring-ring/50 flex aspect-square h-auto w-full min-w-[--cell-size] flex-col gap-1 font-normal leading-none data-[range-end=true]:rounded-md data-[range-middle=true]:rounded-none data-[range-start=true]:rounded-md group-data-[focused=true]/day:relative group-data-[focused=true]/day:z-10 group-data-[focused=true]/day:ring-[3px] [&>span]:text-xs [&>span]:opacity-70\",\n        defaultClassNames.day,\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport { Calendar, CalendarDayButton }\n","path":null,"size_bytes":7569,"size_tokens":null},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent shadow-sm hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-9 px-2 min-w-9\",\n        sm: \"h-8 px-1.5 min-w-8\",\n        lg: \"h-10 px-2.5 min-w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","path":null,"size_bytes":1486,"size_tokens":null},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","path":null,"size_bytes":6210,"size_tokens":null},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"px-2 py-1.5 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute right-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","path":null,"size_bytes":5745,"size_tokens":null},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","path":null,"size_bytes":325,"size_tokens":null},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","path":null,"size_bytes":1383,"size_tokens":null},"client/src/pages/reports.tsx":{"content":"import AuditLayout from \"@/components/layout/audit-layout\";\nimport { useAudit } from \"@/lib/audit-context\";\nimport { useAuth } from \"@/lib/auth\";\nimport { Card } from \"@/components/ui/card\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Button } from \"@/components/ui/button\";\nimport { \n  Table, \n  TableBody, \n  TableCell, \n  TableHead, \n  TableHeader, \n  TableRow \n} from \"@/components/ui/table\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Search, Filter, ArrowRightLeft, Calendar, Info, AlertCircle, CheckCircle, Camera, ShieldCheck, Activity, Image as ImageIcon, AlertTriangle, Scale, BrainCircuit, Clock, Timer, Trash2, Download, RefreshCw } from \"lucide-react\";\nimport { Input } from \"@/components/ui/input\";\nimport { useState } from \"react\";\nimport { Link } from \"wouter\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter, DialogTrigger, DialogClose } from \"@/components/ui/dialog\";\nimport { Label } from \"@/components/ui/label\";\nimport { Pencil } from \"lucide-react\";\nimport { useQueryClient } from \"@tanstack/react-query\";\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from \"@/components/ui/tooltip\";\nimport { HoverCard, HoverCardContent, HoverCardTrigger } from \"@/components/ui/hover-card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { format } from \"date-fns\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n  AlertDialogTrigger,\n} from \"@/components/ui/alert-dialog\";\n\nexport default function ReportsPage() {\n  const { reports, associates, deleteReport } = useAudit();\n  const { user } = useAuth();\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [selectedReports, setSelectedReports] = useState<string[]>([]);\n  const [selectedMonth, setSelectedMonth] = useState(\"all\");\n  const [deletingId, setDeletingId] = useState<string | null>(null);\n  const [rescoringId, setRescoringId] = useState<string | null>(null);\n  const [editingInitiation, setEditingInitiation] = useState<string | null>(null);\n  const [initiationDate, setInitiationDate] = useState(\"\");\n  const [savingInitiation, setSavingInitiation] = useState(false);\n  const queryClient = useQueryClient();\n\n  const handleSaveInitiationDate = async (reportId: string) => {\n    if (!initiationDate) return;\n    \n    setSavingInitiation(true);\n    try {\n      const dateOnly = new Date(`${initiationDate}T00:00:00`);\n      const response = await fetch(`/api/reports/${reportId}/initiation-time`, {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ initiationTime: dateOnly.toISOString() })\n      });\n      \n      if (response.ok) {\n        queryClient.invalidateQueries({ queryKey: ['/api/reports'] });\n        setEditingInitiation(null);\n        setInitiationDate(\"\");\n      }\n    } catch (error) {\n      console.error('Failed to update initiation date:', error);\n    } finally {\n      setSavingInitiation(false);\n    }\n  };\n\n  const handleDelete = async (id: string) => {\n    setDeletingId(id);\n    const success = await deleteReport(id);\n    setDeletingId(null);\n    if (success) {\n      setSelectedReports(prev => prev.filter(r => r !== id));\n    }\n  };\n\n  const handleRescore = async (id: string) => {\n    setRescoringId(id);\n    try {\n      const response = await fetch(`/api/reports/${id}/rescore`, {\n        method: 'POST',\n      });\n      \n      if (response.ok) {\n        queryClient.invalidateQueries({ queryKey: ['/api/reports'] });\n      } else {\n        const error = await response.json();\n        console.error('Failed to rescore report:', error);\n      }\n    } catch (error) {\n      console.error('Failed to rescore report:', error);\n    } finally {\n      setRescoringId(null);\n    }\n  };\n\n  // Debug: Log to help diagnose production issues\n  console.log('[REPORTS PAGE] Total reports loaded:', reports.length);\n  \n  const filteredReports = reports.filter(r => \n    r.title.toLowerCase().includes(searchTerm.toLowerCase()) || \n    r.id.toLowerCase().includes(searchTerm.toLowerCase())\n  );\n\n  const getAssociate = (associateId: string) => {\n    return associates.find(a => a.id === associateId);\n  };\n\n  const getScoreColor = (score: number) => {\n    if (score >= 90) return \"text-emerald-600\";\n    if (score >= 70) return \"text-amber-600\";\n    return \"text-rose-600\";\n  };\n\n  const getProgressColor = (score: number) => {\n    if (score >= 90) return \"bg-emerald-500\";\n    if (score >= 70) return \"bg-amber-500\";\n    return \"bg-rose-500\";\n  };\n\n  const toggleSelection = (id: string) => {\n    if (selectedReports.includes(id)) {\n      setSelectedReports(selectedReports.filter(r => r !== id));\n    } else {\n      if (selectedReports.length < 3) {\n        setSelectedReports([...selectedReports, id]);\n      }\n    }\n  };\n\n  return (\n    <AuditLayout>\n      <div className=\"space-y-6\">\n        <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-4\">\n          <div>\n            <h1 className=\"text-2xl font-bold tracking-tight text-slate-900\">Reports Analysis</h1>\n            <p className=\"text-slate-500\">Compare report quality and completeness across associates.</p>\n          </div>\n          <div className=\"flex gap-2\">\n            <Link href={`/compare?ids=${selectedReports.join(',')}`}>\n              <Button disabled={selectedReports.length < 2} className=\"gap-2\">\n                <ArrowRightLeft className=\"h-4 w-4\" />\n                Compare ({selectedReports.length})\n              </Button>\n            </Link>\n            <Select value={selectedMonth} onValueChange={setSelectedMonth}>\n               <SelectTrigger className=\"w-[180px]\">\n                 <SelectValue placeholder=\"Filter by Month\" />\n               </SelectTrigger>\n               <SelectContent>\n                 <SelectItem value=\"all\">All Months</SelectItem>\n                 <SelectItem value=\"october\">October 2024</SelectItem>\n                 <SelectItem value=\"november\">November 2024</SelectItem>\n                 <SelectItem value=\"december\">December 2024</SelectItem>\n               </SelectContent>\n             </Select>\n          </div>\n        </div>\n\n        <div className=\"flex items-center gap-4 bg-white p-4 rounded-lg border border-slate-200 shadow-sm\">\n          <Search className=\"text-slate-400 h-5 w-5\" />\n          <Input \n            placeholder=\"Search by Lead ID (e.g., A1_20251101 or bhara01112025)...\" \n            className=\"border-none shadow-none focus-visible:ring-0 px-0\"\n            value={searchTerm}\n            onChange={(e) => setSearchTerm(e.target.value)}\n            data-testid=\"input-search-lead-id\"\n          />\n        </div>\n\n        <Card>\n          <Table>\n            <TableHeader>\n              <TableRow className=\"bg-slate-50/50\">\n                <TableHead className=\"w-[50px]\"></TableHead>\n                <TableHead className=\"w-[300px]\">Report Details</TableHead>\n                <TableHead>Associate</TableHead>\n                <TableHead>\n                  <TooltipProvider>\n                    <Tooltip>\n                      <TooltipTrigger className=\"flex items-center gap-1 cursor-help\">\n                        Comprehensive <Info className=\"h-3 w-3 text-slate-400\" />\n                      </TooltipTrigger>\n                      <TooltipContent>\n                        <p>Evaluates risk analysis depth, photo evidence, and due diligence</p>\n                      </TooltipContent>\n                    </Tooltip>\n                  </TooltipProvider>\n                </TableHead>\n                <TableHead>\n                   <TooltipProvider>\n                    <Tooltip>\n                      <TooltipTrigger className=\"flex items-center gap-1 cursor-help\">\n                        Decision <Info className=\"h-3 w-3 text-slate-400\" />\n                      </TooltipTrigger>\n                      <TooltipContent>\n                        <p>Customer Profile Status & AI Validation</p>\n                      </TooltipContent>\n                    </Tooltip>\n                  </TooltipProvider>\n                </TableHead>\n                <TableHead>\n                   <TooltipProvider>\n                    <Tooltip>\n                      <TooltipTrigger className=\"flex items-center gap-1 cursor-help\">\n                        TAT <Info className=\"h-3 w-3 text-slate-400\" />\n                      </TooltipTrigger>\n                      <TooltipContent>\n                        <p>Turnaround Time from trigger email to report submission</p>\n                      </TooltipContent>\n                    </Tooltip>\n                  </TooltipProvider>\n                </TableHead>\n                <TableHead className=\"text-right\">Overall Score</TableHead>\n                <TableHead className=\"w-[50px]\"></TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {filteredReports.map((report) => {\n                const associate = getAssociate(report.associateId);\n                const isSelected = selectedReports.includes(report.id);\n                const missingCount = report.metrics ? (report.metrics.totalFields - report.metrics.filledFields) : 0;\n                const photoMismatchCount = report.metrics?.photoValidation?.missedDetails.length || 0;\n                const missingFieldsList = report.metrics?.missingFields || [];\n                const remainingMissingCount = Math.max(0, missingCount - missingFieldsList.length);\n                \n                return (\n                  <TableRow key={report.id} className=\"group hover:bg-slate-50/50 transition-colors\">\n                    <TableCell>\n                      <Checkbox \n                        checked={isSelected}\n                        onCheckedChange={() => toggleSelection(report.id)}\n                        disabled={!isSelected && selectedReports.length >= 3}\n                      />\n                    </TableCell>\n                    <TableCell className=\"font-medium\">\n                      <div className=\"space-y-1\">\n                        <div className=\"font-semibold text-slate-900\">{report.title}</div>\n                        <div className=\"text-xs text-slate-500 font-mono\">{report.leadId || report.id}_{format(new Date(report.date), 'ddMMyy')}</div>\n                        {report.createdAt && (\n                          <div className=\"text-[10px] text-slate-400 flex items-center gap-1\">\n                            <Calendar className=\"h-3 w-3\" />\n                            Uploaded: {format(new Date(report.createdAt), 'MMM d, yyyy h:mm a')}\n                            {report.fileSize && (\n                              <span className=\"ml-2\"> {(report.fileSize / 1024 / 1024).toFixed(2)} MB</span>\n                            )}\n                          </div>\n                        )}\n                      </div>\n                    </TableCell>\n                    <TableCell>\n                      <div className=\"flex items-center gap-3\">\n                        <Avatar className=\"h-8 w-8\">\n                          <AvatarImage src={associate?.avatar} />\n                          <AvatarFallback>{associate?.name[0]}</AvatarFallback>\n                        </Avatar>\n                        <div className=\"text-sm\">\n                          <div className=\"font-medium text-slate-900\">{associate?.name}</div>\n                          <div className=\"text-xs text-slate-500\">{associate?.role}</div>\n                        </div>\n                      </div>\n                    </TableCell>\n                    <TableCell>\n                      <HoverCard openDelay={0} closeDelay={100}>\n                        <HoverCardTrigger>\n                          <div className=\"space-y-1 w-[140px] cursor-help\">\n                            <div className=\"flex justify-between text-xs items-end\">\n                              <span className=\"text-slate-500\">\n                                {report.metrics?.riskAnalysisDepth || 'Medium'} Risk Analysis\n                              </span>\n                              <span className={`text-xs flex items-center gap-1 ${photoMismatchCount > 0 ? 'text-amber-600 font-medium' : ''}`}>\n                                {photoMismatchCount > 0 && <AlertTriangle className=\"h-3 w-3\" />}\n                                <span className=\"font-bold text-slate-900\">{report.scores.comprehensive}%</span>\n                              </span>\n                            </div>\n                            <Progress value={report.scores.comprehensive} className=\"h-1.5\" indicatorClassName={getProgressColor(report.scores.comprehensive)} />\n                          </div>\n                        </HoverCardTrigger>\n                        <HoverCardContent side=\"right\" className=\"w-[320px] p-0 overflow-hidden shadow-lg max-h-[70vh]\" align=\"start\">\n                          <div className=\"bg-slate-50 px-3 py-2 border-b border-slate-100 sticky top-0 z-10\">\n                            <span className=\"font-semibold text-slate-900 text-xs\">Comprehensive Score Breakdown</span>\n                          </div>\n                          <div className=\"p-3 space-y-2 overflow-y-auto max-h-[calc(70vh-40px)]\">\n                            {/* Personal Details with breakdown */}\n                            <div className=\"space-y-1\">\n                              <div className=\"flex items-center justify-between text-xs\">\n                                <span className=\"text-slate-600 font-medium\">Personal Details</span>\n                                <span className={`font-medium ${(report.scores.comprehensiveBreakdown?.personal ?? 0) === 15 ? 'text-emerald-600' : (report.scores.comprehensiveBreakdown?.personal ?? 0) >= 9 ? 'text-slate-900' : 'text-amber-600'}`}>\n                                  {report.scores.comprehensiveBreakdown?.personal ?? 0}/15\n                                </span>\n                              </div>\n                              <Progress value={((report.scores.comprehensiveBreakdown?.personal ?? 0) / 15) * 100} className=\"h-1\" indicatorClassName={(report.scores.comprehensiveBreakdown?.personal ?? 0) === 15 ? 'bg-emerald-500' : (report.scores.comprehensiveBreakdown?.personal ?? 0) >= 9 ? 'bg-blue-500' : 'bg-amber-500'} />\n                              <div className=\"ml-3 mt-1 space-y-0.5 text-[10px] text-slate-500 border-l-2 border-slate-200 pl-2\">\n                                {(() => {\n                                  const pm = report.scores.comprehensiveBreakdown?.personalMatches as Record<string, boolean> | undefined;\n                                  const items = [\n                                    { name: 'Self Education', key: 'selfEducation' },\n                                    { name: 'Spouse Name', key: 'spouseName' },\n                                    { name: 'Spouse Education', key: 'spouseEducation' },\n                                    { name: 'Spouse Employment', key: 'spouseEmployment' },\n                                    { name: 'Mention about Kids', key: 'mentionAboutKids' },\n                                    { name: 'Kids Education', key: 'kidsEducation' },\n                                    { name: 'Kids School', key: 'kidsSchool' },\n                                    { name: 'Residence Vintage', key: 'residenceVintage' },\n                                    { name: 'Monthly Rent (if rented)', key: 'monthlyRentIfRented' },\n                                    { name: 'Residence Owned/Rented', key: 'residenceOwnedOrRented' }\n                                  ];\n                                  return items.map((item, idx) => {\n                                    const isMet = pm ? pm[item.key] : false;\n                                    return (\n                                      <div key={idx} className=\"flex justify-between\">\n                                        <span> {item.name}</span>\n                                        <span className={isMet ? 'text-emerald-600' : 'text-slate-400'}>{isMet ? '' : ''}</span>\n                                      </div>\n                                    );\n                                  });\n                                })()}\n                              </div>\n                            </div>\n\n                            {/* Business Details with breakdown */}\n                            <div className=\"space-y-1\">\n                              <div className=\"flex items-center justify-between text-xs\">\n                                <span className=\"text-slate-600 font-medium\">Business Details</span>\n                                <span className={`font-medium ${(report.scores.comprehensiveBreakdown?.business ?? 0) === 30 ? 'text-emerald-600' : (report.scores.comprehensiveBreakdown?.business ?? 0) >= 18 ? 'text-slate-900' : 'text-amber-600'}`}>\n                                  {report.scores.comprehensiveBreakdown?.business ?? 0}/30\n                                </span>\n                              </div>\n                              <Progress value={((report.scores.comprehensiveBreakdown?.business ?? 0) / 30) * 100} className=\"h-1\" indicatorClassName={(report.scores.comprehensiveBreakdown?.business ?? 0) === 30 ? 'bg-emerald-500' : (report.scores.comprehensiveBreakdown?.business ?? 0) >= 18 ? 'bg-blue-500' : 'bg-amber-500'} />\n                              <div className=\"ml-3 mt-1 space-y-0.5 text-[10px] text-slate-500 border-l-2 border-slate-200 pl-2\">\n                                {(() => {\n                                  const bm = report.scores.comprehensiveBreakdown?.businessMatches as Record<string, boolean> | undefined;\n                                  const coreItems = [\n                                    { name: 'Business Name', key: 'businessName' },\n                                    { name: 'Nature of Business', key: 'natureOfBusiness' },\n                                    { name: 'Existence at Current Place', key: 'existenceCurrentPlace' },\n                                    { name: 'Licenses/Registrations', key: 'licensesRegistrations' },\n                                    { name: 'Promoter Experience/Qualifications', key: 'promoterExperienceQualifications' },\n                                    { name: 'Strategic Vision/Clarity', key: 'strategicVisionClarity' },\n                                    { name: 'Employees Seen', key: 'employeesSeen' },\n                                    { name: 'Monthly Turnover', key: 'monthlyTurnover' },\n                                    { name: 'Client List/Concentration Risk', key: 'clientListConcentrationRisk' },\n                                    { name: 'Activity During Visit', key: 'activityDuringVisit' },\n                                    { name: 'Monthly Income', key: 'monthlyIncome' },\n                                    { name: 'Seasonality', key: 'seasonality' },\n                                    { name: 'Infra Supports Turnover', key: 'infraSupportsTurnover' }\n                                  ];\n                                  const mfgItems = [\n                                    { name: 'Mfg: Raw Material Sourcing/Storage', key: 'mfgRawMaterialSourcingStorage' },\n                                    { name: 'Mfg: Process Flow', key: 'mfgProcessFlow' },\n                                    { name: 'Mfg: Capacity vs Utilization', key: 'mfgCapacityVsUtilization' },\n                                    { name: 'Mfg: Machinery/Automation/Maintenance', key: 'mfgMachineryMakeAutomationMaintenance' },\n                                    { name: 'Mfg: Inventory FIFO/Aging', key: 'mfgInventoryFifoAging' },\n                                    { name: 'Mfg: Quality Control', key: 'mfgQualityControl' }\n                                  ];\n                                  const tradingItems = [\n                                    { name: 'Trading: Product Range/Inventory', key: 'tradingProductRangeInventoryMovement' },\n                                    { name: 'Trading: Purchase/Sales Cycle', key: 'tradingPurchaseSalesCycle' },\n                                    { name: 'Trading: Warehouse/Stock Seen', key: 'tradingWarehouseStockSeen' }\n                                  ];\n                                  const svcItems = [\n                                    { name: 'Svc: Documentation of Delivery', key: 'svcDocumentationOfDelivery' },\n                                    { name: 'Svc: Technology/Systems', key: 'svcTechnologySystems' },\n                                    { name: 'Svc: Client List/Contracts/Revenue', key: 'svcClientListContractsRevenueModel' },\n                                    { name: 'Svc: Contract-based or Walk-in', key: 'svcContractBasedOrWalkin' }\n                                  ];\n                                  const hasMfg = mfgItems.some(item => bm?.[item.key]);\n                                  const hasTrading = tradingItems.some(item => bm?.[item.key]);\n                                  const hasSvc = svcItems.some(item => bm?.[item.key]);\n                                  let allItems = [...coreItems];\n                                  if (hasMfg) allItems = [...allItems, ...mfgItems];\n                                  if (hasTrading) allItems = [...allItems, ...tradingItems];\n                                  if (hasSvc) allItems = [...allItems, ...svcItems];\n                                  if (!hasMfg && !hasTrading && !hasSvc) allItems = [...allItems, ...mfgItems, ...tradingItems, ...svcItems];\n                                  return allItems.map((item, idx) => {\n                                    const isMet = bm ? bm[item.key] : false;\n                                    return (\n                                      <div key={idx} className=\"flex justify-between\">\n                                        <span> {item.name}</span>\n                                        <span className={isMet ? 'text-emerald-600' : 'text-slate-400'}>{isMet ? '' : ''}</span>\n                                      </div>\n                                    );\n                                  });\n                                })()}\n                              </div>\n                            </div>\n                            \n                            {/* Banking with detailed breakdown */}\n                            <div className=\"space-y-1\">\n                              <div className=\"flex items-center justify-between text-xs\">\n                                <span className=\"text-slate-600 font-medium\">Banking</span>\n                                <span className={`font-medium ${(report.scores.comprehensiveBreakdown?.banking ?? 0) === 15 ? 'text-emerald-600' : (report.scores.comprehensiveBreakdown?.banking ?? 0) >= 9 ? 'text-slate-900' : 'text-amber-600'}`}>\n                                  {report.scores.comprehensiveBreakdown?.banking ?? 0}/15\n                                </span>\n                              </div>\n                              <Progress value={((report.scores.comprehensiveBreakdown?.banking ?? 0) / 15) * 100} className=\"h-1\" indicatorClassName={(report.scores.comprehensiveBreakdown?.banking ?? 0) === 15 ? 'bg-emerald-500' : (report.scores.comprehensiveBreakdown?.banking ?? 0) >= 9 ? 'bg-blue-500' : 'bg-amber-500'} />\n                              <div className=\"ml-3 mt-1 space-y-0.5 text-[10px] text-slate-500 border-l-2 border-slate-200 pl-2\">\n                                {(() => {\n                                  const bkm = report.scores.comprehensiveBreakdown?.bankingMatches as Record<string, boolean> | undefined;\n                                  const items = [\n                                    { name: 'Primary Banker Name', key: 'primaryBankerName' },\n                                    { name: 'Turnover Credited %', key: 'turnoverCreditedPercent' },\n                                    { name: 'Banking Tenure', key: 'bankingTenure' },\n                                    { name: 'EMIs Routed Bank', key: 'emisRoutedBank' },\n                                    { name: 'QR Code Spotted', key: 'qrCodeSpotted' }\n                                  ];\n                                  return items.map((item, idx) => {\n                                    const isMet = bkm ? bkm[item.key] : false;\n                                    return (\n                                      <div key={idx} className=\"flex justify-between\">\n                                        <span> {item.name}</span>\n                                        <span className={isMet ? 'text-emerald-600' : 'text-slate-400'}>{isMet ? '' : ''}</span>\n                                      </div>\n                                    );\n                                  });\n                                })()}\n                              </div>\n                            </div>\n\n                            {/* Networth/Asset with breakdown */}\n                            <div className=\"space-y-1\">\n                              <div className=\"flex items-center justify-between text-xs\">\n                                <span className=\"text-slate-600 font-medium\">Networth/Asset</span>\n                                <span className={`font-medium ${(report.scores.comprehensiveBreakdown?.networth ?? 0) === 10 ? 'text-emerald-600' : (report.scores.comprehensiveBreakdown?.networth ?? 0) >= 6 ? 'text-slate-900' : 'text-amber-600'}`}>\n                                  {report.scores.comprehensiveBreakdown?.networth ?? 0}/10\n                                </span>\n                              </div>\n                              <Progress value={((report.scores.comprehensiveBreakdown?.networth ?? 0) / 10) * 100} className=\"h-1\" indicatorClassName={(report.scores.comprehensiveBreakdown?.networth ?? 0) === 10 ? 'bg-emerald-500' : (report.scores.comprehensiveBreakdown?.networth ?? 0) >= 6 ? 'bg-blue-500' : 'bg-amber-500'} />\n                              <div className=\"ml-3 mt-1 space-y-0.5 text-[10px] text-slate-500 border-l-2 border-slate-200 pl-2\">\n                                {(() => {\n                                  const nm = report.scores.comprehensiveBreakdown?.networthMatches as Record<string, boolean> | undefined;\n                                  const items = [\n                                    { name: 'Properties Owned', key: 'propertiesOwned' },\n                                    { name: 'Vehicles Owned', key: 'vehiclesOwned' },\n                                    { name: 'Other Investments', key: 'otherInvestments' },\n                                    { name: 'Business Place Owned', key: 'businessPlaceOwned' },\n                                    { name: 'Total Networth Available', key: 'totalNetworthAvailable' }\n                                  ];\n                                  return items.map((item, idx) => {\n                                    const isMet = nm ? nm[item.key] : false;\n                                    return (\n                                      <div key={idx} className=\"flex justify-between\">\n                                        <span> {item.name}</span>\n                                        <span className={isMet ? 'text-emerald-600' : 'text-slate-400'}>{isMet ? '' : ''}</span>\n                                      </div>\n                                    );\n                                  });\n                                })()}\n                              </div>\n                            </div>\n\n                            {/* Existing Debt with breakdown */}\n                            <div className=\"space-y-1\">\n                              <div className=\"flex items-center justify-between text-xs\">\n                                <span className=\"text-slate-600 font-medium\">Existing Debt</span>\n                                <span className={`font-medium ${(report.scores.comprehensiveBreakdown?.existingDebt ?? 0) === 10 ? 'text-emerald-600' : (report.scores.comprehensiveBreakdown?.existingDebt ?? 0) >= 6 ? 'text-slate-900' : 'text-amber-600'}`}>\n                                  {report.scores.comprehensiveBreakdown?.existingDebt ?? 0}/10\n                                </span>\n                              </div>\n                              <Progress value={((report.scores.comprehensiveBreakdown?.existingDebt ?? 0) / 10) * 100} className=\"h-1\" indicatorClassName={(report.scores.comprehensiveBreakdown?.existingDebt ?? 0) === 10 ? 'bg-emerald-500' : (report.scores.comprehensiveBreakdown?.existingDebt ?? 0) >= 6 ? 'bg-blue-500' : 'bg-amber-500'} />\n                              <div className=\"ml-3 mt-1 space-y-0.5 text-[10px] text-slate-500 border-l-2 border-slate-200 pl-2\">\n                                {(() => {\n                                  const dm = report.scores.comprehensiveBreakdown?.debtMatches as Record<string, boolean> | undefined;\n                                  const items = [\n                                    { name: 'Has Existing Loans', key: 'hasExistingLoans' },\n                                    { name: 'Loan List Available', key: 'loanListAvailable' },\n                                    { name: 'Can Service New Loan', key: 'canServiceNewLoan' },\n                                    { name: 'Repayment History Quality', key: 'repaymentHistoryQuality' },\n                                    { name: 'Loans Source/Bank/Nature', key: 'loansSourceBankNature' }\n                                  ];\n                                  return items.map((item, idx) => {\n                                    const isMet = dm ? dm[item.key] : false;\n                                    return (\n                                      <div key={idx} className=\"flex justify-between\">\n                                        <span> {item.name}</span>\n                                        <span className={isMet ? 'text-emerald-600' : 'text-slate-400'}>{isMet ? '' : ''}</span>\n                                      </div>\n                                    );\n                                  });\n                                })()}\n                              </div>\n                            </div>\n\n                            {/* End Use with breakdown */}\n                            <div className=\"space-y-1\">\n                              <div className=\"flex items-center justify-between text-xs\">\n                                <span className=\"text-slate-600 font-medium\">End Use</span>\n                                <span className={`font-medium ${(report.scores.comprehensiveBreakdown?.endUse ?? 0) === 10 ? 'text-emerald-600' : (report.scores.comprehensiveBreakdown?.endUse ?? 0) >= 6 ? 'text-slate-900' : 'text-amber-600'}`}>\n                                  {report.scores.comprehensiveBreakdown?.endUse ?? 0}/10\n                                </span>\n                              </div>\n                              <Progress value={((report.scores.comprehensiveBreakdown?.endUse ?? 0) / 10) * 100} className=\"h-1\" indicatorClassName={(report.scores.comprehensiveBreakdown?.endUse ?? 0) === 10 ? 'bg-emerald-500' : (report.scores.comprehensiveBreakdown?.endUse ?? 0) >= 6 ? 'bg-blue-500' : 'bg-amber-500'} />\n                              <div className=\"ml-3 mt-1 space-y-0.5 text-[10px] text-slate-500 border-l-2 border-slate-200 pl-2\">\n                                {(() => {\n                                  const em = report.scores.comprehensiveBreakdown?.endUseMatches as Record<string, boolean> | undefined;\n                                  const items = [\n                                    { name: 'Agreement Value Available', key: 'agreementValueAvailable' },\n                                    { name: 'Advance Paid (Cash/Bank)', key: 'advancePaidCashOrBankAmount' },\n                                    { name: 'Will Occupy Post Purchase', key: 'willOccupyPostPurchase' },\n                                    { name: 'Mortgage Funds Use', key: 'mortgageFundsUse' },\n                                    { name: 'Additional Use Information', key: 'additionalUseInformation' }\n                                  ];\n                                  return items.map((item, idx) => {\n                                    const isMet = em ? em[item.key] : false;\n                                    return (\n                                      <div key={idx} className=\"flex justify-between\">\n                                        <span> {item.name}</span>\n                                        <span className={isMet ? 'text-emerald-600' : 'text-slate-400'}>{isMet ? '' : ''}</span>\n                                      </div>\n                                    );\n                                  });\n                                })()}\n                              </div>\n                            </div>\n\n                            {/* Reference Checks with breakdown */}\n                            <div className=\"space-y-1\">\n                              <div className=\"flex items-center justify-between text-xs\">\n                                <span className=\"text-slate-600 font-medium\">Reference Checks</span>\n                                <span className={`font-medium ${(report.scores.comprehensiveBreakdown?.referenceChecks ?? 0) === 10 ? 'text-emerald-600' : (report.scores.comprehensiveBreakdown?.referenceChecks ?? 0) >= 6 ? 'text-slate-900' : 'text-amber-600'}`}>\n                                  {report.scores.comprehensiveBreakdown?.referenceChecks ?? 0}/10\n                                </span>\n                              </div>\n                              <Progress value={((report.scores.comprehensiveBreakdown?.referenceChecks ?? 0) / 10) * 100} className=\"h-1\" indicatorClassName={(report.scores.comprehensiveBreakdown?.referenceChecks ?? 0) === 10 ? 'bg-emerald-500' : (report.scores.comprehensiveBreakdown?.referenceChecks ?? 0) >= 6 ? 'bg-blue-500' : 'bg-amber-500'} />\n                              <div className=\"ml-3 mt-1 space-y-0.5 text-[10px] text-slate-500 border-l-2 border-slate-200 pl-2\">\n                                {(() => {\n                                  const rm = report.scores.comprehensiveBreakdown?.referenceMatches as Record<string, boolean> | undefined;\n                                  const items = [\n                                    { name: 'Personal/Neighbour Ref', key: 'personalRefNeighbours' },\n                                    { name: 'Business/Buyers/Sellers Ref', key: 'businessRefBuyersSellers' },\n                                    { name: 'Invoice Verification', key: 'invoiceVerification' }\n                                  ];\n                                  return items.map((item, idx) => {\n                                    const isMet = rm ? rm[item.key] : false;\n                                    return (\n                                      <div key={idx} className=\"flex justify-between\">\n                                        <span> {item.name}</span>\n                                        <span className={isMet ? 'text-emerald-600' : 'text-slate-400'}>{isMet ? '' : ''}</span>\n                                      </div>\n                                    );\n                                  });\n                                })()}\n                              </div>\n                            </div>\n                            <div className=\"pt-2 mt-2 border-t border-slate-100 flex items-center justify-between\">\n                              <span className=\"text-xs font-semibold text-slate-900\">Total Score</span>\n                              <span className=\"text-sm font-bold text-slate-900\">{report.scores.comprehensive}/100</span>\n                            </div>\n                          </div>\n                        </HoverCardContent>\n                      </HoverCard>\n                    </TableCell>\n                    <TableCell>\n                      <HoverCard openDelay={0} closeDelay={100}>\n                        <HoverCardTrigger>\n                          <div className=\"space-y-1 w-[120px] cursor-help text-left\">\n                            <Badge \n                              variant=\"outline\" \n                              className={`\n                                ${report.decision?.status === 'Positive' ? 'bg-emerald-50 text-emerald-700 border-emerald-200' : \n                                  report.decision?.status === 'Negative' ? 'bg-rose-50 text-rose-700 border-rose-200' : \n                                  'bg-amber-50 text-amber-700 border-amber-200'}\n                                font-semibold\n                              `}\n                            >\n                              {report.decision?.status || 'Pending'}\n                            </Badge>\n                            {report.decision?.aiValidation && (\n                              <div className=\"flex items-center gap-1 text-[10px] text-slate-500 mt-1\">\n                                <BrainCircuit className=\"h-3 w-3\" />\n                                <span>{report.decision.aiValidation.confidence}% AI Confidence</span>\n                              </div>\n                            )}\n                          </div>\n                        </HoverCardTrigger>\n                        <HoverCardContent side=\"right\" className=\"w-[300px] p-0 overflow-hidden shadow-lg\" align=\"start\">\n                          <div className=\"bg-slate-50 px-3 py-2 border-b border-slate-100 flex items-center justify-between\">\n                            <span className=\"font-semibold text-slate-900 text-xs\">Decision Rationale</span>\n                            <Badge variant=\"outline\" className=\"text-[10px] h-5 bg-white\">\n                              {report.decision?.status}\n                            </Badge>\n                          </div>\n                          <div className=\"p-3 space-y-3\">\n                            <div className=\"space-y-1\">\n                              <span className=\"text-xs text-slate-500 font-medium flex items-center gap-1\">\n                                <Scale className=\"h-3 w-3\" /> Associate Remarks\n                              </span>\n                              <p className=\"text-xs text-slate-700 bg-slate-50 p-2 rounded border border-slate-100\">\n                                \"{report.decision?.remarks || 'No remarks provided.'}\"\n                              </p>\n                            </div>\n                            \n                            {report.decision?.aiValidation && (\n                              <div className=\"space-y-1 pt-2 border-t border-slate-100\">\n                                <div className=\"flex items-center justify-between\">\n                                  <span className=\"text-xs text-slate-500 font-medium flex items-center gap-1\">\n                                    <BrainCircuit className=\"h-3 w-3\" /> AI Validation\n                                  </span>\n                                  <span className={`text-[10px] font-bold ${report.decision.aiValidation.confidence > 80 ? 'text-emerald-600' : 'text-amber-600'}`}>\n                                    {report.decision.aiValidation.confidence}% Match\n                                  </span>\n                                </div>\n                                <p className=\"text-xs text-slate-600 italic\">\n                                  {report.decision.aiValidation.reasoning}\n                                </p>\n                              </div>\n                            )}\n                          </div>\n                        </HoverCardContent>\n                      </HoverCard>\n                    </TableCell>\n                    <TableCell>\n                      <HoverCard openDelay={0} closeDelay={100}>\n                        <HoverCardTrigger>\n                          <div className=\"space-y-1 w-[120px] cursor-help\">\n                            {report.tat?.totalTATHours != null ? (\n                              <>\n                                <div className=\"flex items-center gap-1\">\n                                  <Clock className=\"h-3 w-3 text-slate-500\" />\n                                  <span className={`text-sm font-bold ${report.tat.totalTATHours <= 48 ? 'text-emerald-600' : report.tat.totalTATHours <= 120 ? 'text-amber-600' : 'text-rose-600'}`}>\n                                    {report.tat.totalTATHours < 24 ? `${report.tat.totalTATHours}h` : `${Math.round(report.tat.totalTATHours / 24 * 10) / 10}d`}\n                                  </span>\n                                </div>\n                                <div className=\"text-[10px] text-slate-400 space-y-0.5\">\n                                  {report.tat.initiationTime && <div>Init: {format(new Date(report.tat.initiationTime), 'dd/MM/yyyy')}</div>}\n                                  {report.tat.visitTime && <div>Visit: {format(new Date(report.tat.visitTime), 'dd/MM HH:mm')}</div>}\n                                </div>\n                              </>\n                            ) : (\n                              <span className=\"text-xs text-slate-400 italic\">Not available</span>\n                            )}\n                          </div>\n                        </HoverCardTrigger>\n                        <HoverCardContent side=\"right\" className=\"w-[320px] p-0 overflow-hidden shadow-lg\" align=\"start\">\n                          <div className=\"bg-slate-50 px-3 py-2 border-b border-slate-100\">\n                            <span className=\"font-semibold text-slate-900 text-xs\">Turnaround Time Details</span>\n                          </div>\n                          <div className=\"p-3 space-y-3\">\n                            <div className=\"space-y-2\">\n                              <div className=\"flex items-center justify-between\">\n                                <span className=\"text-xs text-slate-500 font-medium\">Initiation Date</span>\n                                <div className=\"flex items-center gap-1\">\n                                  <span className=\"text-xs font-medium text-slate-900\">\n                                    {report.tat?.initiationTime ? format(new Date(report.tat.initiationTime), 'MMM d, yyyy') : <span className=\"text-slate-400 italic\">Not found</span>}\n                                  </span>\n                                  <Dialog open={editingInitiation === report.id} onOpenChange={(open) => {\n                                    if (open) {\n                                      setEditingInitiation(report.id);\n                                      if (report.tat?.initiationTime) {\n                                        const dt = new Date(report.tat.initiationTime);\n                                        setInitiationDate(dt.toISOString().split('T')[0]);\n                                      } else {\n                                        setInitiationDate(\"\");\n                                      }\n                                    } else {\n                                      setEditingInitiation(null);\n                                    }\n                                  }}>\n                                    <DialogTrigger asChild>\n                                      <Button variant=\"ghost\" size=\"sm\" className=\"h-5 w-5 p-0 hover:bg-slate-100\" data-testid={`button-edit-initiation-${report.id}`}>\n                                        <Pencil className=\"h-3 w-3 text-slate-400\" />\n                                      </Button>\n                                    </DialogTrigger>\n                                    <DialogContent className=\"max-w-sm\">\n                                      <DialogHeader>\n                                        <DialogTitle>Set Initiation Date</DialogTitle>\n                                      </DialogHeader>\n                                      <div className=\"space-y-4 py-4\">\n                                        <div className=\"space-y-2\">\n                                          <Label htmlFor=\"init-date\">Date</Label>\n                                          <Input \n                                            id=\"init-date\" \n                                            type=\"date\" \n                                            value={initiationDate} \n                                            onChange={(e) => setInitiationDate(e.target.value)}\n                                            data-testid=\"input-initiation-date\"\n                                          />\n                                        </div>\n                                      </div>\n                                      <DialogFooter>\n                                        <DialogClose asChild>\n                                          <Button variant=\"outline\">Cancel</Button>\n                                        </DialogClose>\n                                        <Button \n                                          onClick={() => handleSaveInitiationDate(report.id)} \n                                          disabled={!initiationDate || savingInitiation}\n                                          data-testid=\"button-save-initiation\"\n                                        >\n                                          {savingInitiation ? 'Saving...' : 'Save'}\n                                        </Button>\n                                      </DialogFooter>\n                                    </DialogContent>\n                                  </Dialog>\n                                </div>\n                              </div>\n                              <div className=\"flex items-center justify-between\">\n                                <span className=\"text-xs text-slate-500 font-medium\">Visit Time</span>\n                                <span className=\"text-xs font-medium text-slate-900\">\n                                  {report.tat?.visitTime ? format(new Date(report.tat.visitTime), 'MMM d, yyyy h:mm a') : <span className=\"text-slate-400 italic\">Not found</span>}\n                                </span>\n                              </div>\n                              <div className=\"flex items-center justify-between\">\n                                <span className=\"text-xs text-slate-500 font-medium\">Report Date</span>\n                                <span className=\"text-xs font-medium text-slate-900\">\n                                  {report.tat?.reportDate ? format(new Date(report.tat.reportDate), 'MMM d, yyyy') : report.date}\n                                </span>\n                              </div>\n                            </div>\n                            <div className=\"border-t border-slate-100 pt-2 space-y-1\">\n                              <div className=\"flex items-center justify-between\">\n                                <span className=\"text-xs text-slate-500 flex items-center gap-1\">\n                                  <Timer className=\"h-3 w-3\" /> Initiation  Visit\n                                </span>\n                                <Badge variant={report.tat?.initiationToVisitHours != null && report.tat.initiationToVisitHours <= 24 ? 'default' : 'secondary'} className=\"text-[10px] h-5\">\n                                  {report.tat?.initiationToVisitHours != null ? `${report.tat.initiationToVisitHours}h` : 'N/A'}\n                                </Badge>\n                              </div>\n                              <div className=\"flex items-center justify-between\">\n                                <span className=\"text-xs text-slate-500 flex items-center gap-1\">\n                                  <Timer className=\"h-3 w-3\" /> Visit  Report\n                                </span>\n                                <Badge variant={report.tat?.visitToReportHours != null && report.tat.visitToReportHours <= 24 ? 'default' : 'secondary'} className=\"text-[10px] h-5\">\n                                  {report.tat?.visitToReportHours != null ? `${report.tat.visitToReportHours}h` : 'N/A'}\n                                </Badge>\n                              </div>\n                              <div className=\"flex items-center justify-between\">\n                                <span className=\"text-xs text-slate-500 flex items-center gap-1 font-medium\">\n                                  <Clock className=\"h-3 w-3\" /> Total TAT\n                                </span>\n                                <Badge variant={report.tat?.totalTATHours != null && report.tat.totalTATHours <= 48 ? 'default' : report.tat?.totalTATHours != null && report.tat.totalTATHours <= 120 ? 'secondary' : 'destructive'} className=\"text-[10px] h-5\">\n                                  {report.tat?.totalTATHours != null ? `${Math.round(report.tat.totalTATHours / 24 * 10) / 10} days` : 'N/A'}\n                                </Badge>\n                              </div>\n                            </div>\n                          </div>\n                        </HoverCardContent>\n                      </HoverCard>\n                    </TableCell>\n                    <TableCell className=\"text-right\">\n                      <div className={`text-xl font-bold font-mono ${getScoreColor(report.scores.overall)}`}>\n                        {report.scores.overall}\n                      </div>\n                    </TableCell>\n                    <TableCell>\n                      <div className=\"flex items-center gap-1\">\n                        <Link href={`/compare?ids=${report.id}`}>\n                          <Button variant=\"ghost\" size=\"sm\" data-testid={`button-details-${report.id}`}>Details</Button>\n                        </Link>\n                        <Button \n                          variant=\"ghost\" \n                          size=\"sm\" \n                          className=\"text-blue-500 hover:text-blue-700 hover:bg-blue-50\"\n                          onClick={() => window.open(`/api/reports/${report.id}/download`, '_blank')}\n                          data-testid={`button-download-${report.id}`}\n                        >\n                          <Download className=\"h-4 w-4\" />\n                        </Button>\n                        {user?.isAdmin && (\n                          <Button \n                            variant=\"ghost\" \n                            size=\"sm\" \n                            className=\"text-violet-500 hover:text-violet-700 hover:bg-violet-50\"\n                            onClick={() => handleRescore(report.id)}\n                            disabled={rescoringId === report.id}\n                            data-testid={`button-rescore-${report.id}`}\n                          >\n                            <RefreshCw className={`h-4 w-4 ${rescoringId === report.id ? 'animate-spin' : ''}`} />\n                          </Button>\n                        )}\n                        {(user?.isAdmin || user?.id === report.associateId) && (\n                          <AlertDialog>\n                            <AlertDialogTrigger asChild>\n                              <Button \n                                variant=\"ghost\" \n                                size=\"sm\" \n                                className=\"text-rose-500 hover:text-rose-700 hover:bg-rose-50\"\n                                disabled={deletingId === report.id}\n                                data-testid={`button-delete-${report.id}`}\n                              >\n                                <Trash2 className=\"h-4 w-4\" />\n                              </Button>\n                            </AlertDialogTrigger>\n                            <AlertDialogContent>\n                              <AlertDialogHeader>\n                                <AlertDialogTitle>Delete Report</AlertDialogTitle>\n                                <AlertDialogDescription>\n                                  Are you sure you want to delete the report for <strong>{report.leadId || report.id}</strong>? This action cannot be undone.\n                                </AlertDialogDescription>\n                              </AlertDialogHeader>\n                              <AlertDialogFooter>\n                                <AlertDialogCancel>Cancel</AlertDialogCancel>\n                                <AlertDialogAction \n                                  onClick={() => handleDelete(report.id)}\n                                  className=\"bg-rose-600 hover:bg-rose-700\"\n                                  data-testid={`button-confirm-delete-${report.id}`}\n                                >\n                                  Delete\n                                </AlertDialogAction>\n                              </AlertDialogFooter>\n                            </AlertDialogContent>\n                          </AlertDialog>\n                        )}\n                      </div>\n                    </TableCell>\n                  </TableRow>\n                );\n              })}\n            </TableBody>\n          </Table>\n        </Card>\n      </div>\n    </AuditLayout>\n  );\n}","path":null,"size_bytes":53255,"size_tokens":null},"client/src/components/ui/label.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","path":null,"size_bytes":724,"size_tokens":null},"client/src/components/event-card.tsx":{"content":"import { Event } from \"@/lib/mock-data\";\nimport { Calendar, MapPin, Users } from \"lucide-react\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Heart } from \"lucide-react\";\nimport { useState } from \"react\";\nimport { cn } from \"@/lib/utils\";\n\ninterface EventCardProps {\n  event: Event;\n}\n\nexport default function EventCard({ event }: EventCardProps) {\n  const [isSaved, setIsSaved] = useState(false);\n\n  return (\n    <Card className=\"overflow-hidden border-none shadow-sm hover:shadow-md transition-all duration-300 group bg-card\">\n      <div className=\"relative aspect-[4/3] overflow-hidden\">\n        <img\n          src={event.image}\n          alt={event.title}\n          className=\"object-cover w-full h-full transition-transform duration-500 group-hover:scale-105\"\n        />\n        <div className=\"absolute top-3 right-3\">\n          <Button\n            size=\"icon\"\n            variant=\"secondary\"\n            className=\"h-8 w-8 rounded-full bg-white/90 backdrop-blur-sm shadow-sm hover:bg-white\"\n            onClick={(e) => {\n              e.preventDefault();\n              setIsSaved(!isSaved);\n            }}\n          >\n            <Heart\n              size={16}\n              className={cn(\n                \"transition-colors\",\n                isSaved ? \"fill-primary text-primary\" : \"text-muted-foreground\"\n              )}\n            />\n          </Button>\n        </div>\n        <div className=\"absolute top-3 left-3\">\n            <Badge variant=\"secondary\" className=\"bg-white/90 backdrop-blur-sm text-foreground font-medium shadow-sm hover:bg-white/100\">\n                {event.type}\n            </Badge>\n        </div>\n      </div>\n      \n      <CardContent className=\"p-4 space-y-3\">\n        <div className=\"flex justify-between items-start\">\n          <h3 className=\"font-serif text-xl font-bold leading-tight text-foreground line-clamp-2\">\n            {event.title}\n          </h3>\n          <div className=\"text-lg font-bold text-primary shrink-0 ml-3\">\n            {event.price === 0 ? \"Free\" : `$${event.price}`}\n          </div>\n        </div>\n\n        <div className=\"space-y-2 text-sm text-muted-foreground\">\n          <div className=\"flex items-center gap-2\">\n            <Calendar size={14} className=\"text-primary/70\" />\n            <span>{event.date}  {event.time}</span>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <MapPin size={14} className=\"text-primary/70\" />\n            <span className=\"truncate\">{event.location}</span>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <Users size={14} className=\"text-primary/70\" />\n            <span>{event.attendees} going</span>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}","path":null,"size_bytes":2861,"size_tokens":null},"client/src/components/ui/kbd.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Kbd({ className, ...props }: React.ComponentProps<\"kbd\">) {\n  return (\n    <kbd\n      data-slot=\"kbd\"\n      className={cn(\n        \"bg-muted text-muted-foreground pointer-events-none inline-flex h-5 w-fit min-w-5 select-none items-center justify-center gap-1 rounded-sm px-1 font-sans text-xs font-medium\",\n        \"[&_svg:not([class*='size-'])]:size-3\",\n        \"[[data-slot=tooltip-content]_&]:bg-background/20 [[data-slot=tooltip-content]_&]:text-background dark:[[data-slot=tooltip-content]_&]:bg-background/10\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction KbdGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <kbd\n      data-slot=\"kbd-group\"\n      className={cn(\"inline-flex items-center gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Kbd, KbdGroup }\n","path":null,"size_bytes":862,"size_tokens":null},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Portal>\n    <TooltipPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 overflow-hidden rounded-md bg-primary px-3 py-1.5 text-xs text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </TooltipPrimitive.Portal>\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","path":null,"size_bytes":1267,"size_tokens":null},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","path":null,"size_bytes":1642,"size_tokens":null},"client/src/lib/auth.tsx":{"content":"import { createContext, useContext, useState, ReactNode, useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport type { User as SchemaUser } from \"@shared/schema\";\n\ninterface User extends SchemaUser {\n  isAdmin?: boolean;\n}\n\ninterface AuthContextType {\n  user: User | null;\n  login: (username: string, password: string) => Promise<boolean>;\n  logout: () => Promise<void>;\n  loading: boolean;\n}\n\nconst AuthContext = createContext<AuthContextType | null>(null);\n\nexport function AuthProvider({ children }: { children: ReactNode }) {\n  const [user, setUser] = useState<User | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [, setLocation] = useLocation();\n\n  useEffect(() => {\n    checkAuth();\n  }, []);\n\n  const checkAuth = async () => {\n    try {\n      const response = await fetch('/api/user', {\n        credentials: 'include',\n      });\n      \n      if (response.ok) {\n        const userData = await response.json();\n        setUser(userData);\n      } else {\n        // In development, auto-login as admin for easier testing\n        console.log('Not authenticated, attempting auto-login...');\n        const autoLoginResponse = await fetch('/api/dev-login/admin', {\n          credentials: 'include',\n        });\n        if (autoLoginResponse.ok || autoLoginResponse.redirected) {\n          // Re-check auth after auto-login\n          const recheckResponse = await fetch('/api/user', {\n            credentials: 'include',\n          });\n          if (recheckResponse.ok) {\n            const userData = await recheckResponse.json();\n            setUser(userData);\n          }\n        }\n      }\n    } catch (error) {\n      console.error('Auth check failed:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const login = async (username: string, password: string) => {\n    console.log('Login function called with:', username);\n    try {\n      console.log('Making fetch request to /api/login');\n      const response = await fetch('/api/login', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ username, password }),\n        credentials: 'include',\n      });\n\n      console.log('Response status:', response.status);\n      \n      if (response.ok) {\n        const userData = await response.json();\n        console.log('Login successful:', userData);\n        setUser(userData);\n        \n        // Redirect based on user role or ID\n        if (userData.id === 'ADMIN') {\n          setLocation('/');\n        } else {\n          setLocation('/upload');\n        }\n        \n        return true;\n      }\n      \n      const errorData = await response.json();\n      console.log('Login failed with response:', errorData);\n      return false;\n    } catch (error) {\n      console.error('Login failed with exception:', error);\n      return false;\n    }\n  };\n\n  const logout = async () => {\n    try {\n      await fetch('/api/logout', {\n        method: 'POST',\n        credentials: 'include',\n      });\n    } catch (error) {\n      console.error('Logout failed:', error);\n    } finally {\n      setUser(null);\n      setLocation('/login');\n    }\n  };\n\n  return (\n    <AuthContext.Provider value={{ user, login, logout, loading }}>\n      {children}\n    </AuthContext.Provider>\n  );\n}\n\nexport function useAuth() {\n  const context = useContext(AuthContext);\n  if (!context) {\n    throw new Error(\"useAuth must be used within an AuthProvider\");\n  }\n  return context;\n}","path":null,"size_bytes":3474,"size_tokens":null},"client/src/App.tsx":{"content":"import { Switch, Route, Redirect } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport NotFound from \"@/pages/not-found\";\nimport AuditDashboard from \"@/pages/audit-dashboard\";\nimport ReportsPage from \"@/pages/reports\";\nimport ComparePage from \"@/pages/compare\";\nimport LoginPage from \"@/pages/login\";\nimport UploadPage from \"@/pages/upload\";\nimport MisPage from \"@/pages/mis\";\nimport MisDashboardPage from \"@/pages/mis-dashboard\";\nimport CreateReportPage from \"@/pages/create-report\";\nimport AssociatesPage from \"@/pages/associates\";\nimport { AuthProvider, useAuth } from \"@/lib/auth\";\nimport { AuditProvider } from \"@/lib/audit-context\";\n\n// Protected Route Wrapper\nfunction ProtectedRoute({ component: Component }: { component: React.ComponentType }) {\n  const { user } = useAuth();\n  if (!user) return <Redirect to=\"/login\" />;\n  return <Component />;\n}\n\nfunction Router() {\n  return (\n    <Switch>\n      <Route path=\"/login\" component={LoginPage} />\n      \n      {/* Protected Routes */}\n      <Route path=\"/\">\n        <ProtectedRoute component={AuditDashboard} />\n      </Route>\n      <Route path=\"/reports\">\n        <ProtectedRoute component={ReportsPage} />\n      </Route>\n      <Route path=\"/compare\">\n        <ProtectedRoute component={ComparePage} />\n      </Route>\n      <Route path=\"/upload\">\n        <ProtectedRoute component={UploadPage} />\n      </Route>\n      <Route path=\"/mis\">\n        <ProtectedRoute component={MisPage} />\n      </Route>\n      <Route path=\"/mis-dashboard\">\n        <ProtectedRoute component={MisDashboardPage} />\n      </Route>\n      <Route path=\"/create-report\">\n        <ProtectedRoute component={CreateReportPage} />\n      </Route>\n      <Route path=\"/associates\">\n        <ProtectedRoute component={AssociatesPage} />\n      </Route>\n      <Route path=\"/analytics\">\n        <ProtectedRoute component={ReportsPage} />\n      </Route>\n      \n      <Route component={NotFound} />\n    </Switch>\n  );\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <AuthProvider>\n        <AuditProvider>\n          <TooltipProvider>\n            <Toaster />\n            <Router />\n          </TooltipProvider>\n        </AuditProvider>\n      </AuthProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;","path":null,"size_bytes":2453,"size_tokens":null},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","path":null,"size_bytes":1598,"size_tokens":null},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary shadow focus:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-3.5 w-3.5 fill-primary\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","path":null,"size_bytes":1410,"size_tokens":null},"client/src/components/ui/spinner.tsx":{"content":"import { Loader2Icon } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction Spinner({ className, ...props }: React.ComponentProps<\"svg\">) {\n  return (\n    <Loader2Icon\n      role=\"status\"\n      aria-label=\"Loading\"\n      className={cn(\"size-4 animate-spin\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Spinner }\n","path":null,"size_bytes":331,"size_tokens":null},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","path":null,"size_bytes":166,"size_tokens":null},"client/src/components/ui/sidebar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, VariantProps } from \"class-variance-authority\"\nimport { PanelLeftIcon } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  defaultOpen?: boolean\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n}) {\n  const isMobile = useIsMobile()\n  const [openMobile, setOpenMobile] = React.useState(false)\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen)\n  const open = openProp ?? _open\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value\n      if (setOpenProp) {\n        setOpenProp(openState)\n      } else {\n        _setOpen(openState)\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n    },\n    [setOpenProp, open]\n  )\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)\n  }, [isMobile, setOpen, setOpenMobile])\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault()\n        toggleSidebar()\n      }\n    }\n\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [toggleSidebar])\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\"\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n  )\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            \"group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full\",\n            className\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  )\n}\n\nfunction Sidebar({\n  side = \"left\",\n  variant = \"sidebar\",\n  collapsible = \"offcanvas\",\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  side?: \"left\" | \"right\"\n  variant?: \"sidebar\" | \"floating\" | \"inset\"\n  collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          \"bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    )\n  }\n\n  return (\n    <div\n      className=\"group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          \"relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]\"\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<\"button\">) {\n  const { toggleSidebar } = useSidebar()\n\n  // Note: Tailwind v3.4 doesn't support \"in-\" selectors. So the rail won't work perfectly.\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex\",\n        \"in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<\"main\">) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        \"bg-background relative flex w-full flex-1 flex-col\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn(\"bg-background h-8 w-full shadow-none\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn(\"bg-sidebar-border mx-2 w-auto\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn(\"w-full text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn(\"group/menu-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:p-0!\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = \"default\",\n  size = \"default\",\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  isActive?: boolean\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : \"button\"\n  const { isMobile, state } = useSidebar()\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  )\n\n  if (!tooltip) {\n    return button\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    }\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== \"collapsed\" || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  )\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  showOnHover?: boolean\n}) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  showIcon?: boolean\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[var(--skeleton-width)] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn(\"group/menu-sub-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = \"md\",\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<\"a\"> & {\n  asChild?: boolean\n  size?: \"sm\" | \"md\"\n  isActive?: boolean\n}) {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline outline-2 outline-transparent outline-offset-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","path":null,"size_bytes":21846,"size_tokens":null},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","path":null,"size_bytes":756,"size_tokens":null},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","path":null,"size_bytes":565,"size_tokens":null},"client/src/components/ui/input-group.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Textarea } from \"@/components/ui/textarea\"\n\nfunction InputGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"input-group\"\n      role=\"group\"\n      className={cn(\n        \"group/input-group border-input dark:bg-input/30 shadow-xs relative flex w-full items-center rounded-md border outline-none transition-[color,box-shadow]\",\n        \"h-9 has-[>textarea]:h-auto\",\n\n        // Variants based on alignment.\n        \"has-[>[data-align=inline-start]]:[&>input]:pl-2\",\n        \"has-[>[data-align=inline-end]]:[&>input]:pr-2\",\n        \"has-[>[data-align=block-start]]:h-auto has-[>[data-align=block-start]]:flex-col has-[>[data-align=block-start]]:[&>input]:pb-3\",\n        \"has-[>[data-align=block-end]]:h-auto has-[>[data-align=block-end]]:flex-col has-[>[data-align=block-end]]:[&>input]:pt-3\",\n\n        // Focus state.\n        \"has-[[data-slot=input-group-control]:focus-visible]:ring-ring has-[[data-slot=input-group-control]:focus-visible]:ring-1\",\n\n        // Error state.\n        \"has-[[data-slot][aria-invalid=true]]:ring-destructive/20 has-[[data-slot][aria-invalid=true]]:border-destructive dark:has-[[data-slot][aria-invalid=true]]:ring-destructive/40\",\n\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nconst inputGroupAddonVariants = cva(\n  \"text-muted-foreground flex h-auto cursor-text select-none items-center justify-center gap-2 py-1.5 text-sm font-medium group-data-[disabled=true]/input-group:opacity-50 [&>kbd]:rounded-[calc(var(--radius)-5px)] [&>svg:not([class*='size-'])]:size-4\",\n  {\n    variants: {\n      align: {\n        \"inline-start\":\n          \"order-first pl-3 has-[>button]:ml-[-0.45rem] has-[>kbd]:ml-[-0.35rem]\",\n        \"inline-end\":\n          \"order-last pr-3 has-[>button]:mr-[-0.4rem] has-[>kbd]:mr-[-0.35rem]\",\n        \"block-start\":\n          \"[.border-b]:pb-3 order-first w-full justify-start px-3 pt-3 group-has-[>input]/input-group:pt-2.5\",\n        \"block-end\":\n          \"[.border-t]:pt-3 order-last w-full justify-start px-3 pb-3 group-has-[>input]/input-group:pb-2.5\",\n      },\n    },\n    defaultVariants: {\n      align: \"inline-start\",\n    },\n  }\n)\n\nfunction InputGroupAddon({\n  className,\n  align = \"inline-start\",\n  ...props\n}: React.ComponentProps<\"div\"> & VariantProps<typeof inputGroupAddonVariants>) {\n  return (\n    <div\n      role=\"group\"\n      data-slot=\"input-group-addon\"\n      data-align={align}\n      className={cn(inputGroupAddonVariants({ align }), className)}\n      onClick={(e) => {\n        if ((e.target as HTMLElement).closest(\"button\")) {\n          return\n        }\n        e.currentTarget.parentElement?.querySelector(\"input\")?.focus()\n      }}\n      {...props}\n    />\n  )\n}\n\nconst inputGroupButtonVariants = cva(\n  \"flex items-center gap-2 text-sm shadow-none\",\n  {\n    variants: {\n      size: {\n        xs: \"h-6 gap-1 rounded-[calc(var(--radius)-5px)] px-2 has-[>svg]:px-2 [&>svg:not([class*='size-'])]:size-3.5\",\n        sm: \"h-8 gap-1.5 rounded-md px-2.5 has-[>svg]:px-2.5\",\n        \"icon-xs\":\n          \"size-6 rounded-[calc(var(--radius)-5px)] p-0 has-[>svg]:p-0\",\n        \"icon-sm\": \"size-8 p-0 has-[>svg]:p-0\",\n      },\n    },\n    defaultVariants: {\n      size: \"xs\",\n    },\n  }\n)\n\nfunction InputGroupButton({\n  className,\n  type = \"button\",\n  variant = \"ghost\",\n  size = \"xs\",\n  ...props\n}: Omit<React.ComponentProps<typeof Button>, \"size\"> &\n  VariantProps<typeof inputGroupButtonVariants>) {\n  return (\n    <Button\n      type={type}\n      data-size={size}\n      variant={variant}\n      className={cn(inputGroupButtonVariants({ size }), className)}\n      {...props}\n    />\n  )\n}\n\nfunction InputGroupText({ className, ...props }: React.ComponentProps<\"span\">) {\n  return (\n    <span\n      className={cn(\n        \"text-muted-foreground flex items-center gap-2 text-sm [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction InputGroupInput({\n  className,\n  ...props\n}: React.ComponentProps<\"input\">) {\n  return (\n    <Input\n      data-slot=\"input-group-control\"\n      className={cn(\n        \"flex-1 rounded-none border-0 bg-transparent shadow-none focus-visible:ring-0 dark:bg-transparent\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction InputGroupTextarea({\n  className,\n  ...props\n}: React.ComponentProps<\"textarea\">) {\n  return (\n    <Textarea\n      data-slot=\"input-group-control\"\n      className={cn(\n        \"flex-1 resize-none rounded-none border-0 bg-transparent py-3 shadow-none focus-visible:ring-0 dark:bg-transparent\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  InputGroup,\n  InputGroupAddon,\n  InputGroupButton,\n  InputGroupText,\n  InputGroupInput,\n  InputGroupTextarea,\n}\n","path":null,"size_bytes":4971,"size_tokens":null},"server/gmail.ts":{"content":"import { google } from 'googleapis';\n\nexport interface TriggerEmailInfo {\n  triggerDate: Date;\n  messageId: string;\n  subject: string;\n  from: string;\n}\n\nexport function formatInitiationTime(date: Date): string {\n  const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];\n  const month = months[date.getMonth()];\n  const day = date.getDate();\n  const year = date.getFullYear();\n  let hours = date.getHours();\n  const minutes = date.getMinutes().toString().padStart(2, '0');\n  const ampm = hours >= 12 ? 'PM' : 'AM';\n  hours = hours % 12;\n  hours = hours ? hours : 12;\n  return `${month} ${day}, ${year} ${hours}:${minutes} ${ampm}`;\n}\n\n// Gmail OAuth integration - connection:conn_google-mail_01KC3JM0FBYWW3J07BWC0CE8W6\nlet connectionSettings: any = null;\n\nasync function getAccessToken() {\n  // Always fetch fresh credentials - don't rely on cache for OAuth tokens\n  connectionSettings = null;\n  \n  const hostname = process.env.REPLIT_CONNECTORS_HOSTNAME;\n  const xReplitToken = process.env.REPL_IDENTITY \n    ? 'repl ' + process.env.REPL_IDENTITY \n    : process.env.WEB_REPL_RENEWAL \n    ? 'depl ' + process.env.WEB_REPL_RENEWAL \n    : null;\n\n  if (!xReplitToken) {\n    throw new Error('X_REPLIT_TOKEN not found for repl/depl');\n  }\n\n  connectionSettings = await fetch(\n    'https://' + hostname + '/api/v2/connection?include_secrets=true&connector_names=google-mail',\n    {\n      headers: {\n        'Accept': 'application/json',\n        'X_REPLIT_TOKEN': xReplitToken\n      }\n    }\n  ).then(res => res.json()).then(data => data.items?.[0]);\n\n  const accessToken = connectionSettings?.settings?.access_token || connectionSettings?.settings?.oauth?.credentials?.access_token;\n\n  if (!connectionSettings || !accessToken) {\n    throw new Error('Gmail not connected');\n  }\n  return accessToken;\n}\n\nasync function getGmailClient() {\n  const accessToken = await getAccessToken();\n\n  const oauth2Client = new google.auth.OAuth2();\n  oauth2Client.setCredentials({\n    access_token: accessToken\n  });\n\n  return google.gmail({ version: 'v1', auth: oauth2Client });\n}\n\nexport async function sendTestEmail(to: string, from: string): Promise<{ success: boolean; message: string }> {\n  try {\n    console.log(`Sending test email from ${from} to ${to}`);\n    const gmail = await getGmailClient();\n    \n    const emailContent = [\n      `To: ${to}`,\n      `From: ${from}`,\n      `Subject: AuditGuard Gmail Test`,\n      '',\n      'This is a test email from AuditGuard to verify Gmail connectivity.',\n      '',\n      `Sent at: ${new Date().toISOString()}`\n    ].join('\\r\\n');\n    \n    const encodedEmail = Buffer.from(emailContent).toString('base64').replace(/\\+/g, '-').replace(/\\//g, '_').replace(/=+$/, '');\n    \n    await gmail.users.messages.send({\n      userId: 'me',\n      requestBody: {\n        raw: encodedEmail\n      }\n    });\n    \n    console.log('Test email sent successfully');\n    return { success: true, message: 'Test email sent successfully' };\n  } catch (error: any) {\n    console.error('Error sending test email:', error.message);\n    return { success: false, message: error.message };\n  }\n}\n\nexport async function searchTriggerEmail(leadId: string): Promise<TriggerEmailInfo | null> {\n  try {\n    console.log(`Searching Gmail for Lead ID: ${leadId}`);\n    console.log('Note: Gmail OAuth only has send permissions. Reading emails requires gmail.readonly scope which is not available.');\n    \n    const gmail = await getGmailClient();\n    \n    // Search for emails containing the lead ID\n    const query = `${leadId}`;\n    console.log(`Gmail search query: ${query}`);\n    \n    const response = await gmail.users.messages.list({\n      userId: 'me',\n      q: query,\n      maxResults: 10\n    });\n\n    const messages = response.data.messages;\n    \n    if (!messages || messages.length === 0) {\n      console.log(`No emails found for Lead ID: ${leadId}`);\n      return null;\n    }\n\n    console.log(`Found ${messages.length} emails containing ${leadId}`);\n\n    let mostRecentEmail: TriggerEmailInfo | null = null;\n    let mostRecentDate: Date | null = null;\n\n    // Process each message to find the most recent one\n    for (const message of messages) {\n      if (!message.id) continue;\n      \n      try {\n        const msgDetails = await gmail.users.messages.get({\n          userId: 'me',\n          id: message.id,\n          format: 'metadata',\n          metadataHeaders: ['Date', 'Subject', 'From']\n        });\n\n        const headers = msgDetails.data.payload?.headers || [];\n        const dateHeader = headers.find(h => h.name === 'Date')?.value;\n        const subjectHeader = headers.find(h => h.name === 'Subject')?.value || '';\n        const fromHeader = headers.find(h => h.name === 'From')?.value || '';\n\n        if (dateHeader) {\n          const emailDate = new Date(dateHeader);\n          \n          if (!mostRecentDate || emailDate > mostRecentDate) {\n            mostRecentDate = emailDate;\n            mostRecentEmail = {\n              triggerDate: emailDate,\n              messageId: message.id,\n              subject: subjectHeader,\n              from: fromHeader\n            };\n          }\n        }\n      } catch (msgErr) {\n        console.error(`Error fetching message ${message.id}:`, msgErr);\n      }\n    }\n\n    if (mostRecentEmail) {\n      console.log(`Found initiation email for ${leadId}: \"${mostRecentEmail.subject}\" from ${mostRecentEmail.triggerDate.toISOString()}`);\n    }\n\n    return mostRecentEmail;\n  } catch (error: any) {\n    console.error('Gmail API Error:', error.message || error);\n    return null;\n  }\n}\n\nexport interface WorkAllocationEntry {\n  product: string | null;\n  businessName: string | null;\n  entityType: string | null;\n  customerName: string;\n  leadId: string;\n  branch: string | null;\n  initiationDate: string | null;\n  mobileNumber: string | null;\n  address: string | null;\n  initiatedPerson: string | null;\n}\n\nexport interface EmailImportResult {\n  success: boolean;\n  message: string;\n  entries: WorkAllocationEntry[];\n  emailCount: number;\n}\n\nfunction parseWorkAllocationTable(htmlContent: string): WorkAllocationEntry[] {\n  const entries: WorkAllocationEntry[] = [];\n  \n  // Look for table rows containing work allocation data\n  // Piramal email format: Product | Business Name | Entity Type | Name of Applicant | Lead ID | Branch | Initiation Date | Mobile Number | Address\n  \n  // Try to find table data by looking for common patterns\n  const tableRowPattern = /<tr[^>]*>([\\s\\S]*?)<\\/tr>/gi;\n  const cellPattern = /<td[^>]*>([\\s\\S]*?)<\\/td>/gi;\n  \n  let rowMatch;\n  while ((rowMatch = tableRowPattern.exec(htmlContent)) !== null) {\n    const rowContent = rowMatch[1];\n    const cells: string[] = [];\n    let cellMatch;\n    \n    while ((cellMatch = cellPattern.exec(rowContent)) !== null) {\n      // Strip HTML tags and get text content\n      const cellText = cellMatch[1]\n        .replace(/<[^>]+>/g, ' ')\n        .replace(/&nbsp;/g, ' ')\n        .replace(/&amp;/g, '&')\n        .replace(/\\s+/g, ' ')\n        .trim();\n      cells.push(cellText);\n    }\n    \n    // Need at least 5 cells to be a valid row (Product, Business Name, Entity Type, Applicant Name, Lead ID)\n    if (cells.length >= 5) {\n      // Skip header rows\n      const firstCell = cells[0].toLowerCase();\n      if (firstCell.includes('product') || firstCell.includes('s.no') || firstCell.includes('sr.no')) {\n        continue;\n      }\n      \n      // Check if this looks like a data row (has a valid Lead ID pattern)\n      const leadIdIndex = cells.findIndex(c => /^[A-Z]{2,}[A-Z0-9_-]+$/i.test(c.trim()));\n      \n      if (leadIdIndex >= 0 || cells.length >= 5) {\n        // Standard format: Product | Business Name | Entity Type | Name of Applicant | Lead ID | Branch | Initiation Date | Mobile Number | Address\n        const entry: WorkAllocationEntry = {\n          product: cells[0] || null,\n          businessName: cells[1] || null,\n          entityType: cells[2] || null,\n          customerName: cells[3] || '',\n          leadId: cells[4] || '',\n          branch: cells[5] || null,\n          initiationDate: cells[6] || null,\n          mobileNumber: cells[7] ? cells[7].replace(/^(ph:|phone:|tel:|mob:|mobile:)/i, '').trim() : null,\n          address: cells[8] || null,\n          initiatedPerson: null, // Will be populated from email sender\n        };\n        \n        // Only add if we have a valid lead ID and customer name\n        if (entry.leadId && entry.customerName) {\n          entries.push(entry);\n        }\n      }\n    }\n  }\n  \n  // Also try plain text parsing for non-HTML or poorly formatted HTML\n  if (entries.length === 0) {\n    const lines = htmlContent.split(/\\r?\\n/);\n    for (const line of lines) {\n      // Try tab or pipe separated\n      let parts = line.includes('\\t') ? line.split('\\t') : line.split('|');\n      parts = parts.map(p => p.replace(/<[^>]+>/g, '').replace(/&nbsp;/g, ' ').trim());\n      \n      if (parts.length >= 5) {\n        const firstPart = parts[0].toLowerCase();\n        if (firstPart.includes('product') || firstPart.includes('s.no') || firstPart.includes('sr.no')) {\n          continue;\n        }\n        \n        const entry: WorkAllocationEntry = {\n          product: parts[0] || null,\n          businessName: parts[1] || null,\n          entityType: parts[2] || null,\n          customerName: parts[3] || '',\n          leadId: parts[4] || '',\n          branch: parts[5] || null,\n          initiationDate: parts[6] || null,\n          mobileNumber: parts[7] ? parts[7].replace(/^(ph:|phone:|tel:|mob:|mobile:)/i, '').trim() : null,\n          address: parts[8] || null,\n          initiatedPerson: null, // Will be populated from email sender\n        };\n        \n        if (entry.leadId && entry.customerName) {\n          entries.push(entry);\n        }\n      }\n    }\n  }\n  \n  return entries;\n}\n\nfunction extractBodyFromParts(parts: any[], preferHtml: boolean = true): string {\n  let htmlContent = '';\n  let plainContent = '';\n  \n  for (const part of parts) {\n    const mimeType = part.mimeType || '';\n    \n    if (mimeType === 'text/html' && part.body?.data) {\n      htmlContent = Buffer.from(part.body.data, 'base64').toString('utf-8');\n    } else if (mimeType === 'text/plain' && part.body?.data) {\n      plainContent = Buffer.from(part.body.data, 'base64').toString('utf-8');\n    } else if (mimeType.startsWith('multipart/') && part.parts) {\n      const nestedContent = extractBodyFromParts(part.parts, preferHtml);\n      if (nestedContent) {\n        if (mimeType === 'multipart/alternative') {\n          if (!htmlContent) htmlContent = nestedContent;\n        } else {\n          if (!htmlContent && !plainContent) {\n            htmlContent = nestedContent;\n          }\n        }\n      }\n    }\n  }\n  \n  return preferHtml ? (htmlContent || plainContent) : (plainContent || htmlContent);\n}\n\nexport async function importWorkAllocationEmails(daysBack: number = 7): Promise<EmailImportResult> {\n  try {\n    console.log(`Importing work allocation emails from last ${daysBack} days`);\n    const gmail = await getGmailClient();\n    \n    // Calculate date filter\n    const afterDate = new Date();\n    afterDate.setDate(afterDate.getDate() - daysBack);\n    const afterDateStr = afterDate.toISOString().split('T')[0].replace(/-/g, '/');\n    \n    // Search for Piramal work allocation emails\n    // Common patterns: subject contains \"allocation\" or \"assigned\" or from piramal domain\n    const query = `after:${afterDateStr} (subject:allocation OR subject:assigned OR subject:\"work order\" OR from:piramal)`;\n    console.log(`Gmail search query: ${query}`);\n    \n    const response = await gmail.users.messages.list({\n      userId: 'me',\n      q: query,\n      maxResults: 50\n    });\n\n    const messages = response.data.messages;\n    \n    if (!messages || messages.length === 0) {\n      console.log('No work allocation emails found');\n      return {\n        success: true,\n        message: 'No work allocation emails found in the last ' + daysBack + ' days',\n        entries: [],\n        emailCount: 0\n      };\n    }\n\n    console.log(`Found ${messages.length} potential work allocation emails`);\n    const allEntries: WorkAllocationEntry[] = [];\n\n    for (const message of messages) {\n      if (!message.id) continue;\n      \n      try {\n        const msgDetails = await gmail.users.messages.get({\n          userId: 'me',\n          id: message.id,\n          format: 'full'\n        });\n\n        // Extract sender from headers\n        const headers = msgDetails.data.payload?.headers || [];\n        const fromHeader = headers.find(h => h.name?.toLowerCase() === 'from')?.value || '';\n        // Parse sender name from \"Name <email>\" or just \"email\" format\n        let senderName: string | null = null;\n        const nameMatch = fromHeader.match(/^([^<]+)\\s*<.+>$/);\n        if (nameMatch) {\n          senderName = nameMatch[1].trim().replace(/\"/g, '');\n        } else if (fromHeader.includes('@')) {\n          senderName = fromHeader.split('@')[0].replace(/[._-]/g, ' ');\n        }\n\n        // Extract body content - handle nested multipart messages\n        let bodyContent = '';\n        const payload = msgDetails.data.payload;\n        \n        if (payload?.body?.data) {\n          bodyContent = Buffer.from(payload.body.data, 'base64').toString('utf-8');\n        } else if (payload?.parts) {\n          bodyContent = extractBodyFromParts(payload.parts, true);\n        }\n\n        if (bodyContent) {\n          const entries = parseWorkAllocationTable(bodyContent);\n          if (entries.length > 0) {\n            // Populate initiatedPerson from email sender\n            entries.forEach(entry => {\n              entry.initiatedPerson = senderName;\n            });\n            console.log(`Parsed ${entries.length} entries from email ${message.id} (from: ${senderName})`);\n            allEntries.push(...entries);\n          }\n        }\n      } catch (msgErr: any) {\n        console.error(`Error processing email ${message.id}:`, msgErr.message);\n      }\n    }\n\n    // Deduplicate by Lead ID\n    const uniqueEntries = allEntries.reduce((acc, entry) => {\n      if (!acc.find(e => e.leadId === entry.leadId)) {\n        acc.push(entry);\n      }\n      return acc;\n    }, [] as WorkAllocationEntry[]);\n\n    console.log(`Total unique entries extracted: ${uniqueEntries.length}`);\n\n    return {\n      success: true,\n      message: `Found ${uniqueEntries.length} unique work allocations from ${messages.length} emails`,\n      entries: uniqueEntries,\n      emailCount: messages.length\n    };\n  } catch (error: any) {\n    console.error('Error importing work allocation emails:', error.message);\n    return {\n      success: false,\n      message: 'Failed to import emails: ' + error.message,\n      entries: [],\n      emailCount: 0\n    };\n  }\n}\n\nexport function calculateTATMetrics(\n  initiationTime: Date | null,\n  visitTime: Date | null,\n  reportDate: Date | null\n): {\n  initiationToVisitHours: number | null;\n  visitToReportHours: number | null;\n  totalTATHours: number | null;\n} {\n  let initiationToVisitHours: number | null = null;\n  let visitToReportHours: number | null = null;\n  let totalTATHours: number | null = null;\n\n  if (initiationTime && visitTime) {\n    const diffMs = visitTime.getTime() - initiationTime.getTime();\n    initiationToVisitHours = Math.round(diffMs / (1000 * 60 * 60) * 10) / 10;\n  }\n\n  if (visitTime && reportDate) {\n    const diffMs = reportDate.getTime() - visitTime.getTime();\n    visitToReportHours = Math.round(diffMs / (1000 * 60 * 60) * 10) / 10;\n  }\n\n  if (initiationTime && reportDate) {\n    const diffMs = reportDate.getTime() - initiationTime.getTime();\n    totalTATHours = Math.round(diffMs / (1000 * 60 * 60) * 10) / 10;\n  }\n\n  return {\n    initiationToVisitHours: initiationToVisitHours !== null ? Math.max(0, initiationToVisitHours) : null,\n    visitToReportHours: visitToReportHours !== null ? Math.max(0, visitToReportHours) : null,\n    totalTATHours: totalTATHours !== null ? Math.max(0, totalTATHours) : null\n  };\n}\n","path":null,"size_bytes":15940,"size_tokens":null},"server/sheets.ts":{"content":"import { google } from 'googleapis';\n\n// Google Sheets integration - connection:conn_google-sheet_01KC99521K0ZQ5ZE0XSZQAQ94N\nlet connectionSettings: any;\n\nasync function getAccessToken() {\n  if (connectionSettings && connectionSettings.settings.expires_at && new Date(connectionSettings.settings.expires_at).getTime() > Date.now()) {\n    return connectionSettings.settings.access_token;\n  }\n  \n  const hostname = process.env.REPLIT_CONNECTORS_HOSTNAME;\n  const xReplitToken = process.env.REPL_IDENTITY \n    ? 'repl ' + process.env.REPL_IDENTITY \n    : process.env.WEB_REPL_RENEWAL \n    ? 'depl ' + process.env.WEB_REPL_RENEWAL \n    : null;\n\n  if (!xReplitToken) {\n    throw new Error('X_REPLIT_TOKEN not found for repl/depl');\n  }\n\n  connectionSettings = await fetch(\n    'https://' + hostname + '/api/v2/connection?include_secrets=true&connector_names=google-sheet',\n    {\n      headers: {\n        'Accept': 'application/json',\n        'X_REPLIT_TOKEN': xReplitToken\n      }\n    }\n  ).then(res => res.json()).then(data => data.items?.[0]);\n\n  const accessToken = connectionSettings?.settings?.access_token || connectionSettings?.settings?.oauth?.credentials?.access_token;\n\n  if (!connectionSettings || !accessToken) {\n    throw new Error('Google Sheet not connected');\n  }\n  return accessToken;\n}\n\nasync function getSheetsClient() {\n  const accessToken = await getAccessToken();\n\n  const oauth2Client = new google.auth.OAuth2();\n  oauth2Client.setCredentials({\n    access_token: accessToken\n  });\n\n  return google.sheets({ version: 'v4', auth: oauth2Client });\n}\n\nexport interface InitiationDateResult {\n  initiationDate: Date | null;\n  found: boolean;\n  rowData?: any;\n}\n\n// MIS Spreadsheet configuration\nconst MIS_SPREADSHEET_ID = '1VWJsiKp0GgYHgv9JnRI-rW1eV9UkNP4O';\nconst MIS_SHEET_GID = 2067088679; // Sheet ID from URL\n\nexport async function searchLeadIdInMIS(leadId: string): Promise<InitiationDateResult> {\n  try {\n    console.log(`Searching for Lead ID ${leadId} in MIS spreadsheet...`);\n    \n    const sheets = await getSheetsClient();\n    \n    // First, get spreadsheet metadata to find sheet names\n    const spreadsheet = await sheets.spreadsheets.get({\n      spreadsheetId: MIS_SPREADSHEET_ID,\n    });\n    \n    // Find the sheet with matching GID, or use the first sheet\n    let sheetName = 'Sheet1';\n    const sheetsInfo = spreadsheet.data.sheets || [];\n    console.log(`Found ${sheetsInfo.length} sheets`);\n    \n    for (const sheet of sheetsInfo) {\n      const sheetId = sheet.properties?.sheetId;\n      const title = sheet.properties?.title;\n      console.log(`Sheet: ${title}, ID: ${sheetId}`);\n      \n      if (sheetId === MIS_SHEET_GID) {\n        sheetName = title || 'Sheet1';\n        console.log(`Using sheet: ${sheetName} (matched GID ${MIS_SHEET_GID})`);\n        break;\n      }\n    }\n    \n    // If no match found, use first sheet\n    if (sheetsInfo.length > 0 && !sheetsInfo.find(s => s.properties?.sheetId === MIS_SHEET_GID)) {\n      sheetName = sheetsInfo[0].properties?.title || 'Sheet1';\n      console.log(`GID not found, using first sheet: ${sheetName}`);\n    }\n    \n    // Get all data from the sheet\n    const response = await sheets.spreadsheets.values.get({\n      spreadsheetId: MIS_SPREADSHEET_ID,\n      range: `${sheetName}`,\n    });\n    \n    const rows = response.data.values;\n    \n    if (!rows || rows.length === 0) {\n      console.log('No data found in spreadsheet');\n      return { initiationDate: null, found: false };\n    }\n    \n    // Find header row to identify Lead ID and Date columns\n    const headerRow = rows[0];\n    console.log(`Headers: ${headerRow.join(', ')}`);\n    \n    // Find Lead ID column (look for variations)\n    let leadIdColIndex = -1;\n    let dateColIndex = -1;\n    let inDateColIndex = -1;\n    \n    for (let i = 0; i < headerRow.length; i++) {\n      const header = String(headerRow[i] || '').toLowerCase().trim();\n      \n      // Check for Lead ID column\n      if (header.includes('lead') && header.includes('id') || \n          header === 'leadid' || \n          header === 'lead_id' ||\n          header === 'lead id') {\n        leadIdColIndex = i;\n      }\n      \n      // Priority: Look specifically for \"In Date\" column first\n      if (header === 'in date' || header === 'indate' || header === 'in_date') {\n        inDateColIndex = i;\n        console.log(`Found \"In Date\" column at index ${i}`);\n      }\n      \n      // Check for Date column (initiation date, date, created date, etc.) as fallback\n      if (header.includes('date') || \n          header.includes('initiation') ||\n          header.includes('created') ||\n          header.includes('assigned')) {\n        if (dateColIndex === -1) { // Take the first date-like column\n          dateColIndex = i;\n        }\n      }\n    }\n    \n    // Use \"In Date\" column if found, otherwise fall back to generic date column\n    if (inDateColIndex !== -1) {\n      dateColIndex = inDateColIndex;\n      console.log(`Using \"In Date\" column (index ${inDateColIndex}) for initiation time`);\n    }\n    \n    console.log(`Lead ID column index: ${leadIdColIndex}, Date column index: ${dateColIndex}`);\n    \n    if (leadIdColIndex === -1) {\n      console.log('Could not find Lead ID column in spreadsheet');\n      return { initiationDate: null, found: false };\n    }\n    \n    // Search for the Lead ID in the data rows\n    for (let i = 1; i < rows.length; i++) {\n      const row = rows[i];\n      const cellValue = String(row[leadIdColIndex] || '').trim();\n      \n      if (cellValue.toUpperCase() === leadId.toUpperCase()) {\n        console.log(`Found Lead ID ${leadId} in row ${i + 1}`);\n        \n        // Get the date from the date column\n        if (dateColIndex !== -1 && row[dateColIndex]) {\n          const dateValue = row[dateColIndex];\n          console.log(`Date value found: ${dateValue}`);\n          \n          // Parse the date\n          const parsedDate = parseFlexibleDate(dateValue);\n          \n          if (parsedDate) {\n            return { \n              initiationDate: parsedDate, \n              found: true,\n              rowData: row \n            };\n          }\n        }\n        \n        return { initiationDate: null, found: true, rowData: row };\n      }\n    }\n    \n    console.log(`Lead ID ${leadId} not found in spreadsheet`);\n    return { initiationDate: null, found: false };\n    \n  } catch (error: any) {\n    console.error('Error searching MIS spreadsheet:', error.message);\n    return { initiationDate: null, found: false };\n  }\n}\n\nexport function parseFlexibleDate(dateValue: string): Date | null {\n  try {\n    // Handle various date formats\n    const value = String(dateValue).trim();\n    \n    // DD/MM/YYYY or DD-MM-YYYY\n    const ddmmyyyy = value.match(/^(\\d{1,2})[\\/\\-](\\d{1,2})[\\/\\-](\\d{4})$/);\n    if (ddmmyyyy) {\n      const [, day, month, year] = ddmmyyyy;\n      return new Date(parseInt(year), parseInt(month) - 1, parseInt(day));\n    }\n    \n    // YYYY-MM-DD\n    const yyyymmdd = value.match(/^(\\d{4})[\\/\\-](\\d{1,2})[\\/\\-](\\d{1,2})$/);\n    if (yyyymmdd) {\n      const [, year, month, day] = yyyymmdd;\n      return new Date(parseInt(year), parseInt(month) - 1, parseInt(day));\n    }\n    \n    // DD MMM YYYY (e.g., 12 Nov 2025)\n    const ddmmmyyyy = value.match(/^(\\d{1,2})\\s+(\\w{3})\\s+(\\d{4})$/i);\n    if (ddmmmyyyy) {\n      const [, day, monthStr, year] = ddmmmyyyy;\n      const months: { [key: string]: number } = {\n        jan: 0, feb: 1, mar: 2, apr: 3, may: 4, jun: 5,\n        jul: 6, aug: 7, sep: 8, oct: 9, nov: 10, dec: 11\n      };\n      const month = months[monthStr.toLowerCase()];\n      if (month !== undefined) {\n        return new Date(parseInt(year), month, parseInt(day));\n      }\n    }\n    \n    // Try standard Date parsing as fallback\n    const parsed = new Date(value);\n    if (!isNaN(parsed.getTime())) {\n      return parsed;\n    }\n    \n    return null;\n  } catch {\n    return null;\n  }\n}\n","path":null,"size_bytes":7852,"size_tokens":null},"client/src/pages/mis.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport AuditLayout from \"@/components/layout/audit-layout\";\nimport { useAuth } from \"@/lib/auth\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Plus, Upload, Trash2, Edit, ClipboardPaste, ExternalLink, Inbox } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ntype MisEntry = {\n  id: number;\n  associateId: string;\n  sno: number;\n  leadId: string;\n  customerName: string;\n  businessName: string | null;\n  contactDetails: string | null;\n  customerAddress: string | null;\n  inDate: string | null;\n  outDate: string | null;\n  initiatedPerson: string | null;\n  product: string | null;\n  pdPerson: string | null;\n  pdTyping: string | null;\n  pdPersonId: string | null;\n  pdTypingId: string | null;\n  location: string | null;\n  status: string | null;\n  workflowStatus: string | null;\n  assignedAt: string | null;\n  createdAt: string;\n};\n\ntype Associate = {\n  id: string;\n  name: string;\n  username: string;\n  isAdmin: boolean;\n};\n\nexport default function MisPage() {\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [pasteDialogOpen, setPasteDialogOpen] = useState(false);\n  const [pasteContent, setPasteContent] = useState(\"\");\n  const [editDialogOpen, setEditDialogOpen] = useState(false);\n  const [editEntry, setEditEntry] = useState<MisEntry | null>(null);\n\n  // Fetch centralized MIS (all entries from all associates)\n  const { data: misEntries = [], isLoading } = useQuery<MisEntry[]>({\n    queryKey: [\"/api/mis\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/mis\");\n      if (!res.ok) throw new Error(\"Failed to fetch MIS entries\");\n      return res.json();\n    },\n  });\n\n  // Fetch associates to show contributor names and populate dropdowns\n  const { data: associates = [] } = useQuery<Associate[]>({\n    queryKey: [\"/api/associates\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/associates\");\n      if (!res.ok) return [];\n      return res.json();\n    },\n  });\n\n  const getAssociateName = (associateId: string | null) => {\n    if (!associateId) return \"-\";\n    const associate = associates.find(a => a.id === associateId);\n    return associate?.name || associateId;\n  };\n\n  const createBulkMutation = useMutation({\n    mutationFn: async (entries: any[]) => {\n      const res = await fetch(\"/api/mis/bulk\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ associateId: user?.id, entries }),\n      });\n      if (!res.ok) throw new Error(\"Failed to create entries\");\n      return res.json();\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/mis\"] });\n      const added = data.entries?.length || 0;\n      const skipped = data.skipped || 0;\n      if (skipped > 0) {\n        toast({ title: \"Success\", description: `${added} entries added. ${skipped} duplicate Lead ID(s) skipped.` });\n      } else {\n        toast({ title: \"Success\", description: `${added} MIS entries added successfully` });\n      }\n      setPasteDialogOpen(false);\n      setPasteContent(\"\");\n    },\n    onError: (error: any) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async ({ id, updates }: { id: number; updates: any }) => {\n      const res = await fetch(`/api/mis/${id}`, {\n        method: \"PATCH\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(updates),\n      });\n      if (!res.ok) throw new Error(\"Failed to update entry\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/mis\"] });\n      toast({ title: \"Success\", description: \"MIS entry updated\" });\n      setEditDialogOpen(false);\n      setEditEntry(null);\n    },\n    onError: (error: any) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: number) => {\n      const res = await fetch(`/api/mis/${id}`, { method: \"DELETE\" });\n      if (!res.ok) throw new Error(\"Failed to delete entry\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/mis\"] });\n      toast({ title: \"Success\", description: \"MIS entry deleted\" });\n    },\n    onError: (error: any) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const parsePastedContent = (content: string) => {\n    const lines = content.trim().split(\"\\n\");\n    const entries: any[] = [];\n\n    // Extract initiated person from email header pattern like \"to me, enakollu.ashok\" or \"to enakollu.ashok, me\"\n    let initiatedPerson: string | null = null;\n    // Extract work nature from patterns like 'A new \"LIP\"' or 'A new \"Home Loan\"'\n    let workNature: string | null = null;\n    \n    for (const line of lines) {\n      const lowerLine = line.toLowerCase().trim();\n      \n      // Match patterns: \"to me, username\" or \"to username, me\" or \"to username\"\n      const toMatch = lowerLine.match(/^to\\s+(.+)$/);\n      if (toMatch && !initiatedPerson) {\n        const recipients = toMatch[1].split(\",\").map(r => r.trim());\n        // Find the recipient that's not \"me\"\n        for (const recipient of recipients) {\n          if (recipient !== \"me\" && recipient.length > 0) {\n            initiatedPerson = recipient;\n            break;\n          }\n        }\n      }\n      \n      // Match patterns: 'A new LIP' or 'A new \"LIP\"' or 'new AIP' or 'new PD'\n      const workNatureMatch = line.match(/[Aa]\\s*new\\s+[\"']?([A-Z]{2,4})[\"']?\\s/i);\n      if (workNatureMatch && !workNature) {\n        workNature = workNatureMatch[1].trim().toUpperCase();\n      }\n    }\n\n    for (const line of lines) {\n      const parts = line.split(\"\\t\");\n      if (parts.length < 5) continue;\n\n      // Email format: Product | Business Name | Entity Type | Name of Applicant | Lead ID | Branch | Initiation Date/Time | Mobile Number | Address\n      const [product, businessName, entityType, applicantName, leadId, branch, initiationDateTime, mobileNumber, address] = parts;\n\n      // Skip header row\n      if (product?.toLowerCase() === \"product\" || leadId?.toLowerCase() === \"lead id\" || \n          applicantName?.toLowerCase().includes(\"name of applicant\")) {\n        continue;\n      }\n\n      if (!leadId || !applicantName) continue;\n\n      // Clean up phone number\n      const cleanPhone = mobileNumber?.trim().replace(/^(ph:|phone:|tel:|mob:|mobile:)/i, \"\").trim() || null;\n\n      entries.push({\n        leadId: leadId?.trim() || \"\",\n        customerName: applicantName?.trim() || \"\",  // Applicant Name\n        businessName: businessName?.trim() || null,\n        contactDetails: cleanPhone,  // Phone Number\n        customerAddress: address?.trim() || null,\n        inDate: initiationDateTime?.trim() || null,\n        outDate: null,\n        initiatedPerson: initiatedPerson,\n        product: product?.trim() || null,\n        workNature: workNature,\n        pdPerson: null,\n        location: branch?.trim() || null,  // Branch\n        status: \"Pending\",\n      });\n    }\n\n    return entries;\n  };\n\n  const handlePasteSubmit = () => {\n    const entries = parsePastedContent(pasteContent);\n    if (entries.length === 0) {\n      toast({ title: \"Error\", description: \"No valid entries found. Check format.\", variant: \"destructive\" });\n      return;\n    }\n    // Backend handles duplicate checking - send all entries\n    createBulkMutation.mutate(entries);\n  };\n\n  const handleEdit = (entry: MisEntry) => {\n    setEditEntry(entry);\n    setEditDialogOpen(true);\n  };\n\n  const handleEditSave = () => {\n    if (!editEntry) return;\n    updateMutation.mutate({\n      id: editEntry.id,\n      updates: {\n        leadId: editEntry.leadId,\n        customerName: editEntry.customerName,\n        businessName: editEntry.businessName,\n        contactDetails: editEntry.contactDetails,\n        customerAddress: editEntry.customerAddress,\n        inDate: editEntry.inDate,\n        outDate: editEntry.outDate,\n        initiatedPerson: editEntry.initiatedPerson,\n        product: editEntry.product,\n        pdPerson: editEntry.pdPerson,\n        pdPersonId: editEntry.pdPersonId,\n        workflowStatus: editEntry.workflowStatus,\n        location: editEntry.location,\n        status: editEntry.status,\n      },\n    });\n  };\n\n  // Get entries assigned to current user for Intray\n  const intrayEntries = misEntries.filter(entry => \n    entry.pdPersonId === user?.id && \n    entry.workflowStatus === \"assigned\"\n  );\n\n  const getStatusBadge = (status: string | null) => {\n    switch (status?.toLowerCase()) {\n      case \"completed\":\n        return <Badge className=\"bg-green-100 text-green-800\">Completed</Badge>;\n      case \"in progress\":\n        return <Badge className=\"bg-blue-100 text-blue-800\">In Progress</Badge>;\n      case \"pending\":\n      default:\n        return <Badge className=\"bg-amber-100 text-amber-800\">Pending</Badge>;\n    }\n  };\n\n  return (\n    <AuditLayout>\n      <div className=\"space-y-6\">\n        <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-4\">\n          <div>\n            <h1 className=\"text-2xl font-bold tracking-tight text-slate-900\" data-testid=\"text-page-title\">MIS - Work Allocation</h1>\n            <p className=\"text-slate-500\">Track your assigned work from email allocations</p>\n          </div>\n          <div className=\"flex gap-2\">\n            <Button \n              variant=\"outline\" \n              className=\"gap-2\" \n              data-testid=\"button-view-mis\"\n              onClick={() => document.getElementById('mis-table')?.scrollIntoView({ behavior: 'smooth' })}\n            >\n              <ExternalLink className=\"h-4 w-4\" />\n              View MIS ({misEntries.length})\n            </Button>\n            <Dialog open={pasteDialogOpen} onOpenChange={setPasteDialogOpen}>\n              <DialogTrigger asChild>\n                <Button className=\"gap-2\" data-testid=\"button-paste-data\">\n                  <ClipboardPaste className=\"h-4 w-4\" />\n                  Paste Email Data\n                </Button>\n              </DialogTrigger>\n            <DialogContent className=\"max-w-3xl\">\n              <DialogHeader>\n                <DialogTitle>Paste Work Allocation Data</DialogTitle>\n                <DialogDescription>\n                  Copy the table data from your Piramal email and paste it below. The system will automatically assign serial numbers.\n                  Expected format: Product, Business Name, Entity Type, Applicant Name, Lead ID, Branch, Initiation Date, Mobile Number, Address\n                </DialogDescription>\n              </DialogHeader>\n              <Textarea\n                placeholder=\"Paste your tab-separated data here...\"\n                className=\"min-h-[200px] font-mono text-sm\"\n                value={pasteContent}\n                onChange={(e) => setPasteContent(e.target.value)}\n                data-testid=\"input-paste-content\"\n              />\n              <DialogFooter>\n                <Button variant=\"outline\" onClick={() => setPasteDialogOpen(false)} data-testid=\"button-cancel-paste\">\n                  Cancel\n                </Button>\n                <Button onClick={handlePasteSubmit} disabled={createBulkMutation.isPending} data-testid=\"button-submit-paste\">\n                  {createBulkMutation.isPending ? \"Adding...\" : \"Add Entries\"}\n                </Button>\n              </DialogFooter>\n            </DialogContent>\n          </Dialog>\n          </div>\n        </div>\n\n        {/* Intray Section - Shows entries assigned to current user */}\n        {!user?.isAdmin && intrayEntries.length > 0 && (\n          <Card className=\"border-blue-200 bg-blue-50/50\">\n            <CardHeader className=\"pb-3\">\n              <CardTitle className=\"flex items-center gap-2 text-blue-700\">\n                <Inbox className=\"h-5 w-5\" />\n                Your Intray ({intrayEntries.length})\n              </CardTitle>\n              <CardDescription>\n                Cases assigned to you for PD. Upload report to clear from intray.\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"overflow-x-auto\">\n                <Table className=\"text-xs\">\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead className=\"text-xs px-2\">Lead ID</TableHead>\n                      <TableHead className=\"text-xs px-2\">Applicant</TableHead>\n                      <TableHead className=\"text-xs px-2\">Business</TableHead>\n                      <TableHead className=\"text-xs px-2\">Phone</TableHead>\n                      <TableHead className=\"text-xs px-2\">Address</TableHead>\n                      <TableHead className=\"text-xs px-2\">Branch</TableHead>\n                      <TableHead className=\"text-xs px-2\">Product</TableHead>\n                      <TableHead className=\"text-xs px-2\">Initiated By</TableHead>\n                      <TableHead className=\"text-xs px-2\">Assigned</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {intrayEntries.map((entry) => (\n                      <TableRow key={entry.id} className=\"bg-white\" data-testid={`row-intray-${entry.id}`}>\n                        <TableCell className=\"font-mono font-medium text-xs px-2\">{entry.leadId}</TableCell>\n                        <TableCell className=\"text-xs px-2\">{entry.customerName}</TableCell>\n                        <TableCell className=\"text-xs px-2\">{entry.businessName || \"-\"}</TableCell>\n                        <TableCell className=\"text-xs px-2\">{entry.contactDetails || \"-\"}</TableCell>\n                        <TableCell className=\"text-[9px] px-1 w-[350px] leading-tight\" title={entry.customerAddress || \"\"}>\n                          <div className=\"line-clamp-2\">{entry.customerAddress || \"-\"}</div>\n                        </TableCell>\n                        <TableCell className=\"text-xs px-2\">{entry.location || \"-\"}</TableCell>\n                        <TableCell className=\"text-xs px-2\">{entry.product || \"-\"}</TableCell>\n                        <TableCell className=\"text-xs px-2 text-slate-600\">{entry.initiatedPerson || \"-\"}</TableCell>\n                        <TableCell className=\"text-xs px-2 text-slate-600\">\n                          {entry.assignedAt ? new Date(entry.assignedAt).toLocaleDateString() : \"-\"}\n                        </TableCell>\n                      </TableRow>\n                    ))}\n                  </TableBody>\n                </Table>\n              </div>\n            </CardContent>\n          </Card>\n        )}\n\n        <Card id=\"mis-table\">\n          <CardHeader>\n            <CardTitle>Work Allocation List</CardTitle>\n            <CardDescription>\n              {misEntries.length} entries total\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            {isLoading ? (\n              <div className=\"text-center py-8 text-slate-500\">Loading...</div>\n            ) : misEntries.length === 0 ? (\n              <div className=\"text-center py-8 text-slate-500\">\n                No MIS entries yet. Click \"Paste Email Data\" to add work allocations.\n              </div>\n            ) : (\n              <div className=\"overflow-x-auto\">\n                <Table className=\"text-xs\">\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead className=\"w-[40px] text-xs px-2\">SNO</TableHead>\n                      <TableHead className=\"text-xs px-2\">Lead ID</TableHead>\n                      <TableHead className=\"text-xs px-2\">Applicant</TableHead>\n                      <TableHead className=\"text-xs px-2\">Business</TableHead>\n                      <TableHead className=\"text-xs px-2\">Phone</TableHead>\n                      <TableHead className=\"text-xs px-2\">Address</TableHead>\n                      <TableHead className=\"text-xs px-2\">Branch</TableHead>\n                      <TableHead className=\"text-xs px-2\">In Date</TableHead>\n                      <TableHead className=\"text-xs px-2\">Out Date</TableHead>\n                      <TableHead className=\"text-xs px-2\">Work Nature</TableHead>\n                      <TableHead className=\"text-xs px-2\">Initiated By</TableHead>\n                      <TableHead className=\"text-xs px-2\">PD Person</TableHead>\n                      <TableHead className=\"text-xs px-2\">Status</TableHead>\n                      <TableHead className=\"w-[70px] text-xs px-2\">Actions</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {misEntries.map((entry) => (\n                      <TableRow key={entry.id} data-testid={`row-mis-${entry.id}`}>\n                        <TableCell className=\"font-mono text-xs px-2\">{entry.sno}</TableCell>\n                        <TableCell className=\"font-mono font-medium text-xs px-2\">{entry.leadId}</TableCell>\n                        <TableCell className=\"text-xs px-2\">{entry.customerName}</TableCell>\n                        <TableCell className=\"text-xs px-2\">{entry.businessName || \"-\"}</TableCell>\n                        <TableCell className=\"text-xs px-2\">{entry.contactDetails || \"-\"}</TableCell>\n                        <TableCell className=\"text-[9px] px-1 w-[350px] leading-tight\" title={entry.customerAddress || \"\"}>\n                          <div className=\"line-clamp-2\">{entry.customerAddress || \"-\"}</div>\n                        </TableCell>\n                        <TableCell className=\"text-xs px-2\">{entry.location || \"-\"}</TableCell>\n                        <TableCell className=\"text-xs px-2 whitespace-nowrap\">{entry.inDate || \"-\"}</TableCell>\n                        <TableCell className=\"text-xs px-2 whitespace-nowrap\">{entry.outDate || \"-\"}</TableCell>\n                        <TableCell className=\"text-xs px-2\">{(entry as any).workNature || \"-\"}</TableCell>\n                        <TableCell className=\"text-xs px-2 text-slate-600\">{entry.initiatedPerson || \"-\"}</TableCell>\n                        <TableCell className=\"text-xs px-2 text-slate-600\">{getAssociateName(entry.pdPersonId)}</TableCell>\n                        <TableCell className=\"text-xs px-2\">{getStatusBadge(entry.status)}</TableCell>\n                        <TableCell className=\"px-2\">\n                          <div className=\"flex items-center gap-1\">\n                            <Button\n                              variant=\"ghost\"\n                              size=\"icon\"\n                              className=\"h-7 w-7\"\n                              onClick={() => handleEdit(entry)}\n                              data-testid={`button-edit-${entry.id}`}\n                            >\n                              <Edit className=\"h-3 w-3\" />\n                            </Button>\n                            <Button\n                              variant=\"ghost\"\n                              size=\"icon\"\n                              className=\"h-7 w-7\"\n                              onClick={() => deleteMutation.mutate(entry.id)}\n                              data-testid={`button-delete-${entry.id}`}\n                            >\n                              <Trash2 className=\"h-3 w-3 text-red-500\" />\n                            </Button>\n                          </div>\n                        </TableCell>\n                      </TableRow>\n                    ))}\n                  </TableBody>\n                </Table>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        <Dialog open={editDialogOpen} onOpenChange={setEditDialogOpen}>\n          <DialogContent className=\"max-w-2xl\">\n            <DialogHeader>\n              <DialogTitle>Edit MIS Entry</DialogTitle>\n              <DialogDescription>Update the work allocation details</DialogDescription>\n            </DialogHeader>\n            {editEntry && (\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"text-sm font-medium\">Lead ID</label>\n                  <Input\n                    value={editEntry.leadId}\n                    onChange={(e) => setEditEntry({ ...editEntry, leadId: e.target.value })}\n                    data-testid=\"input-edit-leadId\"\n                  />\n                </div>\n                <div>\n                  <label className=\"text-sm font-medium\">Applicant Name</label>\n                  <Input\n                    value={editEntry.customerName}\n                    onChange={(e) => setEditEntry({ ...editEntry, customerName: e.target.value })}\n                    data-testid=\"input-edit-customerName\"\n                  />\n                </div>\n                <div>\n                  <label className=\"text-sm font-medium\">Business Name</label>\n                  <Input\n                    value={editEntry.businessName || \"\"}\n                    onChange={(e) => setEditEntry({ ...editEntry, businessName: e.target.value })}\n                    data-testid=\"input-edit-businessName\"\n                  />\n                </div>\n                <div>\n                  <label className=\"text-sm font-medium\">Phone Number</label>\n                  <Input\n                    value={editEntry.contactDetails || \"\"}\n                    onChange={(e) => setEditEntry({ ...editEntry, contactDetails: e.target.value })}\n                    data-testid=\"input-edit-contactDetails\"\n                  />\n                </div>\n                <div className=\"col-span-2\">\n                  <label className=\"text-sm font-medium\">Address</label>\n                  <Input\n                    value={editEntry.customerAddress || \"\"}\n                    onChange={(e) => setEditEntry({ ...editEntry, customerAddress: e.target.value })}\n                    data-testid=\"input-edit-customerAddress\"\n                  />\n                </div>\n                <div>\n                  <label className=\"text-sm font-medium\">In Date</label>\n                  <Input\n                    value={editEntry.inDate || \"\"}\n                    onChange={(e) => setEditEntry({ ...editEntry, inDate: e.target.value })}\n                    data-testid=\"input-edit-inDate\"\n                  />\n                </div>\n                <div>\n                  <label className=\"text-sm font-medium\">Out Date</label>\n                  <Input\n                    value={editEntry.outDate || \"\"}\n                    onChange={(e) => setEditEntry({ ...editEntry, outDate: e.target.value })}\n                    data-testid=\"input-edit-outDate\"\n                  />\n                </div>\n                <div>\n                  <label className=\"text-sm font-medium\">Initiated Person</label>\n                  <Input\n                    value={editEntry.initiatedPerson || \"\"}\n                    onChange={(e) => setEditEntry({ ...editEntry, initiatedPerson: e.target.value })}\n                    data-testid=\"input-edit-initiatedPerson\"\n                  />\n                </div>\n                <div>\n                  <label className=\"text-sm font-medium\">Product</label>\n                  <Input\n                    value={editEntry.product || \"\"}\n                    onChange={(e) => setEditEntry({ ...editEntry, product: e.target.value })}\n                    data-testid=\"input-edit-product\"\n                  />\n                </div>\n                <div>\n                  <label className=\"text-sm font-medium\">PD Person</label>\n                  <Select\n                    value={editEntry.pdPersonId || \"unassigned\"}\n                    onValueChange={(value) => {\n                      const pdPersonId = value === \"unassigned\" ? null : value;\n                      const associate = associates.find(a => a.id === value);\n                      setEditEntry({ \n                        ...editEntry, \n                        pdPersonId,\n                        pdPerson: associate?.name || null,\n                        workflowStatus: pdPersonId ? \"assigned\" : \"unassigned\"\n                      });\n                    }}\n                  >\n                    <SelectTrigger data-testid=\"select-edit-pdPerson\">\n                      <SelectValue placeholder=\"Select PD Person\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"unassigned\">-- Not Assigned --</SelectItem>\n                      {associates.filter(a => !a.isAdmin).map((associate) => (\n                        <SelectItem key={associate.id} value={associate.id}>\n                          {associate.name}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div>\n                  <label className=\"text-sm font-medium\">Branch</label>\n                  <Input\n                    value={editEntry.location || \"\"}\n                    onChange={(e) => setEditEntry({ ...editEntry, location: e.target.value })}\n                    data-testid=\"input-edit-location\"\n                  />\n                </div>\n                <div>\n                  <label className=\"text-sm font-medium\">Status</label>\n                  <Select\n                    value={editEntry.status || \"Pending\"}\n                    onValueChange={(value) => setEditEntry({ ...editEntry, status: value })}\n                  >\n                    <SelectTrigger data-testid=\"select-edit-status\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"Pending\">Pending</SelectItem>\n                      <SelectItem value=\"In Progress\">In Progress</SelectItem>\n                      <SelectItem value=\"Completed\">Completed</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n            )}\n            <DialogFooter>\n              <Button variant=\"outline\" onClick={() => setEditDialogOpen(false)} data-testid=\"button-cancel-edit\">\n                Cancel\n              </Button>\n              <Button onClick={handleEditSave} disabled={updateMutation.isPending} data-testid=\"button-save-edit\">\n                {updateMutation.isPending ? \"Saving...\" : \"Save Changes\"}\n              </Button>\n            </DialogFooter>\n          </DialogContent>\n        </Dialog>\n      </div>\n    </AuditLayout>\n  );\n}\n","path":null,"size_bytes":27241,"size_tokens":null},"server/openrouter.ts":{"content":"import OpenAI from \"openai\";\n\n// Simple retry helper (replaces p-retry to avoid bundling issues)\nasync function simpleRetry<T>(fn: () => Promise<T>, retries: number = 2, delay: number = 1000): Promise<T> {\n  let lastError: any;\n  for (let attempt = 0; attempt <= retries; attempt++) {\n    try {\n      return await fn();\n    } catch (error: any) {\n      lastError = error;\n      if (attempt < retries) {\n        await new Promise(resolve => setTimeout(resolve, delay * (attempt + 1)));\n      }\n    }\n  }\n  throw lastError;\n}\n\n// AI configuration - supports both Replit AI Integrations and standard OpenRouter credentials\n// Priority: Standard OpenRouter credentials > Replit AI Integrations (production first)\nfunction getAICredentials(): { baseURL: string | undefined; apiKey: string | undefined; source: string } {\n  // Log all available credential options for debugging\n  const hasStandard = !!process.env.OPENROUTER_API_KEY;\n  const hasIntegrations = !!(process.env.AI_INTEGRATIONS_OPENROUTER_BASE_URL && process.env.AI_INTEGRATIONS_OPENROUTER_API_KEY);\n  console.log(`[AI Credentials] Available: Standard=${hasStandard}, Integrations=${hasIntegrations}`);\n  \n  // Prefer standard OpenRouter credentials (works in both dev and production)\n  if (process.env.OPENROUTER_API_KEY) {\n    return {\n      baseURL: process.env.OPENROUTER_BASE_URL || 'https://openrouter.ai/api/v1',\n      apiKey: process.env.OPENROUTER_API_KEY,\n      source: 'Standard OpenRouter'\n    };\n  }\n  \n  // Fallback to Replit AI Integrations (development/preview only)\n  if (process.env.AI_INTEGRATIONS_OPENROUTER_BASE_URL && process.env.AI_INTEGRATIONS_OPENROUTER_API_KEY) {\n    return {\n      baseURL: process.env.AI_INTEGRATIONS_OPENROUTER_BASE_URL,\n      apiKey: process.env.AI_INTEGRATIONS_OPENROUTER_API_KEY,\n      source: 'Replit AI Integrations'\n    };\n  }\n  \n  return { baseURL: undefined, apiKey: undefined, source: 'none' };\n}\n\n// Lazy-load OpenAI client to ensure secrets are available at call time (important for production)\n// Track cached credentials to detect when they change and recreate client\nlet _openrouter: OpenAI | null = null;\nlet _cachedApiKey: string | undefined = undefined;\nlet _cachedBaseURL: string | undefined = undefined;\n\nfunction getOpenRouterClient(): OpenAI {\n  const credentials = getAICredentials();\n  \n  // Recreate client if credentials changed or if we previously had no valid credentials\n  const credentialsChanged = credentials.apiKey !== _cachedApiKey || credentials.baseURL !== _cachedBaseURL;\n  const hadInvalidCredentials = _cachedApiKey === undefined || _cachedApiKey === 'missing';\n  const nowHasValidCredentials = !!credentials.apiKey && credentials.apiKey !== 'missing';\n  \n  if (!_openrouter || (credentialsChanged && nowHasValidCredentials) || (hadInvalidCredentials && nowHasValidCredentials)) {\n    console.log(`[AI Config] Creating new client with source: ${credentials.source}, hasKey: ${!!credentials.apiKey}`);\n    _openrouter = new OpenAI({\n      baseURL: credentials.baseURL || 'https://openrouter.ai/api/v1',\n      apiKey: credentials.apiKey || 'missing'\n    });\n    _cachedApiKey = credentials.apiKey;\n    _cachedBaseURL = credentials.baseURL;\n  } else {\n    console.log(`[AI Config] Reusing cached client, source: ${credentials.source}`);\n  }\n  \n  return _openrouter;\n}\n\nexport function isAIConfigured(): boolean {\n  const creds = getAICredentials();\n  const hasCredentials = !!creds.baseURL && !!creds.apiKey;\n  console.log(`[AI Config] Source: ${creds.source}, BaseURL: ${!!creds.baseURL}, API Key: ${!!creds.apiKey}, Configured: ${hasCredentials}`);\n  return hasCredentials;\n}\n\nfunction isRateLimitError(error: any): boolean {\n  const errorMsg = error?.message || String(error);\n  return (\n    errorMsg.includes(\"429\") ||\n    errorMsg.includes(\"RATELIMIT_EXCEEDED\") ||\n    errorMsg.toLowerCase().includes(\"quota\") ||\n    errorMsg.toLowerCase().includes(\"rate limit\")\n  );\n}\n\nexport async function analyzeBusinessForReport(businessDetails: {\n  businessName: string;\n  businessType: string;\n  location: string;\n  ownerName: string;\n  observations: string[];\n  photoEvidence: string[];\n}): Promise<{\n  summary: string;\n  strengths: string[];\n  concerns: string[];\n  recommendation: string;\n  reportDraft: string;\n}> {\n  const prompt = `You are an expert field verification officer analyst. Analyze this business verification and provide a comprehensive report to help the officer complete their verification report.\n\n**Business Details:**\n- Business Name: ${businessDetails.businessName}\n- Type: ${businessDetails.businessType}\n- Location: ${businessDetails.location}\n- Owner: ${businessDetails.ownerName}\n\n**Field Observations:**\n${businessDetails.observations.map((o, i) => `${i + 1}. ${o}`).join('\\n')}\n\n**Photo Evidence Captured:**\n${businessDetails.photoEvidence.map((p, i) => `${i + 1}. ${p}`).join('\\n')}\n\nProvide your analysis in the following JSON format:\n{\n  \"summary\": \"2-3 sentence executive summary of the business verification\",\n  \"strengths\": [\"list of positive verification points\"],\n  \"concerns\": [\"any concerns or red flags observed\"],\n  \"recommendation\": \"POSITIVE/NEGATIVE/REFER with brief justification\",\n  \"reportDraft\": \"A professional verification report paragraph (100-150 words) that the officer can use in their final report\"\n}\n\nRespond ONLY with valid JSON, no additional text.`;\n\n  const response = await simpleRetry(async () => {\n    const result = await getOpenRouterClient().chat.completions.create({\n      model: \"anthropic/claude-3-haiku\",\n      messages: [{ role: \"user\", content: prompt }],\n      max_tokens: 2048,\n    });\n    return result.choices[0]?.message?.content || \"\";\n  }, 2, 2000);\n\n  try {\n    const jsonMatch = response.match(/\\{[\\s\\S]*\\}/);\n    if (jsonMatch) {\n      return JSON.parse(jsonMatch[0]);\n    }\n    throw new Error(\"No valid JSON found in response\");\n  } catch (e) {\n    return {\n      summary: \"Business verification completed. Analysis available.\",\n      strengths: [\"Business exists at stated location\", \"Owner verified\"],\n      concerns: [],\n      recommendation: \"POSITIVE - Business appears legitimate\",\n      reportDraft: response || \"Verification completed successfully.\"\n    };\n  }\n}\n\nexport interface ComprehensiveScoreResult {\n  personal: number;\n  business: number;\n  banking: number;\n  networth: number;\n  existingDebt: number;\n  endUse: number;\n  referenceChecks: number;\n  personalMatches: {\n    selfEducation: boolean;\n    spouseName: boolean;\n    spouseEducation: boolean;\n    spouseEmployment: boolean;\n    mentionAboutKids: boolean;\n    kidsEducation: boolean;\n    kidsSchool: boolean;\n    residenceVintage: boolean;\n    monthlyRentIfRented: boolean;\n    residenceOwnedOrRented: boolean;\n  };\n  businessMatches: {\n    businessName: boolean;\n    natureOfBusiness: boolean;\n    existenceCurrentPlace: boolean;\n    licensesRegistrations: boolean;\n    promoterExperienceQualifications: boolean;\n    strategicVisionClarity: boolean;\n    employeesSeen: boolean;\n    monthlyTurnover: boolean;\n    clientListConcentrationRisk: boolean;\n    activityDuringVisit: boolean;\n    monthlyIncome: boolean;\n    seasonality: boolean;\n    infraSupportsTurnover: boolean;\n    mfgRawMaterialSourcingStorage: boolean;\n    mfgProcessFlow: boolean;\n    mfgCapacityVsUtilization: boolean;\n    mfgMachineryMakeAutomationMaintenance: boolean;\n    mfgInventoryFifoAging: boolean;\n    mfgQualityControl: boolean;\n    tradingProductRangeInventoryMovement: boolean;\n    tradingPurchaseSalesCycle: boolean;\n    tradingWarehouseStockSeen: boolean;\n    svcDocumentationOfDelivery: boolean;\n    svcTechnologySystems: boolean;\n    svcClientListContractsRevenueModel: boolean;\n    svcContractBasedOrWalkin: boolean;\n  };\n  bankingMatches: {\n    primaryBankerName: boolean;\n    turnoverCreditedPercent: boolean;\n    bankingTenure: boolean;\n    emisRoutedBank: boolean;\n    qrCodeSpotted: boolean;\n  };\n  networthMatches: {\n    propertiesOwned: boolean;\n    vehiclesOwned: boolean;\n    otherInvestments: boolean;\n    businessPlaceOwned: boolean;\n    totalNetworthAvailable: boolean;\n  };\n  debtMatches: {\n    hasExistingLoans: boolean;\n    loanListAvailable: boolean;\n    canServiceNewLoan: boolean;\n    repaymentHistoryQuality: boolean;\n    loansSourceBankNature: boolean;\n  };\n  endUseMatches: {\n    agreementValueAvailable: boolean;\n    advancePaidCashOrBankAmount: boolean;\n    willOccupyPostPurchase: boolean;\n    mortgageFundsUse: boolean;\n    additionalUseInformation: boolean;\n  };\n  referenceMatches: {\n    personalRefNeighbours: boolean;\n    businessRefBuyersSellers: boolean;\n    invoiceVerification: boolean;\n  };\n  rationale: string;\n  aiError?: string;\n}\n\nfunction getDefaultScoreResult(rationale: string, aiError?: string): ComprehensiveScoreResult {\n  return {\n    personal: 0,\n    business: 0,\n    banking: 0,\n    networth: 0,\n    existingDebt: 0,\n    endUse: 0,\n    referenceChecks: 0,\n    aiError,\n    personalMatches: {\n      selfEducation: false,\n      spouseName: false,\n      spouseEducation: false,\n      spouseEmployment: false,\n      mentionAboutKids: false,\n      kidsEducation: false,\n      kidsSchool: false,\n      residenceVintage: false,\n      monthlyRentIfRented: false,\n      residenceOwnedOrRented: false,\n    },\n    businessMatches: {\n      businessName: false,\n      natureOfBusiness: false,\n      existenceCurrentPlace: false,\n      licensesRegistrations: false,\n      promoterExperienceQualifications: false,\n      strategicVisionClarity: false,\n      employeesSeen: false,\n      monthlyTurnover: false,\n      clientListConcentrationRisk: false,\n      activityDuringVisit: false,\n      monthlyIncome: false,\n      seasonality: false,\n      infraSupportsTurnover: false,\n      mfgRawMaterialSourcingStorage: false,\n      mfgProcessFlow: false,\n      mfgCapacityVsUtilization: false,\n      mfgMachineryMakeAutomationMaintenance: false,\n      mfgInventoryFifoAging: false,\n      mfgQualityControl: false,\n      tradingProductRangeInventoryMovement: false,\n      tradingPurchaseSalesCycle: false,\n      tradingWarehouseStockSeen: false,\n      svcDocumentationOfDelivery: false,\n      svcTechnologySystems: false,\n      svcClientListContractsRevenueModel: false,\n      svcContractBasedOrWalkin: false,\n    },\n    bankingMatches: {\n      primaryBankerName: false,\n      turnoverCreditedPercent: false,\n      bankingTenure: false,\n      emisRoutedBank: false,\n      qrCodeSpotted: false,\n    },\n    networthMatches: {\n      propertiesOwned: false,\n      vehiclesOwned: false,\n      otherInvestments: false,\n      businessPlaceOwned: false,\n      totalNetworthAvailable: false,\n    },\n    debtMatches: {\n      hasExistingLoans: false,\n      loanListAvailable: false,\n      canServiceNewLoan: false,\n      repaymentHistoryQuality: false,\n      loansSourceBankNature: false,\n    },\n    endUseMatches: {\n      agreementValueAvailable: false,\n      advancePaidCashOrBankAmount: false,\n      willOccupyPostPurchase: false,\n      mortgageFundsUse: false,\n      additionalUseInformation: false,\n    },\n    referenceMatches: {\n      personalRefNeighbours: false,\n      businessRefBuyersSellers: false,\n      invoiceVerification: false,\n    },\n    rationale,\n  };\n}\n\nexport async function scoreComprehensiveWithAI(pdfText: string, leadId: string): Promise<ComprehensiveScoreResult> {\n  // Check if AI is configured\n  if (!isAIConfigured()) {\n    console.error(`[AI Scoring - ${leadId}] AI not configured - returning zero scores`);\n    return getDefaultScoreResult(\"AI integration not configured\", \"AI_NOT_CONFIGURED\");\n  }\n  \n  console.log(`[AI Scoring - ${leadId}] Starting comprehensive scoring, PDF text length: ${pdfText.length}`);\n  \n  const prompt = `You are an expert loan verification report analyst. Analyze this Personal Discussion (PD) Report and score each section based on the completeness and quality of information provided.\n\n**REPORT TEXT:**\n${pdfText.substring(0, 15000)}\n\n**SCORING RUBRIC:**\n\n1. **Personal Details (max 15 points, 1.5 pts each):**\n   - selfEducation: Education level mentioned\n   - spouseName: Spouse's name mentioned\n   - spouseEducation: Spouse's education mentioned\n   - spouseEmployment: Spouse's occupation\n   - mentionAboutKids: Children mentioned\n   - kidsEducation: Children's education level\n   - kidsSchool: Children's school/institution name\n   - residenceVintage: Duration at current residence\n   - monthlyRentIfRented: Monthly rent amount (or NA if owned)\n   - residenceOwnedOrRented: Ownership/rental status captured\n\n2. **Business Details (max 30 points):**\n   Core (2 pts each):\n   - businessName, natureOfBusiness, existenceCurrentPlace, licensesRegistrations\n   - promoterExperienceQualifications, strategicVisionClarity, employeesSeen\n   - monthlyTurnover, clientListConcentrationRisk, activityDuringVisit\n   - monthlyIncome, seasonality, infraSupportsTurnover\n   Manufacturing (1 pt each, score only if applicable):\n   - mfgRawMaterialSourcingStorage, mfgProcessFlow, mfgCapacityVsUtilization\n   - mfgMachineryMakeAutomationMaintenance, mfgInventoryFifoAging, mfgQualityControl\n   Trading (1 pt each, score only if applicable):\n   - tradingProductRangeInventoryMovement, tradingPurchaseSalesCycle, tradingWarehouseStockSeen\n   Service (1 pt each, score only if applicable):\n   - svcDocumentationOfDelivery, svcTechnologySystems, svcClientListContractsRevenueModel, svcContractBasedOrWalkin\n\n3. **Banking (max 15 points, 3 pts each):**\n   - primaryBankerName, turnoverCreditedPercent, bankingTenure, emisRoutedBank, qrCodeSpotted\n\n4. **Networth (max 10 points, 2 pts each):**\n   - propertiesOwned, vehiclesOwned, otherInvestments, businessPlaceOwned, totalNetworthAvailable\n\n5. **Existing Debt (max 10 points, 2 pts each):**\n   - hasExistingLoans, loanListAvailable, canServiceNewLoan, repaymentHistoryQuality, loansSourceBankNature\n\n6. **End Use (max 10 points, 2 pts each):**\n   - agreementValueAvailable, advancePaidCashOrBankAmount, willOccupyPostPurchase, mortgageFundsUse, additionalUseInformation\n\n7. **Reference Checks (max 10 points):**\n   - personalRefNeighbours (3.4 pts), businessRefBuyersSellers (3.3 pts), invoiceVerification (3.3 pts)\n\n**IMPORTANT:** Score based on actual content found. If information is meaningfully present, give credit.\n\nReturn your analysis as JSON:\n{\n  \"personal\": <score 0-15>,\n  \"business\": <score 0-30>,\n  \"banking\": <score 0-15>,\n  \"networth\": <score 0-10>,\n  \"existingDebt\": <score 0-10>,\n  \"endUse\": <score 0-10>,\n  \"referenceChecks\": <score 0-10>,\n  \"personalMatches\": {\n    \"selfEducation\": <boolean>,\n    \"spouseName\": <boolean>,\n    \"spouseEducation\": <boolean>,\n    \"spouseEmployment\": <boolean>,\n    \"mentionAboutKids\": <boolean>,\n    \"kidsEducation\": <boolean>,\n    \"kidsSchool\": <boolean>,\n    \"residenceVintage\": <boolean>,\n    \"monthlyRentIfRented\": <boolean>,\n    \"residenceOwnedOrRented\": <boolean>\n  },\n  \"businessMatches\": {\n    \"businessName\": <boolean>,\n    \"natureOfBusiness\": <boolean>,\n    \"existenceCurrentPlace\": <boolean>,\n    \"licensesRegistrations\": <boolean>,\n    \"promoterExperienceQualifications\": <boolean>,\n    \"strategicVisionClarity\": <boolean>,\n    \"employeesSeen\": <boolean>,\n    \"monthlyTurnover\": <boolean>,\n    \"clientListConcentrationRisk\": <boolean>,\n    \"activityDuringVisit\": <boolean>,\n    \"monthlyIncome\": <boolean>,\n    \"seasonality\": <boolean>,\n    \"infraSupportsTurnover\": <boolean>,\n    \"mfgRawMaterialSourcingStorage\": <boolean>,\n    \"mfgProcessFlow\": <boolean>,\n    \"mfgCapacityVsUtilization\": <boolean>,\n    \"mfgMachineryMakeAutomationMaintenance\": <boolean>,\n    \"mfgInventoryFifoAging\": <boolean>,\n    \"mfgQualityControl\": <boolean>,\n    \"tradingProductRangeInventoryMovement\": <boolean>,\n    \"tradingPurchaseSalesCycle\": <boolean>,\n    \"tradingWarehouseStockSeen\": <boolean>,\n    \"svcDocumentationOfDelivery\": <boolean>,\n    \"svcTechnologySystems\": <boolean>,\n    \"svcClientListContractsRevenueModel\": <boolean>,\n    \"svcContractBasedOrWalkin\": <boolean>\n  },\n  \"bankingMatches\": {\n    \"primaryBankerName\": <boolean>,\n    \"turnoverCreditedPercent\": <boolean>,\n    \"bankingTenure\": <boolean>,\n    \"emisRoutedBank\": <boolean>,\n    \"qrCodeSpotted\": <boolean>\n  },\n  \"networthMatches\": {\n    \"propertiesOwned\": <boolean>,\n    \"vehiclesOwned\": <boolean>,\n    \"otherInvestments\": <boolean>,\n    \"businessPlaceOwned\": <boolean>,\n    \"totalNetworthAvailable\": <boolean>\n  },\n  \"debtMatches\": {\n    \"hasExistingLoans\": <boolean>,\n    \"loanListAvailable\": <boolean>,\n    \"canServiceNewLoan\": <boolean>,\n    \"repaymentHistoryQuality\": <boolean>,\n    \"loansSourceBankNature\": <boolean>\n  },\n  \"endUseMatches\": {\n    \"agreementValueAvailable\": <boolean>,\n    \"advancePaidCashOrBankAmount\": <boolean>,\n    \"willOccupyPostPurchase\": <boolean>,\n    \"mortgageFundsUse\": <boolean>,\n    \"additionalUseInformation\": <boolean>\n  },\n  \"referenceMatches\": {\n    \"personalRefNeighbours\": <boolean>,\n    \"businessRefBuyersSellers\": <boolean>,\n    \"invoiceVerification\": <boolean>\n  },\n  \"rationale\": \"<brief explanation>\"\n}\n\nRespond ONLY with valid JSON.`;\n\n  try {\n    console.log(`[AI Scoring - ${leadId}] About to call OpenRouter API...`);\n    \n    const response = await simpleRetry(async () => {\n      console.log(`[AI Scoring - ${leadId}] Making API request to OpenRouter...`);\n      const result = await getOpenRouterClient().chat.completions.create({\n        model: \"anthropic/claude-3-haiku\",\n        messages: [{ role: \"user\", content: prompt }],\n        max_tokens: 2048,\n      });\n      console.log(`[AI Scoring - ${leadId}] API request successful, got response`);\n      return result.choices[0]?.message?.content || \"\";\n    }, 1, 2000);\n\n    console.log(`[AI Scoring - ${leadId}] Raw response length: ${response.length}, preview:`, response.substring(0, 500));\n\n    const jsonMatch = response.match(/\\{[\\s\\S]*\\}/);\n    if (jsonMatch) {\n      const parsed = JSON.parse(jsonMatch[0]);\n      \n      // Helper to coerce and clamp scores within valid range\n      const coerceScore = (value: any, max: number): number => {\n        const num = typeof value === 'string' ? parseFloat(value) : Number(value);\n        if (isNaN(num)) return 0;\n        return Math.max(0, Math.min(max, Math.round(num)));\n      };\n      \n      // Helper to coerce boolean values\n      const coerceBool = (value: any): boolean => {\n        if (typeof value === 'boolean') return value;\n        if (typeof value === 'string') return value.toLowerCase() === 'true';\n        return Boolean(value);\n      };\n      \n      // Validate and clamp all scores to their respective maximums\n      const validatedScores: ComprehensiveScoreResult = {\n        personal: coerceScore(parsed.personal, 15),\n        business: coerceScore(parsed.business, 30),\n        banking: coerceScore(parsed.banking, 15),\n        networth: coerceScore(parsed.networth, 10),\n        existingDebt: coerceScore(parsed.existingDebt, 10),\n        endUse: coerceScore(parsed.endUse, 10),\n        referenceChecks: coerceScore(parsed.referenceChecks, 10),\n        personalMatches: {\n          selfEducation: coerceBool(parsed.personalMatches?.selfEducation),\n          spouseName: coerceBool(parsed.personalMatches?.spouseName),\n          spouseEducation: coerceBool(parsed.personalMatches?.spouseEducation),\n          spouseEmployment: coerceBool(parsed.personalMatches?.spouseEmployment),\n          mentionAboutKids: coerceBool(parsed.personalMatches?.mentionAboutKids),\n          kidsEducation: coerceBool(parsed.personalMatches?.kidsEducation),\n          kidsSchool: coerceBool(parsed.personalMatches?.kidsSchool),\n          residenceVintage: coerceBool(parsed.personalMatches?.residenceVintage),\n          monthlyRentIfRented: coerceBool(parsed.personalMatches?.monthlyRentIfRented),\n          residenceOwnedOrRented: coerceBool(parsed.personalMatches?.residenceOwnedOrRented),\n        },\n        businessMatches: {\n          businessName: coerceBool(parsed.businessMatches?.businessName),\n          natureOfBusiness: coerceBool(parsed.businessMatches?.natureOfBusiness),\n          existenceCurrentPlace: coerceBool(parsed.businessMatches?.existenceCurrentPlace),\n          licensesRegistrations: coerceBool(parsed.businessMatches?.licensesRegistrations),\n          promoterExperienceQualifications: coerceBool(parsed.businessMatches?.promoterExperienceQualifications),\n          strategicVisionClarity: coerceBool(parsed.businessMatches?.strategicVisionClarity),\n          employeesSeen: coerceBool(parsed.businessMatches?.employeesSeen),\n          monthlyTurnover: coerceBool(parsed.businessMatches?.monthlyTurnover),\n          clientListConcentrationRisk: coerceBool(parsed.businessMatches?.clientListConcentrationRisk),\n          activityDuringVisit: coerceBool(parsed.businessMatches?.activityDuringVisit),\n          monthlyIncome: coerceBool(parsed.businessMatches?.monthlyIncome),\n          seasonality: coerceBool(parsed.businessMatches?.seasonality),\n          infraSupportsTurnover: coerceBool(parsed.businessMatches?.infraSupportsTurnover),\n          mfgRawMaterialSourcingStorage: coerceBool(parsed.businessMatches?.mfgRawMaterialSourcingStorage),\n          mfgProcessFlow: coerceBool(parsed.businessMatches?.mfgProcessFlow),\n          mfgCapacityVsUtilization: coerceBool(parsed.businessMatches?.mfgCapacityVsUtilization),\n          mfgMachineryMakeAutomationMaintenance: coerceBool(parsed.businessMatches?.mfgMachineryMakeAutomationMaintenance),\n          mfgInventoryFifoAging: coerceBool(parsed.businessMatches?.mfgInventoryFifoAging),\n          mfgQualityControl: coerceBool(parsed.businessMatches?.mfgQualityControl),\n          tradingProductRangeInventoryMovement: coerceBool(parsed.businessMatches?.tradingProductRangeInventoryMovement),\n          tradingPurchaseSalesCycle: coerceBool(parsed.businessMatches?.tradingPurchaseSalesCycle),\n          tradingWarehouseStockSeen: coerceBool(parsed.businessMatches?.tradingWarehouseStockSeen),\n          svcDocumentationOfDelivery: coerceBool(parsed.businessMatches?.svcDocumentationOfDelivery),\n          svcTechnologySystems: coerceBool(parsed.businessMatches?.svcTechnologySystems),\n          svcClientListContractsRevenueModel: coerceBool(parsed.businessMatches?.svcClientListContractsRevenueModel),\n          svcContractBasedOrWalkin: coerceBool(parsed.businessMatches?.svcContractBasedOrWalkin),\n        },\n        bankingMatches: {\n          primaryBankerName: coerceBool(parsed.bankingMatches?.primaryBankerName),\n          turnoverCreditedPercent: coerceBool(parsed.bankingMatches?.turnoverCreditedPercent),\n          bankingTenure: coerceBool(parsed.bankingMatches?.bankingTenure),\n          emisRoutedBank: coerceBool(parsed.bankingMatches?.emisRoutedBank),\n          qrCodeSpotted: coerceBool(parsed.bankingMatches?.qrCodeSpotted),\n        },\n        networthMatches: {\n          propertiesOwned: coerceBool(parsed.networthMatches?.propertiesOwned),\n          vehiclesOwned: coerceBool(parsed.networthMatches?.vehiclesOwned),\n          otherInvestments: coerceBool(parsed.networthMatches?.otherInvestments),\n          businessPlaceOwned: coerceBool(parsed.networthMatches?.businessPlaceOwned),\n          totalNetworthAvailable: coerceBool(parsed.networthMatches?.totalNetworthAvailable),\n        },\n        debtMatches: {\n          hasExistingLoans: coerceBool(parsed.debtMatches?.hasExistingLoans),\n          loanListAvailable: coerceBool(parsed.debtMatches?.loanListAvailable),\n          canServiceNewLoan: coerceBool(parsed.debtMatches?.canServiceNewLoan),\n          repaymentHistoryQuality: coerceBool(parsed.debtMatches?.repaymentHistoryQuality),\n          loansSourceBankNature: coerceBool(parsed.debtMatches?.loansSourceBankNature),\n        },\n        endUseMatches: {\n          agreementValueAvailable: coerceBool(parsed.endUseMatches?.agreementValueAvailable),\n          advancePaidCashOrBankAmount: coerceBool(parsed.endUseMatches?.advancePaidCashOrBankAmount),\n          willOccupyPostPurchase: coerceBool(parsed.endUseMatches?.willOccupyPostPurchase),\n          mortgageFundsUse: coerceBool(parsed.endUseMatches?.mortgageFundsUse),\n          additionalUseInformation: coerceBool(parsed.endUseMatches?.additionalUseInformation),\n        },\n        referenceMatches: {\n          personalRefNeighbours: coerceBool(parsed.referenceMatches?.personalRefNeighbours),\n          businessRefBuyersSellers: coerceBool(parsed.referenceMatches?.businessRefBuyersSellers),\n          invoiceVerification: coerceBool(parsed.referenceMatches?.invoiceVerification),\n        },\n        rationale: typeof parsed.rationale === 'string' ? parsed.rationale : \"AI analysis completed\",\n      };\n      \n      console.log(`[AI Scoring - ${leadId}] Validated scores:`, validatedScores);\n      \n      return validatedScores;\n    }\n    console.error(`[AI Scoring - ${leadId}] No valid JSON found in response`);\n    throw new Error(\"No valid JSON found in AI response\");\n  } catch (error: any) {\n    const errorMsg = error?.message || 'Unknown error';\n    console.error(`[AI Scoring - ${leadId}] SCORING FAILED:`, {\n      message: errorMsg,\n      status: error?.status,\n      code: error?.code,\n      type: error?.type,\n      stack: error?.stack?.substring(0, 500),\n    });\n    return getDefaultScoreResult(\n      `AI scoring failed: ${errorMsg} - manual review required`,\n      `SCORING_FAILED: ${errorMsg}`\n    );\n  }\n}\n\nexport async function calculatePhotoScore(checklistItems: {\n  personal: { applicantPhoto: boolean; selfieWithVO: boolean };\n  business: { \n    signboard: boolean; \n    proprietorName: boolean; \n    contactVisible: boolean;\n    activeOperations: boolean;\n    staffVisible: boolean;\n    stockInventory: boolean;\n  };\n  banking: { upiQR: boolean; multipleQR: boolean; bankEvidence: boolean };\n  endUse: { premises: boolean; workingCapital: boolean; equipment: boolean };\n  quality: { gpsTimestamp: boolean; locationConsistent: boolean; timeSequence: boolean };\n}): Promise<{\n  personal: number;\n  business: number;\n  banking: number;\n  endUse: number;\n  quality: number;\n  total: number;\n  maxTotal: number;\n  percentage: number;\n}> {\n  const personal = \n    (checklistItems.personal.applicantPhoto ? 5 : 0) +\n    (checklistItems.personal.selfieWithVO ? 5 : 0);\n\n  const business = \n    (checklistItems.business.signboard ? 5 : 0) +\n    (checklistItems.business.proprietorName ? 4 : 0) +\n    (checklistItems.business.contactVisible ? 3 : 0) +\n    (checklistItems.business.activeOperations ? 4 : 0) +\n    (checklistItems.business.staffVisible ? 3 : 0) +\n    (checklistItems.business.stockInventory ? 3 : 0);\n\n  const banking = \n    (checklistItems.banking.upiQR ? 4 : 0) +\n    (checklistItems.banking.multipleQR ? 2 : 0) +\n    (checklistItems.banking.bankEvidence ? 2 : 0);\n\n  const endUse = \n    (checklistItems.endUse.premises ? 4 : 0) +\n    (checklistItems.endUse.workingCapital ? 3 : 0) +\n    (checklistItems.endUse.equipment ? 3 : 0);\n\n  const quality = \n    (checklistItems.quality.gpsTimestamp ? 4 : 0) +\n    (checklistItems.quality.locationConsistent ? 3 : 0) +\n    (checklistItems.quality.timeSequence ? 3 : 0);\n\n  const total = personal + business + banking + endUse + quality;\n  const maxTotal = 10 + 22 + 8 + 10 + 10; // 60 points max\n\n  return {\n    personal,\n    business,\n    banking,\n    endUse,\n    quality,\n    total,\n    maxTotal,\n    percentage: Math.round((total / maxTotal) * 100)\n  };\n}\n","path":null,"size_bytes":27259,"size_tokens":null},"client/src/pages/create-report.tsx":{"content":"import { useState, useRef } from \"react\";\nimport AuditLayout from \"@/components/layout/audit-layout\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { \n  Mic, \n  Upload, \n  Camera, \n  FileAudio, \n  Image as ImageIcon, \n  Loader2, \n  CheckCircle, \n  AlertCircle,\n  Trash2,\n  BrainCircuit,\n  FileText,\n  Send,\n  User,\n  Building,\n  Home,\n  Briefcase,\n  Users,\n  MapPin,\n  Download\n} from \"lucide-react\";\n\ninterface UploadedFile {\n  file: File;\n  preview?: string;\n  name: string;\n  size: string;\n}\n\ninterface LIPDraftReport {\n  leadId: string;\n  reportDate: string;\n  primaryApplicant: {\n    customerName: string;\n    mobileNumber: string;\n    emailId: string;\n    residenceAddress: string;\n    officeAddress: string;\n    spouseName: string;\n  };\n  basicDetails: {\n    branch: string;\n    productLine: string;\n    transactionType: string;\n    totalLoanAmount: string;\n    pdType: string;\n    customerProfile: string;\n    natureOfBusiness: string;\n    profession: string;\n  };\n  pdDetails: {\n    pdDate: string;\n    pdPlace: string;\n    currentAddress: string;\n    pdDoneWith: string;\n  };\n  personalDetails: {\n    residenceType: string;\n    residenceVintage: string;\n    monthlyRent: string;\n    totalFamilyMembers: string;\n    dependents: string;\n    monthlyHouseholdExpenses: string;\n    otherComments: string;\n    selfEducation: string;\n    spouseEducation: string;\n    spouseEmployment: string;\n    kidsEducation: string;\n    kidsSchool: string;\n    spouseName: string;\n  };\n  businessDetails: {\n    businessVintageMonths: string;\n    totalBusinessVintage: string;\n    majorServices: string;\n    businessName: string;\n    businessProfile: string;\n    sourceOfBusiness: string;\n    businessSetup: string;\n    monthlyRental: string;\n    surroundingArea: string;\n    netMonthlyIncome: string;\n    comfortableEmi: string;\n    strategicVision: string;\n    promoterExperience: string;\n    clientListConcentrationRisk: string;\n    seasonality: string;\n    employeeCount: string;\n    monthlyTurnover: string;\n    majorClients: string;\n    growthPlans: string;\n  };\n  referenceChecks: {\n    reference1: {\n      type: string;\n      name: string;\n      contact: string;\n      feedback: string;\n      remarks: string;\n    };\n    reference2: {\n      type: string;\n      name: string;\n      contact: string;\n      feedback: string;\n      remarks: string;\n    };\n    invoiceVerified: string;\n  };\n  propertyDetails: {\n    propertyType: string;\n    approxArea: string;\n    propertyUsage: string;\n    approxValuation: string;\n    propertyAddress: string;\n    propertiesOwned: string;\n    vehiclesOwned: string;\n    otherInvestments: string;\n  };\n  bankingDetails: {\n    bankName: string;\n    turnoverCreditPercent: string;\n    bankingTenure: string;\n    emisRouted: string;\n    qrCodeSpotted: string;\n  };\n  debtDetails: {\n    existingLoans: string;\n    loanList: string;\n    repaymentHistory: string;\n  };\n  summary: {\n    overallSummary: string;\n    riskMitigants: string;\n  };\n  endUseDetails: {\n    purposeOfLoan: string;\n    endUse: string;\n    agreementValue: string;\n    advancePaid: string;\n  };\n  recommendation: string;\n  remarks: string;\n}\n\nexport default function CreateReportPage() {\n  const { toast } = useToast();\n  const audioInputRef = useRef<HTMLInputElement>(null);\n  const photoInputRef = useRef<HTMLInputElement>(null);\n  \n  const [leadId, setLeadId] = useState(\"\");\n  const [audioFile, setAudioFile] = useState<UploadedFile | null>(null);\n  const [photos, setPhotos] = useState<UploadedFile[]>([]);\n  const [isGenerating, setIsGenerating] = useState(false);\n  const [generationProgress, setGenerationProgress] = useState(0);\n  const [progressMessage, setProgressMessage] = useState(\"\");\n  const [draftReport, setDraftReport] = useState<LIPDraftReport | null>(null);\n  const [activeTab, setActiveTab] = useState(\"upload\");\n  const [isDownloading, setIsDownloading] = useState(false);\n\n  const formatFileSize = (bytes: number): string => {\n    if (bytes < 1024) return bytes + \" B\";\n    if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + \" KB\";\n    return (bytes / (1024 * 1024)).toFixed(1) + \" MB\";\n  };\n\n  const handleAudioUpload = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (file) {\n      if (!file.type.startsWith(\"audio/\")) {\n        toast({\n          title: \"Invalid file type\",\n          description: \"Please upload an audio file (MP3, WAV, M4A, etc.)\",\n          variant: \"destructive\"\n        });\n        return;\n      }\n      setAudioFile({\n        file,\n        name: file.name,\n        size: formatFileSize(file.size)\n      });\n      toast({\n        title: \"Audio uploaded\",\n        description: `${file.name} ready for processing`\n      });\n    }\n  };\n\n  const handlePhotoUpload = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const files = e.target.files;\n    if (files) {\n      const newPhotos: UploadedFile[] = [];\n      Array.from(files).forEach(file => {\n        if (!file.type.startsWith(\"image/\")) {\n          toast({\n            title: \"Invalid file type\",\n            description: `${file.name} is not an image file`,\n            variant: \"destructive\"\n          });\n          return;\n        }\n        const preview = URL.createObjectURL(file);\n        newPhotos.push({\n          file,\n          preview,\n          name: file.name,\n          size: formatFileSize(file.size)\n        });\n      });\n      setPhotos(prev => [...prev, ...newPhotos]);\n      toast({\n        title: \"Photos uploaded\",\n        description: `${newPhotos.length} photo(s) added`\n      });\n    }\n  };\n\n  const removePhoto = (index: number) => {\n    setPhotos(prev => {\n      const newPhotos = [...prev];\n      if (newPhotos[index].preview) {\n        URL.revokeObjectURL(newPhotos[index].preview!);\n      }\n      newPhotos.splice(index, 1);\n      return newPhotos;\n    });\n  };\n\n  const generateDraftReport = async () => {\n    if (!leadId.trim()) {\n      toast({\n        title: \"Lead ID required\",\n        description: \"Please enter a Lead ID before generating the report\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    if (!audioFile && photos.length === 0) {\n      toast({\n        title: \"No files uploaded\",\n        description: \"Please upload a voice recording or photos to generate a report\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    setIsGenerating(true);\n    setGenerationProgress(0);\n    setProgressMessage(\"Preparing files...\");\n\n    try {\n      const formData = new FormData();\n      formData.append(\"leadId\", leadId);\n      \n      if (audioFile) {\n        formData.append(\"audio\", audioFile.file);\n      }\n      \n      photos.forEach((photo, index) => {\n        formData.append(`photo_${index}`, photo.file);\n      });\n\n      setGenerationProgress(20);\n      setProgressMessage(\"Uploading files...\");\n\n      const response = await fetch(\"/api/generate-draft-report\", {\n        method: \"POST\",\n        body: formData,\n        credentials: \"include\"\n      });\n\n      setGenerationProgress(60);\n      setProgressMessage(\"AI analyzing content...\");\n\n      if (!response.ok) {\n        throw new Error(\"Failed to generate report\");\n      }\n\n      const data = await response.json();\n      \n      setGenerationProgress(100);\n      setProgressMessage(\"Report generated!\");\n\n      setDraftReport(data.draft);\n      setActiveTab(\"review\");\n\n      toast({\n        title: \"Draft report generated\",\n        description: \"Review the AI-generated LIP Report and make any edits\"\n      });\n\n    } catch (error) {\n      console.error(\"Generate report error:\", error);\n      toast({\n        title: \"Generation failed\",\n        description: \"Failed to generate draft report. Please try again.\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setIsGenerating(false);\n      setGenerationProgress(0);\n      setProgressMessage(\"\");\n    }\n  };\n\n  const submitReport = async () => {\n    if (!draftReport) return;\n\n    try {\n      const response = await fetch(\"/api/submit-draft-report\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(draftReport),\n        credentials: \"include\"\n      });\n\n      if (!response.ok) throw new Error(\"Failed to submit\");\n\n      toast({\n        title: \"Report submitted\",\n        description: \"Your LIP Report has been submitted successfully\"\n      });\n\n      setDraftReport(null);\n      setAudioFile(null);\n      setPhotos([]);\n      setLeadId(\"\");\n      setActiveTab(\"upload\");\n\n    } catch (error) {\n      toast({\n        title: \"Submission failed\",\n        description: \"Failed to submit report. Please try again.\",\n        variant: \"destructive\"\n      });\n    }\n  };\n\n  const downloadDraftPdf = async () => {\n    if (!draftReport) return;\n\n    setIsDownloading(true);\n    try {\n      const response = await fetch(\"/api/generate-draft-pdf\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(draftReport),\n        credentials: \"include\"\n      });\n\n      if (!response.ok) throw new Error(\"Failed to generate PDF\");\n\n      const blob = await response.blob();\n      const url = window.URL.createObjectURL(blob);\n      const a = document.createElement(\"a\");\n      a.href = url;\n      a.download = `${draftReport.leadId}_draft_report.pdf`;\n      document.body.appendChild(a);\n      a.click();\n      window.URL.revokeObjectURL(url);\n      document.body.removeChild(a);\n\n      toast({\n        title: \"PDF downloaded\",\n        description: \"Draft LIP Report PDF has been downloaded\"\n      });\n    } catch (error) {\n      toast({\n        title: \"Download failed\",\n        description: \"Failed to download PDF. Please try again.\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setIsDownloading(false);\n    }\n  };\n\n  const updateField = (section: keyof LIPDraftReport, field: string, value: string) => {\n    if (!draftReport) return;\n    \n    if (typeof draftReport[section] === 'object' && draftReport[section] !== null) {\n      setDraftReport({\n        ...draftReport,\n        [section]: {\n          ...(draftReport[section] as object),\n          [field]: value\n        }\n      });\n    } else {\n      setDraftReport({\n        ...draftReport,\n        [section]: value\n      });\n    }\n  };\n\n  const updateReferenceField = (refNum: 'reference1' | 'reference2', field: string, value: string) => {\n    if (!draftReport) return;\n    setDraftReport({\n      ...draftReport,\n      referenceChecks: {\n        ...draftReport.referenceChecks,\n        [refNum]: {\n          ...draftReport.referenceChecks[refNum],\n          [field]: value\n        }\n      }\n    });\n  };\n\n  return (\n    <AuditLayout>\n      <div className=\"space-y-6 max-w-5xl mx-auto\">\n        <div>\n          <h1 className=\"text-2xl font-bold tracking-tight text-slate-900\">Create LIP Report</h1>\n          <p className=\"text-slate-500\">Upload voice recording and photos to generate an AI-powered draft report</p>\n        </div>\n\n        <Tabs value={activeTab} onValueChange={setActiveTab}>\n          <TabsList className=\"grid w-full grid-cols-2\">\n            <TabsTrigger value=\"upload\" className=\"flex items-center gap-2\" data-testid=\"tab-upload\">\n              <Upload className=\"h-4 w-4\" />\n              Upload Files\n            </TabsTrigger>\n            <TabsTrigger value=\"review\" className=\"flex items-center gap-2\" disabled={!draftReport} data-testid=\"tab-review\">\n              <FileText className=\"h-4 w-4\" />\n              Review LIP Report\n            </TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"upload\" className=\"space-y-6 mt-6\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <FileText className=\"h-5 w-5\" />\n                  Lead Information\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"leadId\">Lead ID</Label>\n                  <Input\n                    id=\"leadId\"\n                    placeholder=\"Enter Lead ID (e.g., BLSA00090139)\"\n                    value={leadId}\n                    onChange={(e) => setLeadId(e.target.value)}\n                    data-testid=\"input-lead-id\"\n                  />\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <Mic className=\"h-5 w-5 text-blue-600\" />\n                  Voice Recording\n                </CardTitle>\n                <CardDescription>\n                  Upload the discussion recording from your field visit\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                <input\n                  ref={audioInputRef}\n                  type=\"file\"\n                  accept=\"audio/*\"\n                  className=\"hidden\"\n                  onChange={handleAudioUpload}\n                  data-testid=\"input-audio\"\n                />\n                \n                {!audioFile ? (\n                  <div \n                    className=\"border-2 border-dashed border-slate-300 rounded-lg p-8 text-center hover:border-blue-400 hover:bg-blue-50/50 transition-colors cursor-pointer\"\n                    onClick={() => audioInputRef.current?.click()}\n                    data-testid=\"dropzone-audio\"\n                  >\n                    <FileAudio className=\"h-12 w-12 mx-auto text-slate-400 mb-4\" />\n                    <p className=\"text-slate-600 font-medium\">Click to upload voice recording</p>\n                    <p className=\"text-sm text-slate-400 mt-1\">MP3, WAV, M4A, or other audio formats</p>\n                  </div>\n                ) : (\n                  <div className=\"flex items-center gap-4 p-4 bg-blue-50 rounded-lg border border-blue-200\">\n                    <div className=\"h-12 w-12 rounded-full bg-blue-600 flex items-center justify-center\">\n                      <FileAudio className=\"h-6 w-6 text-white\" />\n                    </div>\n                    <div className=\"flex-1\">\n                      <p className=\"font-medium text-slate-900\">{audioFile.name}</p>\n                      <p className=\"text-sm text-slate-500\">{audioFile.size}</p>\n                    </div>\n                    <Button\n                      variant=\"ghost\"\n                      size=\"icon\"\n                      className=\"text-rose-500 hover:text-rose-700 hover:bg-rose-50\"\n                      onClick={() => setAudioFile(null)}\n                      data-testid=\"button-remove-audio\"\n                    >\n                      <Trash2 className=\"h-5 w-5\" />\n                    </Button>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <Camera className=\"h-5 w-5 text-emerald-600\" />\n                  Photos\n                </CardTitle>\n                <CardDescription>\n                  Upload photos from your field visit (business premises, signage, etc.)\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                <input\n                  ref={photoInputRef}\n                  type=\"file\"\n                  accept=\"image/*\"\n                  multiple\n                  className=\"hidden\"\n                  onChange={handlePhotoUpload}\n                  data-testid=\"input-photos\"\n                />\n\n                <div \n                  className=\"border-2 border-dashed border-slate-300 rounded-lg p-6 text-center hover:border-emerald-400 hover:bg-emerald-50/50 transition-colors cursor-pointer mb-4\"\n                  onClick={() => photoInputRef.current?.click()}\n                  data-testid=\"dropzone-photos\"\n                >\n                  <ImageIcon className=\"h-10 w-10 mx-auto text-slate-400 mb-3\" />\n                  <p className=\"text-slate-600 font-medium\">Click to upload photos</p>\n                  <p className=\"text-sm text-slate-400 mt-1\">JPG, PNG, or other image formats</p>\n                </div>\n\n                {photos.length > 0 && (\n                  <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n                    {photos.map((photo, index) => (\n                      <div key={index} className=\"relative group\">\n                        <img\n                          src={photo.preview}\n                          alt={photo.name}\n                          className=\"w-full h-24 object-cover rounded-lg border border-slate-200\"\n                        />\n                        <Button\n                          variant=\"destructive\"\n                          size=\"icon\"\n                          className=\"absolute top-1 right-1 h-6 w-6 opacity-0 group-hover:opacity-100 transition-opacity\"\n                          onClick={() => removePhoto(index)}\n                          data-testid={`button-remove-photo-${index}`}\n                        >\n                          <Trash2 className=\"h-3 w-3\" />\n                        </Button>\n                        <p className=\"text-xs text-slate-500 mt-1 truncate\">{photo.name}</p>\n                      </div>\n                    ))}\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n\n            <div className=\"flex justify-end\">\n              <Button\n                size=\"lg\"\n                onClick={generateDraftReport}\n                disabled={isGenerating || (!audioFile && photos.length === 0)}\n                className=\"gap-2\"\n                data-testid=\"button-generate-report\"\n              >\n                {isGenerating ? (\n                  <>\n                    <Loader2 className=\"h-5 w-5 animate-spin\" />\n                    Generating...\n                  </>\n                ) : (\n                  <>\n                    <BrainCircuit className=\"h-5 w-5\" />\n                    Generate LIP Report\n                  </>\n                )}\n              </Button>\n            </div>\n\n            {isGenerating && (\n              <Card className=\"bg-blue-50 border-blue-200\">\n                <CardContent className=\"pt-6\">\n                  <div className=\"space-y-3\">\n                    <div className=\"flex items-center justify-between\">\n                      <span className=\"text-sm font-medium text-blue-700\">{progressMessage}</span>\n                      <span className=\"text-sm text-blue-600\">{generationProgress}%</span>\n                    </div>\n                    <Progress value={generationProgress} className=\"h-2\" />\n                  </div>\n                </CardContent>\n              </Card>\n            )}\n          </TabsContent>\n\n          <TabsContent value=\"review\" className=\"space-y-6 mt-6\">\n            {draftReport && (\n              <>\n                <div className=\"text-center mb-6\">\n                  <h2 className=\"text-2xl font-bold text-slate-900\">LIP Report</h2>\n                  <p className=\"text-slate-500\">{draftReport.reportDate}</p>\n                </div>\n\n                <Card>\n                  <CardHeader className=\"bg-slate-50\">\n                    <CardTitle className=\"flex items-center gap-2\">\n                      <User className=\"h-5 w-5 text-blue-600\" />\n                      Primary Applicant Details\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"pt-4\">\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">Customer Name</Label>\n                        <Input\n                          value={draftReport.primaryApplicant.customerName}\n                          onChange={(e) => updateField('primaryApplicant', 'customerName', e.target.value)}\n                          data-testid=\"input-customer-name\"\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">Lead ID</Label>\n                        <Input value={draftReport.leadId} disabled className=\"bg-slate-100\" />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">Mobile Number</Label>\n                        <Input\n                          value={draftReport.primaryApplicant.mobileNumber}\n                          onChange={(e) => updateField('primaryApplicant', 'mobileNumber', e.target.value)}\n                          data-testid=\"input-mobile\"\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">Email ID</Label>\n                        <Input\n                          value={draftReport.primaryApplicant.emailId}\n                          onChange={(e) => updateField('primaryApplicant', 'emailId', e.target.value)}\n                          data-testid=\"input-email\"\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">Residence Address</Label>\n                        <Textarea\n                          value={draftReport.primaryApplicant.residenceAddress}\n                          onChange={(e) => updateField('primaryApplicant', 'residenceAddress', e.target.value)}\n                          rows={2}\n                          data-testid=\"input-residence-address\"\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">Office Address</Label>\n                        <Textarea\n                          value={draftReport.primaryApplicant.officeAddress}\n                          onChange={(e) => updateField('primaryApplicant', 'officeAddress', e.target.value)}\n                          rows={2}\n                          data-testid=\"input-office-address\"\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">Spouse Name</Label>\n                        <Input\n                          value={draftReport.primaryApplicant.spouseName}\n                          onChange={(e) => updateField('primaryApplicant', 'spouseName', e.target.value)}\n                          data-testid=\"input-spouse-name\"\n                        />\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n\n                <Card>\n                  <CardHeader className=\"bg-slate-50\">\n                    <CardTitle className=\"flex items-center gap-2\">\n                      <FileText className=\"h-5 w-5 text-purple-600\" />\n                      Basic Details\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"pt-4\">\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">Branch</Label>\n                        <Input\n                          value={draftReport.basicDetails.branch}\n                          onChange={(e) => updateField('basicDetails', 'branch', e.target.value)}\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">Product Line</Label>\n                        <Input\n                          value={draftReport.basicDetails.productLine}\n                          onChange={(e) => updateField('basicDetails', 'productLine', e.target.value)}\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">Transaction Type</Label>\n                        <Input\n                          value={draftReport.basicDetails.transactionType}\n                          onChange={(e) => updateField('basicDetails', 'transactionType', e.target.value)}\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">Total Loan Amount</Label>\n                        <Input\n                          value={draftReport.basicDetails.totalLoanAmount}\n                          onChange={(e) => updateField('basicDetails', 'totalLoanAmount', e.target.value)}\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">PD Type</Label>\n                        <Input\n                          value={draftReport.basicDetails.pdType}\n                          onChange={(e) => updateField('basicDetails', 'pdType', e.target.value)}\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">Customer Profile</Label>\n                        <Input\n                          value={draftReport.basicDetails.customerProfile}\n                          onChange={(e) => updateField('basicDetails', 'customerProfile', e.target.value)}\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">Nature of Business</Label>\n                        <Input\n                          value={draftReport.basicDetails.natureOfBusiness}\n                          onChange={(e) => updateField('basicDetails', 'natureOfBusiness', e.target.value)}\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">Profession</Label>\n                        <Input\n                          value={draftReport.basicDetails.profession}\n                          onChange={(e) => updateField('basicDetails', 'profession', e.target.value)}\n                        />\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n\n                <Card>\n                  <CardHeader className=\"bg-slate-50\">\n                    <CardTitle className=\"flex items-center gap-2\">\n                      <MapPin className=\"h-5 w-5 text-red-600\" />\n                      PD Details\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"pt-4\">\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">PD Date</Label>\n                        <Input\n                          value={draftReport.pdDetails.pdDate}\n                          onChange={(e) => updateField('pdDetails', 'pdDate', e.target.value)}\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">PD Place</Label>\n                        <Input\n                          value={draftReport.pdDetails.pdPlace}\n                          onChange={(e) => updateField('pdDetails', 'pdPlace', e.target.value)}\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">Current Address</Label>\n                        <Textarea\n                          value={draftReport.pdDetails.currentAddress}\n                          onChange={(e) => updateField('pdDetails', 'currentAddress', e.target.value)}\n                          rows={2}\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">PD Done With</Label>\n                        <Input\n                          value={draftReport.pdDetails.pdDoneWith}\n                          onChange={(e) => updateField('pdDetails', 'pdDoneWith', e.target.value)}\n                        />\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n\n                <Card>\n                  <CardHeader className=\"bg-slate-50\">\n                    <CardTitle className=\"flex items-center gap-2\">\n                      <Home className=\"h-5 w-5 text-green-600\" />\n                      Personal Details\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"pt-4\">\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">Residence Type</Label>\n                        <Input\n                          value={draftReport.personalDetails.residenceType}\n                          onChange={(e) => updateField('personalDetails', 'residenceType', e.target.value)}\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">Residence Vintage</Label>\n                        <Input\n                          value={draftReport.personalDetails.residenceVintage}\n                          onChange={(e) => updateField('personalDetails', 'residenceVintage', e.target.value)}\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">Monthly Rent</Label>\n                        <Input\n                          value={draftReport.personalDetails.monthlyRent}\n                          onChange={(e) => updateField('personalDetails', 'monthlyRent', e.target.value)}\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">Total Family Members</Label>\n                        <Input\n                          value={draftReport.personalDetails.totalFamilyMembers}\n                          onChange={(e) => updateField('personalDetails', 'totalFamilyMembers', e.target.value)}\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">Dependents</Label>\n                        <Input\n                          value={draftReport.personalDetails.dependents}\n                          onChange={(e) => updateField('personalDetails', 'dependents', e.target.value)}\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">Monthly Household Expenses</Label>\n                        <Input\n                          value={draftReport.personalDetails.monthlyHouseholdExpenses}\n                          onChange={(e) => updateField('personalDetails', 'monthlyHouseholdExpenses', e.target.value)}\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">Self Education</Label>\n                        <Input\n                          value={draftReport.personalDetails.selfEducation}\n                          onChange={(e) => updateField('personalDetails', 'selfEducation', e.target.value)}\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">Spouse Education</Label>\n                        <Input\n                          value={draftReport.personalDetails.spouseEducation}\n                          onChange={(e) => updateField('personalDetails', 'spouseEducation', e.target.value)}\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">Spouse Employment</Label>\n                        <Input\n                          value={draftReport.personalDetails.spouseEmployment}\n                          onChange={(e) => updateField('personalDetails', 'spouseEmployment', e.target.value)}\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">Kids Education</Label>\n                        <Input\n                          value={draftReport.personalDetails.kidsEducation}\n                          onChange={(e) => updateField('personalDetails', 'kidsEducation', e.target.value)}\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">Kids School</Label>\n                        <Input\n                          value={draftReport.personalDetails.kidsSchool}\n                          onChange={(e) => updateField('personalDetails', 'kidsSchool', e.target.value)}\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">Spouse Name (Personal)</Label>\n                        <Input\n                          value={draftReport.personalDetails.spouseName}\n                          onChange={(e) => updateField('personalDetails', 'spouseName', e.target.value)}\n                        />\n                      </div>\n                      <div className=\"md:col-span-2 lg:col-span-3\">\n                        <Label className=\"text-xs text-slate-500\">Other Comments (Education, Age, Marital Status)</Label>\n                        <Textarea\n                          value={draftReport.personalDetails.otherComments}\n                          onChange={(e) => updateField('personalDetails', 'otherComments', e.target.value)}\n                          rows={2}\n                        />\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n\n                <Card>\n                  <CardHeader className=\"bg-slate-50\">\n                    <CardTitle className=\"flex items-center gap-2\">\n                      <Briefcase className=\"h-5 w-5 text-orange-600\" />\n                      Business Details\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"pt-4\">\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">Business Name</Label>\n                        <Input\n                          value={draftReport.businessDetails.businessName}\n                          onChange={(e) => updateField('businessDetails', 'businessName', e.target.value)}\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">Major Services</Label>\n                        <Input\n                          value={draftReport.businessDetails.majorServices}\n                          onChange={(e) => updateField('businessDetails', 'majorServices', e.target.value)}\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">Business Vintage (Months at Current Address)</Label>\n                        <Input\n                          value={draftReport.businessDetails.businessVintageMonths}\n                          onChange={(e) => updateField('businessDetails', 'businessVintageMonths', e.target.value)}\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">Total Business Vintage</Label>\n                        <Input\n                          value={draftReport.businessDetails.totalBusinessVintage}\n                          onChange={(e) => updateField('businessDetails', 'totalBusinessVintage', e.target.value)}\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">Source of Business</Label>\n                        <Input\n                          value={draftReport.businessDetails.sourceOfBusiness}\n                          onChange={(e) => updateField('businessDetails', 'sourceOfBusiness', e.target.value)}\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">Business Setup</Label>\n                        <Input\n                          value={draftReport.businessDetails.businessSetup}\n                          onChange={(e) => updateField('businessDetails', 'businessSetup', e.target.value)}\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">Monthly Rental</Label>\n                        <Input\n                          value={draftReport.businessDetails.monthlyRental}\n                          onChange={(e) => updateField('businessDetails', 'monthlyRental', e.target.value)}\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">Surrounding Area</Label>\n                        <Input\n                          value={draftReport.businessDetails.surroundingArea}\n                          onChange={(e) => updateField('businessDetails', 'surroundingArea', e.target.value)}\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">Net Monthly Income</Label>\n                        <Input\n                          value={draftReport.businessDetails.netMonthlyIncome}\n                          onChange={(e) => updateField('businessDetails', 'netMonthlyIncome', e.target.value)}\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">Comfortable EMI</Label>\n                        <Input\n                          value={draftReport.businessDetails.comfortableEmi}\n                          onChange={(e) => updateField('businessDetails', 'comfortableEmi', e.target.value)}\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">Strategic Vision / Growth Plans</Label>\n                        <Input\n                          value={draftReport.businessDetails.strategicVision}\n                          onChange={(e) => updateField('businessDetails', 'strategicVision', e.target.value)}\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">Promoter Experience (Years)</Label>\n                        <Input\n                          value={draftReport.businessDetails.promoterExperience}\n                          onChange={(e) => updateField('businessDetails', 'promoterExperience', e.target.value)}\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">Client Concentration Risk</Label>\n                        <Input\n                          value={draftReport.businessDetails.clientListConcentrationRisk}\n                          onChange={(e) => updateField('businessDetails', 'clientListConcentrationRisk', e.target.value)}\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">Seasonality</Label>\n                        <Input\n                          value={draftReport.businessDetails.seasonality}\n                          onChange={(e) => updateField('businessDetails', 'seasonality', e.target.value)}\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">Employee Count</Label>\n                        <Input\n                          value={draftReport.businessDetails.employeeCount}\n                          onChange={(e) => updateField('businessDetails', 'employeeCount', e.target.value)}\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">Monthly Turnover</Label>\n                        <Input\n                          value={draftReport.businessDetails.monthlyTurnover}\n                          onChange={(e) => updateField('businessDetails', 'monthlyTurnover', e.target.value)}\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">Major Clients</Label>\n                        <Input\n                          value={draftReport.businessDetails.majorClients}\n                          onChange={(e) => updateField('businessDetails', 'majorClients', e.target.value)}\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">Growth Plans</Label>\n                        <Input\n                          value={draftReport.businessDetails.growthPlans}\n                          onChange={(e) => updateField('businessDetails', 'growthPlans', e.target.value)}\n                        />\n                      </div>\n                      <div className=\"md:col-span-2 lg:col-span-3\">\n                        <Label className=\"text-xs text-slate-500\">Business Profile (Detailed Description)</Label>\n                        <Textarea\n                          value={draftReport.businessDetails.businessProfile}\n                          onChange={(e) => updateField('businessDetails', 'businessProfile', e.target.value)}\n                          rows={4}\n                        />\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n\n                <Card>\n                  <CardHeader className=\"bg-slate-50\">\n                    <CardTitle className=\"flex items-center gap-2\">\n                      <Building className=\"h-5 w-5 text-blue-600\" />\n                      Banking Details\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"pt-4\">\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">Primary Bank Name</Label>\n                        <Input\n                          value={draftReport.bankingDetails?.bankName || ''}\n                          onChange={(e) => updateField('bankingDetails', 'bankName', e.target.value)}\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">Turnover Credit %</Label>\n                        <Input\n                          value={draftReport.bankingDetails?.turnoverCreditPercent || ''}\n                          onChange={(e) => updateField('bankingDetails', 'turnoverCreditPercent', e.target.value)}\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">Banking Tenure (Years)</Label>\n                        <Input\n                          value={draftReport.bankingDetails?.bankingTenure || ''}\n                          onChange={(e) => updateField('bankingDetails', 'bankingTenure', e.target.value)}\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">EMIs Routed via Bank</Label>\n                        <Input\n                          value={draftReport.bankingDetails?.emisRouted || ''}\n                          onChange={(e) => updateField('bankingDetails', 'emisRouted', e.target.value)}\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">QR Code Spotted</Label>\n                        <Input\n                          value={draftReport.bankingDetails?.qrCodeSpotted || ''}\n                          onChange={(e) => updateField('bankingDetails', 'qrCodeSpotted', e.target.value)}\n                        />\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n\n                <Card>\n                  <CardHeader className=\"bg-slate-50\">\n                    <CardTitle className=\"flex items-center gap-2\">\n                      <FileText className=\"h-5 w-5 text-red-600\" />\n                      Debt Details\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"pt-4\">\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">Existing Loans (Yes/No)</Label>\n                        <Input\n                          value={draftReport.debtDetails?.existingLoans || ''}\n                          onChange={(e) => updateField('debtDetails', 'existingLoans', e.target.value)}\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">Repayment History</Label>\n                        <Input\n                          value={draftReport.debtDetails?.repaymentHistory || ''}\n                          onChange={(e) => updateField('debtDetails', 'repaymentHistory', e.target.value)}\n                        />\n                      </div>\n                      <div className=\"md:col-span-2 lg:col-span-3\">\n                        <Label className=\"text-xs text-slate-500\">Loan List (Details of existing loans)</Label>\n                        <Textarea\n                          value={draftReport.debtDetails?.loanList || ''}\n                          onChange={(e) => updateField('debtDetails', 'loanList', e.target.value)}\n                          rows={2}\n                        />\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n\n                <Card>\n                  <CardHeader className=\"bg-slate-50\">\n                    <CardTitle className=\"flex items-center gap-2\">\n                      <Users className=\"h-5 w-5 text-cyan-600\" />\n                      Reference Checks\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"pt-4\">\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                      <div className=\"space-y-3 p-4 bg-slate-50 rounded-lg\">\n                        <h4 className=\"font-medium\">Reference 1</h4>\n                        <div className=\"space-y-2\">\n                          <div>\n                            <Label className=\"text-xs text-slate-500\">Type</Label>\n                            <Input\n                              value={draftReport.referenceChecks.reference1.type}\n                              onChange={(e) => updateReferenceField('reference1', 'type', e.target.value)}\n                            />\n                          </div>\n                          <div>\n                            <Label className=\"text-xs text-slate-500\">Name</Label>\n                            <Input\n                              value={draftReport.referenceChecks.reference1.name}\n                              onChange={(e) => updateReferenceField('reference1', 'name', e.target.value)}\n                            />\n                          </div>\n                          <div>\n                            <Label className=\"text-xs text-slate-500\">Contact</Label>\n                            <Input\n                              value={draftReport.referenceChecks.reference1.contact}\n                              onChange={(e) => updateReferenceField('reference1', 'contact', e.target.value)}\n                            />\n                          </div>\n                          <div>\n                            <Label className=\"text-xs text-slate-500\">Feedback</Label>\n                            <Input\n                              value={draftReport.referenceChecks.reference1.feedback}\n                              onChange={(e) => updateReferenceField('reference1', 'feedback', e.target.value)}\n                            />\n                          </div>\n                          <div>\n                            <Label className=\"text-xs text-slate-500\">Remarks</Label>\n                            <Textarea\n                              value={draftReport.referenceChecks.reference1.remarks}\n                              onChange={(e) => updateReferenceField('reference1', 'remarks', e.target.value)}\n                              rows={2}\n                            />\n                          </div>\n                        </div>\n                      </div>\n                      <div className=\"space-y-3 p-4 bg-slate-50 rounded-lg\">\n                        <h4 className=\"font-medium\">Reference 2</h4>\n                        <div className=\"space-y-2\">\n                          <div>\n                            <Label className=\"text-xs text-slate-500\">Type</Label>\n                            <Input\n                              value={draftReport.referenceChecks.reference2.type}\n                              onChange={(e) => updateReferenceField('reference2', 'type', e.target.value)}\n                            />\n                          </div>\n                          <div>\n                            <Label className=\"text-xs text-slate-500\">Name</Label>\n                            <Input\n                              value={draftReport.referenceChecks.reference2.name}\n                              onChange={(e) => updateReferenceField('reference2', 'name', e.target.value)}\n                            />\n                          </div>\n                          <div>\n                            <Label className=\"text-xs text-slate-500\">Contact</Label>\n                            <Input\n                              value={draftReport.referenceChecks.reference2.contact}\n                              onChange={(e) => updateReferenceField('reference2', 'contact', e.target.value)}\n                            />\n                          </div>\n                          <div>\n                            <Label className=\"text-xs text-slate-500\">Feedback</Label>\n                            <Input\n                              value={draftReport.referenceChecks.reference2.feedback}\n                              onChange={(e) => updateReferenceField('reference2', 'feedback', e.target.value)}\n                            />\n                          </div>\n                          <div>\n                            <Label className=\"text-xs text-slate-500\">Remarks</Label>\n                            <Textarea\n                              value={draftReport.referenceChecks.reference2.remarks}\n                              onChange={(e) => updateReferenceField('reference2', 'remarks', e.target.value)}\n                              rows={2}\n                            />\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                    <div className=\"mt-4 pt-4 border-t\">\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">Invoice/Document Verified</Label>\n                        <Input\n                          value={draftReport.referenceChecks.invoiceVerified}\n                          onChange={(e) => updateField('referenceChecks', 'invoiceVerified', e.target.value)}\n                        />\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n\n                <Card>\n                  <CardHeader className=\"bg-slate-50\">\n                    <CardTitle className=\"flex items-center gap-2\">\n                      <Building className=\"h-5 w-5 text-amber-600\" />\n                      Property Details\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"pt-4\">\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">Property Type</Label>\n                        <Input\n                          value={draftReport.propertyDetails.propertyType}\n                          onChange={(e) => updateField('propertyDetails', 'propertyType', e.target.value)}\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">Approx Area (Sq Ft)</Label>\n                        <Input\n                          value={draftReport.propertyDetails.approxArea}\n                          onChange={(e) => updateField('propertyDetails', 'approxArea', e.target.value)}\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">Property Usage</Label>\n                        <Input\n                          value={draftReport.propertyDetails.propertyUsage}\n                          onChange={(e) => updateField('propertyDetails', 'propertyUsage', e.target.value)}\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">Approx Valuation</Label>\n                        <Input\n                          value={draftReport.propertyDetails.approxValuation}\n                          onChange={(e) => updateField('propertyDetails', 'approxValuation', e.target.value)}\n                        />\n                      </div>\n                      <div className=\"md:col-span-2\">\n                        <Label className=\"text-xs text-slate-500\">Property Address</Label>\n                        <Input\n                          value={draftReport.propertyDetails.propertyAddress}\n                          onChange={(e) => updateField('propertyDetails', 'propertyAddress', e.target.value)}\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">Properties Owned (Count)</Label>\n                        <Input\n                          value={draftReport.propertyDetails.propertiesOwned}\n                          onChange={(e) => updateField('propertyDetails', 'propertiesOwned', e.target.value)}\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">Vehicles Owned (Count)</Label>\n                        <Input\n                          value={draftReport.propertyDetails.vehiclesOwned}\n                          onChange={(e) => updateField('propertyDetails', 'vehiclesOwned', e.target.value)}\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">Other Investments</Label>\n                        <Input\n                          value={draftReport.propertyDetails.otherInvestments}\n                          onChange={(e) => updateField('propertyDetails', 'otherInvestments', e.target.value)}\n                        />\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n\n                <Card>\n                  <CardHeader className=\"bg-slate-50\">\n                    <CardTitle className=\"flex items-center gap-2\">\n                      <FileText className=\"h-5 w-5 text-indigo-600\" />\n                      Summary\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"pt-4 space-y-4\">\n                    <div>\n                      <Label className=\"text-xs text-slate-500\">Overall Summary (Risk/Mitigant, End Use Comments)</Label>\n                      <Textarea\n                        value={draftReport.summary.overallSummary}\n                        onChange={(e) => updateField('summary', 'overallSummary', e.target.value)}\n                        rows={4}\n                      />\n                    </div>\n                    <div>\n                      <Label className=\"text-xs text-slate-500\">Risk Mitigants</Label>\n                      <Textarea\n                        value={draftReport.summary.riskMitigants}\n                        onChange={(e) => updateField('summary', 'riskMitigants', e.target.value)}\n                        rows={2}\n                      />\n                    </div>\n                  </CardContent>\n                </Card>\n\n                <Card>\n                  <CardHeader className=\"bg-slate-50\">\n                    <CardTitle className=\"flex items-center gap-2\">\n                      <CheckCircle className=\"h-5 w-5 text-teal-600\" />\n                      End Use & Recommendation\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"pt-4 space-y-4\">\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">Purpose of Loan</Label>\n                        <Input\n                          value={draftReport.endUseDetails.purposeOfLoan}\n                          onChange={(e) => updateField('endUseDetails', 'purposeOfLoan', e.target.value)}\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">End Use</Label>\n                        <Input\n                          value={draftReport.endUseDetails.endUse}\n                          onChange={(e) => updateField('endUseDetails', 'endUse', e.target.value)}\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">Agreement Value</Label>\n                        <Input\n                          value={draftReport.endUseDetails.agreementValue}\n                          onChange={(e) => updateField('endUseDetails', 'agreementValue', e.target.value)}\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs text-slate-500\">Advance Paid</Label>\n                        <Input\n                          value={draftReport.endUseDetails.advancePaid}\n                          onChange={(e) => updateField('endUseDetails', 'advancePaid', e.target.value)}\n                        />\n                      </div>\n                    </div>\n                    <div>\n                      <Label className=\"text-xs text-slate-500\">Customer Profile Status (Recommendation)</Label>\n                      <div className=\"flex gap-2 mt-2\">\n                        {['Positive', 'Negative', 'Refer'].map((status) => (\n                          <Button\n                            key={status}\n                            variant={draftReport.recommendation === status ? 'default' : 'outline'}\n                            className={draftReport.recommendation === status ? \n                              (status === 'Positive' ? 'bg-green-600' : status === 'Negative' ? 'bg-red-600' : 'bg-amber-600') : ''\n                            }\n                            onClick={() => setDraftReport({...draftReport, recommendation: status})}\n                          >\n                            {status}\n                          </Button>\n                        ))}\n                      </div>\n                    </div>\n                    <div>\n                      <Label className=\"text-xs text-slate-500\">Remarks</Label>\n                      <Textarea\n                        value={draftReport.remarks}\n                        onChange={(e) => setDraftReport({...draftReport, remarks: e.target.value})}\n                        rows={2}\n                      />\n                    </div>\n                  </CardContent>\n                </Card>\n\n                <div className=\"flex justify-between\">\n                  <Button variant=\"outline\" onClick={() => setActiveTab(\"upload\")} data-testid=\"button-back-to-upload\">\n                    Back to Upload\n                  </Button>\n                  <div className=\"flex gap-3\">\n                    <Button \n                      size=\"lg\" \n                      variant=\"outline\"\n                      onClick={downloadDraftPdf} \n                      disabled={isDownloading}\n                      className=\"gap-2\" \n                      data-testid=\"button-download-draft\"\n                    >\n                      {isDownloading ? (\n                        <Loader2 className=\"h-5 w-5 animate-spin\" />\n                      ) : (\n                        <Download className=\"h-5 w-5\" />\n                      )}\n                      Download PDF\n                    </Button>\n                    <Button size=\"lg\" onClick={submitReport} className=\"gap-2\" data-testid=\"button-submit-report\">\n                      <Send className=\"h-5 w-5\" />\n                      Submit LIP Report\n                    </Button>\n                  </div>\n                </div>\n              </>\n            )}\n          </TabsContent>\n        </Tabs>\n      </div>\n    </AuditLayout>\n  );\n}\n","path":null,"size_bytes":62412,"size_tokens":null},"client/src/pages/associates.tsx":{"content":"import AuditLayout from \"@/components/layout/audit-layout\";\nimport { useAudit } from \"@/lib/audit-context\";\nimport { useAuth } from \"@/lib/auth\";\nimport { Card } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Trash2, UserPlus } from \"lucide-react\";\nimport { useState } from \"react\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n  AlertDialogTrigger,\n} from \"@/components/ui/alert-dialog\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport { useToast } from \"@/hooks/use-toast\";\n\nexport default function AssociatesPage() {\n  const { associates } = useAudit();\n  const { user } = useAuth();\n  const [deletingId, setDeletingId] = useState<string | null>(null);\n  const [isAddOpen, setIsAddOpen] = useState(false);\n  const [isAdding, setIsAdding] = useState(false);\n  const [newAssociate, setNewAssociate] = useState({\n    name: '',\n    username: '',\n    password: '',\n  });\n  const { toast } = useToast();\n\n  const handleDelete = async (id: string, name: string) => {\n    if (id === 'ADMIN') {\n      toast({\n        title: \"Cannot Delete\",\n        description: \"Admin user cannot be deleted.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setDeletingId(id);\n    try {\n      const response = await fetch(`/api/associates/${id}`, {\n        method: 'DELETE',\n        credentials: 'include',\n      });\n\n      if (response.ok) {\n        toast({\n          title: \"Associate Deleted\",\n          description: `${name} has been removed from the system.`,\n        });\n        window.location.reload();\n      } else {\n        const error = await response.json();\n        toast({\n          title: \"Delete Failed\",\n          description: error.error || \"Failed to delete associate.\",\n          variant: \"destructive\",\n        });\n      }\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"An error occurred while deleting the associate.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setDeletingId(null);\n    }\n  };\n\n  const handleAdd = async () => {\n    if (!newAssociate.name || !newAssociate.username || !newAssociate.password) {\n      toast({\n        title: \"Missing Fields\",\n        description: \"Please fill in all required fields.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setIsAdding(true);\n    try {\n      const response = await fetch('/api/associates', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        credentials: 'include',\n        body: JSON.stringify(newAssociate),\n      });\n\n      if (response.ok) {\n        toast({\n          title: \"Associate Created\",\n          description: `${newAssociate.name} has been added successfully.`,\n        });\n        setIsAddOpen(false);\n        setNewAssociate({ name: '', username: '', password: '' });\n        window.location.reload();\n      } else {\n        const error = await response.json();\n        toast({\n          title: \"Creation Failed\",\n          description: error.error || \"Failed to create associate.\",\n          variant: \"destructive\",\n        });\n      }\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"An error occurred while creating the associate.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsAdding(false);\n    }\n  };\n\n  const isAdmin = user?.id === 'ADMIN' || user?.isAdmin;\n\n  return (\n    <AuditLayout>\n      <div className=\"space-y-6\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-2xl font-bold\" data-testid=\"text-page-title\">Associates Management</h1>\n            <p className=\"text-muted-foreground\">Manage verification officers and their access</p>\n          </div>\n          \n          {isAdmin && (\n            <Dialog open={isAddOpen} onOpenChange={setIsAddOpen}>\n              <DialogTrigger asChild>\n                <Button data-testid=\"button-add-associate\">\n                  <UserPlus className=\"h-4 w-4 mr-2\" />\n                  Add Associate\n                </Button>\n              </DialogTrigger>\n              <DialogContent>\n                <DialogHeader>\n                  <DialogTitle>Add New Associate</DialogTitle>\n                  <DialogDescription>\n                    Create a new verification officer account.\n                  </DialogDescription>\n                </DialogHeader>\n                <div className=\"space-y-4 py-4\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"name\">Full Name</Label>\n                    <Input\n                      id=\"name\"\n                      placeholder=\"Enter full name\"\n                      value={newAssociate.name}\n                      onChange={(e) => setNewAssociate(prev => ({ ...prev, name: e.target.value }))}\n                      data-testid=\"input-name\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"username\">Username</Label>\n                    <Input\n                      id=\"username\"\n                      placeholder=\"Enter username\"\n                      value={newAssociate.username}\n                      onChange={(e) => setNewAssociate(prev => ({ ...prev, username: e.target.value }))}\n                      data-testid=\"input-username\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"password\">Password</Label>\n                    <Input\n                      id=\"password\"\n                      type=\"password\"\n                      placeholder=\"Enter password\"\n                      value={newAssociate.password}\n                      onChange={(e) => setNewAssociate(prev => ({ ...prev, password: e.target.value }))}\n                      data-testid=\"input-password\"\n                    />\n                  </div>\n                </div>\n                <DialogFooter>\n                  <Button variant=\"outline\" onClick={() => setIsAddOpen(false)}>\n                    Cancel\n                  </Button>\n                  <Button onClick={handleAdd} disabled={isAdding} data-testid=\"button-confirm-add\">\n                    {isAdding ? \"Creating...\" : \"Create Associate\"}\n                  </Button>\n                </DialogFooter>\n              </DialogContent>\n            </Dialog>\n          )}\n        </div>\n\n        <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\n          {associates.map((associate) => (\n            <Card key={associate.id} className=\"p-4\" data-testid={`card-associate-${associate.id}`}>\n              <div className=\"flex items-start justify-between\">\n                <div className=\"flex items-center gap-3\">\n                  <Avatar className=\"h-12 w-12\">\n                    <AvatarImage src={associate.avatar || ''} alt={associate.name} />\n                    <AvatarFallback>{associate.name?.charAt(0) || 'U'}</AvatarFallback>\n                  </Avatar>\n                  <div>\n                    <h3 className=\"font-semibold\" data-testid={`text-name-${associate.id}`}>{associate.name}</h3>\n                    <p className=\"text-sm text-muted-foreground\">{associate.role}</p>\n                    <p className=\"text-xs text-muted-foreground\">@{associate.username}</p>\n                  </div>\n                </div>\n                \n                {isAdmin && associate.id !== 'ADMIN' && (\n                  <AlertDialog>\n                    <AlertDialogTrigger asChild>\n                      <Button \n                        variant=\"ghost\" \n                        size=\"icon\" \n                        className=\"text-destructive hover:text-destructive hover:bg-destructive/10\"\n                        data-testid={`button-delete-${associate.id}`}\n                      >\n                        <Trash2 className=\"h-4 w-4\" />\n                      </Button>\n                    </AlertDialogTrigger>\n                    <AlertDialogContent>\n                      <AlertDialogHeader>\n                        <AlertDialogTitle>Delete Associate?</AlertDialogTitle>\n                        <AlertDialogDescription>\n                          Are you sure you want to delete <strong>{associate.name}</strong>? \n                          This action cannot be undone. All reports associated with this user will remain but the user will no longer be able to log in.\n                        </AlertDialogDescription>\n                      </AlertDialogHeader>\n                      <AlertDialogFooter>\n                        <AlertDialogCancel>Cancel</AlertDialogCancel>\n                        <AlertDialogAction\n                          onClick={() => handleDelete(associate.id, associate.name)}\n                          className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n                          disabled={deletingId === associate.id}\n                        >\n                          {deletingId === associate.id ? \"Deleting...\" : \"Delete\"}\n                        </AlertDialogAction>\n                      </AlertDialogFooter>\n                    </AlertDialogContent>\n                  </AlertDialog>\n                )}\n              </div>\n            </Card>\n          ))}\n        </div>\n\n        {associates.length === 0 && (\n          <Card className=\"p-8 text-center\">\n            <p className=\"text-muted-foreground\">No associates found.</p>\n          </Card>\n        )}\n      </div>\n    </AuditLayout>\n  );\n}\n","path":null,"size_bytes":9877,"size_tokens":null},"server/gmail-oauth.ts":{"content":"import { google } from \"googleapis\";\n\nexport interface LoanProposalEmail {\n  id: string;\n  subject: string;\n  from: string;\n  snippet: string;\n  date: string;\n  threadId?: string;\n}\n\nlet oAuth2Client: InstanceType<typeof google.auth.OAuth2> | null = null;\n\nfunction getOAuthClient() {\n  if (!oAuth2Client) {\n    const clientId = process.env.GMAIL_CLIENT_ID;\n    const clientSecret = process.env.GMAIL_CLIENT_SECRET;\n    const redirectUri = process.env.GMAIL_REDIRECT_URI || \"https://developers.google.com/oauthplayground\";\n\n    if (!clientId || !clientSecret) {\n      throw new Error(\"Gmail OAuth credentials not configured. Set GMAIL_CLIENT_ID and GMAIL_CLIENT_SECRET.\");\n    }\n\n    oAuth2Client = new google.auth.OAuth2(clientId, clientSecret, redirectUri);\n\n    const tokenJson = process.env.GMAIL_TOKEN;\n    if (tokenJson) {\n      try {\n        const tokens = JSON.parse(tokenJson);\n        oAuth2Client.setCredentials(tokens);\n      } catch (e) {\n        console.error(\"Failed to parse GMAIL_TOKEN:\", e);\n      }\n    }\n  }\n  return oAuth2Client;\n}\n\nexport function isGmailOAuthConfigured(): boolean {\n  return !!(process.env.GMAIL_CLIENT_ID && process.env.GMAIL_CLIENT_SECRET && process.env.GMAIL_TOKEN);\n}\n\nexport async function fetchLoanProposalsByQuery(\n  query: string = \"subject:Loan Proposal\",\n  maxResults: number = 10\n): Promise<LoanProposalEmail[]> {\n  const auth = getOAuthClient();\n  const gmail = google.gmail({ version: \"v1\", auth });\n\n  const res = await gmail.users.messages.list({\n    userId: \"me\",\n    q: query,\n    maxResults,\n  });\n\n  const messages = res.data.messages || [];\n  const results: LoanProposalEmail[] = [];\n\n  for (const msg of messages) {\n    if (!msg.id) continue;\n\n    const full = await gmail.users.messages.get({ userId: \"me\", id: msg.id });\n    const headers = full.data.payload?.headers || [];\n    \n    const subject = headers.find(h => h.name === \"Subject\")?.value || \"\";\n    const from = headers.find(h => h.name === \"From\")?.value || \"\";\n    const date = headers.find(h => h.name === \"Date\")?.value || \"\";\n\n    results.push({\n      id: msg.id,\n      subject,\n      from,\n      snippet: full.data.snippet || \"\",\n      date,\n      threadId: msg.threadId || undefined,\n    });\n  }\n\n  return results;\n}\n\nexport async function searchEmailsByLeadId(leadId: string): Promise<LoanProposalEmail[]> {\n  return fetchLoanProposalsByQuery(`subject:${leadId}`, 5);\n}\n\nexport async function getEmailContent(messageId: string): Promise<{\n  subject: string;\n  from: string;\n  date: string;\n  body: string;\n}> {\n  const auth = getOAuthClient();\n  const gmail = google.gmail({ version: \"v1\", auth });\n\n  const full = await gmail.users.messages.get({ \n    userId: \"me\", \n    id: messageId,\n    format: \"full\"\n  });\n\n  const headers = full.data.payload?.headers || [];\n  const subject = headers.find(h => h.name === \"Subject\")?.value || \"\";\n  const from = headers.find(h => h.name === \"From\")?.value || \"\";\n  const date = headers.find(h => h.name === \"Date\")?.value || \"\";\n\n  let body = \"\";\n  const payload = full.data.payload;\n  \n  if (payload?.body?.data) {\n    body = Buffer.from(payload.body.data, \"base64\").toString(\"utf-8\");\n  } else if (payload?.parts) {\n    const textPart = payload.parts.find(p => p.mimeType === \"text/plain\");\n    if (textPart?.body?.data) {\n      body = Buffer.from(textPart.body.data, \"base64\").toString(\"utf-8\");\n    }\n  }\n\n  return { subject, from, date, body };\n}\n","path":null,"size_bytes":3422,"size_tokens":null},"server/ai-scoring.ts":{"content":"import OpenAI from \"openai\";\nimport type { ComprehensiveScoreResult } from \"./openrouter\";\n\nlet openaiClient: OpenAI | null = null;\n\nfunction getClient(): OpenAI {\n  if (!openaiClient) {\n    const baseURL = process.env.AI_INTEGRATIONS_OPENROUTER_BASE_URL || \"https://openrouter.ai/api/v1\";\n    const apiKey = process.env.OPENROUTER_API_KEY || process.env.AI_INTEGRATIONS_OPENROUTER_API_KEY;\n    \n    if (!apiKey) {\n      throw new Error(\"No OpenRouter API key configured\");\n    }\n    \n    openaiClient = new OpenAI({ baseURL, apiKey });\n  }\n  return openaiClient;\n}\n\nexport function isAIConfigured(): boolean {\n  const apiKey = process.env.OPENROUTER_API_KEY || process.env.AI_INTEGRATIONS_OPENROUTER_API_KEY;\n  return !!apiKey;\n}\n\n// Exact scoring weights from the Excel rubric\nconst WEIGHTS = {\n  personal: {\n    selfEducation: 1.5,\n    spouseName: 1.5,\n    spouseEducation: 1.5,\n    spouseEmployment: 1.5,\n    mentionAboutKids: 1.5,\n    kidsEducation: 1.5,\n    kidsSchool: 1.5,\n    residenceVintage: 1.5,\n    monthlyRentIfRented: 1.5,\n    residenceOwnedOrRented: 1.5,\n  }, // Max 15\n  business: {\n    businessName: 2,\n    natureOfBusiness: 2,\n    existenceCurrentPlace: 2,\n    licensesRegistrations: 2,\n    promoterExperience: 2,\n    strategicVision: 2,\n    employeesSeen: 2,\n    monthlyTurnover: 2,\n    clientList: 2,\n    activityDuringVisit: 2,\n    monthlyIncome: 2,\n    seasonality: 2,\n    infrastructure: 2,\n  }, // Max 26\n  businessMfg: {\n    mfgRawMaterial: 0.5,\n    mfgProcessFlow: 1,\n    mfgCapacity: 0.5,\n    mfgMachinery: 1,\n    mfgInventory: 0.5,\n    mfgQualityControl: 0.5,\n  }, // Max 4\n  businessTrading: {\n    tradingProductRange: 1,\n    tradingPurchaseCycle: 2,\n    tradingWarehouse: 1,\n  }, // Max 4\n  businessService: {\n    svcDocumentation: 1,\n    svcTechnology: 1,\n    svcContracts: 1,\n    svcContractBased: 1,\n  }, // Max 4\n  banking: {\n    primaryBankerName: 3,\n    turnoverCreditedPercent: 3,\n    bankingTenure: 3,\n    emisRoutedBank: 3,\n    qrCodeSpotted: 3,\n  }, // Max 15\n  networth: {\n    propertiesOwned: 2.5,\n    vehiclesOwned: 2.5,\n    otherInvestments: 2.5,\n    businessPlaceOwned: 2.5,\n    totalNetworthAvailable: 2.5,\n  }, // Max 10 (capped)\n  existingDebt: {\n    hasExistingLoans: 2,\n    loanListAvailable: 2,\n    canServiceNewLoan: 2,\n    repaymentHistoryQuality: 2,\n    loansSourceBankNature: 2,\n  }, // Max 10\n  endUseHomeLoan: {\n    agreementValueAvailable: 3,\n    advancePaidAmount: 3,\n    willOccupyPostPurchase: 4,\n  }, // Max 10\n  endUseMortgage: {\n    mortgageFundsUse: 5,\n    additionalUseInformation: 5,\n  }, // Max 10\n  referenceChecks: {\n    personalRefNeighbours: 4,\n    businessRefBuyersSellers: 3,\n    invoiceVerification: 3,\n  }, // Max 10\n};\n\nfunction calculateScore(matches: Record<string, boolean>, weights: Record<string, number>): number {\n  let score = 0;\n  for (const [key, weight] of Object.entries(weights)) {\n    if (matches[key] === true) {\n      score += weight;\n    }\n  }\n  return Math.round(score * 100) / 100;\n}\n\nexport async function scoreComprehensiveWithAI(pdfText: string, leadId: string): Promise<ComprehensiveScoreResult> {\n  console.log(`[AI Scoring - ${leadId}] Starting holistic AI scoring, text length: ${pdfText.length}`);\n  const startTime = Date.now();\n  \n  const client = getClient();\n  \n  // Truncate PDF text to fit within context limits\n  const maxTextLength = 12000;\n  const truncatedText = pdfText.length > maxTextLength \n    ? pdfText.substring(0, maxTextLength) + \"\\n...[Report truncated]...\"\n    : pdfText;\n\n  const prompt = `You are an expert audit report analyzer. Read the COMPLETE report below and identify what information is ACTUALLY PRESENT.\n\nIMPORTANT: Only mark an item as TRUE if the specific information is CLEARLY DOCUMENTED in the report. Do NOT assume or infer - only mark TRUE for explicitly stated information.\n\n=== AUDIT REPORT ===\n${truncatedText}\n=== END OF REPORT ===\n\nAnalyze the report and respond with ONLY a JSON object (no markdown):\n{\n  \"businessType\": \"manufacturing\" | \"trading\" | \"service\" | \"unknown\",\n  \"loanType\": \"home_loan\" | \"mortgage\" | \"unknown\",\n  \"personal\": {\n    \"selfEducation\": true/false,\n    \"spouseName\": true/false,\n    \"spouseEducation\": true/false,\n    \"spouseEmployment\": true/false,\n    \"mentionAboutKids\": true/false,\n    \"kidsEducation\": true/false,\n    \"kidsSchool\": true/false,\n    \"residenceVintage\": true/false,\n    \"monthlyRentIfRented\": true/false,\n    \"residenceOwnedOrRented\": true/false\n  },\n  \"business\": {\n    \"businessName\": true/false,\n    \"natureOfBusiness\": true/false,\n    \"existenceCurrentPlace\": true/false,\n    \"licensesRegistrations\": true/false,\n    \"promoterExperience\": true/false,\n    \"strategicVision\": true/false,\n    \"employeesSeen\": true/false,\n    \"monthlyTurnover\": true/false,\n    \"clientList\": true/false,\n    \"activityDuringVisit\": true/false,\n    \"monthlyIncome\": true/false,\n    \"seasonality\": true/false,\n    \"infrastructure\": true/false,\n    \"mfgRawMaterial\": true/false,\n    \"mfgProcessFlow\": true/false,\n    \"mfgCapacity\": true/false,\n    \"mfgMachinery\": true/false,\n    \"mfgInventory\": true/false,\n    \"mfgQualityControl\": true/false,\n    \"tradingProductRange\": true/false,\n    \"tradingPurchaseCycle\": true/false,\n    \"tradingWarehouse\": true/false,\n    \"svcDocumentation\": true/false,\n    \"svcTechnology\": true/false,\n    \"svcContracts\": true/false,\n    \"svcContractBased\": true/false\n  },\n  \"banking\": {\n    \"primaryBankerName\": true/false,\n    \"turnoverCreditedPercent\": true/false,\n    \"bankingTenure\": true/false,\n    \"emisRoutedBank\": true/false,\n    \"qrCodeSpotted\": true/false\n  },\n  \"networth\": {\n    \"propertiesOwned\": true/false,\n    \"vehiclesOwned\": true/false,\n    \"otherInvestments\": true/false,\n    \"businessPlaceOwned\": true/false,\n    \"totalNetworthAvailable\": true/false\n  },\n  \"existingDebt\": {\n    \"hasExistingLoans\": true/false,\n    \"loanListAvailable\": true/false,\n    \"canServiceNewLoan\": true/false,\n    \"repaymentHistoryQuality\": true/false,\n    \"loansSourceBankNature\": true/false\n  },\n  \"endUse\": {\n    \"agreementValueAvailable\": true/false,\n    \"advancePaidAmount\": true/false,\n    \"willOccupyPostPurchase\": true/false,\n    \"mortgageFundsUse\": true/false,\n    \"additionalUseInformation\": true/false\n  },\n  \"referenceChecks\": {\n    \"personalRefNeighbours\": true/false,\n    \"businessRefBuyersSellers\": true/false,\n    \"invoiceVerification\": true/false\n  },\n  \"summary\": \"<one sentence summary>\"\n}`;\n\n  try {\n    const response = await client.chat.completions.create({\n      model: \"anthropic/claude-3-haiku\",\n      messages: [{ role: \"user\", content: prompt }],\n      max_tokens: 2048,\n      temperature: 0,\n    });\n    \n    const content = response.choices[0]?.message?.content || \"{}\";\n    console.log(`[AI Scoring - ${leadId}] Raw response length: ${content.length}`);\n    \n    const jsonMatch = content.match(/\\{[\\s\\S]*\\}/);\n    if (!jsonMatch) {\n      throw new Error(\"No valid JSON in AI response\");\n    }\n    \n    const parsed = JSON.parse(jsonMatch[0]);\n    const totalTime = Date.now() - startTime;\n    \n    // Calculate scores from boolean matches using exact weights\n    const personalMatches = parsed.personal || {};\n    const businessMatches = parsed.business || {};\n    const bankingMatches = parsed.banking || {};\n    const networthMatches = parsed.networth || {};\n    const debtMatches = parsed.existingDebt || {};\n    const endUseMatches = parsed.endUse || {};\n    const refMatches = parsed.referenceChecks || {};\n    \n    const personalScore = calculateScore(personalMatches, WEIGHTS.personal);\n    \n    // Business score: core + type-specific\n    let businessScore = calculateScore(businessMatches, WEIGHTS.business);\n    const businessType = parsed.businessType || \"unknown\";\n    if (businessType === \"manufacturing\") {\n      businessScore += calculateScore(businessMatches, WEIGHTS.businessMfg);\n    } else if (businessType === \"trading\") {\n      businessScore += calculateScore(businessMatches, WEIGHTS.businessTrading);\n    } else if (businessType === \"service\") {\n      businessScore += calculateScore(businessMatches, WEIGHTS.businessService);\n    }\n    businessScore = Math.min(businessScore, 30);\n    \n    const bankingScore = Math.min(calculateScore(bankingMatches, WEIGHTS.banking), 15);\n    const rawNetworthScore = calculateScore(networthMatches, WEIGHTS.networth);\n    const networthScore = Math.min(rawNetworthScore, 10); // Cap at 10 since 5 items  2.5 = 12.5\n    const debtScore = Math.min(calculateScore(debtMatches, WEIGHTS.existingDebt), 10);\n    \n    // Debug logging to trace exact values\n    const networthChecks = Object.values(networthMatches).filter(v => v === true).length;\n    console.log(`[AI Scoring - ${leadId}] Networth matches:`, JSON.stringify(networthMatches));\n    console.log(`[AI Scoring - ${leadId}] Networth: ${networthChecks} items  2.5pts = ${rawNetworthScore}, capped to ${networthScore}/10`);\n    \n    // End use score: depends on loan type\n    const loanType = parsed.loanType || \"unknown\";\n    let endUseScore = 0;\n    const homeLoanScore = calculateScore(endUseMatches, WEIGHTS.endUseHomeLoan);\n    const mortgageScore = calculateScore(endUseMatches, WEIGHTS.endUseMortgage);\n    \n    if (loanType === \"home_loan\") {\n      endUseScore = homeLoanScore;\n    } else if (loanType === \"mortgage\") {\n      endUseScore = mortgageScore;\n    } else {\n      // Use whichever gives higher score\n      endUseScore = Math.max(homeLoanScore, mortgageScore);\n    }\n    endUseScore = Math.min(endUseScore, 10);\n    \n    // Debug logging for End Use\n    const endUseChecks = Object.values(endUseMatches).filter(v => v === true).length;\n    console.log(`[AI Scoring - ${leadId}] End Use matches:`, JSON.stringify(endUseMatches));\n    console.log(`[AI Scoring - ${leadId}] End Use: ${endUseChecks} checks, loanType=${loanType}, homeLoan=${homeLoanScore}, mortgage=${mortgageScore}, final=${endUseScore}/10`);\n    \n    const refScore = Math.min(calculateScore(refMatches, WEIGHTS.referenceChecks), 10);\n    const refChecks = Object.values(refMatches).filter(v => v === true).length;\n    console.log(`[AI Scoring - ${leadId}] Reference: ${refChecks} checks, score=${refScore}/10`);\n    \n    const totalScore = personalScore + businessScore + bankingScore + networthScore + debtScore + endUseScore + refScore;\n    \n    const rationale = `AI scoring completed in ${totalTime}ms. Total: ${totalScore}/100. ` +\n      `Business: ${businessType}. ${parsed.summary || ''}`;\n    \n    console.log(`[AI Scoring - ${leadId}] Scores: Personal=${personalScore}/15, Business=${businessScore}/30, Banking=${bankingScore}/15, Networth=${networthScore}/10, Debt=${debtScore}/10, EndUse=${endUseScore}/10, Ref=${refScore}/10`);\n\n    return {\n      personal: personalScore,\n      business: businessScore,\n      banking: bankingScore,\n      networth: networthScore,\n      existingDebt: debtScore,\n      endUse: endUseScore,\n      referenceChecks: refScore,\n      personalMatches: {\n        selfEducation: personalMatches.selfEducation || false,\n        spouseName: personalMatches.spouseName || false,\n        spouseEducation: personalMatches.spouseEducation || false,\n        spouseEmployment: personalMatches.spouseEmployment || false,\n        mentionAboutKids: personalMatches.mentionAboutKids || false,\n        kidsEducation: personalMatches.kidsEducation || false,\n        kidsSchool: personalMatches.kidsSchool || false,\n        residenceVintage: personalMatches.residenceVintage || false,\n        monthlyRentIfRented: personalMatches.monthlyRentIfRented || false,\n        residenceOwnedOrRented: personalMatches.residenceOwnedOrRented || false,\n      },\n      businessMatches: {\n        businessName: businessMatches.businessName || false,\n        natureOfBusiness: businessMatches.natureOfBusiness || false,\n        existenceCurrentPlace: businessMatches.existenceCurrentPlace || false,\n        licensesRegistrations: businessMatches.licensesRegistrations || false,\n        promoterExperienceQualifications: businessMatches.promoterExperience || false,\n        strategicVisionClarity: businessMatches.strategicVision || false,\n        employeesSeen: businessMatches.employeesSeen || false,\n        monthlyTurnover: businessMatches.monthlyTurnover || false,\n        clientListConcentrationRisk: businessMatches.clientList || false,\n        activityDuringVisit: businessMatches.activityDuringVisit || false,\n        monthlyIncome: businessMatches.monthlyIncome || false,\n        seasonality: businessMatches.seasonality || false,\n        infraSupportsTurnover: businessMatches.infrastructure || false,\n        mfgRawMaterialSourcingStorage: businessMatches.mfgRawMaterial || false,\n        mfgProcessFlow: businessMatches.mfgProcessFlow || false,\n        mfgCapacityVsUtilization: businessMatches.mfgCapacity || false,\n        mfgMachineryMakeAutomationMaintenance: businessMatches.mfgMachinery || false,\n        mfgInventoryFifoAging: businessMatches.mfgInventory || false,\n        mfgQualityControl: businessMatches.mfgQualityControl || false,\n        tradingProductRangeInventoryMovement: businessMatches.tradingProductRange || false,\n        tradingPurchaseSalesCycle: businessMatches.tradingPurchaseCycle || false,\n        tradingWarehouseStockSeen: businessMatches.tradingWarehouse || false,\n        svcDocumentationOfDelivery: businessMatches.svcDocumentation || false,\n        svcTechnologySystems: businessMatches.svcTechnology || false,\n        svcClientListContractsRevenueModel: businessMatches.svcContracts || false,\n        svcContractBasedOrWalkin: businessMatches.svcContractBased || false,\n      },\n      bankingMatches: {\n        primaryBankerName: bankingMatches.primaryBankerName || false,\n        turnoverCreditedPercent: bankingMatches.turnoverCreditedPercent || false,\n        bankingTenure: bankingMatches.bankingTenure || false,\n        emisRoutedBank: bankingMatches.emisRoutedBank || false,\n        qrCodeSpotted: bankingMatches.qrCodeSpotted || false,\n      },\n      networthMatches: {\n        propertiesOwned: networthMatches.propertiesOwned || false,\n        vehiclesOwned: networthMatches.vehiclesOwned || false,\n        otherInvestments: networthMatches.otherInvestments || false,\n        businessPlaceOwned: networthMatches.businessPlaceOwned || false,\n        totalNetworthAvailable: networthMatches.totalNetworthAvailable || false,\n      },\n      debtMatches: {\n        hasExistingLoans: debtMatches.hasExistingLoans || false,\n        loanListAvailable: debtMatches.loanListAvailable || false,\n        canServiceNewLoan: debtMatches.canServiceNewLoan || false,\n        repaymentHistoryQuality: debtMatches.repaymentHistoryQuality || false,\n        loansSourceBankNature: debtMatches.loansSourceBankNature || false,\n      },\n      endUseMatches: {\n        agreementValueAvailable: endUseMatches.agreementValueAvailable || false,\n        advancePaidCashOrBankAmount: endUseMatches.advancePaidAmount || false,\n        willOccupyPostPurchase: endUseMatches.willOccupyPostPurchase || false,\n        mortgageFundsUse: endUseMatches.mortgageFundsUse || false,\n        additionalUseInformation: endUseMatches.additionalUseInformation || false,\n      },\n      referenceMatches: {\n        personalRefNeighbours: refMatches.personalRefNeighbours || false,\n        businessRefBuyersSellers: refMatches.businessRefBuyersSellers || false,\n        invoiceVerification: refMatches.invoiceVerification || false,\n      },\n      rationale,\n    };\n  } catch (error: any) {\n    console.error(`[AI Scoring - ${leadId}] Error:`, error?.message);\n    \n    return {\n      personal: 0,\n      business: 0,\n      banking: 0,\n      networth: 0,\n      existingDebt: 0,\n      endUse: 0,\n      referenceChecks: 0,\n      personalMatches: {\n        selfEducation: false, spouseName: false, spouseEducation: false, spouseEmployment: false,\n        mentionAboutKids: false, kidsEducation: false, kidsSchool: false, residenceVintage: false,\n        monthlyRentIfRented: false, residenceOwnedOrRented: false,\n      },\n      businessMatches: {\n        businessName: false, natureOfBusiness: false, existenceCurrentPlace: false, licensesRegistrations: false,\n        promoterExperienceQualifications: false, strategicVisionClarity: false, employeesSeen: false,\n        monthlyTurnover: false, clientListConcentrationRisk: false, activityDuringVisit: false,\n        monthlyIncome: false, seasonality: false, infraSupportsTurnover: false,\n        mfgRawMaterialSourcingStorage: false, mfgProcessFlow: false, mfgCapacityVsUtilization: false,\n        mfgMachineryMakeAutomationMaintenance: false, mfgInventoryFifoAging: false, mfgQualityControl: false,\n        tradingProductRangeInventoryMovement: false, tradingPurchaseSalesCycle: false, tradingWarehouseStockSeen: false,\n        svcDocumentationOfDelivery: false, svcTechnologySystems: false, svcClientListContractsRevenueModel: false,\n        svcContractBasedOrWalkin: false,\n      },\n      bankingMatches: {\n        primaryBankerName: false, turnoverCreditedPercent: false, bankingTenure: false,\n        emisRoutedBank: false, qrCodeSpotted: false,\n      },\n      networthMatches: {\n        propertiesOwned: false, vehiclesOwned: false, otherInvestments: false,\n        businessPlaceOwned: false, totalNetworthAvailable: false,\n      },\n      debtMatches: {\n        hasExistingLoans: false, loanListAvailable: false, canServiceNewLoan: false,\n        repaymentHistoryQuality: false, loansSourceBankNature: false,\n      },\n      endUseMatches: {\n        agreementValueAvailable: false, advancePaidCashOrBankAmount: false, willOccupyPostPurchase: false,\n        mortgageFundsUse: false, additionalUseInformation: false,\n      },\n      referenceMatches: {\n        personalRefNeighbours: false, businessRefBuyersSellers: false, invoiceVerification: false,\n      },\n      rationale: `AI scoring failed: ${error?.message || 'Unknown error'}`,\n      aiError: error?.message || 'Unknown error',\n    };\n  }\n}\n","path":null,"size_bytes":17890,"size_tokens":null},"pyproject.toml":{"content":"[project]\nname = \"repl-nix-workspace\"\nversion = \"0.1.0\"\ndescription = \"Add your description here\"\nrequires-python = \">=3.11\"\ndependencies = [\n    \"openpyxl>=3.1.5\",\n]\n","path":null,"size_bytes":167,"size_tokens":null},"server/rule-scoring.ts":{"content":"import type { ComprehensiveScoreResult } from \"./openrouter\";\n\ninterface ExtractedFields {\n  personal: {\n    selfEducation: string | null;\n    spouseName: string | null;\n    spouseEducation: string | null;\n    spouseEmployment: string | null;\n    kidsMentioned: boolean;\n    kidsEducation: string | null;\n    kidsSchool: string | null;\n    residenceVintage: string | null;\n    monthlyRent: number | null;\n    residenceOwnership: \"Owned\" | \"Rented\" | null;\n  };\n  business: {\n    businessName: string | null;\n    natureOfBusiness: string | null;\n    existenceYears: number | null;\n    licenses: string[];\n    experience: string | null;\n    vision: string | null;\n    employeeCount: number | null;\n    monthlyTurnover: number | null;\n    clientList: string[];\n    activityObserved: boolean;\n    monthlyIncome: number | null;\n    seasonality: string | null;\n    infrastructure: string | null;\n    businessType: \"manufacturing\" | \"trading\" | \"service\" | null;\n    mfgDetails: { rawMaterial: boolean; processFlow: boolean; capacity: boolean; machinery: boolean; inventory: boolean; qualityControl: boolean };\n    tradingDetails: { productRange: boolean; purchaseCycle: boolean; warehouse: boolean };\n    serviceDetails: { documentation: boolean; technology: boolean; contracts: boolean; contractBased: boolean };\n  };\n  banking: {\n    bankerName: string | null;\n    turnoverCreditedPercent: number | null;\n    bankingTenure: string | null;\n    emisRouted: boolean;\n    qrCodeSpotted: boolean;\n  };\n  networth: {\n    propertiesOwned: string[];\n    vehiclesOwned: string[];\n    investments: string[];\n    businessPlaceOwned: boolean;\n    totalNetworth: number | null;\n  };\n  debt: {\n    hasLoans: boolean;\n    loanList: string[];\n    canServiceNewLoan: boolean;\n    repaymentHistory: string | null;\n    loanSources: string[];\n  };\n  endUse: {\n    agreementValue: number | null;\n    advancePaid: number | null;\n    willOccupy: boolean;\n    mortgageUse: string | null;\n    additionalInfo: string | null;\n  };\n  references: {\n    personalRefs: string[];\n    businessRefs: string[];\n    invoicesVerified: boolean;\n  };\n}\n\nconst PERSONAL_PATTERNS = {\n  selfEducation: [/education[:\\s]*([^\\n,]+)/i, /qualification[:\\s]*([^\\n,]+)/i, /educated[:\\s]*([^\\n,]+)/i, /graduate/i, /post[- ]?graduate/i, /degree/i, /diploma/i, /10th|12th|matriculat/i],\n  spouseName: [/spouse[:\\s]*([^\\n,]+)/i, /wife[:\\s]*([^\\n,]+)/i, /husband[:\\s]*([^\\n,]+)/i, /married to[:\\s]*([^\\n,]+)/i],\n  spouseEducation: [/spouse.*education[:\\s]*([^\\n,]+)/i, /wife.*education/i, /husband.*education/i],\n  spouseEmployment: [/spouse.*employ|spouse.*occupation|spouse.*work|wife.*work|husband.*work/i, /spouse.*job/i],\n  kids: [/child|children|son|daughter|kid|dependent/i],\n  kidsEducation: [/child.*educat|son.*educat|daughter.*educat|kid.*school|child.*study/i],\n  kidsSchool: [/school[:\\s]*([^\\n,]+)/i, /college[:\\s]*([^\\n,]+)/i, /studying at/i],\n  residenceVintage: [/resid.*since|stay.*since|living.*since|(\\d+)\\s*years?\\s*(at|in|of)\\s*residen/i, /residence\\s*vintage/i],\n  monthlyRent: [/rent[:\\s]*(?:Rs\\.?|INR|)?\\s*([\\d,]+)/i, /monthly\\s*rent/i],\n  residenceOwnership: [/own\\s*house|owned\\s*residen|self[- ]?owned|property\\s*owned/i, /rent(ed|al)\\s*(house|residen|property)/i],\n};\n\nconst BUSINESS_PATTERNS = {\n  businessName: [/business\\s*name[:\\s]*([^\\n]+)/i, /firm\\s*name[:\\s]*([^\\n]+)/i, /company\\s*name[:\\s]*([^\\n]+)/i, /entity\\s*name[:\\s]*([^\\n]+)/i],\n  natureOfBusiness: [/nature\\s*of\\s*business[:\\s]*([^\\n]+)/i, /business\\s*type[:\\s]*([^\\n]+)/i, /type\\s*of\\s*business/i],\n  existence: [/exist.*since|establish.*since|operat.*since|(\\d+)\\s*years?\\s*(in|of)\\s*business/i],\n  licenses: [/licen[sc]e|registration|gst|pan|udyam|msme|trade\\s*licen|shop\\s*act/i],\n  experience: [/experience|expertise|years?\\s*in\\s*business/i],\n  vision: [/vision|plan|growth|expansion|future/i],\n  employees: [/employee|staff|worker|labour|(\\d+)\\s*people\\s*work/i],\n  turnover: [/turnover[:\\s]*(?:Rs\\.?|INR|)?\\s*([\\d,\\.]+)\\s*(lakh|lac|cr|crore)?/i, /monthly\\s*sales/i],\n  clients: [/client|customer|buyer|seller/i],\n  activity: [/active\\s*operation|business\\s*activity|visit.*observed|during\\s*visit/i],\n  income: [/income[:\\s]*(?:Rs\\.?|INR|)?\\s*([\\d,\\.]+)/i, /monthly\\s*income/i, /net\\s*profit/i],\n  seasonality: [/seasonal|peak\\s*season|off[- ]?season|fluctuat/i],\n  infrastructure: [/infrastructure|premises|factory|office\\s*space|godown|warehouse/i],\n  manufacturing: [/manufactur|production|factory|plant/i],\n  trading: [/trad(e|ing)|wholesale|retail|shop|store|dealer/i],\n  service: [/service|consultancy|IT|software|contractor/i],\n};\n\nconst BANKING_PATTERNS = {\n  bankerName: [/bank[:\\s]*([^\\n,]+)/i, /banker[:\\s]*([^\\n,]+)/i, /primary\\s*bank/i, /hdfc|icici|sbi|axis|kotak|yes\\s*bank|idfc|bandhan|pnb|bob|union|canara/i],\n  turnoverCredited: [/(\\d+)[\\s%]*(?:of\\s*)?turnover.*credit|credit.*(\\d+)[\\s%]/i, /turnover.*routed/i],\n  tenure: [/banking\\s*(?:relation|tenure|since)|account.*since|(\\d+)\\s*years?\\s*(?:with|at)\\s*bank/i],\n  emisRouted: [/emi.*routed|emi.*debit|loan\\s*emi.*bank/i],\n  qrCode: [/qr\\s*code|upi|phonepe|gpay|paytm|bhim/i],\n};\n\nconst NETWORTH_PATTERNS = {\n  properties: [/property|properties|land|plot|flat|house|apartment|real\\s*estate/i],\n  vehicles: [/vehicle|car|bike|scooter|two[- ]?wheeler|four[- ]?wheeler/i],\n  investments: [/invest|fd|fixed\\s*deposit|mutual\\s*fund|shares|stock|gold|lic|insurance/i],\n  businessPlace: [/own\\s*business\\s*place|office\\s*owned|shop\\s*owned|factory\\s*owned/i],\n  totalNetworth: [/net\\s*worth[:\\s]*(?:Rs\\.?|INR|)?\\s*([\\d,\\.]+)/i, /total\\s*asset/i],\n};\n\nconst DEBT_PATTERNS = {\n  hasLoans: [/existing\\s*loan|current\\s*loan|outstanding|emi|debt/i],\n  loanList: [/loan\\s*(?:from|with|at)[:\\s]*([^\\n]+)/i, /borrowing/i],\n  serviceability: [/can\\s*service|repay.*capacity|sufficient\\s*income/i],\n  repaymentHistory: [/repayment|cibil|credit\\s*score|payment\\s*history|no\\s*default/i],\n  loanSource: [/loan.*from.*bank|loan.*from.*nbfc|loan.*from.*fintech/i],\n};\n\nconst ENDUSE_PATTERNS = {\n  agreementValue: [/agreement\\s*value[:\\s]*(?:Rs\\.?|INR|)?\\s*([\\d,\\.]+)/i, /property\\s*value/i],\n  advancePaid: [/advance\\s*paid[:\\s]*(?:Rs\\.?|INR|)?\\s*([\\d,\\.]+)/i, /down\\s*payment/i],\n  willOccupy: [/will\\s*occupy|self[- ]?occup|personal\\s*use|own\\s*stay/i],\n  mortgageUse: [/mortgage.*for|loan.*for|end\\s*use|purpose.*loan/i],\n  additionalInfo: [/additional.*use|other.*purpose/i],\n};\n\nconst REFERENCE_PATTERNS = {\n  personalRef: [/neighbour|neighbor|relative|family\\s*reference|personal\\s*reference/i],\n  businessRef: [/buyer|seller|supplier|vendor|customer\\s*reference|business\\s*reference/i],\n  invoices: [/invoice|bill|receipt|purchase\\s*order|sales\\s*order/i],\n};\n\nfunction matchPattern(text: string, patterns: RegExp[]): string | null {\n  for (const pattern of patterns) {\n    const match = text.match(pattern);\n    if (match) {\n      return match[1] || match[0];\n    }\n  }\n  return null;\n}\n\nfunction hasPattern(text: string, patterns: RegExp[]): boolean {\n  return patterns.some(p => p.test(text));\n}\n\nfunction extractNumber(text: string, patterns: RegExp[]): number | null {\n  for (const pattern of patterns) {\n    const match = text.match(pattern);\n    if (match) {\n      const numStr = (match[1] || match[0]).replace(/[,\\s]/g, '');\n      const num = parseFloat(numStr);\n      if (!isNaN(num)) return num;\n    }\n  }\n  return null;\n}\n\nfunction extractFields(pdfText: string): ExtractedFields {\n  const text = pdfText.toLowerCase();\n  \n  const businessType: \"manufacturing\" | \"trading\" | \"service\" | null = \n    hasPattern(text, BUSINESS_PATTERNS.manufacturing) ? \"manufacturing\" :\n    hasPattern(text, BUSINESS_PATTERNS.trading) ? \"trading\" :\n    hasPattern(text, BUSINESS_PATTERNS.service) ? \"service\" : null;\n\n  return {\n    personal: {\n      selfEducation: matchPattern(text, PERSONAL_PATTERNS.selfEducation),\n      spouseName: matchPattern(text, PERSONAL_PATTERNS.spouseName),\n      spouseEducation: matchPattern(text, PERSONAL_PATTERNS.spouseEducation),\n      spouseEmployment: matchPattern(text, PERSONAL_PATTERNS.spouseEmployment),\n      kidsMentioned: hasPattern(text, PERSONAL_PATTERNS.kids),\n      kidsEducation: matchPattern(text, PERSONAL_PATTERNS.kidsEducation),\n      kidsSchool: matchPattern(text, PERSONAL_PATTERNS.kidsSchool),\n      residenceVintage: matchPattern(text, PERSONAL_PATTERNS.residenceVintage),\n      monthlyRent: extractNumber(text, PERSONAL_PATTERNS.monthlyRent),\n      residenceOwnership: hasPattern(text, [/own\\s*house|owned|self[- ]?owned/i]) ? \"Owned\" : \n                          hasPattern(text, [/rent(ed|al)/i]) ? \"Rented\" : null,\n    },\n    business: {\n      businessName: matchPattern(text, BUSINESS_PATTERNS.businessName),\n      natureOfBusiness: matchPattern(text, BUSINESS_PATTERNS.natureOfBusiness),\n      existenceYears: extractNumber(text, BUSINESS_PATTERNS.existence),\n      licenses: hasPattern(text, BUSINESS_PATTERNS.licenses) ? [\"found\"] : [],\n      experience: matchPattern(text, BUSINESS_PATTERNS.experience),\n      vision: matchPattern(text, BUSINESS_PATTERNS.vision),\n      employeeCount: extractNumber(text, BUSINESS_PATTERNS.employees),\n      monthlyTurnover: extractNumber(text, BUSINESS_PATTERNS.turnover),\n      clientList: hasPattern(text, BUSINESS_PATTERNS.clients) ? [\"found\"] : [],\n      activityObserved: hasPattern(text, BUSINESS_PATTERNS.activity),\n      monthlyIncome: extractNumber(text, BUSINESS_PATTERNS.income),\n      seasonality: matchPattern(text, BUSINESS_PATTERNS.seasonality),\n      infrastructure: matchPattern(text, BUSINESS_PATTERNS.infrastructure),\n      businessType,\n      mfgDetails: {\n        rawMaterial: hasPattern(text, [/raw\\s*material|sourcing|procurement/i]),\n        processFlow: hasPattern(text, [/process\\s*flow|production\\s*process/i]),\n        capacity: hasPattern(text, [/capacity|utiliz/i]),\n        machinery: hasPattern(text, [/machine|equipment|automation/i]),\n        inventory: hasPattern(text, [/inventory|stock|fifo|lifo/i]),\n        qualityControl: hasPattern(text, [/quality\\s*control|qa|qc|iso/i]),\n      },\n      tradingDetails: {\n        productRange: hasPattern(text, [/product\\s*range|variety|assortment/i]),\n        purchaseCycle: hasPattern(text, [/purchase.*cycle|sales.*cycle|credit\\s*period/i]),\n        warehouse: hasPattern(text, [/warehouse|godown|stock.*seen/i]),\n      },\n      serviceDetails: {\n        documentation: hasPattern(text, [/document|record|maintain/i]),\n        technology: hasPattern(text, [/technology|software|system|it\\s*infra/i]),\n        contracts: hasPattern(text, [/contract|agreement|client.*list/i]),\n        contractBased: hasPattern(text, [/contract\\s*based|retainer|project\\s*based/i]),\n      },\n    },\n    banking: {\n      bankerName: matchPattern(text, BANKING_PATTERNS.bankerName),\n      turnoverCreditedPercent: extractNumber(text, BANKING_PATTERNS.turnoverCredited),\n      bankingTenure: matchPattern(text, BANKING_PATTERNS.tenure),\n      emisRouted: hasPattern(text, BANKING_PATTERNS.emisRouted),\n      qrCodeSpotted: hasPattern(text, BANKING_PATTERNS.qrCode),\n    },\n    networth: {\n      propertiesOwned: hasPattern(text, NETWORTH_PATTERNS.properties) ? [\"found\"] : [],\n      vehiclesOwned: hasPattern(text, NETWORTH_PATTERNS.vehicles) ? [\"found\"] : [],\n      investments: hasPattern(text, NETWORTH_PATTERNS.investments) ? [\"found\"] : [],\n      businessPlaceOwned: hasPattern(text, NETWORTH_PATTERNS.businessPlace),\n      totalNetworth: extractNumber(text, NETWORTH_PATTERNS.totalNetworth),\n    },\n    debt: {\n      hasLoans: hasPattern(text, DEBT_PATTERNS.hasLoans),\n      loanList: hasPattern(text, DEBT_PATTERNS.loanList) ? [\"found\"] : [],\n      canServiceNewLoan: hasPattern(text, DEBT_PATTERNS.serviceability),\n      repaymentHistory: matchPattern(text, DEBT_PATTERNS.repaymentHistory),\n      loanSources: hasPattern(text, DEBT_PATTERNS.loanSource) ? [\"found\"] : [],\n    },\n    endUse: {\n      agreementValue: extractNumber(text, ENDUSE_PATTERNS.agreementValue),\n      advancePaid: extractNumber(text, ENDUSE_PATTERNS.advancePaid),\n      willOccupy: hasPattern(text, ENDUSE_PATTERNS.willOccupy),\n      mortgageUse: matchPattern(text, ENDUSE_PATTERNS.mortgageUse),\n      additionalInfo: matchPattern(text, ENDUSE_PATTERNS.additionalInfo),\n    },\n    references: {\n      personalRefs: hasPattern(text, REFERENCE_PATTERNS.personalRef) ? [\"found\"] : [],\n      businessRefs: hasPattern(text, REFERENCE_PATTERNS.businessRef) ? [\"found\"] : [],\n      invoicesVerified: hasPattern(text, REFERENCE_PATTERNS.invoices),\n    },\n  };\n}\n\nconst RUBRIC = {\n  personal: {\n    selfEducation: 1.5,\n    spouseName: 1.5,\n    spouseEducation: 1.5,\n    spouseEmployment: 1.5,\n    kidsMentioned: 1.5,\n    kidsEducation: 1.5,\n    kidsSchool: 1.5,\n    residenceVintage: 1.5,\n    monthlyRent: 1.5,\n    residenceOwnership: 1.5,\n  },\n  businessCore: {\n    businessName: 2,\n    natureOfBusiness: 2,\n    existence: 2,\n    licenses: 2,\n    experience: 2,\n    vision: 2,\n    employees: 2,\n    turnover: 2,\n    clients: 2,\n    activity: 2,\n    income: 2,\n    seasonality: 1,\n    infrastructure: 1,\n  },\n  businessMfg: { rawMaterial: 1, processFlow: 1, capacity: 1, machinery: 1, inventory: 1, qualityControl: 1 },\n  businessTrading: { productRange: 2, purchaseCycle: 2, warehouse: 2 },\n  businessService: { documentation: 1.5, technology: 1.5, contracts: 1.5, contractBased: 1.5 },\n  banking: {\n    bankerName: 3,\n    turnoverCredited: 3,\n    tenure: 3,\n    emisRouted: 3,\n    qrCode: 3,\n  },\n  networth: {\n    properties: 2,\n    vehicles: 2,\n    investments: 2,\n    businessPlace: 2,\n    totalNetworth: 2,\n  },\n  debt: {\n    hasLoans: 2,\n    loanList: 2,\n    serviceability: 2,\n    repaymentHistory: 2,\n    loanSources: 2,\n  },\n  endUse: {\n    agreementValue: 2,\n    advancePaid: 2,\n    willOccupy: 2,\n    mortgageUse: 2,\n    additionalInfo: 2,\n  },\n  references: {\n    personalRef: 3.33,\n    businessRef: 3.33,\n    invoices: 3.34,\n  },\n};\n\nfunction scoreSection(data: Record<string, unknown>, rubric: Record<string, number>, max: number): number {\n  let score = 0;\n  for (const [key, weight] of Object.entries(rubric)) {\n    const val = data[key];\n    const present =\n      typeof val === \"boolean\" ? val :\n      typeof val === \"number\" ? val !== 0 && !Number.isNaN(val) :\n      typeof val === \"string\" ? val.trim().length > 0 :\n      Array.isArray(val) ? val.length > 0 :\n      !!val;\n    if (present) score += weight;\n  }\n  return Math.min(Math.round(score * 100) / 100, max);\n}\n\nfunction scoreBooleanSection(matches: Record<string, boolean>, rubric: Record<string, number>, max: number): number {\n  let score = 0;\n  for (const [key, weight] of Object.entries(rubric)) {\n    if (matches[key] === true) {\n      score += weight;\n    }\n  }\n  return Math.min(Math.round(score * 100) / 100, max);\n}\n\nexport function scoreComprehensiveRuleBased(pdfText: string, leadId: string): ComprehensiveScoreResult {\n  console.log(`[Rule Scoring - ${leadId}] Starting rule-based scoring, text length: ${pdfText.length}`);\n  \n  const fields = extractFields(pdfText);\n  console.log(`[Rule Scoring - ${leadId}] Extracted fields:`, JSON.stringify(fields, null, 2).substring(0, 1000));\n\n  // Build boolean match objects FIRST - these drive both scoring and UI\n  const personalMatches = {\n    selfEducation: !!fields.personal.selfEducation,\n    spouseName: !!fields.personal.spouseName,\n    spouseEducation: !!fields.personal.spouseEducation,\n    spouseEmployment: !!fields.personal.spouseEmployment,\n    kidsMentioned: fields.personal.kidsMentioned,\n    kidsEducation: !!fields.personal.kidsEducation,\n    kidsSchool: !!fields.personal.kidsSchool,\n    residenceVintage: !!fields.personal.residenceVintage,\n    monthlyRent: fields.personal.monthlyRent !== null,\n    residenceOwnership: !!fields.personal.residenceOwnership,\n  };\n  const personalScore = scoreBooleanSection(personalMatches, RUBRIC.personal, 15);\n\n  const businessCoreMatches = {\n    businessName: !!fields.business.businessName,\n    natureOfBusiness: !!fields.business.natureOfBusiness,\n    existence: fields.business.existenceYears !== null,\n    licenses: fields.business.licenses.length > 0,\n    experience: !!fields.business.experience,\n    vision: !!fields.business.vision,\n    employees: fields.business.employeeCount !== null,\n    turnover: fields.business.monthlyTurnover !== null,\n    clients: fields.business.clientList.length > 0,\n    activity: fields.business.activityObserved,\n    income: fields.business.monthlyIncome !== null,\n    seasonality: !!fields.business.seasonality,\n    infrastructure: !!fields.business.infrastructure,\n  };\n  let businessScore = scoreBooleanSection(businessCoreMatches, RUBRIC.businessCore, 24);\n\n  const mfgMatches = {\n    rawMaterial: fields.business.mfgDetails.rawMaterial,\n    processFlow: fields.business.mfgDetails.processFlow,\n    capacity: fields.business.mfgDetails.capacity,\n    machinery: fields.business.mfgDetails.machinery,\n    inventory: fields.business.mfgDetails.inventory,\n    qualityControl: fields.business.mfgDetails.qualityControl,\n  };\n  const tradingMatches = {\n    productRange: fields.business.tradingDetails.productRange,\n    purchaseCycle: fields.business.tradingDetails.purchaseCycle,\n    warehouse: fields.business.tradingDetails.warehouse,\n  };\n  const serviceMatches = {\n    documentation: fields.business.serviceDetails.documentation,\n    technology: fields.business.serviceDetails.technology,\n    contracts: fields.business.serviceDetails.contracts,\n    contractBased: fields.business.serviceDetails.contractBased,\n  };\n\n  if (fields.business.businessType === \"manufacturing\") {\n    businessScore += scoreBooleanSection(mfgMatches, RUBRIC.businessMfg, 6);\n  } else if (fields.business.businessType === \"trading\") {\n    businessScore += scoreBooleanSection(tradingMatches, RUBRIC.businessTrading, 6);\n  } else if (fields.business.businessType === \"service\") {\n    businessScore += scoreBooleanSection(serviceMatches, RUBRIC.businessService, 6);\n  }\n  businessScore = Math.min(businessScore, 30);\n\n  const bankingMatches = {\n    bankerName: !!fields.banking.bankerName,\n    turnoverCredited: fields.banking.turnoverCreditedPercent !== null,\n    tenure: !!fields.banking.bankingTenure,\n    emisRouted: fields.banking.emisRouted,\n    qrCode: fields.banking.qrCodeSpotted,\n  };\n  const bankingScore = scoreBooleanSection(bankingMatches, RUBRIC.banking, 15);\n\n  const networthMatches = {\n    properties: fields.networth.propertiesOwned.length > 0,\n    vehicles: fields.networth.vehiclesOwned.length > 0,\n    investments: fields.networth.investments.length > 0,\n    businessPlace: fields.networth.businessPlaceOwned,\n    totalNetworth: fields.networth.totalNetworth !== null,\n  };\n  const networthScore = scoreBooleanSection(networthMatches, RUBRIC.networth, 10);\n\n  const debtMatches = {\n    hasLoans: fields.debt.hasLoans,\n    loanList: fields.debt.loanList.length > 0,\n    serviceability: fields.debt.canServiceNewLoan,\n    repaymentHistory: !!fields.debt.repaymentHistory,\n    loanSources: fields.debt.loanSources.length > 0,\n  };\n  const debtScore = scoreBooleanSection(debtMatches, RUBRIC.debt, 10);\n\n  const endUseMatches = {\n    agreementValue: fields.endUse.agreementValue !== null,\n    advancePaid: fields.endUse.advancePaid !== null,\n    willOccupy: fields.endUse.willOccupy,\n    mortgageUse: !!fields.endUse.mortgageUse,\n    additionalInfo: !!fields.endUse.additionalInfo,\n  };\n  const endUseScore = scoreBooleanSection(endUseMatches, RUBRIC.endUse, 10);\n\n  const referenceMatchesLocal = {\n    personalRef: fields.references.personalRefs.length > 0,\n    businessRef: fields.references.businessRefs.length > 0,\n    invoices: fields.references.invoicesVerified,\n  };\n  const referenceScore = scoreBooleanSection(referenceMatchesLocal, RUBRIC.references, 10);\n\n  const rationale = `Rule-based scoring completed. Total: ${personalScore + businessScore + bankingScore + networthScore + debtScore + endUseScore + referenceScore}/100. ` +\n    `Personal: ${personalScore}/15, Business: ${businessScore}/30, Banking: ${bankingScore}/15, ` +\n    `Networth: ${networthScore}/10, Debt: ${debtScore}/10, EndUse: ${endUseScore}/10, References: ${referenceScore}/10.`;\n\n  console.log(`[Rule Scoring - ${leadId}] ${rationale}`);\n\n  return {\n    personal: personalScore,\n    business: businessScore,\n    banking: bankingScore,\n    networth: networthScore,\n    existingDebt: debtScore,\n    endUse: endUseScore,\n    referenceChecks: referenceScore,\n    personalMatches: {\n      selfEducation: !!fields.personal.selfEducation,\n      spouseName: !!fields.personal.spouseName,\n      spouseEducation: !!fields.personal.spouseEducation,\n      spouseEmployment: !!fields.personal.spouseEmployment,\n      mentionAboutKids: fields.personal.kidsMentioned,\n      kidsEducation: !!fields.personal.kidsEducation,\n      kidsSchool: !!fields.personal.kidsSchool,\n      residenceVintage: !!fields.personal.residenceVintage,\n      monthlyRentIfRented: fields.personal.monthlyRent !== null,\n      residenceOwnedOrRented: !!fields.personal.residenceOwnership,\n    },\n    businessMatches: {\n      businessName: !!fields.business.businessName,\n      natureOfBusiness: !!fields.business.natureOfBusiness,\n      existenceCurrentPlace: fields.business.existenceYears !== null,\n      licensesRegistrations: fields.business.licenses.length > 0,\n      promoterExperienceQualifications: !!fields.business.experience,\n      strategicVisionClarity: !!fields.business.vision,\n      employeesSeen: fields.business.employeeCount !== null,\n      monthlyTurnover: fields.business.monthlyTurnover !== null,\n      clientListConcentrationRisk: fields.business.clientList.length > 0,\n      activityDuringVisit: fields.business.activityObserved,\n      monthlyIncome: fields.business.monthlyIncome !== null,\n      seasonality: !!fields.business.seasonality,\n      infraSupportsTurnover: !!fields.business.infrastructure,\n      mfgRawMaterialSourcingStorage: fields.business.mfgDetails.rawMaterial,\n      mfgProcessFlow: fields.business.mfgDetails.processFlow,\n      mfgCapacityVsUtilization: fields.business.mfgDetails.capacity,\n      mfgMachineryMakeAutomationMaintenance: fields.business.mfgDetails.machinery,\n      mfgInventoryFifoAging: fields.business.mfgDetails.inventory,\n      mfgQualityControl: fields.business.mfgDetails.qualityControl,\n      tradingProductRangeInventoryMovement: fields.business.tradingDetails.productRange,\n      tradingPurchaseSalesCycle: fields.business.tradingDetails.purchaseCycle,\n      tradingWarehouseStockSeen: fields.business.tradingDetails.warehouse,\n      svcDocumentationOfDelivery: fields.business.serviceDetails.documentation,\n      svcTechnologySystems: fields.business.serviceDetails.technology,\n      svcClientListContractsRevenueModel: fields.business.serviceDetails.contracts,\n      svcContractBasedOrWalkin: fields.business.serviceDetails.contractBased,\n    },\n    bankingMatches: {\n      primaryBankerName: !!fields.banking.bankerName,\n      turnoverCreditedPercent: fields.banking.turnoverCreditedPercent !== null,\n      bankingTenure: !!fields.banking.bankingTenure,\n      emisRoutedBank: fields.banking.emisRouted,\n      qrCodeSpotted: fields.banking.qrCodeSpotted,\n    },\n    networthMatches: {\n      propertiesOwned: fields.networth.propertiesOwned.length > 0,\n      vehiclesOwned: fields.networth.vehiclesOwned.length > 0,\n      otherInvestments: fields.networth.investments.length > 0,\n      businessPlaceOwned: fields.networth.businessPlaceOwned,\n      totalNetworthAvailable: fields.networth.totalNetworth !== null,\n    },\n    debtMatches: {\n      hasExistingLoans: fields.debt.hasLoans,\n      loanListAvailable: fields.debt.loanList.length > 0,\n      canServiceNewLoan: fields.debt.canServiceNewLoan,\n      repaymentHistoryQuality: !!fields.debt.repaymentHistory,\n      loansSourceBankNature: fields.debt.loanSources.length > 0,\n    },\n    endUseMatches: {\n      agreementValueAvailable: fields.endUse.agreementValue !== null,\n      advancePaidCashOrBankAmount: fields.endUse.advancePaid !== null,\n      willOccupyPostPurchase: fields.endUse.willOccupy,\n      mortgageFundsUse: !!fields.endUse.mortgageUse,\n      additionalUseInformation: !!fields.endUse.additionalInfo,\n    },\n    referenceMatches: {\n      personalRefNeighbours: fields.references.personalRefs.length > 0,\n      businessRefBuyersSellers: fields.references.businessRefs.length > 0,\n      invoiceVerification: fields.references.invoicesVerified,\n    },\n    rationale,\n  };\n}\n","path":null,"size_bytes":24415,"size_tokens":null},"main.py":{"content":"def main():\n    print(\"Hello from repl-nix-workspace!\")\n\n\nif __name__ == \"__main__\":\n    main()\n","path":null,"size_bytes":96,"size_tokens":null},"server/deterministic-scoring.ts":{"content":"import type { ApplicantSchema, ComprehensiveBreakdown, PersonalMatches, BusinessMatches, BankingMatches, NetworthMatches, DebtMatches, EndUseMatches, ReferenceMatches } from \"@shared/schema\";\n\n// Excel rubric weights - EXACT values from the scoring model\nconst WEIGHTS = {\n  personal: {\n    max: 15,\n    residenceVintage: 1.5,\n    residenceOwned: 1.5,\n    spouseName: 1.5,\n    spouseEducation: 1.5,\n    spouseEmployment: 1.5,\n    mentionAboutKids: 1.5,\n    kidsEducation: 1.5,\n    kidsSchool: 1.5,\n    selfEducation: 1.5,\n    monthlyRent: 1.5,\n  },\n  business: {\n    max: 30,\n    businessName: 2,\n    natureOfBusiness: 2,\n    businessVintage: 2,\n    licensesVerified: 2,\n    employeesVerified: 2,\n    monthlyTurnover: 2,\n    monthlyIncome: 2,\n    activityObserved: 2,\n    infrastructureAdequate: 2,\n    seasonalityMentioned: 2,\n    clientListAvailable: 2,\n    strategicVision: 2,\n    promoterExperience: 2,\n    sourceOfBusiness: 2,\n    comfortableEmi: 2,\n  },\n  banking: {\n    max: 15,\n    primaryBank: 3,\n    turnoverCreditPercent: 3,\n    bankingTenure: 3,\n    emisRouted: 3,\n    qrCodeSpotted: 3,\n  },\n  networth: {\n    max: 10,\n    perItem: 2.5,\n  },\n  debt: {\n    max: 10,\n    existingLoans: 2.5,\n    loanListAvailable: 2.5,\n    repaymentTrack: 2.5,\n    loansSourceBank: 2.5,\n    // canServiceNewLoan moved to business as comfortableEmi to avoid double counting\n  },\n  endUse: {\n    max: 10,\n    purposeOfLoan: 3,\n    agreementValue: 3,\n    willOccupy: 4,\n  },\n  references: {\n    max: 10,\n    personalCheck: 4,\n    businessCheck: 3,\n    invoiceVerified: 3,\n  },\n};\n\nexport interface ScoringResult {\n  scores: {\n    personal: number;\n    business: number;\n    banking: number;\n    networth: number;\n    existingDebt: number;\n    endUse: number;\n    referenceChecks: number;\n    total: number;\n  };\n  breakdown: ComprehensiveBreakdown;\n  warnings: string[];\n}\n\nexport function mapDraftToApplicant(draft: any): ApplicantSchema {\n  const pa = draft.primaryApplicant || {};\n  const pers = draft.personalDetails || {};\n  const bus = draft.businessDetails || {};\n  const prop = draft.propertyDetails || {};\n  const end = draft.endUseDetails || {};\n  const ref = draft.referenceChecks || {};\n  const bank = draft.bankingDetails || {};\n\n  const parseNumber = (val: any): number => {\n    if (!val || val === 'N/A' || val === 'Not Available') return 0;\n    const num = parseFloat(String(val).replace(/[^\\d.-]/g, ''));\n    return isNaN(num) ? 0 : num;\n  };\n\n  const parseExistingLoans = (val: any): boolean | null => {\n    if (val === true) return true;\n    if (val === false) return false;\n    if (!val || val === 'N/A' || val === 'Not Available' || val === 'unknown') return null; // Missing/unknown\n    const lower = String(val).toLowerCase().trim();\n    if (lower === 'no' || lower === 'none' || lower === 'nil' || lower === 'false') return false; // Explicit no\n    if (lower === 'yes' || lower === 'true') return true; // Explicit yes\n    return null; // Anything else is undocumented\n  };\n\n  const parseRepaymentTrack = (val: any): string => {\n    if (!val || val === 'N/A' || val === 'Not Available' || val === 'unknown') return '';\n    const lower = String(val).toLowerCase().trim();\n    if (lower.includes('good') || lower.includes('excellent') || lower.includes('regular')) return 'good';\n    if (lower.includes('poor') || lower.includes('bad') || lower.includes('irregular')) return 'poor';\n    return '';\n  };\n\n  const isOwned = (type: string): boolean => {\n    const lower = (type || '').toLowerCase();\n    return lower.includes('own') || lower.includes('self') || lower === 'owned';\n  };\n\n  const hasValue = (val: any): boolean => {\n    return val && val !== 'N/A' && val !== 'Not Available' && val !== 'NA' && String(val).trim() !== '';\n  };\n\n  return {\n    personal: {\n      residenceVintage: pers.residenceVintage || draft.personalDetails?.residenceVintage || '',\n      residenceOwned: isOwned(pers.residenceType || draft.personalDetails?.residenceType),\n      spouseName: pa.spouseName || pers.spouseName || draft.primaryApplicant?.spouseName || draft.personalDetails?.spouseName,\n      kidsCount: parseNumber(pers.dependents || draft.personalDetails?.dependents),\n      selfEducation: pers.selfEducation || draft.personalDetails?.selfEducation,\n      spouseEducation: pers.spouseEducation || draft.personalDetails?.spouseEducation,\n      spouseEmployment: pers.spouseEmployment || draft.personalDetails?.spouseEmployment,\n      kidsEducation: pers.kidsEducation || draft.personalDetails?.kidsEducation,\n      kidsSchool: pers.kidsSchool || draft.personalDetails?.kidsSchool,\n      monthlyRent: parseNumber(pers.monthlyRent || draft.personalDetails?.monthlyRent),\n    },\n    business: {\n      name: bus.businessName || draft.businessDetails?.businessName || '',\n      nature: bus.majorServices || draft.businessDetails?.majorServices || '',\n      monthlyIncome: parseNumber(bus.netMonthlyIncome || draft.businessDetails?.netMonthlyIncome),\n      licensesVerified: hasValue(bus.businessSetup) && bus.businessSetup.toLowerCase().includes('license'),\n      businessVintage: parseNumber(bus.businessVintageMonths || draft.businessDetails?.businessVintageMonths),\n      employeesVerified: hasValue(bus.employeeCount) || hasValue(draft.businessDetails?.employeeCount),\n      monthlyTurnover: parseNumber(bus.monthlyTurnover || draft.businessDetails?.monthlyTurnover),\n      activityObserved: hasValue(bus.businessProfile) || hasValue(draft.businessDetails?.businessProfile),\n      infrastructureAdequate: hasValue(bus.surroundingArea) || hasValue(draft.businessDetails?.surroundingArea),\n      seasonalityMentioned: hasValue(bus.seasonality) || hasValue(draft.businessDetails?.seasonality),\n      clientListAvailable: hasValue(bus.clientListConcentrationRisk) || hasValue(draft.businessDetails?.clientListConcentrationRisk) || hasValue(bus.majorClients) || hasValue(draft.businessDetails?.majorClients),\n      sourceOfBusiness: hasValue(bus.sourceOfBusiness) || hasValue(draft.businessDetails?.sourceOfBusiness),\n      strategicVision: hasValue(bus.strategicVision) || hasValue(draft.businessDetails?.strategicVision) || hasValue(bus.growthPlans) || hasValue(draft.businessDetails?.growthPlans),\n      promoterExperience: hasValue(bus.promoterExperience) || hasValue(draft.businessDetails?.promoterExperience) || hasValue(bus.yearsOfExperience),\n    },\n    networth: {\n      propertiesOwned: parseNumber(prop.propertiesOwned) || parseNumber(draft.propertyDetails?.propertiesOwned) || (hasValue(prop.propertyType) ? 1 : 0),\n      vehiclesOwned: parseNumber(prop.vehiclesOwned) || parseNumber(draft.propertyDetails?.vehiclesOwned) || 0,\n      otherInvestments: hasValue(prop.otherInvestments) || hasValue(draft.propertyDetails?.otherInvestments),\n      businessPlaceOwned: isOwned(bus.businessSetup),\n    },\n    debt: {\n      existingLoans: parseExistingLoans(draft.existingLoans || draft.debtDetails?.existingLoans),\n      repaymentTrack: parseRepaymentTrack(draft.repaymentHistory || draft.debtDetails?.repaymentHistory),\n      loanListAvailable: hasValue(draft.loanList) || hasValue(draft.debtDetails?.loanList),\n      canServiceNewLoan: hasValue(bus.comfortableEmi) || hasValue(draft.businessDetails?.comfortableEmi),\n    },\n    endUse: {\n      purpose: end.purposeOfLoan || draft.endUseDetails?.purposeOfLoan || '',\n      agreementValue: parseNumber(end.agreementValue || draft.endUseDetails?.agreementValue),\n      advancePaid: parseNumber(end.advancePaid || draft.endUseDetails?.advancePaid),\n      willOccupy: hasValue(end.endUse || draft.endUseDetails?.endUse) && (end.endUse || draft.endUseDetails?.endUse || '').toLowerCase().includes('self'),\n      mortgageFundsUse: end.endUse || draft.endUseDetails?.endUse,\n    },\n    references: {\n      personalCheck: hasValue(ref.reference1?.feedback) && ref.reference1?.feedback !== 'Pending',\n      businessCheck: hasValue(ref.reference2?.feedback) && ref.reference2?.feedback !== 'Pending',\n      invoiceVerified: hasValue(ref.invoiceVerified) || hasValue(draft.referenceChecks?.invoiceVerified),\n    },\n    banking: {\n      primaryBank: bank.bankName || draft.bankingDetails?.bankName || '',\n      turnoverCreditPercent: parseNumber(bank.turnoverCreditPercent || draft.bankingDetails?.turnoverCreditPercent),\n      bankingTenure: parseNumber(bank.bankingTenure || draft.bankingDetails?.bankingTenure),\n      emisRouted: hasValue(bank.emisRouted) || hasValue(draft.bankingDetails?.emisRouted),\n      qrCodeSpotted: hasValue(bank.qrCodeSpotted) || hasValue(draft.bankingDetails?.qrCodeSpotted),\n    },\n  };\n}\n\nexport function scoreApplicant(applicant: ApplicantSchema): ScoringResult {\n  const warnings: string[] = [];\n  const hasValue = (val: any): boolean => {\n    if (val === undefined || val === null) return false;\n    if (typeof val === 'string') return val !== '' && val !== 'N/A' && val !== 'Not Available';\n    if (typeof val === 'number') return val > 0;\n    if (typeof val === 'boolean') return val;\n    return false;\n  };\n\n  // Personal scoring (max 15)\n  // 10 items at 1.5 pts each = 15 max\n  // residenceOwnedOrRented: award if we know owned OR rented\n  // monthlyRentIfRented: award only if rented AND rent is documented\n  const isRented = !applicant.personal.residenceOwned;\n  const personalMatches: PersonalMatches = {\n    selfEducation: hasValue(applicant.personal.selfEducation),\n    spouseName: hasValue(applicant.personal.spouseName),\n    spouseEducation: hasValue(applicant.personal.spouseEducation),\n    spouseEmployment: hasValue(applicant.personal.spouseEmployment),\n    mentionAboutKids: (applicant.personal.kidsCount || 0) > 0,\n    kidsEducation: hasValue(applicant.personal.kidsEducation),\n    kidsSchool: hasValue(applicant.personal.kidsSchool),\n    residenceVintage: hasValue(applicant.personal.residenceVintage) && applicant.personal.residenceVintage.length > 0,\n    monthlyRentIfRented: isRented && hasValue(applicant.personal.monthlyRent),\n    residenceOwnedOrRented: applicant.personal.residenceOwned || (isRented && hasValue(applicant.personal.monthlyRent)),\n  };\n\n  let personalScore = 0;\n  if (personalMatches.selfEducation) personalScore += WEIGHTS.personal.selfEducation;\n  if (personalMatches.spouseName) personalScore += WEIGHTS.personal.spouseName;\n  if (personalMatches.spouseEducation) personalScore += WEIGHTS.personal.spouseEducation;\n  if (personalMatches.spouseEmployment) personalScore += WEIGHTS.personal.spouseEmployment;\n  if (personalMatches.mentionAboutKids) personalScore += WEIGHTS.personal.mentionAboutKids;\n  if (personalMatches.kidsEducation) personalScore += WEIGHTS.personal.kidsEducation;\n  if (personalMatches.kidsSchool) personalScore += WEIGHTS.personal.kidsSchool;\n  if (personalMatches.residenceVintage) personalScore += WEIGHTS.personal.residenceVintage;\n  // Mutually exclusive: owned OR rented with documented rent\n  if (applicant.personal.residenceOwned) {\n    personalScore += WEIGHTS.personal.residenceOwned;  // 1.5 for owned\n  } else if (personalMatches.monthlyRentIfRented) {\n    personalScore += WEIGHTS.personal.monthlyRent;     // 1.5 for rent documented\n  }\n  if (personalMatches.residenceOwnedOrRented) personalScore += 1.5; // Extra 1.5 for clarity on status\n  personalScore = Math.min(personalScore, WEIGHTS.personal.max);\n\n  // Business scoring (max 30)\n  // Each field maps to DISTINCT data sources to prevent double counting\n  const businessMatches: BusinessMatches = {\n    businessName: hasValue(applicant.business.name),\n    natureOfBusiness: hasValue(applicant.business.nature),\n    existenceCurrentPlace: hasValue(applicant.business.businessVintage) && applicant.business.businessVintage! > 0,\n    licensesRegistrations: applicant.business.licensesVerified,\n    promoterExperienceQualifications: applicant.business.promoterExperience || false, // From promoterExperience field\n    strategicVisionClarity: applicant.business.strategicVision || false, // From strategicVision field\n    employeesSeen: applicant.business.employeesVerified || false,\n    monthlyTurnover: hasValue(applicant.business.monthlyTurnover) && applicant.business.monthlyTurnover! > 0,\n    clientListConcentrationRisk: applicant.business.clientListAvailable || false,\n    activityDuringVisit: applicant.business.activityObserved || false,\n    monthlyIncome: hasValue(applicant.business.monthlyIncome) && applicant.business.monthlyIncome >= 50000,\n    seasonality: applicant.business.seasonalityMentioned || false,\n    infraSupportsTurnover: applicant.business.infrastructureAdequate || false,\n    mfgRawMaterialSourcingStorage: false,\n    mfgProcessFlow: false,\n    mfgCapacityVsUtilization: false,\n    mfgMachineryMakeAutomationMaintenance: false,\n    mfgInventoryFifoAging: false,\n    mfgQualityControl: false,\n    tradingProductRangeInventoryMovement: false,\n    tradingPurchaseSalesCycle: false,\n    tradingWarehouseStockSeen: false,\n    svcDocumentationOfDelivery: false,\n    svcTechnologySystems: false,\n    svcClientListContractsRevenueModel: false,\n    svcContractBasedOrWalkin: false,\n  };\n\n  let businessScore = 0;\n  if (businessMatches.businessName) businessScore += WEIGHTS.business.businessName;\n  if (businessMatches.natureOfBusiness) businessScore += WEIGHTS.business.natureOfBusiness;\n  if (businessMatches.existenceCurrentPlace) businessScore += WEIGHTS.business.businessVintage;\n  if (businessMatches.licensesRegistrations) businessScore += WEIGHTS.business.licensesVerified;\n  if (businessMatches.promoterExperienceQualifications) businessScore += WEIGHTS.business.promoterExperience;\n  if (businessMatches.strategicVisionClarity) businessScore += WEIGHTS.business.strategicVision;\n  if (businessMatches.employeesSeen) businessScore += WEIGHTS.business.employeesVerified;\n  if (businessMatches.monthlyTurnover) businessScore += WEIGHTS.business.monthlyTurnover;\n  if (businessMatches.clientListConcentrationRisk) businessScore += WEIGHTS.business.clientListAvailable;\n  if (businessMatches.activityDuringVisit) businessScore += WEIGHTS.business.activityObserved;\n  if (businessMatches.monthlyIncome) businessScore += WEIGHTS.business.monthlyIncome;\n  if (businessMatches.seasonality) businessScore += WEIGHTS.business.seasonalityMentioned;\n  if (businessMatches.infraSupportsTurnover) businessScore += WEIGHTS.business.infrastructureAdequate;\n  // sourceOfBusiness: 2pts if source of business is documented (separate from client list)\n  if (applicant.business.sourceOfBusiness) businessScore += WEIGHTS.business.sourceOfBusiness;\n  // comfortableEmi: 2pts if EMI capacity is documented (separate from debt scoring)\n  if (applicant.debt.canServiceNewLoan) businessScore += WEIGHTS.business.comfortableEmi;\n  businessScore = Math.min(businessScore, WEIGHTS.business.max);\n\n  // Banking scoring (max 15)\n  const bankingMatches: BankingMatches = {\n    primaryBankerName: hasValue(applicant.banking.primaryBank),\n    turnoverCreditedPercent: applicant.banking.turnoverCreditPercent >= 50,\n    bankingTenure: hasValue(applicant.banking.bankingTenure) && applicant.banking.bankingTenure! >= 12,\n    emisRoutedBank: applicant.banking.emisRouted || false,\n    qrCodeSpotted: applicant.banking.qrCodeSpotted || false,\n  };\n\n  let bankingScore = 0;\n  if (bankingMatches.primaryBankerName) bankingScore += WEIGHTS.banking.primaryBank;\n  if (bankingMatches.turnoverCreditedPercent) bankingScore += WEIGHTS.banking.turnoverCreditPercent;\n  if (bankingMatches.bankingTenure) bankingScore += WEIGHTS.banking.bankingTenure;\n  if (bankingMatches.emisRoutedBank) bankingScore += WEIGHTS.banking.emisRouted;\n  if (bankingMatches.qrCodeSpotted) bankingScore += WEIGHTS.banking.qrCodeSpotted;\n  bankingScore = Math.min(bankingScore, WEIGHTS.banking.max);\n\n  // Networth scoring (max 10, 2.5 per item)\n  const networthMatches: NetworthMatches = {\n    propertiesOwned: applicant.networth.propertiesOwned > 0,\n    vehiclesOwned: applicant.networth.vehiclesOwned > 0,\n    otherInvestments: applicant.networth.otherInvestments || false,\n    businessPlaceOwned: applicant.networth.businessPlaceOwned || false,\n    totalNetworthAvailable: applicant.networth.propertiesOwned > 0 || applicant.networth.vehiclesOwned > 0,\n  };\n\n  let networthScore = 0;\n  const networthItems = [\n    networthMatches.propertiesOwned,\n    networthMatches.vehiclesOwned,\n    networthMatches.otherInvestments,\n    networthMatches.businessPlaceOwned,\n  ].filter(Boolean).length;\n  networthScore = networthItems * WEIGHTS.networth.perItem;\n  networthScore = Math.min(networthScore, WEIGHTS.networth.max);\n\n  // Debt scoring (max 10)\n  // existingLoans: null=undocumented, true=has loans, false=no loans\n  // Points awarded only for EXPLICIT documentation (not null)\n  // repaymentTrack must be non-empty (parsed to 'good' or 'poor', not 'unknown' or '')\n  // Note: canServiceNewLoan (comfortableEmi) is scored in Business section, not here\n  const hasDocumentedLoans = applicant.debt.existingLoans === true;\n  const loansExplicitlyNone = applicant.debt.existingLoans === false;\n  const loanStatusDocumented = applicant.debt.existingLoans !== null; // Explicit yes or no\n  const hasValidRepaymentTrack = applicant.debt.repaymentTrack !== '' && applicant.debt.repaymentTrack !== 'unknown';\n  const debtMatches: DebtMatches = {\n    hasExistingLoans: loanStatusDocumented, // True only if explicitly documented (yes or no)\n    loanListAvailable: hasDocumentedLoans && (applicant.debt.loanListAvailable || false),\n    canServiceNewLoan: applicant.debt.canServiceNewLoan || false, // Tracked but scored in Business\n    repaymentHistoryQuality: hasDocumentedLoans && hasValidRepaymentTrack && applicant.debt.repaymentTrack === 'good',\n    loansSourceBankNature: hasDocumentedLoans && hasValidRepaymentTrack,\n  };\n\n  let debtScore = 0;\n  // Award 2.5 pts ONLY for explicitly documenting loan status (yes or no, NOT null)\n  if (loanStatusDocumented) debtScore += WEIGHTS.debt.existingLoans;\n  // Additional points only if loans exist (true) and are documented\n  if (hasDocumentedLoans) {\n    if (debtMatches.loanListAvailable) debtScore += WEIGHTS.debt.loanListAvailable;\n    if (debtMatches.repaymentHistoryQuality) debtScore += WEIGHTS.debt.repaymentTrack;\n    if (debtMatches.loansSourceBankNature) debtScore += WEIGHTS.debt.loansSourceBank;\n  }\n  // canServiceNewLoan scored in Business section as comfortableEmi - NOT double counted here\n  debtScore = Math.min(debtScore, WEIGHTS.debt.max);\n\n  // End Use scoring (max 10)\n  const endUseMatches: EndUseMatches = {\n    agreementValueAvailable: hasValue(applicant.endUse.agreementValue) && applicant.endUse.agreementValue! > 0,\n    advancePaidCashOrBankAmount: hasValue(applicant.endUse.advancePaid) && applicant.endUse.advancePaid! > 0,\n    willOccupyPostPurchase: applicant.endUse.willOccupy || false,\n    mortgageFundsUse: hasValue(applicant.endUse.mortgageFundsUse),\n    additionalUseInformation: hasValue(applicant.endUse.purpose),\n  };\n\n  let endUseScore = 0;\n  if (endUseMatches.additionalUseInformation) endUseScore += WEIGHTS.endUse.purposeOfLoan;\n  if (endUseMatches.agreementValueAvailable) endUseScore += WEIGHTS.endUse.agreementValue;\n  if (endUseMatches.willOccupyPostPurchase) endUseScore += WEIGHTS.endUse.willOccupy;\n  endUseScore = Math.min(endUseScore, WEIGHTS.endUse.max);\n\n  // Reference scoring (max 10)\n  const referenceMatches: ReferenceMatches = {\n    personalRefNeighbours: applicant.references.personalCheck,\n    businessRefBuyersSellers: applicant.references.businessCheck,\n    invoiceVerification: applicant.references.invoiceVerified || false,\n  };\n\n  let refScore = 0;\n  if (referenceMatches.personalRefNeighbours) refScore += WEIGHTS.references.personalCheck;\n  if (referenceMatches.businessRefBuyersSellers) refScore += WEIGHTS.references.businessCheck;\n  if (referenceMatches.invoiceVerification) refScore += WEIGHTS.references.invoiceVerified;\n  refScore = Math.min(refScore, WEIGHTS.references.max);\n\n  // Coverage warnings\n  if (personalScore === 0) warnings.push('Personal details not verified');\n  if (businessScore === 0) warnings.push('Business details not verified');\n  if (bankingScore === 0) warnings.push('Banking details not verified');\n  if (networthScore === 0) warnings.push('Networth details not verified');\n  if (endUseScore === 0) warnings.push('End use purpose not verified');\n  if (refScore === 0) warnings.push('Reference checks pending');\n\n  const totalScore = personalScore + businessScore + bankingScore + networthScore + debtScore + endUseScore + refScore;\n\n  return {\n    scores: {\n      personal: Math.round(personalScore * 100) / 100,\n      business: Math.round(businessScore * 100) / 100,\n      banking: Math.round(bankingScore * 100) / 100,\n      networth: Math.round(networthScore * 100) / 100,\n      existingDebt: Math.round(debtScore * 100) / 100,\n      endUse: Math.round(endUseScore * 100) / 100,\n      referenceChecks: Math.round(refScore * 100) / 100,\n      total: Math.round(totalScore * 100) / 100,\n    },\n    breakdown: {\n      personal: Math.round(personalScore * 100) / 100,\n      business: Math.round(businessScore * 100) / 100,\n      banking: Math.round(bankingScore * 100) / 100,\n      networth: Math.round(networthScore * 100) / 100,\n      existingDebt: Math.round(debtScore * 100) / 100,\n      endUse: Math.round(endUseScore * 100) / 100,\n      referenceChecks: Math.round(refScore * 100) / 100,\n      personalMatches,\n      businessMatches,\n      bankingMatches,\n      networthMatches,\n      debtMatches,\n      endUseMatches,\n      referenceMatches,\n    },\n    warnings,\n  };\n}\n\nexport function scoreDraft(draft: any): ScoringResult {\n  const applicant = mapDraftToApplicant(draft);\n  console.log('[Deterministic Scoring] Mapped applicant:', JSON.stringify(applicant, null, 2));\n  const result = scoreApplicant(applicant);\n  console.log('[Deterministic Scoring] Scores:', result.scores);\n  if (result.warnings.length > 0) {\n    console.log('[Deterministic Scoring] Warnings:', result.warnings);\n  }\n  return result;\n}\n","path":null,"size_bytes":21925,"size_tokens":null},"docs/SCORING_COVERAGE_MATRIX.md":{"content":"# Scoring Coverage Matrix\n\n## Rubric Parameters vs Extracted Values\n\nThis matrix shows how each scoring rubric item maps to its data source field from the draft report.\n\n---\n\n## Section 1: Personal (Max 15 pts)\n| # | Rubric Parameter | Weight | Data Source Field | Extraction Logic |\n|---|-----------------|--------|-------------------|------------------|\n| 1 | Self Education | 1.5 | `personalDetails.selfEducation` | Has non-empty value |\n| 2 | Spouse Name | 1.5 | `primaryApplicant.spouseName` OR `personalDetails.spouseName` | Has non-empty value |\n| 3 | Spouse Education | 1.5 | `personalDetails.spouseEducation` | Has non-empty value |\n| 4 | Spouse Employment | 1.5 | `personalDetails.spouseEmployment` | Has non-empty value |\n| 5 | Mention About Kids | 1.5 | `personalDetails.dependents` | Count > 0 |\n| 6 | Kids Education | 1.5 | `personalDetails.kidsEducation` | Has non-empty value |\n| 7 | Kids School | 1.5 | `personalDetails.kidsSchool` | Has non-empty value |\n| 8 | Residence Vintage | 1.5 | `personalDetails.residenceVintage` | Has non-empty value |\n| 9 | Residence Owned/Rented | 1.5 | `personalDetails.residenceType` | Contains \"own\" OR (rented AND rent documented) |\n| 10 | Monthly Rent (if rented) | 1.5 | `personalDetails.monthlyRent` | Rented AND rent amount > 0 |\n\n**Notes:**\n- Items 9 & 10 are mutually exclusive: owned properties get 1.5+1.5=3 pts automatically; rented properties need documented rent to get 3 pts\n\n---\n\n## Section 2: Business (Max 30 pts)\n| # | Rubric Parameter | Weight | Data Source Field | Extraction Logic |\n|---|-----------------|--------|-------------------|------------------|\n| 1 | Business Name | 2 | `businessDetails.businessName` | Has non-empty value |\n| 2 | Nature of Business | 2 | `businessDetails.majorServices` | Has non-empty value |\n| 3 | Business Vintage | 2 | `businessDetails.businessVintageMonths` | Value > 0 |\n| 4 | Licenses Verified | 2 | `businessDetails.businessSetup` | Contains \"license\" |\n| 5 | Employees Verified | 2 | `businessDetails.employeeCount` | Has non-empty value |\n| 6 | Monthly Turnover | 2 | `businessDetails.monthlyTurnover` | Value > 0 |\n| 7 | Monthly Income | 2 | `businessDetails.netMonthlyIncome` | Value >= 50,000 |\n| 8 | Activity Observed | 2 | `businessDetails.businessProfile` | Has non-empty value |\n| 9 | Infrastructure Adequate | 2 | `businessDetails.surroundingArea` | Has non-empty value |\n| 10 | Seasonality Mentioned | 2 | `businessDetails.seasonality` | Has non-empty value |\n| 11 | Client List Available | 2 | `businessDetails.clientListConcentrationRisk` OR `businessDetails.majorClients` | Has non-empty value |\n| 12 | Strategic Vision | 2 | `businessDetails.strategicVision` OR `businessDetails.growthPlans` | Has non-empty value |\n| 13 | Promoter Experience | 2 | `businessDetails.promoterExperience` OR `businessDetails.yearsOfExperience` | Has non-empty value |\n| 14 | Source of Business | 2 | `businessDetails.sourceOfBusiness` | Has non-empty value |\n| 15 | Comfortable EMI | 2 | `businessDetails.comfortableEmi` | Has non-empty value |\n\n**Notes:**\n- Each field maps to exactly ONE data source to prevent double counting\n- \"Comfortable EMI\" was moved from Debt section to Business section\n\n---\n\n## Section 3: Banking (Max 15 pts)\n| # | Rubric Parameter | Weight | Data Source Field | Extraction Logic |\n|---|-----------------|--------|-------------------|------------------|\n| 1 | Primary Bank Name | 3 | `bankingDetails.bankName` | Has non-empty value |\n| 2 | Turnover Credit % | 3 | `bankingDetails.turnoverCreditPercent` | Value >= 50% |\n| 3 | Banking Tenure | 3 | `bankingDetails.bankingTenure` | Value >= 12 months |\n| 4 | EMIs Routed | 3 | `bankingDetails.emisRouted` | Has non-empty value |\n| 5 | QR Code Spotted | 3 | `bankingDetails.qrCodeSpotted` | Has non-empty value |\n\n---\n\n## Section 4: Networth (Max 10 pts)\n| # | Rubric Parameter | Weight | Data Source Field | Extraction Logic |\n|---|-----------------|--------|-------------------|------------------|\n| 1 | Properties Owned | 2.5 | `propertyDetails.propertiesOwned` OR `propertyDetails.propertyType` | Count > 0 OR has property type |\n| 2 | Vehicles Owned | 2.5 | `propertyDetails.vehiclesOwned` | Count > 0 |\n| 3 | Other Investments | 2.5 | `propertyDetails.otherInvestments` | Has non-empty value |\n| 4 | Business Place Owned | 2.5 | `businessDetails.businessSetup` | Contains \"own\" |\n\n---\n\n## Section 5: Existing Debt (Max 10 pts)\n| # | Rubric Parameter | Weight | Data Source Field | Extraction Logic |\n|---|-----------------|--------|-------------------|------------------|\n| 1 | Existing Loans Documented | 2.5 | `existingLoans` | Explicitly \"yes\" or \"no\" (NOT null/unknown) |\n| 2 | Loan List Available | 2.5 | `loanList` | Has non-empty value (only if loans exist) |\n| 3 | Repayment Track Good | 2.5 | `repaymentHistory` | Contains \"good\"/\"excellent\"/\"regular\" (only if loans exist) |\n| 4 | Loans Source/Bank | 2.5 | `repaymentHistory` | Has valid repayment track (only if loans exist) |\n\n**Notes:**\n- Items 2, 3, 4 only score when existingLoans = true (has loans)\n- Item 1 scores when status is explicitly documented (yes OR no), NOT when unknown/missing\n- \"Can Service New Loan\" moved to Business section as \"Comfortable EMI\"\n\n---\n\n## Section 6: End Use (Max 10 pts)\n| # | Rubric Parameter | Weight | Data Source Field | Extraction Logic |\n|---|-----------------|--------|-------------------|------------------|\n| 1 | Purpose of Loan | 3 | `endUseDetails.purposeOfLoan` | Has non-empty value |\n| 2 | Agreement Value | 3 | `endUseDetails.agreementValue` | Value > 0 |\n| 3 | Will Occupy/Self Use | 4 | `endUseDetails.endUse` | Contains \"self\" |\n\n---\n\n## Section 7: Reference Checks (Max 10 pts)\n| # | Rubric Parameter | Weight | Data Source Field | Extraction Logic |\n|---|-----------------|--------|-------------------|------------------|\n| 1 | Personal Reference Check | 4 | `referenceChecks.reference1.feedback` | Has value AND not \"Pending\" |\n| 2 | Business Reference Check | 3 | `referenceChecks.reference2.feedback` | Has value AND not \"Pending\" |\n| 3 | Invoice Verified | 3 | `referenceChecks.invoiceVerified` | Has non-empty value |\n\n---\n\n## Summary Table\n\n| Section | Max Points | Items | Weight per Item |\n|---------|-----------|-------|-----------------|\n| Personal | 15 | 10 | 1.5 each |\n| Business | 30 | 15 | 2 each |\n| Banking | 15 | 5 | 3 each |\n| Networth | 10 | 4 | 2.5 each |\n| Existing Debt | 10 | 4 | 2.5 each |\n| End Use | 10 | 3 | 3, 3, 4 |\n| Reference Checks | 10 | 3 | 4, 3, 3 |\n| **TOTAL** | **100** | **44** | - |\n\n---\n\n## Key Principles\n\n1. **No Double Counting**: Each rubric item maps to exactly one unique data source\n2. **Explicit Documentation Required**: Missing/unknown values don't award points\n3. **Deterministic**: Same input always produces the same score\n4. **Mutual Exclusivity**: Some items are mutually exclusive (e.g., owned vs rented)\n\n---\n\n## Form Fields Required for 100% Score\n\nTo achieve a perfect 100-point score, the following fields MUST be populated:\n\n### Personal Details (10 fields)\n- `selfEducation`, `spouseName`, `spouseEducation`, `spouseEmployment`\n- `dependents` (count), `kidsEducation`, `kidsSchool`\n- `residenceVintage`, `residenceType` (owned OR rented with `monthlyRent`)\n\n### Business Details (15 fields)\n- `businessName`, `majorServices`, `businessVintageMonths`, `businessSetup` (with \"license\")\n- `employeeCount`, `monthlyTurnover`, `netMonthlyIncome` (>=50000)\n- `businessProfile`, `surroundingArea`, `seasonality`\n- `clientListConcentrationRisk` OR `majorClients`\n- `strategicVision` OR `growthPlans`\n- `promoterExperience` OR `yearsOfExperience`\n- `sourceOfBusiness`, `comfortableEmi`\n\n### Banking Details (5 fields)\n- `bankName`, `turnoverCreditPercent` (>=50), `bankingTenure` (>=12)\n- `emisRouted`, `qrCodeSpotted`\n\n### Property Details (4 fields)\n- `propertiesOwned` OR `propertyType`, `vehiclesOwned`, `otherInvestments`\n- `businessSetup` containing \"own\" (for businessPlaceOwned)\n\n### Debt Fields (4 fields)\n- `existingLoans` (explicit yes/no)\n- If loans exist: `loanList`, `repaymentHistory` (good/excellent)\n\n### End Use Details (3 fields)\n- `purposeOfLoan`, `agreementValue`, `endUse` (containing \"self\")\n\n### Reference Checks (3 fields)\n- `reference1.feedback` (not \"Pending\")\n- `reference2.feedback` (not \"Pending\")\n- `invoiceVerified`\n","path":null,"size_bytes":8305,"size_tokens":null},"client/src/pages/mis-dashboard.tsx":{"content":"import { useState, useMemo } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport AuditLayout from \"@/components/layout/audit-layout\";\nimport { useAuth } from \"@/lib/auth\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Redirect } from \"wouter\";\nimport { BarChart3, Clock, Award, Users } from \"lucide-react\";\n\ntype Report = {\n  id: string;\n  leadId: string;\n  title: string;\n  associateId: string;\n  date: string;\n  createdAt?: string;\n  status: string;\n  scores: {\n    overall?: number;\n    comprehensive?: number;\n    quality?: number;\n  } | null;\n  tat?: {\n    totalHours?: number;\n  } | null;\n};\n\ntype Associate = {\n  id: string;\n  name: string;\n  username: string;\n};\n\nexport default function MisDashboardPage() {\n  const { user } = useAuth();\n  const currentYear = new Date().getFullYear();\n  const currentMonth = new Date().getMonth() + 1;\n  \n  const [fromMonth, setFromMonth] = useState(currentMonth.toString());\n  const [toMonth, setToMonth] = useState(currentMonth.toString());\n  const [year, setYear] = useState(currentYear.toString());\n\n  if (!user?.isAdmin) {\n    return <Redirect to=\"/\" />;\n  }\n\n  const { data: reports = [] } = useQuery<Report[]>({\n    queryKey: [\"/api/reports\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/reports\");\n      if (!res.ok) return [];\n      return res.json();\n    },\n  });\n\n  const { data: associates = [] } = useQuery<Associate[]>({\n    queryKey: [\"/api/associates\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/associates\");\n      if (!res.ok) return [];\n      return res.json();\n    },\n  });\n\n  const filteredReports = useMemo(() => {\n    return reports.filter((report) => {\n      if (!report.date) return false;\n      const reportDate = new Date(report.date);\n      const reportYear = reportDate.getFullYear();\n      const reportMonth = reportDate.getMonth() + 1;\n      \n      return (\n        reportYear === parseInt(year) &&\n        reportMonth >= parseInt(fromMonth) &&\n        reportMonth <= parseInt(toMonth)\n      );\n    });\n  }, [reports, fromMonth, toMonth, year]);\n\n  const loginData = useMemo(() => {\n    const total = filteredReports.length;\n    const completed = filteredReports.filter(r => r.status === \"Completed\" || r.status === \"Approved\").length;\n    const inProcess = filteredReports.filter(r => r.status === \"In Progress\" || r.status === \"Draft\" || r.status === \"Pending\").length;\n    return { total, completed, inProcess };\n  }, [filteredReports]);\n\n  const tatData = useMemo(() => {\n    const withTat = filteredReports.filter(r => r.tat?.totalHours !== undefined && r.tat?.totalHours !== null);\n    const oneDay = withTat.filter(r => (r.tat?.totalHours ?? 0) <= 24).length;\n    const twoDays = withTat.filter(r => (r.tat?.totalHours ?? 0) > 24 && (r.tat?.totalHours ?? 0) <= 48).length;\n    const threeDaysPlus = withTat.filter(r => (r.tat?.totalHours ?? 0) > 48).length;\n    \n    const avgTat = withTat.length > 0 \n      ? withTat.reduce((sum, r) => sum + (r.tat?.totalHours ?? 0), 0) / withTat.length / 24\n      : 0;\n    \n    return { oneDay, twoDays, threeDaysPlus, avgTat: avgTat.toFixed(1) };\n  }, [filteredReports]);\n\n  const scoreData = useMemo(() => {\n    const withScore = filteredReports.filter(r => r.scores?.comprehensive !== undefined);\n    const range60_70 = withScore.filter(r => (r.scores?.comprehensive || 0) >= 60 && (r.scores?.comprehensive || 0) < 70).length;\n    const range70_80 = withScore.filter(r => (r.scores?.comprehensive || 0) >= 70 && (r.scores?.comprehensive || 0) < 80).length;\n    const range80_90 = withScore.filter(r => (r.scores?.comprehensive || 0) >= 80 && (r.scores?.comprehensive || 0) <= 100).length;\n    const below60 = withScore.filter(r => (r.scores?.comprehensive || 0) < 60).length;\n    \n    const avgScore = withScore.length > 0 \n      ? withScore.reduce((sum, r) => sum + (r.scores?.comprehensive || 0), 0) / withScore.length\n      : 0;\n    \n    return { range60_70, range70_80, range80_90, below60, avgScore: avgScore.toFixed(1) };\n  }, [filteredReports]);\n\n  const associateData = useMemo(() => {\n    const associateMap = new Map<string, { cases: number; totalTat: number; tatCount: number; totalScore: number; scoreCount: number }>();\n    \n    filteredReports.forEach(report => {\n      const current = associateMap.get(report.associateId) || { cases: 0, totalTat: 0, tatCount: 0, totalScore: 0, scoreCount: 0 };\n      current.cases++;\n      \n      if (report.tat?.totalHours !== undefined && report.tat?.totalHours !== null) {\n        current.totalTat += report.tat.totalHours;\n        current.tatCount++;\n      }\n      \n      if (report.scores?.comprehensive !== undefined) {\n        current.totalScore += report.scores.comprehensive;\n        current.scoreCount++;\n      }\n      \n      associateMap.set(report.associateId, current);\n    });\n    \n    return Array.from(associateMap.entries()).map(([associateId, data]) => {\n      const associate = associates.find(a => a.id === associateId);\n      return {\n        id: associateId,\n        name: associate?.name || associateId,\n        casesDone: data.cases,\n        avgTat: data.tatCount > 0 ? (data.totalTat / data.tatCount / 24).toFixed(1) : \"-\",\n        avgScore: data.scoreCount > 0 ? (data.totalScore / data.scoreCount).toFixed(1) : \"-\",\n      };\n    }).sort((a, b) => b.casesDone - a.casesDone);\n  }, [filteredReports, associates]);\n\n  const months = [\n    { value: \"1\", label: \"January\" },\n    { value: \"2\", label: \"February\" },\n    { value: \"3\", label: \"March\" },\n    { value: \"4\", label: \"April\" },\n    { value: \"5\", label: \"May\" },\n    { value: \"6\", label: \"June\" },\n    { value: \"7\", label: \"July\" },\n    { value: \"8\", label: \"August\" },\n    { value: \"9\", label: \"September\" },\n    { value: \"10\", label: \"October\" },\n    { value: \"11\", label: \"November\" },\n    { value: \"12\", label: \"December\" },\n  ];\n\n  const years = Array.from({ length: 5 }, (_, i) => (currentYear - 2 + i).toString());\n\n  return (\n    <AuditLayout>\n      <div className=\"space-y-6\">\n        <div className=\"mb-6\">\n          <h1 className=\"text-2xl font-bold text-slate-900\">MIS Dashboard</h1>\n          <p className=\"text-slate-500\">Management Information System Analytics</p>\n        </div>\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <BarChart3 className=\"h-5 w-5\" />\n              Select Period\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"flex flex-wrap gap-4 items-center\">\n              <div className=\"flex items-center gap-2\">\n                <span className=\"text-sm font-medium\">From:</span>\n                <Select value={fromMonth} onValueChange={setFromMonth}>\n                  <SelectTrigger className=\"w-[140px]\" data-testid=\"select-from-month\">\n                    <SelectValue placeholder=\"Month\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {months.map((m) => (\n                      <SelectItem key={m.value} value={m.value}>{m.label}</SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <span className=\"text-sm font-medium\">To:</span>\n                <Select value={toMonth} onValueChange={setToMonth}>\n                  <SelectTrigger className=\"w-[140px]\" data-testid=\"select-to-month\">\n                    <SelectValue placeholder=\"Month\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {months.map((m) => (\n                      <SelectItem key={m.value} value={m.value}>{m.label}</SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <span className=\"text-sm font-medium\">Year:</span>\n                <Select value={year} onValueChange={setYear}>\n                  <SelectTrigger className=\"w-[100px]\" data-testid=\"select-year\">\n                    <SelectValue placeholder=\"Year\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {years.map((y) => (\n                      <SelectItem key={y} value={y}>{y}</SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Users className=\"h-5 w-5\" />\n              Login Data - Cases\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>Particulars</TableHead>\n                  <TableHead className=\"text-center\">Logged In</TableHead>\n                  <TableHead className=\"text-center\">In Process</TableHead>\n                  <TableHead className=\"text-center\">Completed</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                <TableRow>\n                  <TableCell className=\"font-medium\">Cases</TableCell>\n                  <TableCell className=\"text-center\" data-testid=\"stat-logged-in\">{loginData.total}</TableCell>\n                  <TableCell className=\"text-center\" data-testid=\"stat-in-process\">{loginData.inProcess}</TableCell>\n                  <TableCell className=\"text-center\" data-testid=\"stat-completed\">{loginData.completed}</TableCell>\n                </TableRow>\n              </TableBody>\n            </Table>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Clock className=\"h-5 w-5\" />\n              TAT Data - Cases Wise\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead></TableHead>\n                  <TableHead className=\"text-center\">1 Day</TableHead>\n                  <TableHead className=\"text-center\">2 Days</TableHead>\n                  <TableHead className=\"text-center\">3+ Days</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                <TableRow>\n                  <TableCell className=\"font-medium\">Cases</TableCell>\n                  <TableCell className=\"text-center\" data-testid=\"tat-1day\">{tatData.oneDay}</TableCell>\n                  <TableCell className=\"text-center\" data-testid=\"tat-2days\">{tatData.twoDays}</TableCell>\n                  <TableCell className=\"text-center\" data-testid=\"tat-3days\">{tatData.threeDaysPlus}</TableCell>\n                </TableRow>\n                <TableRow className=\"bg-yellow-50\">\n                  <TableCell className=\"font-medium\">Average TAT for the month</TableCell>\n                  <TableCell colSpan={3} className=\"text-center font-bold\" data-testid=\"avg-tat\">\n                    {tatData.avgTat} days\n                  </TableCell>\n                </TableRow>\n              </TableBody>\n            </Table>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Award className=\"h-5 w-5\" />\n              Comprehensive Score - Quality Data\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead></TableHead>\n                  <TableHead className=\"text-center\">Below 60</TableHead>\n                  <TableHead className=\"text-center\">60-70</TableHead>\n                  <TableHead className=\"text-center\">70-80</TableHead>\n                  <TableHead className=\"text-center\">80-90+</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                <TableRow>\n                  <TableCell className=\"font-medium\">Cases</TableCell>\n                  <TableCell className=\"text-center text-red-600\" data-testid=\"score-below60\">{scoreData.below60}</TableCell>\n                  <TableCell className=\"text-center text-amber-600\" data-testid=\"score-60-70\">{scoreData.range60_70}</TableCell>\n                  <TableCell className=\"text-center text-blue-600\" data-testid=\"score-70-80\">{scoreData.range70_80}</TableCell>\n                  <TableCell className=\"text-center text-emerald-600\" data-testid=\"score-80-90\">{scoreData.range80_90}</TableCell>\n                </TableRow>\n                <TableRow className=\"bg-yellow-50\">\n                  <TableCell className=\"font-medium\">Average Score for the month</TableCell>\n                  <TableCell colSpan={4} className=\"text-center font-bold\" data-testid=\"avg-score\">\n                    {scoreData.avgScore}\n                  </TableCell>\n                </TableRow>\n              </TableBody>\n            </Table>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Users className=\"h-5 w-5\" />\n              Associate Wise Data\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>Associate</TableHead>\n                  <TableHead className=\"text-center\">Cases Done</TableHead>\n                  <TableHead className=\"text-center\">Avg TAT (Days)</TableHead>\n                  <TableHead className=\"text-center\">Avg Score</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {associateData.length === 0 ? (\n                  <TableRow>\n                    <TableCell colSpan={4} className=\"text-center text-muted-foreground py-8\">\n                      No data available for selected period\n                    </TableCell>\n                  </TableRow>\n                ) : (\n                  associateData.map((associate) => (\n                    <TableRow key={associate.id} data-testid={`associate-row-${associate.id}`}>\n                      <TableCell className=\"font-medium\">{associate.name}</TableCell>\n                      <TableCell className=\"text-center\">{associate.casesDone}</TableCell>\n                      <TableCell className=\"text-center\">{associate.avgTat}</TableCell>\n                      <TableCell className=\"text-center\">{associate.avgScore}</TableCell>\n                    </TableRow>\n                  ))\n                )}\n              </TableBody>\n            </Table>\n          </CardContent>\n        </Card>\n      </div>\n    </AuditLayout>\n  );\n}\n","path":null,"size_bytes":15064,"size_tokens":null}},"version":2}